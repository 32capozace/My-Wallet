function _AccountSettings(){function b(l){var k=l.lastIndexOf("@");var j=l.lastIndexOf(".");return(k<j&&k>0&&l.indexOf("@@")==-1&&j>2&&(l.length-j)>2)}function g(j,n,l,m,k){l=$.trim(l);if(l.length==0){MyWallet.makeNotice("error","misc-error",j+": Invalid value");return}if(l.length==0){MyWallet.makeNotice("error",n+"-error",data.responseText);if(k){k()}return}MyWallet.setLoadingText(j);MyWallet.securePost("wallet",{length:(l+"").length,payload:l+"",method:n}).success(function(o){MyWallet.makeNotice("success",n+"-success",o);if(m){m()}}).error(function(o){MyWallet.makeNotice("error",n+"-error",o.responseText);if(k){k()}})}function f(){if(MyWallet.getDoubleEncryption()){$(".double-encryption-off").hide();$(".double-encryption-on").show()}else{$(".double-encryption-on").hide();$(".double-encryption-off").show()}$("#double-password").val("");$("#double-password2").val("")}function i(){$("#password_mnemonic1").find("span").empty();$("#password_mnemonic2").find("span").empty()}function e(){i();var k=$("#password_mnemonic1");var j=$("#password_mnemonic2");loadScript("wallet/mnemonic.js",function(){MyWallet.getMainPassword(function(l){MyWallet.getSecondPassword(function(m){try{k.show().find("span").text(mn_encode_pass(l));if(m){j.show().find("span").text(mn_encode_pass(m))}else{j.hide()}}catch(n){console.log(n);d()}},function(){d()})},function(){d()})})}this.bind=function(){f();c();a()};this.init=function(j,l,k){MyWallet.setLoadingText("Loading Account Settings");if(!j.is(":empty")){AccountSettings.bind();l();return}$.get(root+"wallet/account-settings-template").success(function(m){try{j.html(m);AccountSettings.bind();l()}catch(n){console.log(n);k()}}).error(function(){MyWallet.makeNotice("error","misc-error","Error Downloading Account Settings Template");k()})};function a(){$('a[data-toggle="tab"]').unbind().on("show",function(j){$(j.target.hash).trigger("show")});MyWallet.setLoadingText("Getting Wallet Info");MyWallet.securePost("wallet",{method:"get-info"}).success(function(p){if(p.email!=null){$("#wallet-email").val(p.email);$(".my-email").text(p.email)}$("#wallet-phrase").val(p.phrase);$("#two-factor-select").val(p.auth_type);$(".two-factor").hide();$(".two-factor.t"+p.auth_type).show(200);var q=$("#notifications-type");q.find(":checkbox").prop("checked",false);q.find('[class^="type"]').hide();for(var r in p.notifications_type){var s=p.notifications_type[r];q.find(':checkbox[value="'+s+'"]').prop("checked",true);q.find(".type-"+s).show()}$(".logl").hide();$(".logl.l"+p.logging_level).show();$("#logging-level").val(p.logging_level);$("#notifications-confirmations").val(p.notifications_confirmations);$("#notifications-on").val(p.notifications_on);if(p.alias!=null&&p.alias.length>0){$("#wallet-alias").val(p.alias);$(".alias").text("https://blockchain.info/wallet/"+p.alias);$(".alias").show(200)}var k=$("#local_currency").empty();for(var t in p.currencies){var w=p.currencies[t];k.append('<option value="'+t+'">'+w+"</option>")}k.val(p.currency);var n=$("#language_select").empty();for(var o in p.languages){var v=p.languages[o];n.append('<option value="'+o+'">'+v+"</option>")}n.val(p.language);if(p.auto_email_backup==1){$("#auto-email-backup").prop("checked",true)}else{$("#auto-email-backup").prop("checked",false)}if(p.never_save_auth_type==1){$("#never-save-auth-type").prop("checked",true)}else{$("#never-save-auth-type").prop("checked",false)}if(p.google_secret_url!=null&&p.google_secret_url.length>0){loadScript("wallet/qr.code.creator.js",function(){try{var x=makeQRCode(300,300,1,p.google_secret_url);$("#wallet-google-qr").empty().append(x)}catch(y){MyWallet.makeNotice("error","misc-error",y)}})}$("#wallet-http-url").val(p.http_url);$("#wallet-http-url").val(p.http_url);$("#wallet-skype").val(p.skype_username);$("#wallet-boxcar").val(p.boxcar_email);$("#wallet-yubikey").val(p.yubikey);if(p.password_hint1){$("#password-hint1").val(p.password_hint1)}if(p.password_hint2){$("#password-hint2").val(p.password_hint2)}$("#ip-lock").val(p.ip_lock);$("#my-ip").text(p.my_ip);if(p.ip_lock_on==1){$("#ip-lock-on").prop("checked",true)}else{$("#ip-lock-on").prop("checked",false)}$('input[name="fee-policy"]').each(function(){if(parseInt($(this).val())==MyWallet.getFeePolicy()){$(this).attr("checked",true)}});$('input[name="inactivity-logout-time"]').each(function(){if(parseInt($(this).val())==MyWallet.getLogoutTime()){$(this).attr("checked",true)}});if(p.email_verified==0){$("#verify-email").show();$("#email-verified").hide()}else{$("#verify-email").hide();$("#email-verified").show()}$("#my-ip").text(p.my_ip);var j="1";if(p.sms_number){var m=p.sms_number.split(" ");if(p.sms_number[0]=="+"&&m.length>1){j=m[0].substring(1);$(".wallet-sms").val(m[1])}else{$(".wallet-sms").val(p.sms_number)}}if(p.sms_verified==0){$(".sms-unverified").show();$(".sms-verified").hide()}else{$(".sms-verified").show().trigger("show");$(".sms-unverified").hide()}$.get(resource+"wallet/country_codes.html").success(function(x){$('select[class="wallet-sms-country-codes"]').html(x).val(j)}).error(function(){MyWallet.makeNotice("error","misc-error","Error Downloading SMS Country Codes")});var u=function(B,y,z){try{if(window.webkitNotifications&&navigator.userAgent.indexOf("Chrome")>-1){var x=webkitNotifications.checkPermission();if(x==1&&z){webkitNotifications.requestPermission(u)}else{if(x==0){B()}else{y()}}}else{if(window.Notification){if(Notification.permissionLevel()==="default"&&z){Notification.requestPermission(u)}else{if(window.Notification.permissionLevel()=="granted"){B()}else{y()}}}else{y()}}}catch(A){console.log(A);y()}};var l=$("#html5-notifications-checkbox");l.unbind().change(function(){if($(this).is(":checked")){u(function(){MyWallet.makeNotice("success","misc-success","HTML5 Notifications Enabled");MyWallet.setHTML5Notifications(true);MyWallet.backupWallet()},function(){MyWallet.makeNotice("error","misc-error","Error Enabling HTML5 Notifications");MyWallet.setHTML5Notifications(false);MyWallet.backupWallet()},true)}else{MyWallet.setHTML5Notifications(false);MyWallet.backupWallet()}});if(MyWallet.getHTML5Notifications()){l.attr("checked",true)}else{l.attr("checked",false)}}).error(function(j){MyWallet.makeNotice("error","misc-error",j.responseText)})}function h(){d();var j=$("#update-password-modal");j.modal({keyboard:true,backdrop:"static",show:true});j.center();j.find(".btn.btn-primary").unbind().click(function(){j.modal("hide");var k=$.trim($("#password").val());var l=$.trim($("#password2").val());if(k!=l){MyWallet.makeNotice("error","misc-error","Passwords do not match.");return false}if(k.length==0||k.length<10||k.length>255){MyWallet.makeNotice("error","misc-error","Password length must be between least 10  & 255 characters");return false}MyWallet.setMainPassword(k)});j.find(".btn.btn-secondary").unbind().click(function(){j.modal("hide")})}function d(){$(".accordion-body").collapse("hide")}function c(){var j=$("#notifications-type");j.find(":checkbox").unbind().change(function(){var m=[];j.find(":checkbox:checked").each(function(){m.push($(this).val())});if(!m.length){m.push(0)}g("Updating Notifications Type","update-notifications-type",m.join("|"));j.find(".type-"+$(this).val()).toggle();MyWallet.get_history()});$("input[name=fee-policy]").unbind().change(function(){MyWallet.setFeePolicy($("input[name=fee-policy]:checked").val());MyWallet.backupWallet()});$("input[name=inactivity-logout-time]").unbind().change(function(){MyWallet.setLogoutTime(parseInt($(this).val()));MyWallet.backupWallet()});$("#password_mnemonic").unbind().on("show",function(){e()}).on("hide",function(){i()});$("#pairing_code").unbind().on("show",function(){var m=$("#device-qr-code");m.empty();MyWallet.makePairingQRCode(function(n){m.empty().append(n);setTimeout(function(){m.empty();d()},30000)})});$("#update-password-btn").unbind().click(function(){h()});$("#password-hint1").unbind().change(function(){g("Updating Main Password Hint","update-password-hint1",$(this).val())});$("#password-hint2").unbind().change(function(){g("Updating Second Password Hint","update-password-hint2",$(this).val())});$("#ip-lock-on").unbind().change(function(){g("Updating IP Lock","update-ip-lock-on",$(this).is(":checked"))});$("#ip-lock").unbind().change(function(){g("Updating Locked Ip Addresses","update-ip-lock",$(this).val())});$("#notifications-on").unbind().change(function(){g("Updating Notifications Settings","update-notifications-on",$(this).val())});$("#auto-email-backup").unbind().change(function(){g("Updating Auto Backup Settings","update-auto-email-backup",$(this).is(":checked"))});$("#never-save-auth-type").unbind().change(function(){g("Updating Auth Saving Settings","update-never-save-auth-type",$(this).is(":checked"))});$("#two-factor-select").unbind().change(function(){var m=parseInt($(this).val());g("Updating Two Factor Authentication","update-auth-type",m,function(){if(m==4){a()}MyWallet.updateCacheManifest()});$(".two-factor").hide(200);$(".two-factor.t"+m).show(200)});var k="";$("#wallet-email-send").click(function(){k="";$("#wallet-email").trigger("change")});$("#wallet-email").unbind().change(function(n){var m=$.trim($(this).val());if(m.length==0){return}if(k==m){return}if(!b(m)){MyWallet.makeNotice("error","misc-error","Email address is not valid");return}g("Updating Email","update-email",m,function(){k=m},function(){k=""});k=m;$("#verify-email").show(200);$("#email-verified").hide()});$("#wallet-double-encryption-enable").unbind().click(function(m){d();MyWallet.setDoubleEncryption(true)});$("#wallet-double-encryption-disable").unbind().click(function(m){d();MyWallet.setDoubleEncryption(false)});$("#wallet-email-code").unbind().change(function(n){var m=$.trim($(this).val());if(m.length==0||m.length>255){MyWallet.makeNotice("error","misc-error","You must enter a code to verify");return}MyWallet.setLoadingText("Verifying Email");MyWallet.securePost("wallet",{payload:m,length:m.length,method:"verify-email"}).success(function(o){MyWallet.makeNotice("success","misc-success",o);$("#verify-email").hide();$("#email-verified").show(200)}).error(function(o){MyWallet.makeNotice("error","misc-error",o.responseText);$("#verify-email").show(200);$("#email-verified").hide()})});$(".wallet-sms-code").unbind().change(function(n){var m=$.trim($(this).val());if(m.length==0||m.length>255){MyWallet.makeNotice("error","misc-error","You must enter an SMS code to verify");return}MyWallet.setLoadingText("Verifying SMS Code");MyWallet.securePost("wallet",{payload:m,length:m.length,method:"verify-sms"}).success(function(o){MyWallet.makeNotice("success","misc-success",o);$(".sms-unverified").hide();$(".sms-verified").show(200).trigger("show")}).error(function(o){MyWallet.makeNotice("error","misc-error",o.responseText);$(".sms-verified").hide();$(".sms-unverified").show(200)})});var l="";$(".send-code").unbind().click(function(){l="";$(this).parent().find(".wallet-sms").trigger("change")});$('select[class="wallet-sms-country-codes"]').unbind().change(function(){l="";$(".wallet-sms").trigger("change")});$(".wallet-sms").unbind().change(function(){var m=$.trim($(this).val());if(m==null||m.length==0){return}if(m.charAt(0)!="+"){m="+"+$(".wallet-sms-country-codes").val()+m}if(l==m){return}l=m;g("Updating Cell Number","update-sms",m,function(){$(".sms-unverified").show(200);$(".sms-verified").hide()})});$("#run-key-check").unbind().click(function(){MyWallet.getSecondPassword(function(){try{MyWallet.checkAllKeys(true);MyWallet.backupWallet()}catch(m){MyWallet.makeNotice("error","misc-error",m)}})});$("#local_currency").unbind().change(function(){if(symbol!=symbol_local){toggleSymbol()}g("Updating Local Currency","update-country",$(this).val(),function(){MyWallet.get_history()})});$("#language_select").unbind().change(function(){g("Updating Language","update-language",$(this).val(),function(){MyWallet.updateCacheManifest(function(){window.location.reload()})})});$("#notifications-confirmations").unbind().change(function(m){g("Updating Notification Confirmations","update-notifications-confirmations",$(this).val())});$("#account-logging").unbind().on("show",function(){var n=$(this).find("table").hide();var m=n.find("tbody");MyWallet.securePost("wallet",{method:"list-logs"}).success(function(s){try{n.show();m.empty();if(s==null){throw"Failed to get backups"}var q=s.results;if(q.length==0){throw"No logs found"}for(var p in q){var o=q[p];m.append('<tr><td style="width:130px">'+dateToString(new Date(o.time))+'</td><td style="width:170px">'+o.action+'</td><td style="text-overflow: ellipsis;max-width:100px;overflow: hidden;">'+o.ip_address+"</td><td>"+o.user_agent+"</td></tr>")}}catch(r){MyWallet.makeNotice("error","misc-error",r)}}).error(function(o){MyWallet.makeNotice("error","misc-error",o.responseText)})});$("#logging-level").unbind().change(function(m){$(".logl").hide();$(".logl.l"+$(this).val()).show();g("Updating Logging Level","update-logging-level",$(this).val(),function(){$("#account-logging").trigger("show")})});$("#wallet-yubikey").unbind().change(function(m){g("Updating Yubikey","update-yubikey",$(this).val())});$("#wallet-skype").unbind().change(function(m){g("Updating Skype Username","update-skype",$(this).val())});$("#wallet-boxcar").unbind().change(function(m){g("Updating Boxcar Email","update-boxcar",$(this).val())});$("#wallet-http-url").unbind().change(function(m){g("Updating HTTP url","update-http-url",$(this).val())});$("#wallet-phrase").unbind().change(function(n){var m=$.trim($(this).val());if(m==null||m.length==0||m.length>255){MyWallet.makeNotice("error","misc-error","You must enter a secret phrase");return}g("Updating Secret Phrase","update-phrase",m)});$("#wallet-alias").unbind().change(function(p){var o=$(this);var m=$.trim(o.val());o.val(o.val().replace(/[\.,\/ #!$%\^&\*;:{}=`~()]/g,""));var n=$.trim(o.val());if(n.length>0){$(".alias").fadeIn(200);$(".alias").text("https://blockchain.info/wallet/"+n)}g("Updating Alias","update-alias",n,null,function(){o.val(m)})})}}var AccountSettings=new _AccountSettings();