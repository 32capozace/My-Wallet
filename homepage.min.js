var noFocus=0;var ws;var retry=0;function updateTimes(){document.hasFocus?noFocus=0:++noFocus;if(noFocus>120&&ws){ws.close();ws=null}var a=new Date().getTime()/1000;$("td[data-time]").each(function(b){var d=a-$(this).attr("data-time");if(d<60){$(this).text("< 1 minute")}else{if(d<3600){var c=(parseInt(d/60)>1)?"s":"";$(this).text(parseInt(d/60)+" minute"+c)}else{var c=(parseInt(d/3600)>1)?"s":"";$(this).text(parseInt(d/3600)+" hour"+c+" "+parseInt((d%3600)/60)+" minutes")}}})}function connect(){try{ws=new WebSocket("ws://api.blockchain.info:8335/inv");ws.onmessage=function(d){var c=$.parseJSON(d.data);if(c.op=="minitx"){var b=c.x;$("#txs tr:first").after('<tr><td><a href="${root}tx-index/'+b.txIndex+"/"+b.hash+'">'+b.hash.substring(0,25)+'...</a></td><td data-time="'+b.time+'">< 1 minute</td><td><button class="btn success cb" onclick="toggleSymbol()">'+formatMoney(b.value)+"</button></td></tr>");$("#txs tr:last-child").remove()}else{if(c.op=="block"){console.log("on block");var f=BlockFromJSON(c.x);$("#blocks tr:first").after('<tr><td><a href="${root}/block-index/'+f.blockIndex+"/"+f.hash+'">'+f.height+'</a></td><td data-time="'+f.time+'">< 1 minute</td><td>'+f.txIndex.length+"</td><td>"+formatMoney(f.outputValue)+'<td><a href="'+f.foundByLink+'">'+f.foundByDescription+"</a></td><td>"+f.size+"</td></tr>");$("#blocks tr:last-child").remove()}}};ws.onopen=function(){retry=0;ws.send('{"op":"set_tx_mini"}{"op":"unconfirmed_sub"}{"op":"blocks_sub"}')};ws.onclose=function(){console.log("On close");if(document.hasFocus&&retry<3){connect();++retry}}}catch(a){console.log(a)}}$(document).ready(function(){setInterval(updateTimes,1000);connect()});