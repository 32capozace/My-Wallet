function precisionToSatoshiBN(a){return Bitcoin.Util.parseValue(a).divide(BigInteger.valueOf(Math.pow(10,sShift(symbol_btc)).toString()))}function precisionToBTC(a){return Bitcoin.Util.formatValue(precisionToSatoshiBN(a))}function precisionFromSatoshi(a){return Bitcoin.Util.formatValue(a.multiply(BigInteger.valueOf(Math.pow(10,sShift(symbol_btc)))))}function precisionFromBTC(a){return precisionFromSatoshi(Bitcoin.Util.parseValue(a))}function formatPrecision(a){return formatBTC(precisionToSatoshiBN(a).toString())}var MyWallet=new function(){var i=this;this.skip_init=false;var F="abcaa314-6f67-6705-b384-5d47fbe9d7cc";var am;var P;var k;var aM;var ao;var x;var e;var aC=0;var V=0;var aw=0;var N=0;var aW=0;var aK;var h={};var G=[];var H=false;var aA=0;var av=0;var aF=1000;var L={};var aD;var aq;var y=0.5;var J=true;var ak=10;var R=ak;var c={};var r;var aR=0;var X;var ac=[];var D;var Q=60000;var C=false;var ad;var aa="en";var at=2;var S=0;var aO=0;var ab=false;var aH;var au=false;var W=false;var az=false;var A=false;var t={pbkdf2_iterations:ak,fee_policy:0,html5_notifications:false,logout_time:600000,tx_display:0,always_keep_local_backup:false,transactions_per_page:30,additional_seeds:[]};this.setEncryptedWalletData=function(aY){if(!aY||aY.length==0){am=null;aD=null;return}am=aY;aD=al();try{if(aR==0||t.always_keep_local_backup){MyStore.put("payload",am)}else{MyStore.remove("payload")}}catch(aZ){console.log(aZ)}};this.setRealAuthType=function(aY){aR=aY};this.addAdditionalSeeds=function(aY){t.additional_seeds.push(aY)};this.getAdditionalSeeds=function(aY){return t.additional_seeds};this.getLanguage=function(){return aa};this.setLanguage=function(aY){MyStore.put("language",aY);aa=aY};this.addEventListener=function(aY){ac.push(aY)};this.sendEvent=function(a0,aZ){for(var aY in ac){ac[aY](a0,aZ)}};this.getLogoutTime=function(){return t.logout_time};this.getSecondPasswordPbkdf2Iterations=function(){return t.pbkdf2_iterations};this.getMainPasswordPbkdf2Iterations=function(){return R};this.getDefaultPbkdf2Iterations=function(){return ak};this.getSharedKey=function(){return e};this.getSharedcoinEndpoint=function(){return aH};this.disableLogout=function(aY){au=aY};this.getFinalBalance=function(){return aC};this.getTotalSent=function(){return V};this.getTotalReceived=function(){return aw};this.setLogoutTime=function(aY){t.logout_time=aY;clearInterval(X);X=setTimeout(i.logout,i.getLogoutTime())};this.getDoubleEncryption=function(){return H};this.getEncryptedWalletData=function(){return am};this.getFeePolicy=function(){return t.fee_policy};this.setFeePolicy=function(aY){t.fee_policy=parseInt(aY)};this.setAlwaysKeepLocalBackup=function(aY){t.always_keep_local_backup=aY};this.getAlwaysKeepLocalBackup=function(){return t.always_keep_local_backup};this.setNTransactionsPerPage=function(aY){t.transactions_per_page=aY};this.getNTransactionsPerPage=function(){return t.transactions_per_page};this.getGuid=function(){return P};this.getHTML5Notifications=function(){return t.html5_notifications};this.setHTML5Notifications=function(aY){t.html5_notifications=aY};this.getNTransactions=function(){return N};this.getTransactions=function(){return G};this.addressExists=function(aY){return L[aY]!=null};this.getAddressTag=function(aY){return L[aY].tag};this.setAddressTag=function(aZ,aY){L[aZ].tag=aY};this.getAddressBook=function(){return h};this.getAddressLabel=function(aY){if(L[aY]){return L[aY].label}else{return null}};this.setAddressLabel=function(aY,aZ){L[aY].label=aZ};this.setAddressBalance=function(aY,aZ){L[aY].balance=aZ};this.getAddressBookLabel=function(aY){return h[aY]};this.isWatchOnly=function(aY){return !L[aY]||L[aY].priv==null};this.getAddressBalance=function(aY){return L[aY].balance};this.getMixerFee=function(){return y};this.getRecommendIncludeFee=function(){return J};this.deleteAddress=function(aY){delete L[aY]};this.addAddressBookEntry=function(aZ,aY){h[aZ]=aY};this.getPrivateKey=function(aY){return L[aY].priv};this.setLabel=function(aY,aZ){L[aY].label=aZ;i.backupWalletDelayed();d()};this.securePost=function(aY,a1,a8,a5){var a4=jQuery.extend({},a1);if(!a1.sharedKey){if(!e||e.length==0||e.length!=36){throw"Shared key is invalid"}var aZ=new Date().getTime();var a3=parseInt((aZ-aO)/10000);var a2=Crypto.SHA256(e.toLowerCase()+a3);var a0=0;var a7=a2.substring(a0,a0+=8)+"-"+a2.substring(a0,a0+=4)+"-"+a2.substring(a0,a0+=4)+"-"+a2.substring(a0,a0+=4)+"-"+a2.substring(a0,a0+=12);a4.sharedKey=a7;a4.sKTimestamp=a3;a4.sKDebugHexHash=a2;a4.sKDebugTimeOffset=aO;a4.sKDebugOriginalClientTime=aZ;a4.sKDebugOriginalSharedKey=e}if(!a1.guid){a4.guid=P}a4.format=a1.format?a1.format:"plain";var a6="text";if(a1.format=="json"){a6="json"}$.ajax({dataType:a6,type:"POST",timeout:60000,url:root+aY,data:a4,success:a8,error:a5})};this.isCorrectMainPassword=function(aY){return aM==aY};function ah(aZ,a1){var aY=Crypto.SHA256(aZ,{asBytes:true});for(var a0=1;a0<a1;++a0){aY=Crypto.SHA256(aY,{asBytes:true})}return Crypto.util.bytesToHex(aY)}this.setPbkdf2Iterations=function(aY,a0){var aZ=function(a1){console.log("Panic "+a1);window.location.reload()};i.getSecondPassword(function(){try{if(H){for(var a1 in L){var a3=L[a1];if(a3.priv){a3.priv=i.encrypt(i.decryptPK(a3.priv),e+ao,aY);if(!a3.priv){throw"addr.priv is null"}}}t.pbkdf2_iterations=aY;x=ah(e+ao,aY)}S=2;R=aY;i.backupWallet("update",function(){a0()},function(){aZ(a2)})}catch(a2){aZ(a2)}},function(a1){aZ(a1)})};this.setDoubleEncryption=function(a0,aY,a2){var aZ=function(a3){console.log("Panic "+a3);window.location.reload()};try{if(H==a0){return}if(a0){i.getSecondPassword(function(){try{H=true;ao=aY;for(var a3 in L){var a5=L[a3];if(a5.priv){a5.priv=j(B58.decode(a5.priv));if(!a5.priv){throw"addr.priv is null"}}}x=ah(e+ao,t.pbkdf2_iterations);ao=null;i.getSecondPassword(function(){try{i.checkAllKeys();i.backupWallet("update",function(){a2()},function(){aZ(a6)})}catch(a6){aZ(a6)}},function(a6){aZ(a6)})}catch(a4){aZ(a4)}},function(a3){aZ(a3)})}else{i.getSecondPassword(function(){try{for(var a3 in L){var a5=L[a3];if(a5.priv){a5.priv=i.decryptPK(a5.priv);if(!a5.priv){throw"addr.priv is null"}}}H=false;ao=null;i.checkAllKeys();i.backupWallet("update",function(){a2()},function(){aZ(a4)})}catch(a4){aZ(a4)}},function(a3){aZ(a3)})}}catch(a1){aZ(a1)}};this.unArchiveAddr=function(aY){var aY=L[aY];if(aY.tag==2){aY.tag=null;d();i.backupWalletDelayed("update",function(){i.get_history()})}else{i.makeNotice("error","add-error","Cannot Unarchive This Address")}};this.archiveAddr=function(aY){if(i.getActiveAddresses().length<=1){i.makeNotice("error","add-error","You must leave at least one active address");return}var aY=L[aY];if(aY.tag==null||aY.tag==0){aY.tag=2;d();i.backupWalletDelayed("update",function(){i.get_history()})}else{i.makeNotice("error","add-error","Cannot Archive This Address")}};this.addWatchOnlyAddress=function(aY){return aU(aY)};this.addPrivateKey=function(aY,a0){if(an()){return false}if(aY==null){throw"Cannot add null key."}if(a0==null){a0={}}var a3=a0.compressed?aY.getBitcoinAddressCompressed().toString():aY.getBitcoinAddress().toString();var a2=j(aY.priv);if(a2==null){throw"Error Encoding key"}var aZ=new Bitcoin.ECKey(i.decodePK(a2));if(a3!=aZ.getBitcoinAddress().toString()&&a3!=aZ.getBitcoinAddressCompressed().toString()){throw"Decoded Key address does not match generated address"}if(aU(a3,a2)){L[a3].tag=1;L[a3].created_time=a0.created_time?a0.created_time:0;L[a3].created_device_name=a0.app_name?a0.app_name:APP_NAME;L[a3].created_device_version=a0.app_version?a0.app_version:APP_VERSION;if(L[a3].priv!=a2){throw"Address priv does not match encoded"}try{ws.send('{"op":"addr_sub", "addr":"'+a3+'"}')}catch(a1){}}else{throw"Unable to add generated private key."}return a3};this._seed=function(a0){rng_seed_time();if(aM||a0){var aY=Crypto.util.bytesToWords(Crypto.SHA256(aM?aM:a0,{asBytes:true}));for(var aZ in aY){rng_seed_int(aY[aZ])}}if(!ad){ad=$("body").data("extra-seed")}if(ad){var aY=Crypto.util.bytesToWords(Crypto.util.hexToBytes(ad));for(var aZ in aY){rng_seed_int(aY[aZ])}}};this.generateNewKey=function(aZ){i._seed(aZ);var aY=new Bitcoin.ECKey(false);if(i.addPrivateKey(aY)){return aY}};this.setLoadingText=function(aY){$(".loading-text").text(aY)};function O(){try{$(".popover").remove()}catch(aY){}}$(window).resize(function(){$(".modal:visible").center();O()});function aT(aZ,aY){aZ.click(function(){B(aY.txIndex,aY.result)});aZ.find(".show-note").unbind("mouseover").mouseover(function(){var a0=aY.note?aY.note:c[aY.hash];aN(this,a0,aY.hash)});aZ.find(".add-note").unbind("mouseover").mouseover(function(){n(this,aY.hash)});return aZ}function u(aZ,a5){var aY=0;for(var a1=0;a1<aZ.inputs.length;++a1){var a0=aZ.inputs[a1].prev_out;if(!a0||!a0.addr){continue}var a4=L[a0.addr];if(a4){var a3=parseInt(a0.value);aY-=a3;if(a5){V+=a3;a4.balance-=a3}}}for(var a2=0;a2<aZ.out.length;++a2){var a0=aZ.out[a2];if(!a0||!a0.addr){continue}var a4=L[a0.addr];if(a4){var a3=parseInt(a0.value);aY+=a3;if(a5){aw+=a3;a4.balance+=a3}}}return aY}function al(){return Crypto.util.bytesToHex(Crypto.SHA256(am,{asBytes:true}))}function z(aY){var aZ=null;aY.onmessage=function(a6){try{var a3=$.parseJSON(a6.data);if(a3.op=="on_change"){var a7=al();var a5=a3.checksum;console.log("On change old "+a7+" ==  new "+a5);if(aZ!=a5&&a7!=a5){aZ=a5;M()}}else{if(a3.op=="utx"){var a4=TransactionFromJSON(a3.x);for(var a9 in G){if(G[a9].txIndex==a4.txIndex){return}}var bb=u(a4,true);if(i.getHTML5Notifications()){i.showNotification({title:bb>0?"Payment Received":"Payment Sent",body:"Transaction Value "+formatBTC(bb),iconUrl:resource+"cube48.png"})}a4.result=bb;aC+=bb;N++;a4.setConfirmations(0);playSound("beep");if(av==0&&aA==0){G.unshift(a4);var a8=false;if(G.length>i.getNTransactionsPerPage()){G.pop();a8=true}}i.sendEvent("on_tx");var a1=Y();if("my-transactions"==a1){if(av==0&&aA==0){$("#no-transactions").hide();if(t.tx_display==0){var a0=$("#transactions-compact").show();aT($(E(a4,L,h)),a4).prependTo(a0.find("tbody")).find("div").hide().slideDown("slow");if(a8){a0.find("tbody tr:last-child").remove()}}else{var a0=$("#transactions-detailed").show();a0.prepend(a4.getHTML(L,h));if(a8){a0.find("div:last-child").remove()}setupSymbolToggle()}}}else{d()}}else{if(a3.op=="block"){for(var a2=0;a2<a3.x.txIndexes.length;++a2){for(var ba=0;ba<G.length;++ba){if(G[ba].txIndex==a3.x.txIndexes[a2]){if(G[ba].blockHeight==null||G[ba].blockHeight==0){G[ba].blockHeight=a3.x.height;break}}}}aB(BlockFromJSON(a3.x));i.sendEvent("on_block");Z()}}}}catch(a6){console.log(a6);console.log(a6.data)}};aY.onopen=function(){i.sendEvent("ws_on_open");ax("ok");var a3='{"op":"blocks_sub"}';if(P!=null){a3+='{"op":"wallet_sub","guid":"'+P+'"}'}try{var a1=i.getActiveAddresses();for(var a0 in a1){a3+='{"op":"addr_sub", "addr":"'+a1[a0]+'"}'}}catch(a2){alert(a2)}aY.send(a3)};aY.onclose=function(){i.sendEvent("ws_on_close");ax("error")}}var aS="ok";function ax(aZ){var aY=$("#logout");if(aZ=="loading_start"){aY.attr("src",resource+"logout-orange.png");return}else{if(aZ!="loading_stop"){aS=aZ}}if(aS=="ok"){aY.attr("src",resource+"logout.png")}else{if(aS=="error"){aY.attr("src",resource+"logout-red.png")}}}this.showNotification=function(aY,aZ){try{var a1;if(window.webkitNotifications&&webkitNotifications.checkPermission()==0){a1=webkitNotifications.createNotification(aY.iconUrl,aY.title,aY.body);a1.show()}else{if(window.Notification&&window.Notification.permissionLevel()=="granted"){a1=new window.Notification(aY.title,aY).show()}}if(a1){setTimeout(function(){a1.cancel()},aZ?aZ:5000)}}catch(a0){}};this.makeNotice=function(aZ,a2,a1,a0){if(a1==null||a1.length==0){return}console.log(a1);var aY=$('<div class="alert alert-block alert-'+aZ+'"></div>');aY.text(""+a1);if($("#"+a2).length>0){aY.attr("id",a2);return}$("#notices").append(aY).hide().fadeIn(200);(function(){var a3=aY;setTimeout(function(){a3.fadeOut(250,function(){$(this).remove()})},a0?a0:5000)})()};this.pkBytesToSipa=function(aY,a2){var aZ=new Bitcoin.ECKey(aY);while(aY.length<32){aY.unshift(0)}aY.unshift(128);if(aZ.getBitcoinAddress().toString()==a2){}else{if(aZ.getBitcoinAddressCompressed().toString()==a2){aY.push(1)}else{throw"Private Key does not match bitcoin address"+a2}}var a0=Crypto.SHA256(Crypto.SHA256(aY,{asBytes:true}),{asBytes:true});aY=aY.concat(a0.slice(0,4));var a1=B58.encode(aY);return a1};function aJ(aY){return aY}function ay(aY){return i.decryptPK(aY)}function af(aY){var aZ=i.decodePK(aY);return Crypto.util.bytesToBase64(aZ)}function l(aY){var aZ=i.decodePK(aY);return Crypto.util.bytesToHex(aZ)}this.base58ToSipa=function(aY,aZ){return i.pkBytesToSipa(i.decodePK(aY),aZ)};this.makeWalletJSON=function(aY){return i.makeCustomWalletJSON(aY,P,e)};this.makeCustomWalletJSON=function(a3,aZ,a5){var a2=aJ;if(a3=="base64"){a2=af}else{if(a3=="hex"){a2=l}else{if(a3=="sipa"){a2=i.base58ToSipa}else{if(a3=="base58"){a2=ay}}}}var aY='{\n	"guid" : "'+aZ+'",\n	"sharedKey" : "'+a5+'",\n';if(H&&x!=null&&a2==aJ){aY+='	"double_encryption" : '+H+',\n	"dpasswordhash" : "'+x+'",\n'}if(t){aY+='	"options" : '+JSON.stringify(t)+",\n"}aY+='	"keys" : [\n';for(var a1 in L){var a4=$.extend({},L[a1]);if(a4.tag==1){delete a4.tag}if(a4.priv!=null){a4.priv=a2(a4.priv,a4.addr)}for(var a0 in a4){if(a4[a0]===null||a4[a0]===undefined){delete a4[a0]}}delete a4.balance;aY+=JSON.stringify(a4)+",\n";atLeastOne=true}if(atLeastOne){aY=aY.substring(0,aY.length-2)}aY+="\n	]";if(aI(h)>0){aY+=',\n	"address_book" : [\n';for(var a1 in h){aY+='	{"addr" : "'+a1+'",\n';aY+='	 "label" : "'+h[a1]+'"},\n'}aY=aY.substring(0,aY.length-2);aY+="\n	]"}if(aI(c)>0){aY+=',\n	"tx_notes" : '+JSON.stringify(c)}aY+="\n}";return aY};this.get_history=function(aZ,aY){BlockchainAPI.get_history(function(a0){K(a0,false);if(G.length==0&&aA>0){i.setPage(0)}else{d()}if(aZ){aZ()}},function(){if(aY){aY()}},av,aA*i.getNTransactionsPerPage(),i.getNTransactionsPerPage())};this.deleteAddressBook=function(aY){delete h[aY];i.backupWalletDelayed();$("#send-coins").find(".tab-pane").trigger("show",true)};function v(aY){$("#send-coins").find(".tab-pane.active").trigger("show",aY);if(aY){BlockchainAPI.get_ticker();$(".send").prop("disabled",false)}}function m(aY,aZ,a3){var a2=aY.val();aY.empty();for(var a1 in L){var a4=L[a1];if(!a4||a4.tag==2){continue}var a0=a4.label;if(!a0){a0=a4.addr.substring(0,15)+"..."}if(aZ||a4.balance>0){aY.prepend('<option value="'+a4.addr+'">'+a0+" - "+formatBTC(a4.balance)+"</option>")}}aY.prepend('<option value="any" selected>Any Address</option>');if(!a3&&a2){aY.val(a2)}}function s(a0,a1){m(a0.find('select[name="from"]'),false,a1);m(a0.find('select[name="change"]'),true,a1);a0.find('select[name="change"]').prepend('<option value="new">New Address</option>');a0.find(".local-symbol").text(symbol_local.symbol);a0.find(".btc-symbol").text(symbol_btc.symbol);if(a1){a0.find("input").val("");a0.find(".send-value-usd").text(formatSymbol(0,symbol_local)).val("");a0.find(".amount-needed").text(0)}var aZ=a0.find(".recipient-container");if(a1){var a3=aZ.find(".recipient:first-child").clone();aZ.empty().append(a3)}function aY(){var a4=BigInteger.ZERO;a0.find(".send-value").each(function(){a4=a4.add(precisionToSatoshiBN($(this).val()))});return a4}function a2(a4){a4.find('input[name="send-to-address"]').typeahead({source:aE()}).next().unbind().click(function(){var a5=$(this).prev();i.scanQRCode(function(a6){console.log(a6);try{new Bitcoin.Address(a6);a5.val(a6)}catch(a7){i.handleURI(a6,a4)}},function(a6){i.makeNotice("error","misc-error",a6)})});a4.find(".send-value").unbind().bind("keyup change",function(a5){if(a5.keyCode=="9"){return}a0.find(".amount-needed").text(formatBTC(aY().toString()));a4.find(".send-value-usd").val(convert($(this).val()*symbol_btc.conversion,symbol_local.conversion)).text(formatSymbol($(this).val()*symbol_btc.conversion,symbol_local))});a4.find(".send-value-usd").text(formatSymbol(0,symbol_local)).unbind().bind("keyup change",function(a5){if(a5.keyCode=="9"){return}a4.find(".send-value").val(formatSatoshi(parseFloat($(this).val())*symbol_local.conversion,sShift(symbol_btc),true))})}aZ.find(".recipient").each(function(){a2($(this))});a0.find(".remove-recipient").unbind().click(function(){var a4=aZ.find(".recipient").length;if(a4>1){if(a4==2){$(this).hide(200)}aZ.find(".recipient:last-child").remove()}});a0.find(".add-recipient").unbind().click(function(){var a4=aZ.find(".recipient:first-child").clone();a4.find('input[type="text"]').val("");a4.appendTo(aZ);a2(a4);a0.find(".remove-recipient").show(200)});a0.find('select[name="from"]').unbind().change(function(){var a6=0;var a4=$(this).val();for(var a5 in a4){if(a4[a5]=="any"){$(this).val("any");a6=aC;break}else{var a7=L[a4[a5]];if(a7&&a7.balance){a6+=a7.balance}}}a0.find(".amount-available").text(formatBTC(a6))}).trigger("change")}this.getAllAddresses=function(){var aZ=[];for(var aY in L){aZ.push(aY)}return aZ};this.getPreferredAddress=function(){var aZ=null;for(var aY in L){var a0=L[aY];if(aZ==null){aZ=a0}if(a0.priv!=null){if(aZ==null){aZ=a0}if(a0.tag==null||a0.tag==0){aZ=a0;break}}}return aZ.addr};function aV(){var aY=$("#restore-backup-modal");aY.modal({keyboard:true,backdrop:"static",show:true});aY.find(".btn.btn-secondary").unbind().click(function(){aY.modal("hide")})}this.scanQRCode=function(a0,aY){var aZ=$("#qr-code-reader-modal");aZ.modal({keyboard:false,backdrop:"static",show:true});loadScript("wallet/qr.code.reader",function(){QRCodeReader.init(aZ,function(a1){QRCodeReader.stop();aZ.modal("hide");a0(a1)},function(a1){aZ.modal("hide");aY(a1)})},aY);aZ.find(".btn.btn-secondary").unbind().click(function(){QRCodeReader.stop();aZ.modal("hide");aY()})};this.getActiveAddresses=function(){var a0=[];for(var aY in L){var aZ=L[aY];if(aZ.tag!=2){a0.push(aZ.addr)}}return a0};this.getArchivedAddresses=function(){var a0=[];for(var aY in L){var aZ=L[aY];if(aZ.tag==2){a0.push(aZ.addr)}}return a0};this.getLatestBlock=function(){return aK};function aB(a1){if(a1!=null){aK=a1;for(var aZ in G){var aY=G[aZ];if(aY.blockHeight!=null&&aY.blockHeight>0){var a0=aK.height-aY.blockHeight+1;if(a0<=100){aY.setConfirmations(aK.height-aY.blockHeight+1)}else{aY.setConfirmations(null)}}else{aY.setConfirmations(0)}}i.sendEvent("did_set_latest_block")}}function B(aZ,aY){loadScript("wallet/frame-modal",function(){showFrameModal({title:"Transaction Summary",description:"",src:root+"tx-summary/"+aZ+"?result="+aY+"&symbol_btc="+symbol_btc.code+"&symbol_local="+symbol_local.code})})}this.deleteNote=function(aY){delete c[aY];d();i.backupWalletDelayed()};function ai(aY){return/^[\w\-,._  ]+$/.test(aY)}function n(aY,aZ){(function(a1,a3){a1=$(a1);try{a1.data("popover").tip().remove();a1.removeData("popover")}catch(a4){}console.log("addNotePopover()");a1.popover({title:'Add Note <span style="float:right"><i class="icon-remove-sign"></i></span>',trigger:"manual",content:'<textarea style="width:97%;height:50px;margin-top:2px" placeholder="Enter the note here..."></textarea><div style="text-align:right"><button class="btn btn-small">Save</button></div>'});a1.popover("show");a1.unbind("mouseleave").mouseleave(function(){if(!a1.__timeout){a1.__timeout=setTimeout(function(){a1.popover("hide")},250)}});function a0(){if(a1.__timeout){clearTimeout(a1.__timeout);a1.__timeout=null}}var a2=a1.data("popover").tip().mouseenter(a0);a2.find("textarea").focus(a0);a2.mouseleave(function(){a1.__timeout=setTimeout(function(){a1.popover("hide")},250)});a2.find("i").unbind().click(function(){a1.popover("hide")});a2.find("button").click(function(){var a5=$.trim(a2.find("textarea").val());if(!ai(a5)){i.makeNotice("error","misc-error","Note must be contain letters and numbers only");return}if(a5.length>0){c[a3]=a5;i.backupWalletDelayed()}d()})})(aY,aZ)}function aN(aY,aZ,a0){(function(a1,a2,a4){a1=$(a1);try{a1.data("popover").tip().remove();a1.removeData("popover")}catch(a5){}var a6="Note";if(c[a4]){a6+=' <span style="float:right"><img src="'+resource+'delete.png" /></span>'}a1.popover({title:a6,trigger:"manual",content:a2});a1.popover("show");a1.unbind("mouseleave").mouseleave(function(){if(!a1.__timeout){a1.__timeout=setTimeout(function(){a1.popover("hide")},250)}});var a3=a1.data("popover").tip().mouseenter(function(){if(a1.__timeout){clearTimeout(a1.__timeout);a1.__timeout=null}});a3.find("img").unbind().click(function(){i.deleteNote(a4)});a3.mouseleave(function(){a1.__timeout=setTimeout(function(){a1.popover("hide")},250)})})(aY,aZ,a0)}function E(a1,a6,a3){var a7=a1.result;var a2='<tr class="pointer" id="tx-'+a1.txIndex+'"><td class="hidden-phone" style="width:365px"><div><ul style="margin-left:0px;" class="short-addr">';var aZ=true;if(a7>=0){for(var a0=0;a0<a1.inputs.length;++a0){var aY=a1.inputs[a0].prev_out;if(!aY||!aY.addr){aZ=false;a2+='<span class="label">Newly Generated Coins</span>'}else{var a4=a6[aY.addr];if(a4){continue}aZ=false;a2+=formatOutput(aY,a6,a3)}}}else{if(a7<0){for(var a0=0;a0<a1.out.length;++a0){var aY=a1.out[a0];var a4=a6[aY.addr];if(a4&&aY.type==0){continue}aZ=false;a2+=formatOutput(aY,a6,a3)}}}if(aZ){a2+='<span class="label">Moved Between Wallet</info>'}a2+="</ul></div></td><td><div>";var a5=a1.note?a1.note:c[a1.hash];if(a5){a2+='<img src="'+resource+'note.png" class="show-note"> '}else{a2+='<img src="'+resource+'note_grey.png" class="add-note"> '}if(a1.time>0){a2+=dateToString(new Date(a1.time*1000))}if(a1.confirmations==0){a2+=' <span class="label label-important hidden-phone">Unconfirmed Transaction!</span> '}else{if(a1.confirmations>0){a2+=' <span class="label label-info hidden-phone">'+a1.confirmations+" Confirmations</span> "}}a2+="</div></td>";if(a7>0){a2+='<td style="color:green"><div>'+formatMoney(a7,true)+"</div></td>"}else{if(a7<0){a2+='<td style="color:red"><div>'+formatMoney(a7,true)+"</div></td>"}else{a2+="<td><div>"+formatMoney(a7,true)+"</div></td>"}}if(a1.balance==null){a2+="<td></td></tr>"}else{a2+='<td class="hidden-phone"><div>'+formatMoney(a1.balance)+"</div></td></tr>"}return a2}function Y(){O();if(aC==null){$("#balance").html("Loading...")}else{$("#balance").html(formatSymbol(aC,symbol,true));$("#balance2").html(formatSymbol(aC,(symbol===symbol_local)?symbol_btc:symbol_local),true)}return k.attr("id")}function d(aY){var aZ=Y();if("send-coins"==aZ){v(aY)}else{if("home-intro"==aZ){f(aY)}else{if("receive-coins"==aZ){aX(aY)}else{if("my-transactions"==aZ){Z(aY)}}}}}function f(aY){$("#summary-n-tx").html(N);$("#summary-received").html(formatMoney(aw,true));$("#summary-sent").html(formatMoney(V,true));$("#summary-balance").html(formatMoney(aC,symbol));$(".paper-wallet-btn").unbind().click(function(){loadScript("wallet/paper-wallet",function(){PaperWallet.showModal()})});var a0=i.getPreferredAddress();if(a0==null){return}if(i.isWatchOnly(a0)){$(".no-watch-only").hide()}else{$(".no-watch-only").show();var aZ=$("#my-primary-address");if(aZ.text()!=a0){aZ.text(a0);loadScript("wallet/jquery.qrcode",function(){$("#my-primary-addres-qr-code").empty().qrcode({width:125,height:125,text:a0})})}}$("#tweet-for-btc").unbind().click(function(){i.openWindow("https://twitter.com/share?url=https://blockchain.info/wallet&hashtags=tweet4btc,bitcoin,"+a0+"&text=Sign Up For a Free Bitcoin Wallet @ Blockchain.info")})}function U(){var aY=$("#export-warning").show();var aZ=$("#import-export-content").hide();$("#show-import-export").unbind().click(function(){i.getMainPassword(function(){aY.hide();loadScript("wallet/import-export",function(){ImportExport.init(aZ,function(){aZ.show()},function(){aj($("#home-intro"))})},function(a0){i.makeNotice("error","misc-error",a0);aj($("#home-intro"))})},function(){aj($("#home-intro"))})})}function Z(){var aZ=null;var a1=0;if(aZ!=null){clearInterval(aZ);aZ=null}var aY;if(t.tx_display==0){$("#transactions-detailed").hide();aY=$("#transactions-compact").show().find("tbody").empty()}else{$("#transactions-compact").hide();aY=$("#transactions-detailed").empty().show()}if(G.length==0){$("#transactions-detailed, #transactions-compact").hide();$("#no-transactions").show();return}else{$("#no-transactions").hide()}var a0=function(){for(var a5=a1;a5<G.length&&a5<(a1+i.getNTransactionsPerPage());++a5){var a4=G[a5];if(t.tx_display==0){aY.append(aT($(E(a4,L,h)),a4))}else{aY.append(a4.getHTML(L,h))}}a1+=i.getNTransactionsPerPage();if(a1<G.length){aZ=setTimeout(a0,15)}else{setupSymbolToggle();O();var a3=$(".pagination ul").empty();if(aA==0&&G.length<i.getNTransactionsPerPage()){a3.hide();return}else{a3.show()}var a2=Math.ceil(aW/i.getNTransactionsPerPage());var a7=" disabled";if(aA>0){a7=""}var a8=10;var a6=Math.max(0,Math.min(aA-(a8/2),a2-a8));a3.append($('<li class="prev'+a7+'"><a>&larr; Previous</a></li>').click(function(){i.setPage(aA-1)}));if(a6>0){a3.append($("<li><a>≤</a></li>").click(function(){i.setPage(0)}))}for(var a5=a6;a5<a2&&a5<a6+a8;++a5){(function(a9){var ba="";if(aA==a9){ba=' class="active"'}a3.append($("<li"+ba+'><a class="hidden-phone">'+(a9+1)+"</a></li>").click(function(){i.setPage(a9)}))})(a5)}if(a6+a8<a2){a3.append($("<li><a>≥</a></li>").click(function(){i.setPage(a2-1)}))}var a7=" disabled";if(aA<a2-1){a7=""}a3.append($('<li class="next'+a7+'"><a>Next &rarr;</a></li>').click(function(){i.setPage(aA+1)}))}};a0()}this.setPage=function(aY){aA=aY;scroll(0,0);i.get_history()};function w(){loadScript("wallet/frame-modal",function(){showFrameModal({title:"Export History",description:"",src:root+"export-history?active="+i.getActiveAddresses().join("|")+"&archived="+i.getArchivedAddresses().join("|")})})}function T(a6){var aZ=$("#partner-home-buttons");if(a6.home_buttons&&a6.home_buttons.length>0){aZ.show();aZ.find("p").empty();for(var bg in a6.home_buttons){var aY=a6.home_buttons[bg];var be=$('<a class="btn" style="margin-left:3px;" href="" target="blank"><img src=""></a>');if(aY.button_class){be.addClass(aY.button_class)}be.attr("href",aY.link);be.text(" "+aY.title);if(aY.image){be.prepend("<img>").find("img").attr("src",aY.image.replace("{0}",resource))}aZ.find("p").append(be)}}else{aZ.hide()}var a3=$("#send-coins-nav");a3.find("li.send_partner").remove();var bf=$("#partners-send-divider");if(a6.send_buttons&&a6.send_buttons.length>0){bf.show().next().show();for(var bg in a6.send_buttons){var aY=a6.send_buttons[bg];var a0=$('<li class="send_partner"><a target="blank"></a></li>');var be=a0.find("a");be.attr("href",aY.link);be.text(" "+aY.title);if(aY.image){be.prepend('<i class="icon-dice" style="background-position:0px;width:16px;height:16px;"></i>').find("i").css("background-image","url("+aY.image.replace("{0}",resource)+")")}bf.next().after(a0)}}else{bf.hide().next().hide()}var bd=$("#home-deposit-container").empty();if(a6.deposit_buttons.length>0){bd.show();var a8=$('<ul id="myTab" class="nav nav-tabs">');var a4={US:[],GB:[],EU:[]};var a1=[];for(var bg in a6.deposit_buttons){var aY=a6.deposit_buttons[bg];if(aY.country_code==null||aY.country_code.length==0){a1.push(aY);continue}var a2=a4[aY.country_code];if(a2==null){a2=[];a4[aY.country_code]=a2}a2.push(aY)}var a5=0;for(var a9 in a4){var a2=a4[a9];if(a2.length==0&&a1.length==0){continue}var a7=$("<li><a></a></li>");if(a5==0){a7.addClass("active")}var be=a7.find("a");be.attr("href","#deposit-"+a9.toLowerCase());be.text(" "+a9.toUpperCase());be.prepend("<img>").find("img").attr("src",resource+"flags/"+a9.toLowerCase()+".png");++a5;a8.append(a7)}a8.find("a").click(function(){$(this).tab("show")});bd.append(a8);var bb=$('<div class="tab-content page-header">');var a5=0;for(var a9 in a4){var a2=a4[a9];var ba=$('<div class="tab-pane" style="text-align:right">');if(a5==0){ba.addClass("active")}ba.attr("id","deposit-"+a9.toLowerCase());a2=a2.concat(a1);if(a2.length==0){continue}for(var bc in a2){var aY=a2[bc];var be=$('<a style="margin-left:3px;" class="btn" target="blank"></a>');if(aY.button_class){be.addClass(aY.button_class)}be.attr("href",aY.link);be.text(" "+aY.title);if(aY.image){be.prepend("<img>").find("img").attr("src",aY.image.replace("{0}",resource))}ba.append(be)}++a5;bb.append(ba)}bd.append(bb)}else{bd.hide()}}function K(a1,a0){if(!a0){if(a1.mixer_fee){y=a1.mixer_fee}J=a1.recommend_include_fee;if(a1.info){if(a1.info.symbol_local){setLocalSymbol(a1.info.symbol_local)}if(a1.info.symbol_btc){setBTCSymbol(a1.info.symbol_btc)}}}if(a1.disable_mixer){$("#shared-addresses,#send-shared").hide()}aH=a1.sharedcoin_endpoint;G.length=0;if(a1.wallet==null){aw=0;V=0;aC=0;N=0;aW=0;return}aw=a1.wallet.total_received;V=a1.wallet.total_sent;aC=a1.wallet.final_balance;N=a1.wallet.n_tx;aW=a1.wallet.n_tx_filtered;for(var aZ=0;aZ<a1.addresses.length;++aZ){if(L[a1.addresses[aZ].address]){L[a1.addresses[aZ].address].balance=a1.addresses[aZ].final_balance}}for(var aZ=0;aZ<a1.txs.length;++aZ){var aY=TransactionFromJSON(a1.txs[aZ]);aY.result=u(aY,false);G.push(aY)}if(!a0){if(a1.info.latest_block){aB(a1.info.latest_block)}}if(a1.partners){T(a1.partners)}i.sendEvent("did_multiaddr")}this.handleURI=function(aZ,aY){loadScript("wallet/jsuri-1.1.1",function(){try{var a1=new Uri(aZ);var a0=new Bitcoin.Address(a1.host());aY.find('input[name="send-to-address"]').val(a0.toString());var a2=parseFloat(a1.getQueryParamValue("amount"));if(a2>0&&!isNaN(a2)){aY.find(".send-value").val(a2)}}catch(a3){console.log(a3);i.makeNotice("error","error","Invalid Bitcoin Address or URI")}},function(){i.makeNotice("error","error","Invalid Bitcoin Address or URI")})};function aP(){M();X=setTimeout(i.logout,i.getLogoutTime());i.sendEvent("did_decrypt");i.get_history(null,function(){MyStore.get("multiaddr",function(a1){if(a1!=null){K($.parseJSON(a1),true);d()}})});$("#initial_error,#initial_success").remove();var a0=decodeURIComponent(window.location.hash.replace("#",""));if(a0.indexOf("bitcoin:")==0){var aY=$("#send-coins");aj(aY);var aZ=aY.find(".tab-pane.active").find(".recipient").first();i.handleURI(a0,aZ)}else{aj($("#home-intro"))}window.location.hash=""}function g(aY,a1,aZ){var a0={method:"wallet.aes.json",format:"json",checksum:aY};i.securePost("wallet",a0,function(a2){if(!a2.payload||a2.payload=="Not modified"){if(a1){a1()}}else{if(aZ){aZ()}}},function(a2){if(aZ){aZ()}})}function M(a0,aY){var aZ={method:"wallet.aes.json",format:"json"};if(aD&&aD.length>0){aZ.checksum=aD}i.setLoadingText("Checking For Wallet Updates");i.securePost("wallet",aZ,function(a1){if(!a1.payload||a1.payload=="Not modified"){if(a0){a0()}return}i.setEncryptedWalletData(a1.payload);ae(function(){i.get_history();d();if(a0){a0()}},function(){if(aY){aY()}})},function(a1){if(aY){aY()}})}function ae(aZ,aY){if(am==null||am.length==0){aY("No Wallet Data To Decrypt");return}i.decryptWallet(am,aM,function(a7,a5){try{e=a7.sharedKey;if(!e||e.length==0||e.length!=36){throw"Shared Key is invalid"}if(a5){S=a5.version;R=a5.pbkdf2_iterations}if(a7.double_encryption&&a7.dpasswordhash){H=a7.double_encryption;x=a7.dpasswordhash}if(a7.options){$.extend(t,a7.options)}L={};for(var a1=0;a1<a7.keys.length;++a1){var a0=a7.keys[a1];if(!a0.addr||!ai(a0.addr)){i.makeNotice("error","null-error","Your wallet contains an invalid address. This is a sign of possible corruption, please double check all your BTC is accounted for. Backup your wallet to remove this error.",15000);continue}if(a0.tag==1||!ai(a0.tag)){a0.tag=null}if(a0.label&&!ai(a0.label)){a0.label=null}L[a0.addr]=a0}h={};if(a7.address_book){for(var a1=0;a1<a7.address_book.length;++a1){var a3=a7.address_book[a1];if(a3.label&&ai(a3.label)&&ai(a3.addr)){i.addAddressBookEntry(a3.addr,a3.label)}}}if(a7.tx_notes){for(var a4 in a7.tx_notes){var a2=a7.tx_notes[a4];if(a2&&ai(a2)){c[a4]=a2}}}if(aD==null||aD.length==0){aD=al()}a();aZ()}catch(a6){aY(a6)}},aY)}this.getPassword=function(a3,a4,a1){if(!a3.is(":visible")){a3.trigger("hidden");a3.unbind()}a3.modal({keyboard:false,backdrop:"static",show:true});a3.center();var a2=a3.find('input[name="password"]');var a6=a2,aY=false,a5=false;a3.find(".vkeyboard li").unbind().click(function(){var a9=$(this),a8=a9.html();if(a9.hasClass("left-shift")||a9.hasClass("right-shift")){$(".letter").toggleClass("uppercase");$(".symbol span").toggle();aY=(aY===true)?false:true;a5=false;return false}if(a9.hasClass("capslock")){$(".letter").toggleClass("uppercase");a5=true;return false}if(a9.hasClass("delete")){var a7=a6.val();a6.val(a7.substr(0,a7.length-1));return false}if(a9.hasClass("symbol")){a8=$("span:visible",a9).html()}if(a9.hasClass("space")){a8=" "}if(a9.hasClass("tab")){a8="\t"}if(a9.hasClass("return")){a8="\n"}if(a9.hasClass("uppercase")){a8=a8.toUpperCase()}if(aY===true){$(".symbol span").toggle();if(a5===false){$(".letter").toggleClass("uppercase")}aY=false}a6.val(a6.val()+a8)});a2.keypress(function(a7){if(a7.keyCode==13){a7.preventDefault();a3.find(".btn.btn-primary").click()}});a2.val("");var aZ=a3.find(".btn.btn-primary");aZ.click(function(){if(a4){a1=null;var a7=a4;a4=null;setTimeout(function(){a3.modal("hide");a7(a2.val())},10)}else{a3.modal("hide")}});var a0=a3.find(".btn.btn-secondary");a0.click(function(){if(a1){var a7=a1;a1=null;a4=null;setTimeout(function(){a3.modal("hide");try{a7()}catch(a8){i.makeNotice("error","misc-error",a8)}},10)}else{a3.modal("hide")}});a3.on("hidden",function(){a2.unbind();a0.unbind();aZ.unbind();a3.unbind();if(a1){var a7=a1;a1=null;a4=null;setTimeout(function(){try{a7()}catch(a8){i.makeNotice("error","misc-error",a8)}},10)}})};this.makePairingQRCode=function(aZ,aY){i.getMainPassword(function(){loadScript("wallet/jquery.qrcode",function(){try{if(aY==1){i.securePost("wallet",{method:"pairing-encryption-password"},function(a1){aZ($("<div></div>").qrcode({width:300,height:300,text:"1|"+P+"|"+i.encrypt(e+"|"+Crypto.util.bytesToHex(UTF8.stringToBytes(aM)),a1,i.getDefaultPbkdf2Iterations())}))},function(a1){i.makeNotice("error","misc-error",a1)})}else{if(aY==0){aZ($("<div></div>").qrcode({width:300,height:300,text:P+"|"+e+"|"+aM}))}}}catch(a0){i.makeNotice("error","misc-error",a0)}})},function(){i.logout()})};this.getMainPassword=function(aZ,aY){if(D>new Date().getTime()-Q){return aZ(aM)}i.getPassword($("#main-password-modal"),function(a0){if(aM==a0){D=new Date().getTime();if(aZ){try{aZ(aM)}catch(a1){i.makeNotice("error","misc-error",a1)}}}else{i.makeNotice("error","misc-error","Password incorrect.");if(aY){try{aY()}catch(a1){i.makeNotice("error","misc-error",a1)}}}},aY)};this.getSecondPassword=function(a0,aY){if(!H||ao!=null){if(a0){try{a0(ao)}catch(aZ){i.makeNotice("error","misc-error",aZ)}}return}i.getPassword($("#second-password-modal"),function(a1){try{if(i.validateSecondPassword(a1)){if(a0){try{a0(a1)}catch(a2){console.log(a2);i.makeNotice("error","misc-error",a2)}}}else{i.makeNotice("error","misc-error","Password incorrect.");if(aY){try{aY()}catch(a2){i.makeNotice("error","misc-error",a2)}}}}catch(a2){if(aY){try{aY()}catch(a2){i.makeNotice("error","misc-error",a2)}}}},aY)};function b(){if(C||az){return}function aZ(a2){az=false;i.makeNotice("error","misc-error",a2);i.sendEvent("error_restoring_wallet")}try{az=true;var aY=$("#restore-password");aM=aY.val();aY.val("");D=new Date().getTime();if(am==null||am.length==0){i.setLoadingText("Validating Authentication key");var a0=$.trim($(".auth-"+r).find(".code").val());if(a0.length==0||a0.length>255){throw"You must enter a Two Factor Authentication code"}$.ajax({timeout:60000,type:"POST",url:root+"wallet",data:{guid:P,payload:a0,length:a0.length,method:"get-wallet",format:"plain"},success:function(a2){try{if(a2==null||a2.length==0){throw"Server Return Empty Wallet Data"}if(a2!="Not modified"){i.setEncryptedWalletData(a2)}$(".auth-"+r).hide();$(".auth-0").show();ae(function(){az=false;o();aP()},aZ)}catch(a3){aZ(a3)}},error:function(a2){aZ(a2.responseText)}})}else{ae(function(){az=false;o();aP()},aZ)}}catch(a1){aZ(a1)}}this.getIsInitialized=function(){return C};function a(){if(C){return}ax("error");webSocketConnect(z);C=true;$("#tech-faq").hide();$("#intro-text").hide();$("#large-summary").show()}this.quickSendNoUI=function(a0,aZ,aY){loadScript("wallet/signer",function(){i.getSecondPassword(function(){try{var a2=initNewTx();a2.webworker_resource_prefix="";a2.from_addresses=i.getActiveAddresses();a2.to_addresses.push({address:new Bitcoin.Address(a0),value:Bitcoin.Util.parseValue(aZ)});a2.addListener(aY);a2.start()}catch(a1){aY.on_error(a1)}},function(a1){aY.on_error(a1)})})};function I(){i.setLoadingText("Sending email backup");i.securePost("wallet",{method:"email-backup"},function(aY){i.makeNotice("success","backup-success",aY)},function(aY){i.makeNotice("error","misc-error",aY.responseText)})}this.backupWalletDelayed=function(a1,a0,aZ,aY){if(aq){clearInterval(aq);aq=null}aq=setTimeout(function(){i.backupWallet(a1,a0,aZ,aY)},3000)};this.backupWallet=function(a4,a3,aZ){if(aq){clearInterval(aq);aq=null}var aY=function(a5){i.sendEvent("on_backup_wallet_error");i.makeNotice("error","misc-error","Error Saving Wallet: "+a5,10000);M();d();if(aZ!=null){aZ(a5)}};try{if(a4==null){a4="update"}if(aI(L)==0){throw"Addresses Length 0"}var a0=i.makeWalletJSON();var a2=i.encryptWallet(a0,aM);if(a2.length==0){throw"Error encrypting the JSON output"}i.decryptWallet(a2,aM,function(a9){try{var a6=aD;i.setLoadingText("Saving wallet");i.setEncryptedWalletData(a2);var a5=aD;var a7={length:a2.length,payload:a2,checksum:a5,old_checksum:a6,method:a4,format:"plain",language:aa};if(A){a7.active=i.getActiveAddresses().join("|")}i.securePost("wallet",a7,function(ba){g(a5,function(){for(var bb in L){var bc=L[bb];if(bc.tag==1){delete bc.tag}}i.makeNotice("success","misc-success",ba);d();if(a3!=null){a3()}i.sendEvent("on_backup_wallet_success")},function(){aY("Checksum Did Not Match Expected Value")})},function(ba){aY(ba.responseText)})}catch(a8){aY(a8)}})}catch(a1){aY(a1)}};function aQ(aY){if(H){if(ao==null){throw"Cannot encrypt private key without a password"}return i.encrypt(aY,e+ao,i.getSecondPasswordPbkdf2Iterations())}else{return aY}return null}this.isBase58=function(a0,aZ){for(var aY=0;aY<a0.length;++aY){if(a0[aY]<0||a0[aY]>58){return false}}return true};this.encrypt=function(a0,aZ,aY){return Crypto.AES.encrypt(a0,aZ,{mode:new Crypto.mode.CBC(Crypto.pad.iso10126),iterations:aY})};this.encryptWallet=function(aZ,aY){if(S==2){return JSON.stringify({pbkdf2_iterations:i.getMainPasswordPbkdf2Iterations(),version:S,payload:i.encrypt(aZ,aY,i.getMainPasswordPbkdf2Iterations())})}else{if(S==0){return i.encrypt(aZ,aY,i.getDefaultPbkdf2Iterations())}else{throw"Unknown encryption version "+S}}};this.decryptWallet=function(aZ,a7,a8,a2){try{i.setLoadingText("Decrypting Wallet");i.sendEvent("on_wallet_decrypt_start");var a4=function(a9,ba){i.sendEvent("on_wallet_decrypt_finish");if(a8!=null){a8(a9,ba)}};var a6=function(a9){i.sendEvent("on_wallet_decrypt_finish");if(a2!=null){a2(a9)}};var aY=null;try{var aY=$.parseJSON(aZ)}catch(a1){}var a0=function(){try{var ba=Crypto.AES.decrypt(aY.payload,a7,{mode:new Crypto.mode.CBC(Crypto.pad.iso10126),iterations:aY.pbkdf2_iterations});var a9=$.parseJSON(ba);a4(a9,aY)}catch(bb){a6("Error Decrypting Wallet. Please check your password is correct.")}};if(aY&&aY.payload&&aY.pbkdf2_iterations){if(aY.version!=at){throw"Wallet version "+aY.version+" not supported"}if(aY.pbkdf2_iterations>0){var a5=$("#decrypting-progress-modal");var a3=setTimeout(function(){a5.modal({keyboard:false,backdrop:"static",show:true});a5.center()},500);i.decryptWebWorker(aY.payload,a7,aY.pbkdf2_iterations,function(ba){clearTimeout(a3);a5.modal("hide");try{var a9=$.parseJSON(ba);a4(a9,aY)}catch(bb){a0()}},function(a9){clearTimeout(a3);a5.modal("hide");a0()})}else{a0()}}else{i.decrypt(aZ,a7,i.getDefaultPbkdf2Iterations(),function(ba){try{var a9=$.parseJSON(ba);try{a4(a9)}catch(bb){console.log(bb)}return true}catch(bb){return false}},function(){a6("Error Decrypting Wallet. Please check your password is correct.")})}}catch(a1){a6(a1)}};this.getWebWorkerLoadPrefix=function(){return resource+"wallet/"};this.decryptWebWorker=function(a1,a5,a0,a6,a4){var aY=false;var a3=function(a7){if(!aY){a4(a7);aY=true}};try{var aZ=new Worker(i.getWebWorkerLoadPrefix()+"signer"+(min?".min.js":".js"));aZ.addEventListener("message",function(a8){var a7=a8.data;try{switch(a7.cmd){case"on_decrypt":a6(a7.data);aZ.terminate();break;case"on_error":throw a7.e}}catch(a8){aZ.terminate();a3(a8)}},false);aZ.addEventListener("error",function(a7){a3(a7)});aZ.postMessage({cmd:"load_resource",path:i.getWebWorkerLoadPrefix()+"bitcoinjs"+(min?".min.js":".js")});aZ.postMessage({cmd:"decrypt",data:a1,password:a5,pbkdf2_iterations:a0})}catch(a2){a3(a2)}};this.decrypt=function(a2,a1,aZ,a4,a0){try{var aY=Crypto.AES.decrypt(a2,a1,{mode:new Crypto.mode.CBC(Crypto.pad.iso10126),iterations:aZ});if(aY!=null&&aY.length>0){if(a4(aY)){return aY}}}catch(a3){console.log(a3)}if(aZ!=10){try{var aY=Crypto.AES.decrypt(a2,a1,{mode:new Crypto.mode.CBC(Crypto.pad.iso10126),iterations:10});if(aY!=null&&aY.length>0){if(a4(aY)){return aY}}}catch(a3){console.log(a3)}}try{var aY=Crypto.AES.decrypt(a2,a1);if(aY!=null&&aY.length>0){if(a4(aY)){return aY}}}catch(a3){console.log(a3)}try{var aY=Crypto.AES.decrypt(a2,a1,{mode:new Crypto.mode.OFB(Crypto.pad.iso7816),iterations:1});if(aY!=null&&aY.length>0){if(a4(aY)){return aY}}}catch(a3){console.log(a3)}try{var aY=Crypto.AES.decrypt(a2,a1,{mode:new Crypto.mode.CBC(Crypto.pad.iso10126),iterations:1});if(aY!=null&&aY.length>0){if(a4(aY)){return aY}}}catch(a3){console.log(a3)}if(a0){a0()}return null};this.handleNTPResponse=function(a2,a3){var a0=(new Date()).getTime();if(a2.clientTimeDiff&&a2.serverTime){var aY=a0-a2.serverTime;var aZ=(a2.clientTimeDiff-a0+a3-aY)/2;var a1=(aY-aZ)/2;if(ab){aO=(aO+a1)/2}else{aO=a1;ab=true;MyStore.put("server_time_offset",""+aO)}console.log("Server Time offset "+aO+"ms - This offset "+a1)}};this.setGUID=function(a0,aY){if(C){throw"Cannot Set GUID Once Initialized"}i.setLoadingText("Downloading Wallet");$("#initial_error,#initial_success").remove();var aZ=$("#restore-wallet-continue");aZ.prop("disabled",true);var a2=(new Date()).getTime();var a1={format:"json",resend_code:aY,ct:a2};if(aD){a1.checksum=aD}if(e){a1.sharedKey=e}$.ajax({type:"GET",dataType:"json",url:root+"wallet/"+a0,data:a1,timeout:60000,success:function(a3){i.handleNTPResponse(a3,a2);aZ.prop("disabled",false);if(!a3.guid){i.makeNotice("error","misc-error","Server returned null guid.");return}$(".auth-"+r).hide();ad=a3.extra_seed;P=a3.guid;r=a3.auth_type;aR=a3.real_auth_type;A=a3.sync_pubkeys;if(a3.payload&&a3.payload.length>0&&a3.payload!="Not modified"){i.setEncryptedWalletData(a3.payload)}i.sendEvent("did_set_guid");war_checksum=a3.war_checksum;setLocalSymbol(a3.symbol_local);setBTCSymbol(a3.symbol_btc);$("#restore-guid").val(P);$(".auth-"+r).show();if(a3.initial_error){i.makeNotice("error","misc-error",a3.initial_error)}if(a3.initial_success){i.makeNotice("success","misc-success",a3.initial_success)}MyStore.get("guid",function(a4){if(a4!=P){MyStore.remove("guid");MyStore.remove("multiaddr");MyStore.remove("payload");if(P!=F){MyStore.put("guid",P)}}});if(a3.language&&aa!=a3.language){i.setLanguage(a3.language)}},error:function(a3){aZ.prop("disabled",false);MyStore.get("guid",function(a4){MyStore.get("payload",function(a6){if(a4==a0&&a6){i.setEncryptedWalletData(a6);i.makeNotice("error","misc-error","Error Contacting Server. Using Local Wallet Cache.");P=a4;aD=al();r=0;$("#restore-guid").val(P);$(".auth-"+r).show();i.sendEvent("did_set_guid")}else{i.sendEvent("did_fail_set_guid");try{var a7=$.parseJSON(a3.responseText);if(a7.authorization_required){loadScript("wallet/poll-for-session-guid",function(){pollForSessionGUID()})}if(a7.initial_error){i.makeNotice("error","misc-error",a7.initial_error)}return}catch(a5){}if(a3.responseText){i.makeNotice("error","misc-error",a3.responseText)}else{i.makeNotice("error","misc-error","Error changing wallet identifier")}}})})}})};function j(aY){var aZ=B58.encode(aY);return aQ(aZ)}this.decryptPK=function(aY){if(H){if(ao==null){throw"Cannot decrypt private key without a password"}return i.decrypt(aY,e+ao,i.getSecondPasswordPbkdf2Iterations(),i.isBase58)}else{return aY}return null};this.decodePK=function(aZ){if(!aZ){throw"null PK passed to decodePK"}var aY=i.decryptPK(aZ);if(aY!=null){return B58.decode(aY)}return null};this.signmessage=function(aY,a0){var a2=L[aY];if(!a2.priv){throw"Cannot sign a watch only address"}var a1=i.decodePK(a2.priv);var aZ=new Bitcoin.ECKey(a1);return Bitcoin.Message.signMessage(aZ,a0,a2.addr)};this.validateSecondPassword=function(aZ){var aY=Crypto.SHA256(e+aZ,{asBytes:true});var a2=ah(aY,i.getSecondPasswordPbkdf2Iterations()-1);if(a2==x){ao=aZ;return true}if(i.getSecondPasswordPbkdf2Iterations()!=10){var a0=ah(aY,10-1);if(a0==x){ao=aZ;x=a2;return true}}if(Crypto.util.bytesToHex(aY)==x){ao=aZ;x=a2;return true}var a1=Crypto.SHA256(aZ);if(a1==x){ao=aZ;x=a2;return true}return false};this.runCompressedCheck=function(){var aY=[];var a0={};for(var a1 in L){var a5=L[a1];if(a5.priv!=null){var a4=i.decodePK(a5.priv);var a2=new Bitcoin.ECKey(a4);var aZ=a2.getBitcoinAddress().toString();var a3=a2.getBitcoinAddressCompressed().toString();if(a5.addr!=aZ){a0[aZ]=a5.priv;aY.push(aZ)}if(a5.addr!=a3){a0[a3]=a5.priv;aY.push(a3)}}}if(aY.length==0){alert("to_check length == 0")}BlockchainAPI.get_balances(aY,function(a9){var ba=0;for(var a8 in a9){var bb=a9[a8].final_balance;if(bb>0){var a7=new Bitcoin.ECKey(i.decodePK(a0[a8]));var a6=a7.getBitcoinAddress().toString();if(i.addPrivateKey(a7,{compressed:a6!=a8,app_name:IMPORTED_APP_NAME,app_version:IMPORTED_APP_VERSION})){alert(formatBTC(bb)+" claimable in address "+a8)}}ba+=bb}alert(formatBTC(ba)+" found in compressed addresses");if(ba>0){i.backupWallet("update",function(){i.get_history()})}})};this.checkAllKeys=function(aY){for(var aZ in L){var a3=L[aZ];if(a3.addr==null){throw"Null Address Found in wallet "+aZ}if(a3.addr.toString()==null){throw"Error decoding wallet address "+a3.addr}if(a3.priv!=null){var a2=i.decodePK(a3.priv);var a1=new Bitcoin.ECKey(a2);var a0=a1.getBitcoinAddress().toString();if(a0!=a3.addr&&a1.getBitcoinAddressCompressed().toString()!=a3.addr){throw"Private key does not match bitcoin address "+a3.addr+" != "+a0}if(aY){a3.priv=j(a2)}}}i.makeNotice("success","wallet-success","Wallet verified.")};this.setMainPassword=function(aY){i.getMainPassword(function(){aM=aY;i.backupWallet("update",function(){i.logout()},function(){i.logout()})})};function aj(aY){if(aY===k){return}if(k!=null){if($("#"+k.attr("id")+"-btn").length>0){$("#"+k.attr("id")+"-btn").parent().attr("class","")}k.hide()}k=aY;k.show();if($("#"+k.attr("id")+"-btn").length>0){$("#"+k.attr("id")+"-btn").parent().attr("class","active")}d(true)}function aI(a0){var aZ=0,aY;for(aY in a0){aZ++}return aZ}function ag(aY){L[aY].priv=null}function an(){if(aI(L)>=aF){i.makeNotice("error","misc-error","We currently support a maximum of "+aF+" private keys, please remove some unused ones.");return true}return false}function aU(a0,aY){var aZ=L[a0];if(!aZ||aZ.length==0){L[a0]={addr:a0,priv:aY,balance:0};return true}else{if(!aZ.priv&&aY){aZ.priv=aY;return true}}return false}function p(){var a0=$("#add-address-book-entry-modal");a0.modal({keyboard:true,backdrop:"static",show:true});var aY=a0.find('input[name="label"]');var aZ=a0.find('input[name="address"]');aY.val("");aZ.val("");a0.find(".btn.btn-primary").unbind().click(function(){a0.modal("hide");var a2=$.trim(aY.val());var a1=$.trim(aZ.val());if(a2.length==0||a1.length==0){i.makeNotice("error","misc-error","You must enter an address and label for the address book entry");return false}if(!ai(a2)||!ai(a1)){i.makeNotice("error","misc-error","Label and Bitcoin Address must contain letters and numbers only");return false}var a4;try{a4=new Bitcoin.Address(a1);if(a4==null){throw"Null address"}}catch(a3){i.makeNotice("error","misc-error","Bitcoin address invalid, please make sure you entered it correctly");return false}if(h[a1]!=null){i.makeNotice("error","misc-error","Bitcoin address already exists");return false}i.makeNotice("success","misc-success","Added Address book entry");i.addAddressBookEntry(a1,a2);i.backupWalletDelayed();$("#send-coins").find(".tab-pane").trigger("show",true)});a0.find(".btn.btn-secondary").unbind().click(function(){a0.modal("hide")})}this.logout=function(){if(au){return}if(P==F){window.location=root+"wallet/logout"}else{$.ajax({type:"GET",timeout:60000,url:root+"wallet/logout",data:{format:"plain"},success:function(aY){window.location.reload()},error:function(){window.location.reload()}})}};function ar(a4){var a6=$("#delete-address-modal");a6.modal({keyboard:true,backdrop:"static",show:true});a6.find(".btn.btn-primary").hide();a6.find(".btn.btn-danger").hide();$("#change-mind").hide();a6.find("#to-delete-address").html(a4.join(" "));a6.find("#delete-balance").empty();var a0=a6.find("#delete-balance");var aY=[];for(var a3 in a4){var a5=a4[a3];if(L[a5]&&L[a5].priv){aY.push(a4[a3])}}BlockchainAPI.get_balance(aY,function(a7){a6.find(".btn.btn-primary").show(200);a6.find(".btn.btn-danger").show(200);a0.html("Balance "+formatBTC(a7));if(a7>0){a0.css("color","red")}else{a0.css("color","black")}},function(){a6.find(".btn.btn-primary").show(200);a6.find(".btn.btn-danger").show(200);a0.text("Error Fetching Balance")});var a1=false;var a3=0;var aZ=null;var a2=10;changeMind=function(){$("#change-mind").show();$("#change-mind-time").text(a2-a3)};a6.find(".btn.btn-primary").unbind().click(function(){changeMind();a6.find(".btn.btn-primary").hide();a6.find(".btn.btn-danger").hide();aZ=setInterval(function(){if(a1){return}++a3;changeMind();if(a3==a2){$("#delete-address-modal").modal("hide");i.makeNotice("warning","warning-deleted","Private Key Removed From Wallet");for(var a7 in a4){ag(a4[a7])}d();i.backupWallet();clearInterval(aZ)}},1000)});a6.find(".btn.btn-danger").unbind().click(function(){changeMind();a6.find(".btn.btn-primary").hide();a6.find(".btn.btn-danger").hide();aZ=setInterval(function(){if(a1){return}++a3;changeMind();if(a3==a2){try{$("#delete-address-modal").modal("hide");i.makeNotice("warning","warning-deleted","Address & Private Key Removed From Wallet");for(var a7 in a4){i.deleteAddress(a4[a7])}d();i.backupWallet("update",function(){i.get_history()})}finally{clearInterval(aZ)}}},1000)});a6.unbind().on("hidden",function(){if(aZ){a1=true;clearInterval(aZ);aZ=null}});a6.find(".btn.btn-secondary").unbind().click(function(){a6.modal("hide")})}function aE(){var a0=[];for(var aY in h){a0.push(h[aY])}for(var aY in L){var aZ=L[aY];if(aZ.tag!=2&&aZ.label){a0.push(aZ.label)}}return a0}this.sweepAddressesModal=function(aZ,aY){i.getSecondPassword(function(){var a1=$("#sweep-address-modal");a1.modal("show");BlockchainAPI.get_balance(aZ,function(a2){a1.find(".balance").text("Amount: "+formatBTC(a2))},function(){a1.find(".balance").text("Error Fetching Balance")});var a0=a1.find('select[name="change"]');m(a0,true);a1.find(".btn.btn-primary").unbind().click(function(){loadScript("wallet/signer",function(){BlockchainAPI.get_balance(aZ,function(a3){var a4=initNewTx();var a2=a0.val();if(a2=="any"){a2=i.getPreferredAddress()}a4.fee=a4.base_fee;a4.to_addresses.push({address:new Bitcoin.Address(a2),value:BigInteger.valueOf(a3).subtract(a4.fee)});a4.from_addresses=aZ;a4.extra_private_keys=aY;a4.start()},function(){i.makeNotice("error","misc-error","Error Getting Address Balance")})});a1.modal("hide")});a1.find(".btn.btn-secondary").unbind().click(function(){a1.modal("hide")})})};this.openWindow=function(aZ){function aY(a1){var a0=false;try{if(typeof a1=="undefined"||!a1){a0=true}else{if(a1&&a1.closed){a0=false}else{if(a1&&a1.test){a0=false}}}}catch(a2){}return a0}window.open(aZ,null,"scroll=1,status=1,location=1,toolbar=1");if(aY(window)){i.makeNotice("error","misc-error","Popup Blocked. Try and click again.");return false}else{return true}};function aG(){try{$(".pop").popover({offset:10,placement:"bottom"})}catch(aY){}}function o(){if(W){return}W=true;$("#add-address-book-entry-btn").click(function(){p()});$("#home-intro-btn").click(function(){aj($("#home-intro"))});$("#my-transactions-btn").click(function(){aj($("#my-transactions"))});$("#send-coins-btn").click(function(){aj($("#send-coins"))});$("#import-export-btn").click(function(){aj($("#import-export"));U()});$("#chord-diagram").click(function(){loadScript("wallet/frame-modal",function(){showFrameModal({title:"Address Relationships",description:"",src:root+"taint/"+i.getActiveAddresses().join("|")})})});$("#verify-message").click(function(){loadScript("wallet/address_modal",function(){verifyMessageModal()})});$("#generate-cold-storage").click(function(){loadScript("wallet/paper-wallet",function(){PaperWallet.showColdStorageModal()},null,true)});$("#group-received").click(function(){loadScript("wallet/taint_grouping",function(){try{loadTaintData()}catch(aY){i.makeNotice("error","misc-error","Unable To Load Taint Grouping Data")}})});$("#my-account-btn").click(function(){aj($("#my-account"));var aY=$("#account-settings-warning").show();var aZ=$("#my-account-content").hide();$("#show-account-settings").unbind().click(function(){i.getMainPassword(function(){aY.hide();loadScript("wallet/account",function(){AccountSettings.init(aZ,function(){aZ.show()},function(){aj($("#home-intro"))})},function(a0){i.makeNotice("error","misc-error",a0);aj($("#home-intro"))})},function(){aj($("#home-intro"))})})});$("#shared-addresses").on("show",function(){var aY=$(this);loadScript("wallet/shared-addresses",function(){buildSharedTable(aY)})});$("#active-addresses").on("show",function(){var a4=$(this).find("table:first");a4.find("tbody:gt(0)").remove();var a1=a4.find("tbody").empty();for(var a3 in L){var a5=L[a3];if(a5.tag==2||a5.tag==1){continue}var a2="";if(a5.tag==1){a2=' <font color="red" class="pop" title="Not Synced" data-content="This is a new address which has not yet been synced with our the server. Do not used this address yet.">(Not Synced)</font>'}else{if(a5.priv==null){a2=' <font color="red" class="pop" title="Watch Only" data-content="Watch Only means there is no private key associated with this bitcoin address. <br /><br /> Unless you have the private key stored elsewhere you do not own the funds at this address and can only observe the transactions.">(Watch Only)</font>'}}var aY="";var a0=a5.addr;if(a5.label!=null){a0=a5.label;aY='<span class="hidden-phone"> - '+a5.addr+"</span>"}var aZ=$('<tr><td><div class="short-addr"><a href="'+root+"address/"+a5.addr+'" target="new">'+a0+"</a>"+aY+" "+a2+'<div></td><td><span style="color:green">'+formatMoney(a5.balance,true)+'</span></td>            <td><div class="btn-group pull-right"><a class="btn btn-mini dropdown-toggle" data-toggle="dropdown" href="#"><span class="hidden-phone">Actions </span><span class="caret"></span></a><ul class="dropdown-menu">             <li><a href="#" class="pop act-archive" title="Archive Address" data-content="Click this button to hide the address from the main view. You can restore or delete later by finding it in the Archived addresses tab.">Archive Address</a></li>            <li><a href="#" class="pop act-label" title="Label Address" data-content="Set the label for this address.">Label Address</a></li>            <li><a href="#" class="pop act-qr" title="Show QR Code" data-content="Show a QR Code for this address.">QR Code</a></li>            <li><a href="#" class="pop act-sign" title="Sign Message" data-content="Sign A message with this address.">Sign Message</a></li>            <li><a href="#" class="pop act-request" title="Request Payment" data-content="Click here to create a new QR Code payment request. The QR Code can be scanned using most popular bitcoin software and mobile apps.">Create Payment Request</a></li>            <li><a href="#" class="pop act-pubkey">Show Public Key</a></li>            </ul></div></td></tr>');(function(a6){aZ.find(".act-archive").click(function(){i.archiveAddr(a6)});aZ.find(".act-label").click(function(){loadScript("wallet/address_modal",function(){showLabelAddressModal(a6)})});aZ.find(".act-qr").click(function(){loadScript("wallet/address_modal",function(){showAddressModalQRCode(a6)})});aZ.find(".act-pubkey").click(function(){i.getSecondPassword(function(){var a7=i.getPrivateKey(a6);if(a7==null){i.makeNotice("eror","misc-error","Public Key Unknown");return}var a8=new Bitcoin.ECKey(i.decodePK(a7));if(a8.getBitcoinAddressCompressed().toString()==a6){var a9=a8.getPubCompressed()}else{var a9=a8.getPub()}i.makeNotice("success","pub-key","Public Key of "+a6+" is "+Crypto.util.bytesToHex(a9),20000)})});aZ.find(".act-sign").click(function(){loadScript("wallet/address_modal",function(){showAddressModalSignMessage(a6)})});aZ.find(".act-request").click(function(){loadScript("wallet/frame-modal",function(){showFrameModal({title:"Create Payment Request",description:"Request Payment into address <b>"+a6+"</b>",src:root+"payment_request?address="+a6})})})})(a5.addr);if(a5.balance>0&&a5.priv){a4.prepend(aZ)}else{a4.append(aZ)}}aG()});$("#archived-addresses").on("show",function(){$("#archived-addr tbody").empty();var aZ=$(this).find("tbody");var aY=i.getArchivedAddresses();var a0=function(){aZ.empty();for(var a4 in aY){var a6=L[aY[a4]];if(a6.tag!=2||a6.tag==1){continue}var a3="";if(a6.priv==null){a3=' <font color="red">(Watch Only)</font>'}var a1="";var a2=a6.addr;if(a6.label!=null){a2=a6.label;a1='<span class="hidden-phone"> - '+a6.addr+"</span>"}var a5=$('<tr><td style="width:20px;"><input type="checkbox" class="archived_checkbox" value="'+a6.addr+'"></td><td><div class="short-addr"><a href="'+root+"address/"+a6.addr+'" target="new">'+a2+"</a>"+a1+" "+a3+'<div></td><td><span style="color:green">'+formatBTC(a6.balance)+'</span></td><td style="width:16px"><img src="'+resource+'unarchive.png" class="act-unarchive" /></td></tr>');(function(a7){a5.find(".act-unarchive").click(function(){i.unArchiveAddr(a7)})})(a6.addr);if(a6.balance>0&&a6.priv){aZ.prepend(a5)}else{aZ.append(a5)}}};a0();BlockchainAPI.get_balances(aY,function(a1){a0()},function(a1){i.makeNotice("error","misc-error",a1)})});$("#archived-select-all").click(function(){$(".archived_checkbox").prop("checked",true)});$("#archived-select-none").click(function(){$(".archived_checkbox").prop("checked",false)});$("#archived-sweep").click(function(){var aY=[];$(".archived_checkbox:checked").each(function(){var aZ=L[$(this).val()];if(aZ.priv==null){i.makeNotice("error","misc-error","Cannot Sweep Watch Only Address");return}aY.push(aZ.addr)});if(aY.length==0){return}i.sweepAddressesModal(aY)});$("#archived-delete").click(function(){var aY=[];$(".archived_checkbox:checked").each(function(){aY.push($(this).val())});if(aY.length==0){return}ar(aY)});$("#shared-never-ask").click(function(){SetCookie("shared-never-ask",$(this).is(":checked"))});$(".deposit-btn").click(function(){var a0=$(this);var aZ=i.getPreferredAddress();var aY=a0.data("extra");if(aY==null){aY=""}loadScript("wallet/frame-modal",function(){showFrameModal({title:a0.data("title"),description:"Deposit into address <b>"+aZ+"</b>",top_right:'Have Questions? Read <a href="'+a0.data("link")+'" target="new">How It Works</a>',src:root+"deposit?address="+aZ+"&ptype="+a0.data("type")+"&guid="+P+aY})})});$(".withdraw-btn").click(function(){var aY=$(this);i.getSecondPassword(function(){var aZ=i.getPreferredAddress();loadScript("wallet/frame-modal",function(){showFrameModal({title:aY.data("title"),description:"Your Wallet Balance is <b>"+formatBTC(aC)+"</b>",src:root+"withdraw?method="+aY.data("type")+"&address="+aZ+"&balance="+aC+"&guid="+P})})})});$("#logout").click(i.logout);$("#refresh").click(function(){M(function(){i.get_history()})});$("#summary-n-tx-chart").click(function(){loadScript("wallet/frame-modal",function(){showFrameModal({title:"Number of transactions",description:"",src:root+"charts/n-transactions?show_header=false&address="+i.getActiveAddresses().join("|")})})});$("#summary-received-chart").click(function(){loadScript("wallet/frame-modal",function(){showFrameModal({title:"BTC Received Per Day",description:"",src:root+"charts/received-per-day?show_header=false&address="+i.getActiveAddresses().join("|")})})});$("#summary-balance-chart").click(function(){loadScript("wallet/frame-modal",function(){showFrameModal({title:"Wallet Balance",description:"",src:root+"charts/balance?show_header=false&address="+i.getActiveAddresses().join("|")})})});$("#new-addr").click(function(){M(function(){i.getSecondPassword(function(){var aZ=i.generateNewKey();var aY=aZ.getBitcoinAddress().toString();i.backupWallet("update",function(){i.makeNotice("info","new-address","Generated new Bitcoin Address "+aY);loadScript("wallet/address_modal",function(){showLabelAddressModal(aY)});i.get_history()})},function(){i.logout()})})});$(".tx_filter a").click(function(){aA=0;av=$(this).data("value");i.get_history()});$(".tx_display a").click(function(){var aY=$(this).data("value");if(aY=="export"){w();return}t.tx_display=aY;d();i.backupWalletDelayed()});$("#email-backup-btn").click(function(){I()});$("#dropbox-backup-btn").click(function(){i.openWindow(root+"wallet/dropbox-login?guid="+P)});$("#gdrive-backup-btn").click(function(){i.openWindow(root+"wallet/gdrive-login?guid="+P)});$("#balance").click(function(){toggleSymbol();d()});$("#send-quick").on("show",function(a0,aZ){var aY=$(this);s(aY,aZ);aY.find(".send").unbind().click(function(){loadScript("wallet/signer",function(){startTxUI(aY,"quick",initNewTx())})})});$("#send-email").on("show",function(a0,aZ){var aY=$(this);s(aY,aZ);aY.find(".send").unbind().click(function(){loadScript("wallet/signer",function(){startTxUI(aY,"email",initNewTx())})})});$("#send-shared").on("show",function(a0,aZ){var aY=$(this);s(aY,aZ);aY.find(".mixer_fee").text(y);aY.find(".fees,.free,.bonus").show();if(y<0){aY.find(".fees,.free").hide()}else{if(y==0){aY.find(".fees,.bonus").hide()}else{aY.find(".free,.bonus").hide()}}aY.find(".send").unbind().click(function(){loadScript("wallet/signer",function(){startTxUI(aY,"shared",initNewTx())})});aY.find(".shared-fees").text("0.00");aY.find('input[name="send-before-fees"]').unbind().bind("keyup change",function(){var a2=parseFloat($(this).val());var a1=0;if(a2>0){if(y>0){a1=parseFloat(a2+((a2/100)*y))}else{a1=parseFloat(a2);aY.find(".bonus-value").text(formatPrecision((Math.min(a2,precisionFromBTC(200))/100)*y))}}if(precisionToBTC(a2)<0.1||precisionToBTC(a2)>250){aY.find(".shared-fees").text("0.00");aY.find(".send").prop("disabled",true)}else{aY.find(".shared-fees").text(formatBTC(a1*symbol_btc.conversion));aY.find(".send").prop("disabled",false)}aY.find(".send-value").val(a1).trigger("keyup")})});$("#send-custom").on("show",function(a0,aZ){var aY=$(this);s(aY,aZ);aY.find(".send").unbind().click(function(){var a1=false;if(aY.find('textarea[name="public-note"]').val()){aY.find(".send-value").each(function(){if($(this).val()<0.0001){i.makeNotice("error","misc-error","You cannot attach a note to a transaction with an output size less than 0.0001 BTC");a1=true;return false}})}if(!a1){loadScript("wallet/signer",function(){startTxUI(aY,"custom",initNewTx())})}});aY.find('input[name="fees"]').unbind().bind("keyup change",function(a1){if(a1.keyCode=="9"){return}$(this).parent().find(".send-value-usd").val(convert($(this).val()*symbol_btc.conversion,symbol_local.conversion)).text(formatSymbol($(this).val()*symbol_btc.conversion,symbol_local))});aY.find(".reset").unbind().click(function(){s(aY,true);aY.find('select[name="from"]').trigger("change")})});$("#shared-coin").on("show",function(a0,aZ){var aY=$(this);loadScript("wallet/sharedcoin",function(){try{s(aY);SharedCoin.init(aY)}catch(a1){console.log(a1);i.makeNotice("error","misc-error",a1)}},function(a1){i.makeNotice("error","misc-error",a1)})});$("#send-sms").on("show",function(a0,aZ){if(aZ){return}var aY=$(this);s(aY);$.ajax({type:"GET",timeout:60000,url:resource+"wallet/country_codes.html",success:function(a1){aY.find('select[name="sms-country-code"]').html(a1)},error:function(){i.makeNotice("error","misc-error","Error Downloading SMS Country Codes")}});aY.find(".send").unbind().click(function(){loadScript("wallet/signer",function(){var a1=initNewTx();startTxUI(aY,"sms",a1)})})});$("#address-book").on("show",function(){var aZ=$("#address-book-tbl tbody");if(aI(h)>0){aZ.empty();for(var aY in h){var a0=$("<tr><td>"+h[aY]+'</td><td><div class="addr-book-entry">'+aY+'</div></td><td style="width:16px" class="hidden-phone"><img src="'+resource+'delete.png" class="act-delete" /></td></tr>');(function(a1){a0.find(".act-delete").click(function(){i.deleteAddressBook(a1)})})(aY);aZ.append(a0)}}});$('a[data-toggle="tab"]').unbind().on("show",function(aY){$(aY.target.hash).trigger("show")});$("#receive-coins-btn").click(function(){aj($("#receive-coins"))});$("#cash-into-coins").click(function(){$(this).attr("href",$(this).attr("href")+i.getPreferredAddress())});$(".show_adv").click(function(){$(".modal:visible").center()});$(".download-backup-btn").show();aG()}function q(){$(".resend-code").click(function(){i.setGUID(P,true)});$("#reset-two-factor-btn").click(function(){i.openWindow(root+"wallet/reset-two-factor"+(P?"?guid="+P:""))});$(".recover-wallet-btn").click(function(){i.openWindow(root+"wallet/forgot-password"+(P?"?guid="+P:""))});$(".download-backup-btn").toggle(am!=null).click(function(){if(!am){i.makeNotice("error","error","No Wallet Data to Download");return}try{var aZ=!!new Blob()}catch(a0){}if(aZ){loadScript("wallet/filesaver",function(){var a1=new Blob([am],{type:"text/plain;charset=utf-8"});saveAs(a1,"wallet.aes.json")})}else{var aY=window.open(null,null,"width=700,height=800,toolbar=0");aY.document.write('<!DOCTYPE html><html><head></head><body><div style="word-wrap:break-word;" >'+am+"</div></body></html>")}aV()});$(".auth-0,.auth-1,.auth-2,.auth-3,.auth-4,.auth-5").unbind().keypress(function(aY){if(aY.keyCode==13){aY.preventDefault();$("#restore-wallet-continue").click()}});$("#restore-wallet-continue").unbind().click(function(aZ){aZ.preventDefault();var aY=$.trim($("#restore-guid").val());if(aY.length==0){return}if(P!=aY){e=null;i.setGUID(aY,false)}else{b()}});$(".modal").on("show",function(){O();$(this).center()}).on("hidden",function(){var aZ=$(".modal:visible");var aY=$("#notices").remove();if(aZ.length>0){aZ.find(".modal-body").prepend(aY)}else{$("#main-notices-container").append(aY)}}).on("shown",function(){O();var aY=$(this);setTimeout(function(){if(aY.is(":visible")){aY.find(".modal-body").prepend($("#notices").remove())}},100);aY.center()})}function ap(aZ){var a0=Crypto.SHA256(aZ+"?");switch(a0.slice(0,2)){case"00":var a1=Crypto.SHA256(aZ,{asBytes:true});return a1;break;case"01":var aY=Crypto.util.hexToBytes(a0.slice(2,4))[0];var a2=Math.round(Math.pow(2,(aY/4)));var a1=Crypto.PBKDF2(aZ,"Satoshi Nakamoto",32,{iterations:a2,asBytes:true});return a1;break;default:console.log("invalid key");break}}function aL(){var a0,aY="";if(window.getSelection){a0=window.getSelection();if(a0.rangeCount){var a1=a0.getRangeAt(0).cloneContents();var aZ=document.createElement("div");aZ.appendChild(a1);aY=aZ.innerText}}else{if(document.selection&&document.selection.type=="Text"){aY=document.selection.createRange().htmlText}}return aY}this.detectPrivateKeyFormat=function(aZ){if(/^5[123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz]{50}$/.test(aZ)){return"sipa"}if(/^[LK][123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz]{51}$/.test(aZ)){return"compsipa"}if(/^[123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz]{44}$/.test(aZ)||/^[123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz]{43}$/.test(aZ)){return"base58"}if(/^[A-Fa-f0-9]{64}$/.test(aZ)){return"hex"}if(/^[ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789=+\/]{44}$/.test(aZ)){return"base64"}if(/^6P[123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz]{56}$/.test(aZ)){return"bip38"}if(/^S[123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz]{21}$/.test(aZ)||/^S[123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz]{25}$/.test(aZ)||/^S[123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz]{29}$/.test(aZ)||/^S[123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz]{30}$/.test(aZ)){var aY=Crypto.SHA256(aZ+"?",{asBytes:true});if(aY[0]===0||aY[0]===1){return"mini"}}throw"Unknown Key Format "+aZ};this.privateKeyStringToKey=function(aZ,a1){var aY=null;if(a1=="base58"){aY=B58.decode(aZ)}else{if(a1=="base64"){aY=Crypto.util.base64ToBytes(aZ)}else{if(a1=="hex"){aY=Crypto.util.hexToBytes(aZ)}else{if(a1=="mini"){aY=ap(aZ)}else{if(a1=="sipa"){var a0=B58.decode(aZ);a0.shift();aY=a0.slice(0,a0.length-4)}else{if(a1=="compsipa"){var a0=B58.decode(aZ);a0.shift();a0.pop();aY=a0.slice(0,a0.length-4)}else{throw"Unsupported Key Format"}}}}}}if(aY.length!=32){throw"Result not 32 bytes in length"}return new Bitcoin.ECKey(aY)};$(document).ready(function(){if(!$.isEmptyObject({})||!$.isEmptyObject([])){i.makeNotice("error","error","Object.prototype has been extended by a browser extension. Please disable this extensions and reload the page.");return}$("input,button,select").attr("autocomplete","off");var aZ=$(document.body);function a0(){if(P&&P.length==36){setTimeout(function(){i.setGUID(P,false)},10)}else{$("#signup-btn").show()}}P=aZ.data("guid");e=aZ.data("sharedkey");aa=aZ.data("language");if(i.skip_init){return}MyStore.get("server_time_offset",function(a5){aO=parseInt(a5);if(isNaN(aO)){aO=0}});if((!P||P.length==0)&&(isExtension||window.location.href.indexOf("/login")>0)){MyStore.get("guid",function(a5){P=a5;a0();q()})}else{a0();q()}if(top.location!=self.location){top.location=self.location.href}aZ.click(function(){if(X){clearTimeout(X);X=setTimeout(i.logout,i.getLogoutTime())}rng_seed_time()}).keypress(function(){if(X){clearTimeout(X);X=setTimeout(i.logout,i.getLogoutTime())}rng_seed_time()}).mousemove(function(a5){if(a5){rng_seed_int(a5.clientX*a5.clientY)}});$(".auth-"+r).show();k=$("#restore-wallet");k.show();var a1=false;var a4=17,a3=86,aY=67,a2=67;$(document).keydown(function(a6){try{if(a6.keyCode==a4||a6.keyCode==a2){a1=true}if(a1&&a6.keyCode==aY){var a5=$.trim(aL());var a7=L[a5];if(a7!=null){if(a7.priv==null){$("#watch-only-copy-warning-modal").modal("show")}}}}catch(a6){console.log(a6)}}).keyup(function(a5){if(a5.keyCode==a4||a5.keyCode==a2){a1=false}}).ajaxStart(function(){ax("loading_start");$(".loading-indicator").fadeIn(200)}).ajaxStop(function(){ax("loading_stop");$(".loading-indicator").hide()})});function aX(){$("#receive-coins").find(".tab-pane.active").trigger("show");setupToggle()}};