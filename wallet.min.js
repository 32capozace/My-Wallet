var MyWallet=new function(){var h=this;this.skip_init=false;var B="abcaa314-6f67-6705-b384-5d47fbe9d7cc";var Z;var K;var j;var av;var ac;var v;var d;var al=0;var N=0;var ah=0;var I=0;var aD=0;var at;var g={};var C=[];var D=false;var aj=0;var ag=0;var ao=1000;var G=[];var am;var ae;var w=1.5;var Q=10;var b={};var P;var U=[];var z;var L=60000;var q;var s={fee_policy:0,html5_notifications:false,logout_time:300000};this.addEventListener=function(aF){U.push(aF)};this.getLogoutTime=function(){return s.logout_time};this.setLogoutTime=function(aF){s.logout_time=aF;P=setTimeout(h.logout,h.getLogoutTime())};this.getDoubleEncryption=function(){return D};this.getEncryptedWalletData=function(){return Z};this.getFeePolicy=function(){return s.fee_policy};this.getGuid=function(){return K};this.setFeePolicy=function(aF){s.fee_policy=aF};this.getHTML5Notifications=function(){return s.html5_notifications};this.setHTML5Notifications=function(aF){s.html5_notifications=aF};this.getTransactions=function(){return C};this.addressExists=function(aF){return G[aF]!=null};this.getAddressTag=function(aF){return G[aF].tag};this.setAddressTag=function(aG,aF){G[aG].tag=aF};this.getAddressBook=function(){return g};this.getAddressLabel=function(aF){return G[aF].label};this.setAddressLabel=function(aF,aG){G[aF].label=aG};this.setAddressBalance=function(aF,aG){G[aF].balance=aG};this.getAddressBookLabel=function(aF){return g[aF]};this.isWatchOnly=function(aF){return G[aF].priv==null};this.getAddressBalance=function(aF){return G[aF].balance};this.getMixerFee=function(){return w};this.deleteAddress=function(aF){delete G[aF]};this.addAddressBookEntry=function(aG,aF){g[aG]=aF};this.getPrivateKey=function(aF){return G[aF].priv};this.setLabel=function(aF,aG){G[aF].label=aG;aa();c()};this.securePost=function(aF,aG){var aH=jQuery.extend({},aG);if(d==null||d.length==0||d.length!=36){throw"Shared key is invalid"}aH.sharedKey=d;aH.guid=K;aH.format="plain";return $.post(root+aF,aH)};this.setDoubleEncryption=function(aI){var aH=function(aK){console.log("Panic "+aK);window.location.reload()};try{if(D==aI){return}if(aI){var aF=$("#double-password").val();var aG=$("#double-password2").val();if(aF==null||aF.length==0||aF.length<4||aF.length>255){h.makeNotice("error","misc-error","Password must be 4 characters or more in length");return}if(aF!=aG){h.makeNotice("error","misc-error","Passwords do not match.");return}if(aF==av){h.makeNotice("error","misc-error","Second password should not be the same as your main password.");return}h.getSecondPassword(function(){try{D=true;ac=aF;for(var aM in G){var aO=G[aM];if(aO.priv!=null){aO.priv=i(B58.decode(aO.priv))}}var aK=Crypto.SHA256(d+ac,{asBytes:true});for(var aL=1;aL<Q;++aL){aK=Crypto.SHA256(aK,{asBytes:true})}v=Crypto.util.bytesToHex(aK);ac=null;h.getSecondPassword(function(){try{h.checkAllKeys();h.backupWallet("update",function(){setDoubleEncryptionButton()},function(){aH(aP)})}catch(aP){aH(aP)}},function(){aH()})}catch(aN){aH(aN)}},function(){aH()})}else{h.getSecondPassword(function(){try{for(var aK in G){var aM=G[aK];if(aM.priv!=null){aM.priv=h.decryptPK(aM.priv)}}D=false;ac=null;h.checkAllKeys();h.backupWallet("update",function(){setDoubleEncryptionButton()},function(){aH(aL)})}catch(aL){aH(aL)}},function(aK){aH(aK)})}}catch(aJ){aH(aJ)}};function J(){try{$(".pop").popover("hide")}catch(aF){}}$(window).resize(function(){$(".modal:visible").center();J()});this.setLoadingText=function(aF){$(".loading-text").text(aF)};function aB(aG,aF){aG.click(function(){y(aF.txIndex,aF.result)});aG.find(".show-note").mouseover(function(){var aH=aF.note?aF.note:b[aF.hash];ax(this,aH,aF.hash)});aG.find(".add-note").mouseover(function(){m(this,aF.hash)});return aG}function t(aG,aM){var aF=0;for(var aI=0;aI<aG.inputs.length;++aI){var aH=aG.inputs[aI].prev_out;if(!aH||!aH.addr){continue}var aL=G[aH.addr];if(aL){var aK=parseInt(aH.value);aF-=aK;if(aM){N+=aK;aL.balance-=aK}}}for(var aJ=0;aJ<aG.out.length;++aJ){var aH=aG.out[aJ];if(!aH||!aH.addr){continue}var aL=G[aH.addr];if(aL){var aK=parseInt(aH.value);aF+=aK;if(aM){ah+=aK;aL.balance+=aK}}}return aF}function x(aF){aF.onmessage=function(aN){try{var aK=$.parseJSON(aN.data);if(aK.op=="status"){$("#status").html(aK.msg)}else{if(aK.op=="on_change"){var aO=Crypto.util.bytesToHex(Crypto.SHA256(Z,{asBytes:true}));var aM=aK.checksum;console.log("On change old "+aO+" ==  new "+aM);if(aO!=aM){h.updateCacheManifest();setTimeout(H,250)}}else{if(aK.op=="utx"){var aL=TransactionFromJSON(aK.x);for(var aQ in C){if(C[aQ].txIndex==aL.txIndex){return}}var aS=t(aL,true);if(h.getHTML5Notifications()){var aJ=function(aT){try{if(window.webkitNotifications&&navigator.userAgent.indexOf("Chrome")>-1){if(webkitNotifications.checkPermission()==0){webkitNotifications.createNotification(aT.iconUrl,aT.title,aT.body).show()}}else{if(window.Notification){if(Notification.permissionLevel()==="granted"){new Notification(aT.title,aT).show()}}}}catch(aU){}};try{aJ({title:aS>0?"Payment Received":"Payment Sent",body:"Transaction Value "+formatBTC(aS)+" BTC",iconUrl:resource+"cube48.png"})}catch(aN){console.log(aN)}}aL.result=aS;al+=aS;I++;aL.setConfirmations(0);playSound("beep");if(ag==0&&aj==0){C.unshift(aL);var aP=false;if(C.length>50){C.pop();aP=true}}var aH=R();if("my-transactions"==aH){if(ag==0&&aj==0){$("#no-transactions").hide();if($("#tx_display").val()==0){var aG=$("#transactions-compact").show();aB($(A(aL,G,g)),aL).prependTo(aG.find("tbody")).find("div").hide().slideDown("slow");if(aP){aG.find("tbody tr:last-child").remove()}}else{var aG=$("#transactions-detailed").show();aG.prepend(aL.getHTML(G,g));if(aP){aG.find("div:last-child").remove()}}}}else{c()}}else{if(aK.op=="block"){for(var aI=0;aI<aK.x.txIndexes.length;++aI){for(var aR=0;aR<C.length;++aR){if(C[aR].txIndex==aK.x.txIndexes[aI]){if(C[aR].blockHeight==null||C[aR].blockHeight==0){C[aR].blockHeight=aK.x.height;break}}}}ak(BlockFromJSON(aK.x));T()}}}}}catch(aN){console.log(aN);console.log(aN.data)}};aF.onopen=function(){$("#status").html("CONNECTED.");var aJ='{"op":"blocks_sub"}';if(K!=null){aJ+='{"op":"wallet_sub","guid":"'+K+'"}'}try{var aH=h.getActiveAddresses();for(var aG in aH){aJ+='{"op":"addr_sub", "addr":"'+aH[aG]+'"}'}}catch(aI){alert(aI)}aF.send(aJ)};aF.onclose=function(){$("#status").html("DISCONNECTED.")}}this.makeNotice=function(aG,aJ,aI,aH){if(aI==null||aI.length==0){return}console.log(aI);if(aH==null){aH=5000}var aF=$('<div class="alert alert-block alert-'+aG+'"></div>');aF.text(""+aI);if($("#"+aJ).length>0){aF.attr("id",aJ);return}$("#notices").append(aF).hide().fadeIn(200);if(aH>0){(function(){var aK=aF;setTimeout(function(){aK.fadeOut(250,function(){$(this).remove()})},aH)})()}};function ar(aF){return aF}function ai(aF){return h.decryptPK(aF)}function W(aF){var aG=h.decodePK(aF);return Crypto.util.bytesToBase64(aG)}function k(aF){var aG=h.decodePK(aF);return Crypto.util.bytesToHex(aG)}this.base58ToSipa=function(aF,aK){var aG=h.decodePK(aF);var aH=new Bitcoin.ECKey(aG);while(aG.length<32){aG.unshift(0)}aG.unshift(128);if(aH.getBitcoinAddress().toString()==aK){}else{if(aH.getBitcoinAddressCompressed().toString()==aK){aG.push(1)}else{throw"Private Key does not match bitcoin address"+aK}}var aI=Crypto.SHA256(Crypto.SHA256(aG,{asBytes:true}),{asBytes:true});aG=aG.concat(aI.slice(0,4));var aJ=B58.encode(aG);return aJ};this.makeWalletJSON=function(aF){return aA(aF,K,d)};function aA(aJ,aG,aL){var aI=ar;if(aJ=="base64"){aI=W}else{if(aJ=="hex"){aI=k}else{if(aJ=="sipa"){aI=h.base58ToSipa}else{if(aJ=="base58"){aI=ai}}}}var aF='{\n	"guid" : "'+aG+'",\n	"sharedKey" : "'+aL+'",\n';if(D&&v!=null&&aI==ar){aF+='	"double_encryption" : '+D+',\n	"dpasswordhash" : "'+v+'",\n'}if(s){aF+='	"options" : '+JSON.stringify(s)+",\n"}aF+='	"keys" : [\n';for(var aH in G){var aK=G[aH];aF+='	{"addr" : "'+aK.addr+'"';if(aK.priv!=null){aF+=',\n	 "priv" : "'+aI(aK.priv,aK.addr)+'"'}if(aK.tag==2){aF+=',\n	 "tag" : '+aK.tag}if(aK.label!=null){aF+=',\n	 "label" : "'+aK.label+'"'}aF+="},\n";atLeastOne=true}if(atLeastOne){aF=aF.substring(0,aF.length-2)}aF+="\n	]";if(aq(g)>0){aF+=',\n	"address_book" : [\n';for(var aH in g){aF+='	{"addr" : "'+aH+'",\n';aF+='	 "label" : "'+g[aH]+'"},\n'}aF=aF.substring(0,aF.length-2);aF+="\n	]"}if(aq(b)>0){aF+=',\n	"tx_notes" : '+JSON.stringify(b)}aF+="\n}";return aF}this.get_history=function(aG,aF){BlockchainAPI.get_history(function(aH){F(aH,false);c();if(aG){aG()}},function(){if(aF){aF()}},ag,aj)};this.deleteAddressBook=function(aF){delete g[aF];aa();$("#send-coins").find(".tab-pane").trigger("show",true)};function u(aF){$("#send-coins").find(".tab-pane.active").trigger("show",aF);if(aF){BlockchainAPI.get_ticker();$(".send").attr("disabled",false)}}function l(aF,aG,aK){var aJ=aF.val();aF.empty();for(var aI in G){var aL=G[aI];if(!aL||aL.tag==2){continue}var aH=aL.label;if(!aH){aH=aL.addr.substring(0,15)+"..."}if(aG||aL.balance>0){aF.prepend('<option value="'+aL.addr+'">'+aH+" - "+formatBTC(aL.balance)+" BTC</option>")}}aF.prepend('<option value="any" selected>Any Address</option>');if(!aK&&aJ){aF.val(aJ)}}function r(aH,aI){l(aH.find('select[name="from"]'),false,aI);l(aH.find('select[name="change"]'),true,aI);aH.find('select[name="change"]').prepend('<option value="new">New Address</option>');if(aI){aH.find("input").val("");aH.find(".send-value-usd").text(formatSymbol(0,symbol_local)).val("");aH.find(".amount-needed").text(0)}var aG=aH.find(".recipient-container");if(aI){var aK=aG.find(".recipient:first-child").clone();aG.empty().append(aK)}function aF(){var aL=0;aH.find('input[name="send-value"]').each(function(){var aM=parseFloat($(this).val());if(!isNaN(aM)){aL+=aM}});return aL}function aJ(aL){aL.find('input[name="send-to-address"]').val("").typeahead({source:an()});aL.find(".local-symbol").text(symbol_local.symbol);aL.find('input[name="send-value"]').val("").bind("keyup change",function(aM){if(aM.keyCode=="9"){return}aH.find(".amount-needed").text(formatBTC(Bitcoin.Util.parseValue(aF().toFixed(8)).toString()));aL.find(".send-value-usd").val(convert($(this).val()*100000000,symbol_local.conversion)).text(formatSymbol($(this).val()*100000000,symbol_local))});aL.find(".send-value-usd").val("").text(formatSymbol(0,symbol_local)).bind("keyup change",function(aM){if(aM.keyCode=="9"){return}aL.find(".send-value").val(formatBTC(parseFloat($(this).val())*symbol_local.conversion))})}aG.find(".recipient").each(function(){aJ($(this))});aH.find(".remove-recipient").unbind().click(function(){var aL=aG.find(".recipient").length;if(aL>1){if(aL==2){$(this).hide(200)}aG.find(".recipient:last-child").remove()}});aH.find(".add-recipient").unbind().click(function(){var aL=aG.find(".recipient:first-child").clone();aL.appendTo(aG);aJ(aL);aH.find(".remove-recipient").show(200)})}this.getAllAddresses=function(){var aG=[];for(var aF in G){aG.push(aF)}return aG};this.getPreferredAddress=function(){var aG=null;for(var aF in G){var aH=G[aF];if(aG==null){aG=aH}if(aH.priv!=null){if(aG==null){aG=aH}if(aH.tag==null||aH.tag==0){aG=aH;break}}}return aG.addr};function S(aF){var aI=[];for(var aG in G){var aH=G[aG];if(aH.tag==aF){aI.push(aH.addr)}}return aI}this.getActiveAddresses=function(){return S()};this.getArchivedAddresses=function(){return S(2)};function ak(aI){if(aI!=null){at=aI;for(var aG in C){var aF=C[aG];if(aF.blockHeight!=null&&aF.blockHeight>0){var aH=at.height-aF.blockHeight+1;if(aH<=100){aF.setConfirmations(at.height-aF.blockHeight+1)}else{aF.setConfirmations(null)}}else{aF.setConfirmations(0)}}}}function y(aG,aF){loadScript("wallet/frame-modal.js",function(){showFrameModal({title:"Transaction Summary",description:"",src:root+"tx-summary/"+aG+"?result="+aF+"&guid="+K})})}this.deleteNote=function(aF){delete b[aF];c();aa()};function m(aF,aG){(function(aI,aK){aI=$(aI);if(!aI.data("popover")){aI.popover({title:"Add Note",trigger:"manual",content:'<textarea style="width:97%;height:50px;margin-top:2px" placeholder="Enter the note here..."></textarea><div style="text-align:right"><button class="btn btn-small">Save</button></div>'})}else{if(aI.data("popover").tip().is(":visible")){return}}aI.popover("show");aI.mouseleave(function(){if(!aI.__timeout){aI.__timeout=setTimeout(function(){aI.popover("hide")},250)}});function aH(){if(aI.__timeout){clearTimeout(aI.__timeout);aI.__timeout=null}}var aJ=aI.data("popover").tip().mouseenter(aH);aJ.find("textarea").focus(aH);aJ.mouseleave(function(){aI.__timeout=setTimeout(function(){aI.popover("hide")},250)});aJ.find("button").click(function(){var aL=$.trim($("<div>"+aJ.find("textarea").val()+"</div>").text().replace(/'/g,"").replace(/"/g,""));if(aL.length>0){b[aK]=aL;aa()}c()})})(aF,aG)}function ax(aF,aG,aH){(function(aI,aJ,aL){aI=$(aI);if(!aI.data("popover")){var aM="Note";if(b[aL]){aM+=' <span style="float:right"><img src="'+resource+'delete.png" /></span>'}$(aI).popover({title:aM,trigger:"manual",content:aJ})}else{if(aI.data("popover").tip().is(":visible")){return}}aI.popover("show");aI.mouseleave(function(){if(!aI.__timeout){aI.__timeout=setTimeout(function(){aI.popover("hide")},250)}});var aK=aI.data("popover").tip().mouseenter(function(){if(aI.__timeout){clearTimeout(aI.__timeout);aI.__timeout=null}});aK.find("img").unbind().click(function(){h.deleteNote(aL)});aK.mouseleave(function(){aI.__timeout=setTimeout(function(){aI.popover("hide")},250)})})(aF,aG,aH)}function A(aI,aN,aK){var aO=aI.result;var aJ='<tr class="pointer" id="tx-'+aI.txIndex+'"><td class="hidden-phone" style="width:365px"><div><ul style="margin-left:0px;" class="short-addr">';var aG=true;if(aO>=0){for(var aH=0;aH<aI.inputs.length;++aH){var aF=aI.inputs[aH].prev_out;if(!aF||!aF.addr){aG=false;aJ+='<span class="label">Newly Generated Coins</span>'}else{var aL=aN[aF.addr];if(aL){continue}aG=false;aJ+=formatOutput(aF,aN,aK)}}}else{if(aO<0){for(var aH=0;aH<aI.out.length;++aH){var aF=aI.out[aH];var aL=aN[aF.addr];if(aL&&aF.type==0){continue}aG=false;aJ+=formatOutput(aF,aN,aK)}}}if(aG){aJ+='<span class="label">Moved Between Wallet</info>'}aJ+="</ul></div></td><td><div>";var aM=aI.note?aI.note:b[aI.hash];if(aM){aJ+='<img src="'+resource+'note.png" class="pop show-note"> '}else{aJ+='<img src="'+resource+'note_grey.png" class="pop add-note"> '}if(aI.time>0){aJ+=dateToString(new Date(aI.time*1000))}if(aI.confirmations==0){aJ+=' <span class="label label-important pull-right hidden-phone">Unconfirmed Transaction!</span> '}else{if(aI.confirmations>0){aJ+=' <span class="label label-info pull-right hidden-phone">'+aI.confirmations+" Confirmations</span> "}}aJ+="</div></td>";if(aO>0){aJ+='<td style="color:green"><div>'+formatMoney(aO,true)+"</div></td>"}else{if(aO<0){aJ+='<td style="color:red"><div>'+formatMoney(aO,true)+"</div></td>"}else{aJ+="<td><div>"+formatMoney(aO,true)+"</div></td>"}}if(aI.balance==null){aJ+="<td></td></tr>"}else{aJ+='<td class="hidden-phone"><div>'+formatMoney(aI.balance)+"</div></td></tr>"}return aJ}function R(){J();if(al==null){$("#balance").html("Loading...")}else{$("#balance").html(formatSymbol(al,symbol));$("#balance2").html(formatSymbol(al,(symbol==symbol_local)?symbol_btc:symbol_local))}return j.attr("id")}function c(aF){var aG=R();if("send-coins"==aG){u(aF)}else{if("home-intro"==aG){f(aF)}else{if("receive-coins"==aG){aE(aF)}else{if("my-transactions"==aG){T(aF)}}}}}function f(aF){$("#summary-n-tx").html(I);$("#summary-received").html(formatMoney(ah,true));$("#summary-sent").html(formatMoney(N,true));$("#summary-balance").html(formatMoney(al,symbol));var aH=h.getPreferredAddress();$("#tweet-for-btc").unbind().click(function(){window.open("https://twitter.com/share?url=https://blockchain.info/wallet&hashtags=tweet4btc,bitcoin,"+aH+"&text=Sign Up For a Free Bitcoin Wallet @ Blockchain.info","","toolbar=0, status=0, width=650, height=360")});if(h.isWatchOnly(aH)==null){$(".no-watch-only").hide()}else{$(".no-watch-only").show();var aG=$("#my-primary-address");if(aG.text()!=aH){aG.text(aH);$("#my-primary-addres-qr-code").html('<img style="padding-right:10px;padding-bottom:10px" src="'+root+"qr?data="+aH+'&size=125">')}}}function O(){var aF=$("#export-warning").show();var aG=$("#import-export-content").hide();$("#show-import-export").unbind().click(function(){h.getMainPassword(function(){aF.hide();loadScript("wallet/import-export.min.js",function(){ImportExport.init(aG,function(){aG.show()},function(){Y($("#home-intro"))})},function(aH){h.makeNotice("error","misc-error",aH);Y($("#home-intro"))})},function(){Y($("#home-intro"))})})}function T(){var aI=$("#tx_display").val();var aG=null;var aJ=0;if(aG!=null){clearInterval(aG);aG=null}var aF;if(aI==0){$("#transactions-detailed").hide();aF=$("#transactions-compact").show().find("tbody").empty()}else{$("#transactions-compact").hide();aF=$("#transactions-detailed").empty().show()}if(C.length==0){$("#transactions-detailed, #transactions-compact").hide();$("#no-transactions").show();return}else{$("#no-transactions").hide()}var aH=function(){for(var aN=aJ;aN<C.length&&aN<(aJ+10);++aN){var aM=C[aN];if(aI==0){aF.append(aB($(A(aM,G,g)),aM))}else{aF.append(aM.getHTML(G,g))}}aJ+=10;if(aJ<C.length){aG=setTimeout(aH,15)}else{var aL=$(".pagination ul").empty();if(aj==0&&C.length<50){aL.hide();return}else{aL.show()}var aK=Math.ceil(aD/50);var aO=" disabled";if(aj>0){aO=""}aL.append($('<li class="prev'+aO+'"><a>&larr; Previous</a></li>').click(function(){h.setPage(aj-1)}));for(var aN=0;aN<aK&&aN<=10;++aN){(function(aP){var aQ="";if(aj==aP){aQ=' class="active"'}aL.append($("<li"+aQ+'><a class="hidden-phone">'+aP+"</a></li>").click(function(){h.setPage(aP)}))})(aN)}var aO=" disabled";if(aj<aK){aO=""}aL.append($('<li class="next'+aO+'"><a>Next &rarr;</a></li>').click(function(){h.setPage(aj+1)}))}};aH()}this.setPage=function(aF){aj=aF;scroll(0,0);h.get_history()};function F(aH,aI){var aK=$.parseJSON(aH);if(!aI&&aK.mixer_fee){w=aK.mixer_fee}C.length=0;if(aK.wallet==null){ah=0;N=0;al=0;I=0;aD=0;return}ah=aK.wallet.total_received;N=aK.wallet.total_sent;al=aK.wallet.final_balance;I=aK.wallet.n_tx;aD=aK.wallet.n_tx_filtered;for(var aG=0;aG<aK.addresses.length;++aG){if(G[aK.addresses[aG].address]){G[aK.addresses[aG].address].balance=aK.addresses[aG].final_balance}}for(var aG=0;aG<aK.txs.length;++aG){var aF=TransactionFromJSON(aK.txs[aG]);aF.result=t(aF,false);C.push(aF)}if(aK.info){$("#nodes-connected").html(aK.info.nconnected);if(aK.info.latest_block!=null){ak(aK.info.latest_block)}var aJ=aK.info.symbol_local;if(symbol==symbol_local){symbol_local=aJ;symbol=aJ;calcMoney()}else{if(!aI){symbol_local=aJ}}}}function ay(){P=setTimeout(h.logout,h.getLogoutTime());for(var aH in U){U[aH]("did_decrypt")}window.location.hash="";try{var aF=localStorage.getItem("guid");if(aF!=K){localStorage.clear();if(K!=B){localStorage.setItem("guid",K)}}else{var aG=localStorage.getItem("multiaddr");if(aG!=null){F(aG,true);c()}}}catch(aI){}h.get_history();Y($("#home-intro"));$("#initial_error,#initial_success").remove()}function H(){for(var aF in G){var aG=G[aF];if(aG.tag==1){alert("Warning! wallet data may have changed but cannot sync as you have uns-saved keys");return}}console.log("Get wallet with checksum "+am);$.get(root+"wallet/wallet.aes.json?guid="+K+"&sharedKey="+d+"&checksum="+am+"&format=plain").success(function(aH){if(aH==null||aH.length==0){return}if(aH=="Not modified"){console.log("Not modified");return}else{console.log("Wallet data modified");Z=aH;am=Crypto.util.bytesToHex(Crypto.SHA256(Z,{asBytes:true}));V();h.get_history();c()}})}function V(){try{if(Z==null||Z.length==0){h.makeNotice("error","misc-error","No Wallet Data To Decrypt");return false}var aI=null;h.decrypt(Z,av,function(aJ){try{aI=$.parseJSON(aJ);return(aI!=null)}catch(aK){return false}});if(aI==null){throw"Error Decrypting Wallet. Please check your password is correct."}if(aI.double_encryption&&aI.dpasswordhash){D=aI.double_encryption;v=aI.dpasswordhash}if(aI.options){$.extend(s,aI.options)}else{if(aI.fee_policy){h.setFeePolicy(aI.fee_policy)}if(aI.html5_notifications){h.setHTML5Notifications(aI.html5_notifications)}}G.length=0;for(var aG=0;aG<aI.keys.length;++aG){var aF=aI.keys[aG];if(aF.addr==null||aF.addr.length==0||aF.addr=="undefined"){h.makeNotice("error","null-error","Your wallet contains an undefined address. This is a sign of possible corruption, please double check all your BTC is accounted for. Backup your wallet to remove this error.",15000);continue}G[aF.addr]=aF}g={};if(aI.address_book!=null){for(var aG=0;aG<aI.address_book.length;++aG){h.addAddressBookEntry(aI.address_book[aG].addr,aI.address_book[aG].label)}}if(aI.tx_notes){b=aI.tx_notes}d=aI.sharedKey;if(d==null||d.length==0||d.length!=36){throw"Shared Key is invalid"}if(am==null||am.length==0){am=Crypto.util.bytesToHex(Crypto.SHA256(Z,{asBytes:true}))}else{H()}e();return true}catch(aH){h.makeNotice("error","misc-error",aH)}return false}this.getPassword=function(aK,aL,aI){aK.modal({keyboard:true,backdrop:"static",show:true});aK.center();var aH=aK.find('input[name="password"]');var aG=aH,aF=false,aJ=false;aK.find(".vkeyboard li").click(function(){var aO=$(this),aN=aO.html();if(aO.hasClass("left-shift")||aO.hasClass("right-shift")){$(".letter").toggleClass("uppercase");$(".symbol span").toggle();aF=(aF===true)?false:true;aJ=false;return false}if(aO.hasClass("capslock")){$(".letter").toggleClass("uppercase");aJ=true;return false}if(aO.hasClass("delete")){var aM=aG.val();aG.val(aM.substr(0,aM.length-1));return false}if(aO.hasClass("symbol")){aN=$("span:visible",aO).html()}if(aO.hasClass("space")){aN=" "}if(aO.hasClass("tab")){aN="\t"}if(aO.hasClass("return")){aN="\n"}if(aO.hasClass("uppercase")){aN=aN.toUpperCase()}if(aF===true){$(".symbol span").toggle();if(aJ===false){$(".letter").toggleClass("uppercase")}aF=false}aG.val(aG.val()+aN)});aH.unbind().keypress(function(aM){if(aM.keyCode==13){aM.preventDefault();aK.find(".btn.btn-primary").click()}});aH.val("");aK.find(".btn.btn-primary").unbind().click(function(){if(aL){aI=null;var aM=aL;aL=null;aK.modal("hide");setTimeout(function(){aM(aH.val())},100)}});aK.find(".btn.btn-secondary").unbind().click(function(){if(aI){var aM=aI;aI=null;setTimeout(function(){try{aM()}catch(aN){h.makeNotice("error","misc-error",aN)}},100)}aK.modal("hide")});aK.unbind().on("hidden",function(){if(aI){var aM=aI;aI=null;setTimeout(function(){try{aM()}catch(aN){h.makeNotice("error","misc-error",aN)}},100)}})};this.makePairingQRCode=function(aF){h.getMainPassword(function(){loadScript("wallet/qr.code.creator.js",function(){try{var aG=makeQRCode(300,300,1,K+"|"+d+"|"+av);aF(aG)}catch(aH){h.makeNotice("error","misc-error",aH)}})},function(){h.logout()})};this.getMainPassword=function(aG,aF){if(z>new Date().getTime()-L){return aG(av)}h.getPassword($("#main-password-modal"),function(aH){if(av==aH){z=new Date().getTime();if(aG){try{aG(av)}catch(aI){h.makeNotice("error","misc-error",aI)}}}else{h.makeNotice("error","misc-error","Password incorrect.");if(aF){try{aF()}catch(aI){h.makeNotice("error","misc-error",aI)}}}},aF)};this.getSecondPassword=function(aH,aF){if(!D||ac!=null){if(aH){try{aH(ac)}catch(aG){h.makeNotice("error","misc-error",aG)}}return}h.getPassword($("#second-password-modal"),function(aI){if(aw(aI)){if(aH){try{aH(aI)}catch(aJ){h.makeNotice("error","misc-error",aJ)}}}else{h.makeNotice("error","misc-error","Password incorrect.");if(aF){try{aF()}catch(aJ){h.makeNotice("error","misc-error",aJ)}}}},aF)};function a(){var aF=$("#restore-password");av=$.trim(aF.val());aF.val("");z=new Date().getTime();if(Z==null||Z.length==0){h.setLoadingText("Validating Authentication key");var aG=$.trim($(".restore-auth-"+q).find(".code").val());if(aG.length==0||aG.length>255){h.makeNotice("error","misc-error","You must enter a Two Factor Authentication code");return false}$.post(root+"wallet",{guid:K,payload:aG,length:aG.length,method:"get-wallet",format:"plain"},function(aH){try{if(aH==null||aH.length==0){h.makeNotice("error","misc-error","Server Return Empty Wallet Data");return}Z=aH;$(".restore-auth-"+q).hide();$(".restore-auth-0").show();if(V()){n();ay()}}catch(aI){h.makeNotice("error","misc-error",aI)}}).error(function(aH){h.makeNotice("error","misc-error",aH.responseText)})}else{if(V()){n();ay()}}return true}function e(){webSocketConnect(x);$("#tech-faq").hide();$("#intro-text").hide();$("#large-summary").show();$("#status-container").show()}this.quickSendNoUI=function(aH,aG,aF){loadScript("wallet/signer.min.js",function(){h.getSecondPassword(function(){try{var aJ=initNewTx();aJ.from_addresses=h.getActiveAddresses();aJ.to_addresses.push({address:new Bitcoin.Address(aH),value:Bitcoin.Util.parseValue(aG)});aJ.addListener(aF);aJ.start()}catch(aI){aF.on_error(aI)}},function(aI){aF.on_error(aI)})})};function E(){h.setLoadingText("Sending email backup");$.post(root+"wallet",{guid:K,sharedKey:d,method:"email-backup",format:"plain"},function(aF){h.makeNotice("success","backup-success",aF)}).error(function(aF){h.makeNotice("error","misc-error",aF.responseText)})}this.updateCacheManifest=function(aF){try{var aG=window.applicationCache;console.log("Clear Cache Manifest");aG.addEventListener("updateready",function(aI){aG.swapCache();if(aF){aF()}},false);aG.addEventListener("noupdate",function(aI){if(aF){aF()}},false);aG.addEventListener("error",function(aI){if(aF){aF()}},false);aG.update()}catch(aH){console.log(aH);if(aF){aF()}}};function aa(aI,aH,aG,aF){if(ae!=null){clearInterval(ae);ae=null}ae=setTimeout(function(){h.backupWallet(aI,aH,aG,aF)},3000)}this.insertWallet=function(aM,aO,aP,aF,aH,aN){try{var aI=aA(null,aM,aO);var aL=h.encrypt(aI,aP);if(aL.length==0){throw"Error encrypting the JSON output"}var aG=null;h.decrypt(aL,aP,function(aQ){try{aG=$.parseJSON(aQ);return(aG!=null)}catch(aR){return false}});if(aG==null){throw"Error Decrypting Previously encrypted JSON. Not Saving Wallet."}var aJ=Crypto.util.bytesToHex(Crypto.SHA256(aL,{asBytes:true}));h.setLoadingText("Saving wallet");if(aF==null){aF=""}Z=aL;$.ajax({type:"POST",url:root+"wallet"+aF,data:{guid:aM,length:aL.length,payload:aL,sharedKey:aO,checksum:aJ,method:"insert"},converters:{"* text":window.String,"text html":true,"text json":window.String,"text xml":window.String},success:function(aR){var aT=false;for(var aQ in G){var aS=G[aQ];if(aS.tag==1){aS.tag=null;aT=true}}am=aJ;h.makeNotice("success","misc-success",aR);c();if(aH!=null){aH()}h.updateCacheManifest()},error:function(aQ){h.makeNotice("error","misc-error",aQ.responseText,10000);c();if(aN!=null){aN()}}})}catch(aK){h.makeNotice("error","misc-error","Error Saving Wallet: "+aK,10000);c();if(aN!=null){aN(aK)}else{throw aK}}};this.backupWallet=function(aM,aL,aF){try{if(aM==null){aM="update"}if(aq(G)==0){return}var aH=h.makeWalletJSON();var aK=h.encrypt(aH,av);if(aK.length==0){throw"Error encrypting the JSON output"}var aJ=null;h.decrypt(aK,av,function(aN){try{aJ=$.parseJSON(aN);return(aJ!=null)}catch(aO){return false}});if(aJ==null){throw"Error Decrypting Previously encrypted JSON. Not Saving Wallet."}var aG=Crypto.util.bytesToHex(Crypto.SHA256(aK,{asBytes:true}));h.setLoadingText("Saving wallet");Z=aK;$.ajax({type:"POST",url:root+"wallet",data:{guid:K,length:aK.length,payload:aK,sharedKey:d,checksum:aG,old_checksum:am,method:aM},converters:{"* text":window.String,"text html":true,"text json":window.String,"text xml":window.String},success:function(aO){var aQ=false;for(var aN in G){var aP=G[aN];if(aP.tag==1){aP.tag=null;aQ=true}}am=aG;h.makeNotice("success","misc-success",aO);c();if(aL!=null){aL()}h.updateCacheManifest()},error:function(aN){h.makeNotice("error","misc-error",aN.responseText,10000);c();if(errorcallback!=null){errorcallback()}}})}catch(aI){h.makeNotice("error","misc-error","Error Saving Wallet: "+aI,10000);c();if(errorcallback!=null){errorcallback(aI)}else{throw aI}}};function az(aF){if(D){if(ac==null){throw"Cannot encrypt private key without a password"}return h.encrypt(aF,d+ac)}else{return aF}return null}this.isBase58=function(aH,aG){for(var aF=0;aF<aH.length;++aF){if(aH[aF]<0||aH[aF]>58){return false}}return true};this.encrypt=function(aG,aF){return Crypto.AES.encrypt(aG,aF,{mode:new Crypto.mode.CBC(Crypto.pad.iso10126),iterations:Q})};this.decrypt=function(aI,aH,aK,aG){try{var aF=Crypto.AES.decrypt(aI,aH,{mode:new Crypto.mode.CBC(Crypto.pad.iso10126),iterations:Q});if(aF!=null&&aF.length>0){if(aK(aF)){return aF}}}catch(aJ){console.log(aJ)}try{var aF=Crypto.AES.decrypt(aI,aH,{mode:new Crypto.mode.OFB(Crypto.pad.iso7816),iterations:1});if(aF!=null&&aF.length>0){if(aK(aF)){return aF}}}catch(aJ){console.log(aJ)}try{var aF=Crypto.AES.decrypt(aI,aH,{mode:new Crypto.mode.CBC(Crypto.pad.iso10126),iterations:1});if(aF!=null&&aF.length>0){if(aK(aF)){return aF}}}catch(aJ){console.log(aJ)}if(aG!=null){aG()}return null};this.setGUID=function(aG,aF){h.setLoadingText("Changing Wallet Identifier");$("#initial_error,#initial_success").remove();$.get(root+"wallet/"+aG,{format:"json",resend_code:aF}).success(function(aI){$(".restore-auth-"+q).hide();K=aI.guid;q=aI.auth_type;am=aI.payload_checksum;Z=aI.payload;war_checksum=aI.war_checksum;symbol_local=aI.symbol_local;$("#restore-guid").val(K);$(".restore-auth-"+q).show();if(aI.initial_error){h.makeNotice("error","misc-error",aI.initial_error)}if(aI.initial_success){h.makeNotice("success","misc-success",aI.initial_success)}try{localStorage.clear();if(K!=B){localStorage.setItem("guid",K)}}catch(aH){}}).error(function(aI){console.log(aI);try{var aH=$.parseJSON(aI.responseText);if(aH.initial_error){h.makeNotice("error","misc-error",aH.initial_error);return}}catch(aI){}h.makeNotice("error","misc-error","Error changing wallet identifier")})};function i(aF){var aG=B58.encode(aF);return az(aG)}this.decryptPK=function(aF){if(D){if(ac==null){throw"Cannot decrypt private key without a password"}return h.decrypt(aF,d+ac,h.isBase58)}else{return aF}return null};this.decodePK=function(aG){var aF=h.decryptPK(aG);if(aF!=null){return B58.decode(aF)}return null};this.signmessage=function(aF,aH){var aJ=G[aF];var aI=h.decodePK(aJ.priv);var aG=new Bitcoin.ECKey(aI);return Bitcoin.Message.signMessage(aG,aH,aJ.addr)};function aw(aG){var aF=Crypto.SHA256(d+aG,{asBytes:true});var aI=aF;for(var aH=1;aH<Q;++aH){aI=Crypto.SHA256(aI,{asBytes:true})}var aK=Crypto.util.bytesToHex(aI);if(aK==v){ac=aG;return true}if(Crypto.util.bytesToHex(aF)==v){ac=aG;v=aK;return true}var aJ=Crypto.SHA256(aG);if(aJ==v){ac=aG;v=aK;return true}return false}this.checkAllKeys=function(aF){for(var aG in G){var aK=G[aG];if(aK.addr==null){throw"Null Address Found in wallet "+aG}if(aK.addr.toString()==null){throw"Error decoding wallet address "+aK.addr}if(aK.priv!=null){var aJ=h.decodePK(aK.priv);var aI=new Bitcoin.ECKey(aJ);var aH=aI.getBitcoinAddress().toString();if(aH!=aK.addr&&aI.getBitcoinAddressCompressed().toString()!=aK.addr){throw"Private key does not match bitcoin address "+aK.addr+" != "+aH}if(aF){aK.priv=i(aJ)}}}h.makeNotice("success","wallet-success","Wallet verified.")};this.setMainPassword=function(aF){h.getMainPassword(function(){av=aF;h.backupWallet("update",function(){h.updateCacheManifest(function(){h.logout()})},function(){h.logout()})})};function Y(aF){if(aF===j){return}if(j!=null){if($("#"+j.attr("id")+"-btn").length>0){$("#"+j.attr("id")+"-btn").parent().attr("class","")}j.hide()}j=aF;j.show();if($("#"+j.attr("id")+"-btn").length>0){$("#"+j.attr("id")+"-btn").parent().attr("class","active")}c(true)}function aq(aH){var aG=0,aF;for(aF in aH){aG++}return aG}function X(aF){G[aF].priv=null}function ab(){if(aq(G)>=ao){h.makeNotice("error","misc-error","We currently support a maximum of "+ao+" private keys, please remove some unused ones.");return true}return false}function aC(aH,aF){var aG=G[aH];if(!aG||aG.length==0){G[aH]={addr:aH,priv:aF,balance:0};return true}else{if(!aG.priv&&aF){aG.priv=aF;return true}}return false}function o(){var aH=$("#add-address-book-entry-modal");aH.modal({keyboard:true,backdrop:"static",show:true});var aF=aH.find('input[name="label"]');var aG=aH.find('input[name="address"]');aF.val("");aG.val("");aH.find(".btn.btn-primary").unbind().click(function(){aH.modal("hide");var aJ=$.trim($("<div>"+aF.val()+"</div>").text());var aI=$.trim(aG.val());if(aJ.length==0){h.makeNotice("error","misc-error","You must enter a label for the address book entry");return false}if(aJ.indexOf('"')!=-1){h.makeNotice("error","misc-error","Label cannot contain double quotes");return false}if(aI.length==0){h.makeNotice("error","misc-error","You must enter a bitcoin address for the address book entry");return false}var aL;try{aL=new Bitcoin.Address(aI);if(aL==null){throw"Null address"}}catch(aK){h.makeNotice("error","misc-error","Bitcoin address invalid, please make sure you entered it correctly");return false}if(g[aI]!=null){h.makeNotice("error","misc-error","Bitcoin address already exists");return false}h.makeNotice("success","misc-success","Added Address book entry");h.addAddressBookEntry(aI,aJ);aa();$("#send-coins").find(".tab-pane").trigger("show",true)});aH.find(".btn.btn-secondary").unbind().click(function(){aH.modal("hide")})}this.logout=function(){$.get(root+"wallet/logout?format=plain").success(function(){window.location.reload()}).error(function(){window.location.reload()})};function af(aL){var aN=$("#delete-address-modal");aN.modal({keyboard:true,backdrop:"static",show:true});aN.find(".btn.btn-primary").hide();aN.find(".btn.btn-danger").hide();$("#change-mind").hide();aN.find("#to-delete-address").html(aL.join(" "));aN.find("#delete-balance").empty();var aH=aN.find("#delete-balance");var aF=[];for(var aK in aL){var aM=aL[aK];if(G[aM]&&G[aM].priv){aF.push(aL[aK])}}BlockchainAPI.get_balance(aF,function(aO){aN.find(".btn.btn-primary").show(200);aN.find(".btn.btn-danger").show(200);aH.html("Balance "+formatBTC(aO)+" BTC");if(aO>0){aH.css("color","red")}else{aH.css("color","black")}},function(){aN.find(".btn.btn-primary").show(200);aN.find(".btn.btn-danger").show(200);aH.text("Error Fetching Balance")});var aI=false;var aK=0;var aG=null;var aJ=10;changeMind=function(){$("#change-mind").show();$("#change-mind-time").text(aJ-aK)};aN.find(".btn.btn-primary").unbind().click(function(){changeMind();aN.find(".btn.btn-primary").hide();aN.find(".btn.btn-danger").hide();aG=setInterval(function(){if(aI){return}++aK;changeMind();if(aK==aJ){$("#delete-address-modal").modal("hide");h.makeNotice("warning","warning-deleted","Private Key Removed From Wallet");for(var aO in aL){X(aL[aO])}c();h.backupWallet();clearInterval(aG)}},1000)});aN.find(".btn.btn-danger").unbind().click(function(){changeMind();aN.find(".btn.btn-primary").hide();aN.find(".btn.btn-danger").hide();aG=setInterval(function(){if(aI){return}++aK;changeMind();if(aK==aJ){try{$("#delete-address-modal").modal("hide");h.makeNotice("warning","warning-deleted","Address & Private Key Removed From Wallet");for(var aO in aL){h.deleteAddress(aL[aO])}c();h.backupWallet("update",function(){h.get_history()})}finally{clearInterval(aG)}}},1000)});aN.unbind().on("hidden",function(){if(aG){aI=true;clearInterval(aG);aG=null}});aN.find(".btn.btn-secondary").unbind().click(function(){aN.modal("hide")})}function an(){var aH=[];for(var aF in g){aH.push(g[aF])}for(var aF in G){var aG=G[aF];if(aG.tag!=2&&aG.label){aH.push(aG.label)}}return aH}function M(aF){h.getSecondPassword(function(){var aH=$("#sweep-address-modal");aH.modal("show");BlockchainAPI.get_balance(aF,function(aI){aH.find(".balance").text("Amount: "+formatBTC(aI)+" BTC")},function(){aH.find(".balance").text("Error Fetching Balance")});var aG=aH.find('select[name="change"]');l(aG,true);aH.find(".btn.btn-primary").unbind().click(function(){loadScript("wallet/signer.min.js",function(){BlockchainAPI.get_balance(aF,function(aI){var aJ=initNewTx();aJ.fee=aJ.base_fee;aJ.to_addresses.push({address:new Bitcoin.Address($.trim(aG.val())),value:BigInteger.valueOf(aI).subtract(aJ.fee)});aJ.from_addresses=aF;aJ.start()},function(){h.makeNotice("error","misc-error","Error Getting Address Balance")})});aH.modal("hide")});aH.find(".btn.btn-secondary").unbind().click(function(){aH.modal("hide")})})}function ap(){try{$(".pop").popover({offset:10,placement:"bottom"})}catch(aF){}}function n(){$("#add-address-book-entry-btn").click(function(){o()});$("#home-intro-btn").click(function(){Y($("#home-intro"))});$("#my-transactions-btn").click(function(){Y($("#my-transactions"))});$("#send-coins-btn").click(function(){Y($("#send-coins"))});$("#import-export-btn").click(function(){Y($("#import-export"));O()});$("#chord-diagram").click(function(){window.open(root+"taint/"+h.getActiveAddresses().join("|"),null,"width=850,height=850")});$("#verify-message").click(function(){loadScript("wallet/address_modal.min.js",function(){verifyMessageModal()})});$("#group-received").click(function(){loadScript("wallet/taint_grouping.min.js",function(){try{loadTaintData()}catch(aH){h.makeNotice("error","misc-error","Unable To Load Taint Grouping Data")}})});$("#my-account-btn").click(function(){Y($("#my-account"));var aH=$("#account-settings-warning").show();var aI=$("#my-account-content").hide();$("#show-account-settings").unbind().click(function(){h.getMainPassword(function(){aH.hide();loadScript("wallet/account.min.js",function(){AccountSettings.init(aI,function(){aI.show()},function(){Y($("#home-intro"))})},function(aJ){h.makeNotice("error","misc-error",aJ);Y($("#home-intro"))})},function(){Y($("#home-intro"))})})});$(".download-backup-btn").click(function(){window.open(root+"wallet/wallet.aes.json?guid="+K+"&sharedKey="+d)});$("#enable_archived_checkbox").change(function(){var aH=$(this).is(":checked");$(".archived_checkbox").attr("checked",false);$(".archived_checkbox").attr("disabled",!aH);$("#archived-sweep").attr("disabled",!aH);$("#archived-delete").attr("disabled",!aH)});$("#anonymous-addresses").on("show",function(){var aH=$(this);loadScript("wallet/anonymous-addresses.min.js",function(){buildAnonymousTable(aH)})});$("#active-addresses").on("show",function(){var aN=$(this).find("table:first");aN.find("tbody:gt(0)").remove();var aK=aN.find("tbody").empty();for(var aM in G){var aO=G[aM];if(aO.tag==2){continue}var aL="";if(aO.tag==1){aL=' <font color="red" class="pop" title="Not Synced" data-content="This is a new address which has not yet been synced with our the server. Do not used this address yet.">(Not Synced)</font>'}else{if(aO.priv==null){aL=' <font color="red" class="pop" title="Watch Only" data-content="Watch Only means there is no private key associated with this bitcoin address. <br /><br /> Unless you have the private key stored elsewhere you do not own the funds at this address and can only observe the transactions.">(Watch Only)</font>'}}var aH="";var aJ=aO.addr;if(aO.label!=null){aJ=aO.label;aH='<span class="hidden-phone"> - '+aO.addr+"</span>"}var aI=$('<tr><td><div class="short-addr"><a href="'+root+"address/"+aO.addr+'" target="new">'+aJ+"</a>"+aH+" "+aL+'<div></td><td><span style="color:green">'+formatMoney(aO.balance,true)+'</span></td>            <td><div class="btn-group pull-right"><a class="btn btn-mini dropdown-toggle" data-toggle="dropdown" href="#"><span class="hidden-phone">Actions </span><span class="caret"></span></a><ul class="dropdown-menu">             <li><a href="#" class="pop act-archive" title="Archive Address" data-content="Click this button to hide the address from the main view. You can restore or delete later by finding it in the Archived addresses tab.">Archive Address</a></li>            <li><a href="#" class="pop act-label" title="Label Address" data-content="Set the label for this address.">Label Address</a></li>            <li><a href="#" class="pop act-qr" title="Show QR Code" data-content="Show a QR Code for this address.">QR Code</a></li>            <li><a href="#" class="pop act-sign" title="Sign Message" data-content="Sign A message with this address.">Sign Message</a></li>            <li><a href="#" class="pop act-request" title="Request Payment" data-content="Click here to create a new QR Code payment request. The QR Code can be scanned using most popular bitcoin software and mobile apps.">Create Payment Request</a></li>            </ul></div></td></tr>');(function(aP){aI.find(".act-archive").click(function(){h.archiveAddr(aP)});aI.find(".act-label").click(function(){loadScript("wallet/address_modal.min.js",function(){showLabelAddressModal(aP)})});aI.find(".act-qr").click(function(){loadScript("wallet/address_modal.min.js",function(){showAddressModalQRCode(aP)})});aI.find(".act-sign").click(function(){loadScript("wallet/address_modal.min.js",function(){showAddressModalSignMessage(aP)})});aI.find(".act-request").click(function(){loadScript("wallet/frame-modal.js",function(){showFrameModal({title:"Create Payment Request",description:"Request Payment into address <b>"+aP+"</b>",src:root+"payment_request?address="+aP})})})})(aO.addr);if(aO.balance>0&&aO.priv){aN.prepend(aI)}else{aN.append(aI)}}ap()});$("#archived-addresses").on("show",function(){$("#enable_archived_checkbox").attr("checked",false);$("#archived-delete").attr("disabled",true);$("#archived-sweep").attr("disabled",true);$("#archived-addr tbody").empty();var aI=$(this).find("tbody");var aH=h.getArchivedAddresses();var aJ=function(){aI.empty();for(var aN in aH){var aP=G[aH[aN]];if(aP.tag!=2){continue}var aM="";if(aP.priv==null){aM=' <font color="red">(Watch Only)</font>'}var aK="";var aL=aP.addr;if(aP.label!=null){aL=aP.label;aK='<span class="hidden-phone"> - '+aP.addr+"</span>"}var aO=$('<tr><td style="width:20px;"><input type="checkbox" class="archived_checkbox" value="'+aP.addr+'" disabled></td><td><div class="short-addr"><a href="'+root+"address/"+aP.addr+'" target="new">'+aL+"</a>"+aK+" "+aM+'<div></td><td><span style="color:green">'+formatBTC(aP.balance)+'<span class="hidden-phone"> BTC</span></span></td><td style="width:16px"><img src="'+resource+'unarchive.png" class="act-unarchive" /></td></tr>');(function(aQ){aO.find(".act-unarchive").click(function(){h.unArchiveAddr(aQ)})})(aP.addr);if(aP.balance>0&&aP.priv){aI.prepend(aO)}else{aI.append(aO)}}};aJ();BlockchainAPI.get_balances(aH,function(aK){aJ()},function(aK){h.makeNotice("error","misc-error",aK)})});$("#archived-sweep").click(function(){var aH=[];$(".archived_checkbox:checked").each(function(){var aI=G[$(this).val()];if(aI.priv==null){h.makeNotice("error","misc-error","Cannot Sweep Watch Only Address");return}aH.push(aI.addr)});if(aH.length==0){return}M(aH)});$("#archived-delete").click(function(){var aH=[];$(".archived_checkbox:checked").each(function(){aH.push($(this).val())});if(aH.length==0){return}af(aH)});$("#anonymous-never-ask").click(function(){SetCookie("anonymous-never-ask",$(this).is(":checked"))});$("#export-history").click(function(){loadScript("wallet/frame-modal.js",function(){showFrameModal({title:"Export History",description:"",src:root+"export-history?active="+h.getActiveAddresses().join("|")+"&archived="+h.getArchivedAddresses().join("|")})})});$(".deposit-btn").click(function(){var aI=$(this);var aH=h.getPreferredAddress();loadScript("wallet/frame-modal.js",function(){showFrameModal({title:aI.data("title"),description:"Deposit into address <b>"+aH+"</b>",top_right:'Have Questions? Read <a href="'+aI.data("link")+'" target="new">How It Works</a>',src:root+"deposit?address="+aH+"&ptype="+aI.data("type")+"&guid="+K+"&sharedKey="+d})})});$(".withdraw-btn").click(function(){var aH=$(this);h.getSecondPassword(function(){var aI=h.getPreferredAddress();loadScript("wallet/frame-modal.js",function(){showFrameModal({title:aH.data("title"),description:"Your Wallet Balance is <b>"+formatBTC(al)+" BTC</b>",src:root+"withdraw?method="+aH.data("type")+"&address="+aI+"&balance="+al+"&guid="+K+"&sharedKey="+d})})})});$("#logout").click(h.logout);$("#refresh").click(function(){H();h.get_history()});$("#summary-n-tx-chart").click(function(){window.open(root+"charts/n-transactions?show_header=false&address="+h.getActiveAddresses().join("|"),null,"scroll=0,status=0,location=0,toolbar=0,width=1000,height=700")});$("#summary-received-chart").click(function(){window.open(root+"charts/received-per-day?show_header=false&address="+h.getActiveAddresses().join("|"),null,"scroll=0,status=0,location=0,toolbar=0,width=1000,height=700")});$("#summary-balance-chart").click(function(){window.open(root+"charts/balance?show_header=false&address="+h.getActiveAddresses().join("|"),null,"scroll=0,status=0,location=0,toolbar=0,width=1000,height=700")});$("#new-addr").click(function(){try{h.getSecondPassword(function(){var aI=h.generateNewKey().getBitcoinAddress().toString();h.makeNotice("info","new-address","Generated new Bitcoin Address "+aI);loadScript("wallet/address_modal.min.js",function(){showLabelAddressModal(aI)});h.backupWallet()})}catch(aH){h.makeNotice("error","misc-error",aH)}});$("#filter").change(function(){aj=0;ag=$(this).val();h.get_history()});var aG=$("#tx_display");aG.change(function(){SetCookie("tx_display",$(this).val());c()});var aF=getCookie("tx_display");if(aF!=null){aG.val(parseInt(aF))}$("#email-backup-btn").click(function(){E()});$("#dropbox-backup-btn").click(function(){window.open(root+"wallet/dropbox-login?guid="+K+"&sharedKey="+d)});$("#gdrive-backup-btn").click(function(){window.open(root+"wallet/gdrive-login?guid="+K+"&sharedKey="+d)});$("#large-summary").click(function(){toggleSymbol();c()});$("#send-quick").on("show",function(aJ,aI){var aH=$(this);r(aH,aI);aH.find(".send").unbind().click(function(){loadScript("wallet/signer.min.js",function(){startTxUI(aH,"quick",initNewTx())})})});$("#send-email").on("show",function(aJ,aI){var aH=$(this);r(aH,aI);aH.find(".send").unbind().click(function(){loadScript("wallet/signer.min.js",function(){startTxUI(aH,"email",initNewTx())})})});$("#send-anonymous").on("show",function(aJ,aI){var aH=$(this);r(aH,aI);aH.find(".mixer_fee").text(w);aH.find(".fees,.free,.bonus").show();if(w<0){aH.find(".fees,.free").hide()}else{if(w==0){aH.find(".fees,.bonus").hide()}else{aH.find(".free,.bonus").hide()}}aH.find(".send").unbind().click(function(){loadScript("wallet/signer.min.js",function(){startTxUI(aH,"anonymous",initNewTx())})});aH.find(".anonymous-fees").text("0.00");aH.find('input[name="send-before-fees"]').unbind().bind("keyup change",function(){var aL=parseFloat($.trim($(this).val()));var aK=0;if(aL>0){if(w>0){aK=parseFloat(aL+((aL/100)*w))}else{aK=parseFloat(aL);aH.find(".bonus-value").text(-(Math.min($(this).val(),200)/100)*w)}}if(aL<0.5){aH.find(".anonymous-fees").text("0.00")}else{aH.find(".anonymous-fees").text(aK.toFixed(4))}aH.find('input[name="send-value"]').val(aK).trigger("keyup")})});$("#send-custom").on("show",function(aJ,aI){var aH=$(this);r(aH,aI);aH.find(".send").unbind().click(function(){loadScript("wallet/signer.min.js",function(){startTxUI(aH,"custom",initNewTx())})});aH.find('select[name="from"]').unbind().change(function(){var aM=0;var aK=$(this).val();for(var aL in aK){if(aK[aL]=="any"){$(this).val("any");aM=al;break}else{var aN=G[aK[aL]];if(aN&&aN.balance){aM+=aN.balance}}}aH.find(".amount-available").text(formatBTC(aM))}).trigger("change");aH.find(".reset").unbind().click(function(){r(aH,true);aH.find('select[name="from"]').trigger("change")})});$("#send-satoshi-dice,#send-btcdice-dice").on("show",function(aJ,aI){var aH=this;loadScript("wallet/dicegames.min.js",function(){try{DICEGame.init($(aH))}catch(aK){h.makeNotice("error","misc-error","Unable To Load Dice Bets")}},function(aK){h.makeNotice("error","misc-error",aK)})});$("#send-sms").on("show",function(aJ,aI){if(aI){return}var aH=$(this);r(aH);$.get(resource+"wallet/country_codes.html").success(function(aK){aH.find('select[name="sms-country-code"]').html(aK)}).error(function(){h.makeNotice("error","misc-error","Error Downloading SMS Country Codes")});aH.find(".send").unbind().click(function(){loadScript("wallet/signer.min.js",function(){var aK=initNewTx();startTxUI(aH,"sms",aK)})})});$("#address-book").on("show",function(){var aI=$("#address-book-tbl tbody");if(aq(g)>0){aI.empty();for(var aH in g){var aJ=$("<tr><td>"+g[aH]+'</td><td><div class="addr-book-entry">'+aH+'</div></td><td style="width:16px" class="hidden-phone"><img src="'+resource+'delete.png" class="act-delete" /></td></tr>');(function(aK){aJ.find(".act-delete").click(function(){h.deleteAddressBook(aK)})})(aH);aI.append(aJ)}}});$('a[data-toggle="tab"]').unbind().on("show",function(aH){$(aH.target.hash).trigger("show")});$("#receive-coins-btn").click(function(){Y($("#receive-coins"))});$(".show_adv").click(function(){$(".modal:visible").center()})}function p(){$(".resend-code").click(function(){h.setGUID(K,true)});ap();$("#restore-password").keypress(function(aF){if(aF.keyCode==13){aF.preventDefault();$("#restore-wallet-continue").click()}});$("#restore-wallet-continue").unbind().click(function(aG){aG.preventDefault();var aF=$.trim($("#restore-guid").val());if(aF.length==0){return}if(K!=aF){h.setGUID(aF,false)}else{a()}});$(".modal").on("show",function(){J();$(this).center()}).on("shown",function(){J();$(this).center()})}function ad(aG){var aH=Crypto.SHA256(aG+"?");switch(aH.slice(0,2)){case"00":var aI=Crypto.SHA256(aG,{asBytes:true});return aI;break;case"01":var aF=Crypto.util.hexToBytes(aH.slice(2,4))[0];var aJ=Math.round(Math.pow(2,(aF/4)));var aI=Crypto.PBKDF2(aG,"Satoshi Nakamoto",32,{iterations:aJ,asBytes:true});return aI;break;default:console.log("invalid key");break}}function au(){var aH,aF="";if(window.getSelection){aH=window.getSelection();if(aH.rangeCount){var aI=aH.getRangeAt(0).cloneContents();var aG=document.createElement("div");aG.appendChild(aI);aF=aG.innerText}}else{if(document.selection&&document.selection.type=="Text"){aF=document.selection.createRange().htmlText}}return aF}this.detectPrivateKeyFormat=function(aG){if(/^5[123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz]{50}$/.test(aG)){return"sipa"}if(/^[LK][123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz]{51}$/.test(aG)){return"compsipa"}if(/^[123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz]{44}$/.test(aG)||/^[123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz]{43}$/.test(aG)){return"base58"}if(/^[A-Fa-f0-9]{64}$/.test(aG)){return"hex"}if(/^[ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789=+\/]{44}$/.test(aG)){return"base64"}if(/^S[123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz]{21}$/.test(aG)||/^S[123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz]{25}$/.test(aG)||/^S[123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz]{29}$/.test(aG)||/^S[123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz]{30}$/.test(aG)){var aF=Crypto.SHA256(aG+"?",{asBytes:true});if(aF[0]===0||aF[0]===1){return"mini"}}throw"Unknown Key Format "+aG};this.privateKeyStringToKey=function(aG,aI){var aF=null;if(aI=="base58"){aF=B58.decode(aG)}else{if(aI=="base64"){aF=Crypto.util.base64ToBytes(aG)}else{if(aI=="hex"){aF=Crypto.util.hexToBytes(aG)}else{if(aI=="mini"){aF=ad(aG)}else{if(aI=="sipa"){var aH=B58.decode(aG);aH.shift();aF=aH.slice(0,aH.length-4)}else{if(aI=="sipa"){var aH=B58.decode(aG);aH.shift();aF=aH.slice(0,aH.length-4)}else{if(aI=="compsipa"){var aH=B58.decode(aG);aH.shift();aH.pop();aF=aH.slice(0,aH.length-4)}else{throw"Unsupported Key Format"}}}}}}}if(aF.length!=32){throw"Result not 32 bytes in length"}return new Bitcoin.ECKey(aF)};$(document).ready(function(){var aG=$(document.body);Z=aG.data("payload");K=aG.data("guid");d=aG.data("sharedkey");am=aG.data("payload-checksum");q=aG.data("auth-type");if(h.skip_init){return}if(top.location!=self.location){top.location=self.location.href}if(!$.isEmptyObject({})){h.makeNotice("error","error","Object.prototype has been extended by a browser extension. Please disable this extensions and reload the page.");return}$("input,button,select").attr("autocomplete","off");aG.ajaxStart(function(){$(".loading-indicator").fadeIn(200)}).ajaxStop(function(){$(".loading-indicator").hide()}).click(function(){if(P){clearTimeout(P);P=setTimeout(h.logout,h.getLogoutTime())}rng_seed_time()}).keypress(function(){if(P){clearTimeout(P);P=setTimeout(h.logout,h.getLogoutTime())}rng_seed_time()});p();$(".restore-auth-"+q).show();j=$("#restore-wallet");j.show();var aH=false;var aK=17,aJ=86,aF=67,aI=67;$(document).keydown(function(aM){try{if(aM.keyCode==aK||aM.keyCode==aI){aH=true}if(aH&&aM.keyCode==aF){var aL=$.trim(au());var aN=G[aL];if(aN!=null){if(aN.priv==null){$("#watch-only-copy-warning-modal").modal("show")}else{if(aN.tag==1){$("#not-synced-warning-modal").modal("show")}}}}}catch(aM){console.log(aM)}}).keyup(function(aL){if(aL.keyCode==aK||aL.keyCode==aI){aH=false}})});this.unArchiveAddr=function(aF){var aF=G[aF];if(aF.tag==2){aF.tag=null;c();aa("update",function(){h.get_history()})}else{h.makeNotice("error","add-error","Cannot Unarchive This Address")}};this.archiveAddr=function(aF){if(h.getActiveAddresses().length<=1){h.makeNotice("error","add-error","You must leave at least one active address");return}var aF=G[aF];if(aF.tag==null||aF.tag==0){aF.tag=2;c();aa("update",function(){h.get_history()})}else{h.makeNotice("error","add-error","Cannot Archive This Address")}};function aE(){$("#receive-coins").find(".tab-pane.active").trigger("show");setupToggle()}this.addWatchOnlyAddress=function(aF){return aC(aF)};this.addPrivateKey=function(aG,aF){if(ab()){return false}if(aG==null){throw"Unable to generate a new bitcoin address."}if(aF){var aI=aG.getBitcoinAddressCompressed()}else{var aI=aG.getBitcoinAddress()}if(aI==null){throw"Generated invalid bitcoin address."}if(aC(aI.toString(),i(aG.priv))){G[aI].tag=1;try{ws.send('{"op":"addr_sub", "addr":"'+aI+'"}')}catch(aH){}}else{throw"Unable to add generated bitcoin address."}return aI};this.generateNewKey=function(){var aF=new Bitcoin.ECKey(false);if(h.addPrivateKey(aF)){return aF}}};