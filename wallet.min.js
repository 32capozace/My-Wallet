function precisionToSatoshiBN(a){return Bitcoin.Util.parseValue(a).divide(BigInteger.valueOf(Math.pow(10,sShift(symbol_btc)).toString()))}function precisionToBTC(a){return Bitcoin.Util.formatValue(precisionToSatoshiBN(a))}function precisionFromSatoshi(a){return Bitcoin.Util.formatValue(a.multiply(BigInteger.valueOf(Math.pow(10,sShift(symbol_btc)))))}function precisionFromBTC(a){return precisionFromSatoshi(Bitcoin.Util.parseValue(a))}function formatPrecision(a){return formatBTC(precisionToSatoshiBN(a).toString())}var MyWallet=new function(){var h=this;this.skip_init=false;var E="abcaa314-6f67-6705-b384-5d47fbe9d7cc";var ak;var O;var j;var aL;var am;var w;var d;var aB=0;var U=0;var av=0;var M=0;var aW=0;var aJ;var g={};var F=[];var G=false;var az=0;var au=0;var aE=1000;var K={};var aC;var ao;var x=0.5;var I=true;var ai=10;var R=ai;var b={};var q;var aR=0;var W;var ab=[];var C;var P=60000;var B=false;var ac;var at=false;var Z="en";var aq=2;var S=0;var aO=0;var aa=false;var aG;var ar=false;var V=false;var ay=false;var z=false;var s={pbkdf2_iterations:ai,fee_policy:0,html5_notifications:false,logout_time:600000,tx_display:0,always_keep_local_backup:false,transactions_per_page:30,additional_seeds:[]};this.setEncryptedWalletData=function(aY){if(!aY||aY.length==0){ak=null;aC=null;return}ak=aY;aC=aj();try{if(aR==0||s.always_keep_local_backup){MyStore.put("payload",ak)}}catch(aZ){console.log(aZ)}};this.setRealAuthType=function(aY){aR=aY};this.addAdditionalSeeds=function(aY){s.additional_seeds.push(aY)};this.getAdditionalSeeds=function(aY){return s.additional_seeds};this.getLanguage=function(){return Z};this.setLanguage=function(aY){MyStore.put("language",aY);Z=aY};this.addEventListener=function(aY){ab.push(aY)};this.getLogoutTime=function(){return s.logout_time};this.getSecondPasswordPbkdf2Iterations=function(){return s.pbkdf2_iterations};this.getMainPasswordPbkdf2Iterations=function(){return R};this.getDefaultPbkdf2Iterations=function(){return ai};this.getSharedcoinEndpoint=function(){return aG};this.disableLogout=function(aY){ar=aY};this.setLogoutTime=function(aY){s.logout_time=aY;clearInterval(W);W=setTimeout(h.logout,h.getLogoutTime())};this.getDoubleEncryption=function(){return G};this.getEncryptedWalletData=function(){return ak};this.getFeePolicy=function(){return s.fee_policy};this.setFeePolicy=function(aY){s.fee_policy=parseInt(aY)};this.setAlwaysKeepLocalBackup=function(aY){s.always_keep_local_backup=aY};this.getAlwaysKeepLocalBackup=function(){return s.always_keep_local_backup};this.setNTransactionsPerPage=function(aY){s.transactions_per_page=aY};this.getNTransactionsPerPage=function(){return s.transactions_per_page};this.getGuid=function(){return O};this.getHTML5Notifications=function(){return s.html5_notifications};this.setHTML5Notifications=function(aY){s.html5_notifications=aY};this.getTransactions=function(){return F};this.addressExists=function(aY){return K[aY]!=null};this.getAddressTag=function(aY){return K[aY].tag};this.setAddressTag=function(aZ,aY){K[aZ].tag=aY};this.getAddressBook=function(){return g};this.getAddressLabel=function(aY){return K[aY].label};this.setAddressLabel=function(aY,aZ){K[aY].label=aZ};this.setAddressBalance=function(aY,aZ){K[aY].balance=aZ};this.getAddressBookLabel=function(aY){return g[aY]};this.isWatchOnly=function(aY){return !K[aY]||K[aY].priv==null};this.getAddressBalance=function(aY){return K[aY].balance};this.getMixerFee=function(){return x};this.getRecommendIncludeFee=function(){return I};this.deleteAddress=function(aY){delete K[aY]};this.addAddressBookEntry=function(aZ,aY){g[aZ]=aY};this.getPrivateKey=function(aY){return K[aY].priv};this.setLabel=function(aY,aZ){K[aY].label=aZ;h.backupWalletDelayed();c()};this.securePost=function(aY,a1,a8,a5){var a4=jQuery.extend({},a1);if(!a1.sharedKey){if(!d||d.length==0||d.length!=36){throw"Shared key is invalid"}var aZ=new Date().getTime();var a3=parseInt((aZ-aO)/10000);var a2=Crypto.SHA256(d.toLowerCase()+a3);var a0=0;var a7=a2.substring(a0,a0+=8)+"-"+a2.substring(a0,a0+=4)+"-"+a2.substring(a0,a0+=4)+"-"+a2.substring(a0,a0+=4)+"-"+a2.substring(a0,a0+=12);a4.sharedKey=a7;a4.sKTimestamp=a3;a4.sKDebugHexHash=a2;a4.sKDebugTimeOffset=aO;a4.sKDebugOriginalClientTime=aZ;a4.sKDebugOriginalSharedKey=d}if(!a1.guid){a4.guid=O}a4.format=a1.format?a1.format:"plain";var a6="text";if(a1.format=="json"){a6="json"}$.ajax({dataType:a6,type:"POST",url:root+aY,data:a4,success:a8,error:a5})};this.isCorrectMainPassword=function(aY){return aL==aY};function ag(aZ,a1){var aY=Crypto.SHA256(aZ,{asBytes:true});for(var a0=1;a0<a1;++a0){aY=Crypto.SHA256(aY,{asBytes:true})}return Crypto.util.bytesToHex(aY)}this.setPbkdf2Iterations=function(aY,a0){var aZ=function(a1){console.log("Panic "+a1);window.location.reload()};h.getSecondPassword(function(){try{if(G){for(var a1 in K){var a3=K[a1];if(a3.priv){a3.priv=h.encrypt(h.decryptPK(a3.priv),d+am,aY);if(!a3.priv){throw"addr.priv is null"}}}s.pbkdf2_iterations=aY;w=ag(d+am,aY)}S=2;R=aY;h.backupWallet("update",function(){a0()},function(){aZ(a2)})}catch(a2){aZ(a2)}},function(a1){aZ(a1)})};this.setDoubleEncryption=function(a0,aY,a2){var aZ=function(a3){console.log("Panic "+a3);window.location.reload()};try{if(G==a0){return}if(a0){h.getSecondPassword(function(){try{G=true;am=aY;for(var a3 in K){var a5=K[a3];if(a5.priv){a5.priv=i(B58.decode(a5.priv));if(!a5.priv){throw"addr.priv is null"}}}w=ag(d+am,s.pbkdf2_iterations);am=null;h.getSecondPassword(function(){try{h.checkAllKeys();h.backupWallet("update",function(){a2()},function(){aZ(a6)})}catch(a6){aZ(a6)}},function(a6){aZ(a6)})}catch(a4){aZ(a4)}},function(a3){aZ(a3)})}else{h.getSecondPassword(function(){try{for(var a3 in K){var a5=K[a3];if(a5.priv){a5.priv=h.decryptPK(a5.priv);if(!a5.priv){throw"addr.priv is null"}}}G=false;am=null;h.checkAllKeys();h.backupWallet("update",function(){a2()},function(){aZ(a4)})}catch(a4){aZ(a4)}},function(a3){aZ(a3)})}}catch(a1){aZ(a1)}};this.unArchiveAddr=function(aY){var aY=K[aY];if(aY.tag==2){aY.tag=null;c();h.backupWalletDelayed("update",function(){h.get_history()})}else{h.makeNotice("error","add-error","Cannot Unarchive This Address")}};this.archiveAddr=function(aY){if(h.getActiveAddresses().length<=1){h.makeNotice("error","add-error","You must leave at least one active address");return}var aY=K[aY];if(aY.tag==null||aY.tag==0){aY.tag=2;c();h.backupWalletDelayed("update",function(){h.get_history()})}else{h.makeNotice("error","add-error","Cannot Archive This Address")}};this.addWatchOnlyAddress=function(aY){return aU(aY)};this.addPrivateKey=function(aY,a0){if(al()){return false}if(aY==null){throw"Cannot add null key."}if(a0==null){a0={}}var a3=a0.compressed?aY.getBitcoinAddressCompressed().toString():aY.getBitcoinAddress().toString();var a2=i(aY.priv);if(a2==null){throw"Error Encoding key"}var aZ=new Bitcoin.ECKey(h.decodePK(a2));if(a3!=aZ.getBitcoinAddress().toString()&&a3!=aZ.getBitcoinAddressCompressed().toString()){throw"Decoded Key address does not match generated address"}if(aU(a3,a2)){K[a3].tag=1;K[a3].created_time=a0.created_time?a0.created_time:0;K[a3].created_device_name=a0.app_name?a0.app_name:APP_NAME;K[a3].created_device_version=a0.app_version?a0.app_version:APP_VERSION;if(K[a3].priv!=a2){throw"Address priv does not match encoded"}try{ws.send('{"op":"addr_sub", "addr":"'+a3+'"}')}catch(a1){}}else{throw"Unable to add generated bitcoin address."}return a3};this._seed=function(a0){rng_seed_time();if(aL||a0){var aY=Crypto.util.bytesToWords(Crypto.SHA256(aL?aL:a0,{asBytes:true}));for(var aZ in aY){rng_seed_int(aY[aZ])}}if(!ac){ac=$("body").data("extra-seed")}if(ac){var aY=Crypto.util.bytesToWords(Crypto.util.hexToBytes(ac));for(var aZ in aY){rng_seed_int(aY[aZ])}}};this.generateNewKey=function(aZ){h._seed(aZ);var aY=new Bitcoin.ECKey(false);if(h.addPrivateKey(aY)){return aY}};this.setLoadingText=function(aY){$(".loading-text").text(aY)};function N(){try{$(".popover").remove()}catch(aY){}}$(window).resize(function(){$(".modal:visible").center();N()});function aT(aZ,aY){aZ.unbind().click(function(){A(aY.txIndex,aY.result)});aZ.unbind().find(".show-note").mouseover(function(){var a0=aY.note?aY.note:b[aY.hash];aN(this,a0,aY.hash)});aZ.unbind().find(".add-note").mouseover(function(){m(this,aY.hash)});return aZ}function t(aZ,a5){var aY=0;for(var a1=0;a1<aZ.inputs.length;++a1){var a0=aZ.inputs[a1].prev_out;if(!a0||!a0.addr){continue}var a4=K[a0.addr];if(a4){var a3=parseInt(a0.value);aY-=a3;if(a5){U+=a3;a4.balance-=a3}}}for(var a2=0;a2<aZ.out.length;++a2){var a0=aZ.out[a2];if(!a0||!a0.addr){continue}var a4=K[a0.addr];if(a4){var a3=parseInt(a0.value);aY+=a3;if(a5){av+=a3;a4.balance+=a3}}}return aY}function aj(){return Crypto.util.bytesToHex(Crypto.SHA256(ak,{asBytes:true}))}function y(aY){var aZ=null;aY.onmessage=function(a6){try{var a3=$.parseJSON(a6.data);if(a3.op=="on_change"){var a7=aj();var a5=a3.checksum;console.log("On change old "+a7+" ==  new "+a5);if(aZ!=a5&&a7!=a5){aZ=a5;L()}}else{if(a3.op=="utx"){var a4=TransactionFromJSON(a3.x);for(var a9 in F){if(F[a9].txIndex==a4.txIndex){return}}var bb=t(a4,true);if(h.getHTML5Notifications()){h.showNotification({title:bb>0?"Payment Received":"Payment Sent",body:"Transaction Value "+formatBTC(bb),iconUrl:resource+"cube48.png"})}a4.result=bb;aB+=bb;M++;a4.setConfirmations(0);playSound("beep");if(au==0&&az==0){F.unshift(a4);var a8=false;if(F.length>h.getNTransactionsPerPage()){F.pop();a8=true}}var a1=X();if("my-transactions"==a1){if(au==0&&az==0){$("#no-transactions").hide();if(s.tx_display==0){var a0=$("#transactions-compact").show();aT($(D(a4,K,g)),a4).prependTo(a0.find("tbody")).find("div").hide().slideDown("slow");if(a8){a0.find("tbody tr:last-child").remove()}}else{var a0=$("#transactions-detailed").show();a0.prepend(a4.getHTML(K,g));if(a8){a0.find("div:last-child").remove()}setupSymbolToggle()}}}else{c()}}else{if(a3.op=="block"){for(var a2=0;a2<a3.x.txIndexes.length;++a2){for(var ba=0;ba<F.length;++ba){if(F[ba].txIndex==a3.x.txIndexes[a2]){if(F[ba].blockHeight==null||F[ba].blockHeight==0){F[ba].blockHeight=a3.x.height;break}}}}aA(BlockFromJSON(a3.x));Y()}}}}catch(a6){console.log(a6);console.log(a6.data)}};aY.onopen=function(){aw("ok");var a3='{"op":"blocks_sub"}';if(O!=null){a3+='{"op":"wallet_sub","guid":"'+O+'"}'}try{var a1=h.getActiveAddresses();for(var a0 in a1){a3+='{"op":"addr_sub", "addr":"'+a1[a0]+'"}'}}catch(a2){alert(a2)}aY.send(a3)};aY.onclose=function(){aw("error")}}var aS="ok";function aw(aZ){var aY=$("#logout");if(aZ=="loading_start"){aY.attr("src",resource+"logout-orange.png");return}else{if(aZ!="loading_stop"){aS=aZ}}if(aS=="ok"){aY.attr("src",resource+"logout.png")}else{if(aS=="error"){aY.attr("src",resource+"logout-red.png")}}}this.showNotification=function(aY,aZ){try{var a1;if(window.webkitNotifications&&webkitNotifications.checkPermission()==0){a1=webkitNotifications.createNotification(aY.iconUrl,aY.title,aY.body);a1.show()}else{if(window.Notification&&window.Notification.permissionLevel()=="granted"){a1=new window.Notification(aY.title,aY).show()}}setTimeout(function(){a1.cancel()},aZ?aZ:5000)}catch(a0){}};this.makeNotice=function(aZ,a2,a1,a0){if(a1==null||a1.length==0){return}console.log(a1);var aY=$('<div class="alert alert-block alert-'+aZ+'"></div>');aY.text(""+a1);if($("#"+a2).length>0){aY.attr("id",a2);return}$("#notices").append(aY).hide().fadeIn(200);(function(){var a3=aY;setTimeout(function(){a3.fadeOut(250,function(){$(this).remove()})},a0?a0:5000)})()};this.pkBytesToSipa=function(aY,a2){var aZ=new Bitcoin.ECKey(aY);while(aY.length<32){aY.unshift(0)}aY.unshift(128);if(aZ.getBitcoinAddress().toString()==a2){}else{if(aZ.getBitcoinAddressCompressed().toString()==a2){aY.push(1)}else{throw"Private Key does not match bitcoin address"+a2}}var a0=Crypto.SHA256(Crypto.SHA256(aY,{asBytes:true}),{asBytes:true});aY=aY.concat(a0.slice(0,4));var a1=B58.encode(aY);return a1};function aI(aY){return aY}function ax(aY){return h.decryptPK(aY)}function ae(aY){var aZ=h.decodePK(aY);return Crypto.util.bytesToBase64(aZ)}function k(aY){var aZ=h.decodePK(aY);return Crypto.util.bytesToHex(aZ)}this.base58ToSipa=function(aY,aZ){return h.pkBytesToSipa(h.decodePK(aY),aZ)};this.makeWalletJSON=function(aY){return h.makeCustomWalletJSON(aY,O,d)};this.makeCustomWalletJSON=function(a3,aZ,a5){var a2=aI;if(a3=="base64"){a2=ae}else{if(a3=="hex"){a2=k}else{if(a3=="sipa"){a2=h.base58ToSipa}else{if(a3=="base58"){a2=ax}}}}var aY='{\n	"guid" : "'+aZ+'",\n	"sharedKey" : "'+a5+'",\n';if(G&&w!=null&&a2==aI){aY+='	"double_encryption" : '+G+',\n	"dpasswordhash" : "'+w+'",\n'}if(s){aY+='	"options" : '+JSON.stringify(s)+",\n"}aY+='	"keys" : [\n';for(var a1 in K){var a4=$.extend({},K[a1]);if(a4.tag==1){delete a4.tag}if(a4.priv!=null){a4.priv=a2(a4.priv,a4.addr)}for(var a0 in a4){if(a4[a0]===null||a4[a0]===undefined){delete a4[a0]}}delete a4.balance;aY+=JSON.stringify(a4)+",\n";atLeastOne=true}if(atLeastOne){aY=aY.substring(0,aY.length-2)}aY+="\n	]";if(aH(g)>0){aY+=',\n	"address_book" : [\n';for(var a1 in g){aY+='	{"addr" : "'+a1+'",\n';aY+='	 "label" : "'+g[a1]+'"},\n'}aY=aY.substring(0,aY.length-2);aY+="\n	]"}if(aH(b)>0){aY+=',\n	"tx_notes" : '+JSON.stringify(b)}aY+="\n}";return aY};this.get_history=function(aZ,aY){BlockchainAPI.get_history(function(a0){J(a0,false);if(F.length==0&&az>0){h.setPage(0)}else{c()}if(aZ){aZ()}},function(){if(aY){aY()}},au,az*h.getNTransactionsPerPage(),h.getNTransactionsPerPage())};this.deleteAddressBook=function(aY){delete g[aY];h.backupWalletDelayed();$("#send-coins").find(".tab-pane").trigger("show",true)};function u(aY){$("#send-coins").find(".tab-pane.active").trigger("show",aY);if(aY){BlockchainAPI.get_ticker();$(".send").prop("disabled",false)}}function l(aY,aZ,a3){var a2=aY.val();aY.empty();for(var a1 in K){var a4=K[a1];if(!a4||a4.tag==2){continue}var a0=a4.label;if(!a0){a0=a4.addr.substring(0,15)+"..."}if(aZ||a4.balance>0){aY.prepend('<option value="'+a4.addr+'">'+a0+" - "+formatBTC(a4.balance)+"</option>")}}aY.prepend('<option value="any" selected>Any Address</option>');if(!a3&&a2){aY.val(a2)}}function r(a0,a1){l(a0.find('select[name="from"]'),false,a1);l(a0.find('select[name="change"]'),true,a1);a0.find('select[name="change"]').prepend('<option value="new">New Address</option>');a0.find(".local-symbol").text(symbol_local.symbol);a0.find(".btc-symbol").text(symbol_btc.symbol);if(a1){a0.find("input").val("");a0.find(".send-value-usd").text(formatSymbol(0,symbol_local)).val("");a0.find(".amount-needed").text(0)}var aZ=a0.find(".recipient-container");if(a1){var a3=aZ.find(".recipient:first-child").clone();aZ.empty().append(a3)}function aY(){var a4=BigInteger.ZERO;a0.find(".send-value").each(function(){a4=a4.add(precisionToSatoshiBN($(this).val()))});return a4}function a2(a4){a4.find('input[name="send-to-address"]').typeahead({source:aD()}).next().unbind().click(function(){var a5=$(this).prev();h.scanQRCode(function(a6){console.log(a6);try{new Bitcoin.Address(a6);a5.val(a6)}catch(a7){h.handleURI(a6,a4)}},function(a6){h.makeNotice("error","misc-error",a6)})});a4.find(".send-value").unbind().bind("keyup change",function(a5){if(a5.keyCode=="9"){return}a0.find(".amount-needed").text(formatBTC(aY().toString()));a4.find(".send-value-usd").val(convert($(this).val()*symbol_btc.conversion,symbol_local.conversion)).text(formatSymbol($(this).val()*symbol_btc.conversion,symbol_local))});a4.find(".send-value-usd").text(formatSymbol(0,symbol_local)).unbind().bind("keyup change",function(a5){if(a5.keyCode=="9"){return}a4.find(".send-value").val(formatSatoshi(parseFloat($(this).val())*symbol_local.conversion,sShift(symbol_btc),true))})}aZ.find(".recipient").each(function(){a2($(this))});a0.find(".remove-recipient").unbind().click(function(){var a4=aZ.find(".recipient").length;if(a4>1){if(a4==2){$(this).hide(200)}aZ.find(".recipient:last-child").remove()}});a0.find(".add-recipient").unbind().click(function(){var a4=aZ.find(".recipient:first-child").clone();a4.find('input[type="text"]').val("");a4.appendTo(aZ);a2(a4);a0.find(".remove-recipient").show(200)});a0.find('select[name="from"]').unbind().change(function(){var a6=0;var a4=$(this).val();for(var a5 in a4){if(a4[a5]=="any"){$(this).val("any");a6=aB;break}else{var a7=K[a4[a5]];if(a7&&a7.balance){a6+=a7.balance}}}a0.find(".amount-available").text(formatBTC(a6))}).trigger("change")}this.getAllAddresses=function(){var aZ=[];for(var aY in K){aZ.push(aY)}return aZ};this.getPreferredAddress=function(){var aZ=null;for(var aY in K){var a0=K[aY];if(aZ==null){aZ=a0}if(a0.priv!=null){if(aZ==null){aZ=a0}if(a0.tag==null||a0.tag==0){aZ=a0;break}}}return aZ.addr};function aV(){var aY=$("#restore-backup-modal");aY.modal({keyboard:true,backdrop:"static",show:true});aY.find(".btn.btn-secondary").unbind().click(function(){aY.modal("hide")})}this.scanQRCode=function(a0,aY){var aZ=$("#qr-code-reader-modal");aZ.modal({keyboard:false,backdrop:"static",show:true});loadScript("wallet/qr.code.reader",function(){QRCodeReader.init(aZ,function(a1){QRCodeReader.stop();aZ.modal("hide");a0(a1)},function(a1){aZ.modal("hide");aY(a1)})},aY);aZ.find(".btn.btn-secondary").unbind().click(function(){QRCodeReader.stop();aZ.modal("hide");aY()})};this.getActiveAddresses=function(){var a0=[];for(var aY in K){var aZ=K[aY];if(aZ.tag!=2){a0.push(aZ.addr)}}return a0};this.getArchivedAddresses=function(){var a0=[];for(var aY in K){var aZ=K[aY];if(aZ.tag==2){a0.push(aZ.addr)}}return a0};function aA(a1){if(a1!=null){aJ=a1;for(var aZ in F){var aY=F[aZ];if(aY.blockHeight!=null&&aY.blockHeight>0){var a0=aJ.height-aY.blockHeight+1;if(a0<=100){aY.setConfirmations(aJ.height-aY.blockHeight+1)}else{aY.setConfirmations(null)}}else{aY.setConfirmations(0)}}}}function A(aZ,aY){loadScript("wallet/frame-modal",function(){showFrameModal({title:"Transaction Summary",description:"",src:root+"tx-summary/"+aZ+"?result="+aY+"&guid="+O})})}this.deleteNote=function(aY){delete b[aY];c();h.backupWalletDelayed()};function m(aY,aZ){(function(a1,a3){a1=$(a1);if(!a1.data("popover")){a1.popover({title:'Add Note <span style="float:right"><i class="icon-remove-sign"></i></span>',trigger:"manual",content:'<textarea style="width:97%;height:50px;margin-top:2px" placeholder="Enter the note here..."></textarea><div style="text-align:right"><button class="btn btn-small">Save</button></div>'})}else{if(a1.data("popover").tip().is(":visible")){return}}a1.popover("show");a1.mouseleave(function(){if(!a1.__timeout){a1.__timeout=setTimeout(function(){a1.popover("hide")},250)}});function a0(){if(a1.__timeout){clearTimeout(a1.__timeout);a1.__timeout=null}}var a2=a1.data("popover").tip().mouseenter(a0);a2.find("textarea").focus(a0);a2.mouseleave(function(){a1.__timeout=setTimeout(function(){a1.popover("hide")},250)});a2.find("i").unbind().click(function(){a1.popover("hide")});a2.find("button").click(function(){var a4=stripHTML(a2.find("textarea").val()).replace(/'/g,"").replace(/"/g,"");a4=a4.replace(/(\r\n|\n|\r)/gm,"");if(a4.length>0){b[a3]=a4;h.backupWalletDelayed()}c()})})(aY,aZ)}function aN(aY,aZ,a0){(function(a1,a2,a4){a1=$(a1);if(!a1.data("popover")){var a5="Note";if(b[a4]){a5+=' <span style="float:right"><img src="'+resource+'delete.png" /></span>'}$(a1).popover({title:a5,trigger:"manual",content:$("<div/>").html(a2).text()})}else{if(a1.data("popover").tip().is(":visible")){return}}a1.popover("show");a1.mouseleave(function(){if(!a1.__timeout){a1.__timeout=setTimeout(function(){a1.popover("hide")},250)}});var a3=a1.data("popover").tip().mouseenter(function(){if(a1.__timeout){clearTimeout(a1.__timeout);a1.__timeout=null}});a3.find("img").unbind().click(function(){h.deleteNote(a4)});a3.mouseleave(function(){a1.__timeout=setTimeout(function(){a1.popover("hide")},250)})})(aY,aZ,a0)}function D(a1,a6,a3){var a7=a1.result;var a2='<tr class="pointer" id="tx-'+a1.txIndex+'"><td class="hidden-phone" style="width:365px"><div><ul style="margin-left:0px;" class="short-addr">';var aZ=true;if(a7>=0){for(var a0=0;a0<a1.inputs.length;++a0){var aY=a1.inputs[a0].prev_out;if(!aY||!aY.addr){aZ=false;a2+='<span class="label">Newly Generated Coins</span>'}else{var a4=a6[aY.addr];if(a4){continue}aZ=false;a2+=formatOutput(aY,a6,a3)}}}else{if(a7<0){for(var a0=0;a0<a1.out.length;++a0){var aY=a1.out[a0];var a4=a6[aY.addr];if(a4&&aY.type==0){continue}aZ=false;a2+=formatOutput(aY,a6,a3)}}}if(aZ){a2+='<span class="label">Moved Between Wallet</info>'}a2+="</ul></div></td><td><div>";var a5=a1.note?a1.note:b[a1.hash];if(a5){a2+='<img src="'+resource+'note.png" class="show-note"> '}else{a2+='<img src="'+resource+'note_grey.png" class="add-note"> '}if(a1.time>0){a2+=dateToString(new Date(a1.time*1000))}if(a1.confirmations==0){a2+=' <span class="label label-important hidden-phone">Unconfirmed Transaction!</span> '}else{if(a1.confirmations>0){a2+=' <span class="label label-info hidden-phone">'+a1.confirmations+" Confirmations</span> "}}a2+="</div></td>";if(a7>0){a2+='<td style="color:green"><div>'+formatMoney(a7,true)+"</div></td>"}else{if(a7<0){a2+='<td style="color:red"><div>'+formatMoney(a7,true)+"</div></td>"}else{a2+="<td><div>"+formatMoney(a7,true)+"</div></td>"}}if(a1.balance==null){a2+="<td></td></tr>"}else{a2+='<td class="hidden-phone"><div>'+formatMoney(a1.balance)+"</div></td></tr>"}return a2}function X(){N();if(aB==null){$("#balance").html("Loading...")}else{$("#balance").html(formatSymbol(aB,symbol,true));$("#balance2").html(formatSymbol(aB,(symbol===symbol_local)?symbol_btc:symbol_local),true)}return j.attr("id")}function c(aY){var aZ=X();if("send-coins"==aZ){u(aY)}else{if("home-intro"==aZ){f(aY)}else{if("receive-coins"==aZ){aX(aY)}else{if("my-transactions"==aZ){Y(aY)}}}}}function f(aY){$("#summary-n-tx").html(M);$("#summary-received").html(formatMoney(av,true));$("#summary-sent").html(formatMoney(U,true));$("#summary-balance").html(formatMoney(aB,symbol));var a0=h.getPreferredAddress();$(".paper-wallet-btn").unbind().click(function(){loadScript("wallet/paper-wallet",function(){PaperWallet.showModal()})});if(h.isWatchOnly(a0)){$(".no-watch-only").hide()}else{$(".no-watch-only").show();var aZ=$("#my-primary-address");if(aZ.text()!=a0){aZ.text(a0);loadScript("wallet/jquery.qrcode",function(){$("#my-primary-addres-qr-code").empty().qrcode({width:125,height:125,text:a0})})}}}function T(){var aY=$("#export-warning").show();var aZ=$("#import-export-content").hide();$("#show-import-export").unbind().click(function(){h.getMainPassword(function(){aY.hide();loadScript("wallet/import-export",function(){ImportExport.init(aZ,function(){aZ.show()},function(){ah($("#home-intro"))})},function(a0){h.makeNotice("error","misc-error",a0);ah($("#home-intro"))})},function(){ah($("#home-intro"))})})}function Y(){var aZ=null;var a1=0;if(aZ!=null){clearInterval(aZ);aZ=null}var aY;if(s.tx_display==0){$("#transactions-detailed").hide();aY=$("#transactions-compact").show().find("tbody").empty()}else{$("#transactions-compact").hide();aY=$("#transactions-detailed").empty().show()}if(F.length==0){$("#transactions-detailed, #transactions-compact").hide();$("#no-transactions").show();return}else{$("#no-transactions").hide()}var a0=function(){for(var a5=a1;a5<F.length&&a5<(a1+h.getNTransactionsPerPage());++a5){var a4=F[a5];if(s.tx_display==0){aY.append(aT($(D(a4,K,g)),a4))}else{aY.append(a4.getHTML(K,g))}}a1+=h.getNTransactionsPerPage();if(a1<F.length){aZ=setTimeout(a0,15)}else{setupSymbolToggle();N();var a3=$(".pagination ul").empty();if(az==0&&F.length<h.getNTransactionsPerPage()){a3.hide();return}else{a3.show()}var a2=Math.ceil(aW/h.getNTransactionsPerPage());var a7=" disabled";if(az>0){a7=""}var a8=10;var a6=Math.max(0,Math.min(az-(a8/2),a2-a8));a3.append($('<li class="prev'+a7+'"><a>&larr; Previous</a></li>').click(function(){h.setPage(az-1)}));if(a6>0){a3.append($("<li><a>≤</a></li>").click(function(){h.setPage(0)}))}for(var a5=a6;a5<a2&&a5<a6+a8;++a5){(function(a9){var ba="";if(az==a9){ba=' class="active"'}a3.append($("<li"+ba+'><a class="hidden-phone">'+(a9+1)+"</a></li>").click(function(){h.setPage(a9)}))})(a5)}if(a6+a8<a2){a3.append($("<li><a>≥</a></li>").click(function(){h.setPage(a2-1)}))}var a7=" disabled";if(az<a2-1){a7=""}a3.append($('<li class="next'+a7+'"><a>Next &rarr;</a></li>').click(function(){h.setPage(az+1)}))}};a0()}this.setPage=function(aY){az=aY;scroll(0,0);h.get_history()};function v(){loadScript("wallet/frame-modal",function(){showFrameModal({title:"Export History",description:"",src:root+"export-history?active="+h.getActiveAddresses().join("|")+"&archived="+h.getArchivedAddresses().join("|")})})}function J(a1,a0){if(!a0){if(a1.mixer_fee){x=a1.mixer_fee}I=a1.recommend_include_fee;if(a1.info){if(a1.info.symbol_local){setLocalSymbol(a1.info.symbol_local)}if(a1.info.symbol_btc){setBTCSymbol(a1.info.symbol_btc)}}}if(a1.disable_mixer){$("#shared-addresses,#send-shared").hide()}aG=a1.sharedcoin_endpoint;F.length=0;if(a1.wallet==null){av=0;U=0;aB=0;M=0;aW=0;return}av=a1.wallet.total_received;U=a1.wallet.total_sent;aB=a1.wallet.final_balance;M=a1.wallet.n_tx;aW=a1.wallet.n_tx_filtered;for(var aZ=0;aZ<a1.addresses.length;++aZ){if(K[a1.addresses[aZ].address]){K[a1.addresses[aZ].address].balance=a1.addresses[aZ].final_balance}}for(var aZ=0;aZ<a1.txs.length;++aZ){var aY=TransactionFromJSON(a1.txs[aZ]);aY.result=t(aY,false);F.push(aY)}if(!a0){if(a1.info.latest_block){aA(a1.info.latest_block)}}}this.handleURI=function(aZ,aY){loadScript("wallet/jsuri-1.1.1",function(){try{var a1=new Uri(aZ);var a0=new Bitcoin.Address(a1.host());aY.find('input[name="send-to-address"]').val(a0.toString());var a2=parseFloat(a1.getQueryParamValue("amount"));if(a2>0&&!isNaN(a2)){aY.find(".send-value").val(a2)}}catch(a3){console.log(a3);h.makeNotice("error","error","Invalid Bitcoin Address or URI")}},function(){h.makeNotice("error","error","Invalid Bitcoin Address or URI")})};function aP(){L();W=setTimeout(h.logout,h.getLogoutTime());for(var a0 in ab){ab[a0]("did_decrypt")}MyStore.get("multiaddr",function(a2){if(a2!=null){J($.parseJSON(a2),true);c()}});h.get_history();$("#initial_error,#initial_success").remove();var a1=decodeURIComponent(window.location.hash.replace("#",""));if(a1.indexOf("bitcoin:")==0){var aY=$("#send-coins");ah(aY);var aZ=aY.find(".tab-pane.active").find(".recipient").first();h.handleURI(a1,aZ)}else{ah($("#home-intro"))}window.location.hash=""}function L(a1,aY){for(var aZ in K){var a2=K[aZ];if(a2.tag==1){alert("Warning! wallet data may have changed but cannot sync as you have un-saved keys");return}}console.log("Get wallet with checksum "+aC);var a0={method:"wallet.aes.json",format:"json"};if(aC&&aC.length>0){a0.checksum=aC}h.securePost("wallet",a0,function(a3){if(!a3.payload||a3.payload=="Not modified"){if(a1){a1()}return}console.log("Wallet data modified");h.setEncryptedWalletData(a3.payload);ad(function(){h.get_history();c();if(a1){a1()}},function(){if(aY){aY()}})},function(a3){if(aY){aY()}})}function ad(aZ,aY){if(ak==null||ak.length==0){aY("No Wallet Data To Decrypt");return}h.decryptWallet(ak,aL,function(a4,a2){try{d=a4.sharedKey;if(!d||d.length==0||d.length!=36){throw"Shared Key is invalid"}if(a2){S=a2.version;R=a2.pbkdf2_iterations}if(a4.double_encryption&&a4.dpasswordhash){G=a4.double_encryption;w=a4.dpasswordhash}if(a4.options){$.extend(s,a4.options)}K={};for(var a1=0;a1<a4.keys.length;++a1){var a0=a4.keys[a1];if(a0.addr==null||a0.addr.length==0||a0.addr=="undefined"){h.makeNotice("error","null-error","Your wallet contains an undefined address. This is a sign of possible corruption, please double check all your BTC is accounted for. Backup your wallet to remove this error.",15000);continue}if(a0.tag==1){a0.tag=null}K[a0.addr]=a0}g={};if(a4.address_book){for(var a1=0;a1<a4.address_book.length;++a1){h.addAddressBookEntry(a4.address_book[a1].addr,a4.address_book[a1].label)}}if(a4.tx_notes){b=a4.tx_notes}if(aC==null||aC.length==0){aC=aj()}e();aZ()}catch(a3){aY(a3)}},aY)}this.getPassword=function(a3,a4,a1){if(!a3.is(":visible")){a3.trigger("hidden");a3.unbind()}a3.modal({keyboard:false,backdrop:"static",show:true});a3.center();var a2=a3.find('input[name="password"]');var a6=a2,aY=false,a5=false;a3.find(".vkeyboard li").unbind().click(function(){var a9=$(this),a8=a9.html();if(a9.hasClass("left-shift")||a9.hasClass("right-shift")){$(".letter").toggleClass("uppercase");$(".symbol span").toggle();aY=(aY===true)?false:true;a5=false;return false}if(a9.hasClass("capslock")){$(".letter").toggleClass("uppercase");a5=true;return false}if(a9.hasClass("delete")){var a7=a6.val();a6.val(a7.substr(0,a7.length-1));return false}if(a9.hasClass("symbol")){a8=$("span:visible",a9).html()}if(a9.hasClass("space")){a8=" "}if(a9.hasClass("tab")){a8="\t"}if(a9.hasClass("return")){a8="\n"}if(a9.hasClass("uppercase")){a8=a8.toUpperCase()}if(aY===true){$(".symbol span").toggle();if(a5===false){$(".letter").toggleClass("uppercase")}aY=false}a6.val(a6.val()+a8)});a2.keypress(function(a7){if(a7.keyCode==13){a7.preventDefault();a3.find(".btn.btn-primary").click()}});a2.val("");var aZ=a3.find(".btn.btn-primary");aZ.click(function(){if(a4){a1=null;var a7=a4;a4=null;setTimeout(function(){a3.modal("hide");a7(a2.val())},10)}else{a3.modal("hide")}});var a0=a3.find(".btn.btn-secondary");a0.click(function(){if(a1){var a7=a1;a1=null;a4=null;setTimeout(function(){a3.modal("hide");try{a7()}catch(a8){h.makeNotice("error","misc-error",a8)}},10)}else{a3.modal("hide")}});a3.on("hidden",function(){a2.unbind();a0.unbind();aZ.unbind();a3.unbind();if(a1){var a7=a1;a1=null;a4=null;setTimeout(function(){try{a7()}catch(a8){h.makeNotice("error","misc-error",a8)}},10)}})};this.makePairingQRCode=function(aZ,aY){h.getMainPassword(function(){loadScript("wallet/jquery.qrcode",function(){try{if(aY==1){h.securePost("wallet",{method:"pairing-encryption-password"},function(a1){aZ($("<div></div>").qrcode({width:300,height:300,text:"1|"+O+"|"+h.encrypt(d+"|"+Crypto.util.bytesToHex(UTF8.stringToBytes(aL)),a1,h.getDefaultPbkdf2Iterations())}))},function(a1){h.makeNotice("error","misc-error",a1)})}else{if(aY==0){aZ($("<div></div>").qrcode({width:300,height:300,text:O+"|"+d+"|"+aL}))}}}catch(a0){h.makeNotice("error","misc-error",a0)}})},function(){h.logout()})};this.getMainPassword=function(aZ,aY){if(C>new Date().getTime()-P){return aZ(aL)}h.getPassword($("#main-password-modal"),function(a0){if(aL==a0){C=new Date().getTime();if(aZ){try{aZ(aL)}catch(a1){h.makeNotice("error","misc-error",a1)}}}else{h.makeNotice("error","misc-error","Password incorrect.");if(aY){try{aY()}catch(a1){h.makeNotice("error","misc-error",a1)}}}},aY)};this.getSecondPassword=function(a0,aY){if(!G||am!=null){if(a0){try{a0(am)}catch(aZ){h.makeNotice("error","misc-error",aZ)}}return}h.getPassword($("#second-password-modal"),function(a1){try{if(aM(a1)){if(a0){try{a0(a1)}catch(a2){console.log(a2);h.makeNotice("error","misc-error",a2)}}}else{h.makeNotice("error","misc-error","Password incorrect.");if(aY){try{aY()}catch(a2){h.makeNotice("error","misc-error",a2)}}}}catch(a2){if(aY){try{aY()}catch(a2){h.makeNotice("error","misc-error",a2)}}}},aY)};function a(){if(B||ay){return}try{ay=true;var aY=$("#restore-password");aL=aY.val();aY.val("");C=new Date().getTime();function aZ(a2){ay=false;h.makeNotice("error","misc-error",a2)}if(ak==null||ak.length==0){h.setLoadingText("Validating Authentication key");var a0=$.trim($(".auth-"+q).find(".code").val());if(a0.length==0||a0.length>255){throw"You must enter a Two Factor Authentication code"}$.ajax({type:"POST",url:root+"wallet",data:{guid:O,payload:a0,length:a0.length,method:"get-wallet",format:"plain"},success:function(a2){try{if(a2==null||a2.length==0){throw"Server Return Empty Wallet Data"}if(a2!="Not modified"){h.setEncryptedWalletData(a2)}$(".auth-"+q).hide();$(".auth-0").show();ad(function(){ay=false;n();aP()},aZ)}catch(a3){aZ(a3)}},error:function(a2){aZ(a2.responseText)}})}else{ad(function(){ay=false;n();aP()},aZ)}}catch(a1){aZ(a1)}}function Q(){$("#not-synced-warning-modal").modal("show").find(".btn.btn-danger").unbind().click(function(){$(this).modal("hide");at=true;c()})}function e(){if(B){return}aw("error");webSocketConnect(y);B=true;$("#tech-faq").hide();$("#intro-text").hide();$("#large-summary").show()}this.quickSendNoUI=function(a0,aZ,aY){loadScript("wallet/signer",function(){h.getSecondPassword(function(){try{var a2=initNewTx();a2.from_addresses=h.getActiveAddresses();a2.to_addresses.push({address:new Bitcoin.Address(a0),value:Bitcoin.Util.parseValue(aZ)});a2.addListener(aY);a2.start()}catch(a1){aY.on_error(a1)}},function(a1){aY.on_error(a1)})})};function H(){h.setLoadingText("Sending email backup");h.securePost("wallet",{method:"email-backup"},function(aY){h.makeNotice("success","backup-success",aY)},function(aY){h.makeNotice("error","misc-error",aY.responseText)})}this.backupWalletDelayed=function(a1,a0,aZ,aY){if(ao){clearInterval(ao);ao=null}ao=setTimeout(function(){h.backupWallet(a1,a0,aZ,aY)},3000)};this.backupWallet=function(a4,a3,aZ){if(ao){clearInterval(ao);ao=null}var aY=function(a5){h.makeNotice("error","misc-error","Error Saving Wallet: "+a5,10000);c();if(aZ!=null){aZ(a5)}else{throw a5}};try{if(a4==null){a4="update"}if(aH(K)==0){return}var a0=h.makeWalletJSON();var a2=h.encryptWallet(a0,aL);if(a2.length==0){throw"Error encrypting the JSON output"}h.decryptWallet(a2,aL,function(a8){try{var a5=aC;h.setLoadingText("Saving wallet");h.setEncryptedWalletData(a2);var a6={length:a2.length,payload:a2,checksum:aC,old_checksum:a5,method:a4,format:"plain",language:Z};if(z){a6.active=h.getActiveAddresses().join("|")}h.securePost("wallet",a6,function(ba){for(var a9 in K){var bb=K[a9];if(bb.tag==1){delete bb.tag}}h.makeNotice("success","misc-success",ba);c();if(a3!=null){a3()}},function(ba){for(var a9 in K){var bb=K[a9];if(bb.tag==1){Q();break}}aY(ba.responseText)})}catch(a7){aY(a7)}})}catch(a1){aY(a1)}};function aQ(aY){if(G){if(am==null){throw"Cannot encrypt private key without a password"}return h.encrypt(aY,d+am,h.getSecondPasswordPbkdf2Iterations())}else{return aY}return null}this.isBase58=function(a0,aZ){for(var aY=0;aY<a0.length;++aY){if(a0[aY]<0||a0[aY]>58){return false}}return true};this.encrypt=function(a0,aZ,aY){return Crypto.AES.encrypt(a0,aZ,{mode:new Crypto.mode.CBC(Crypto.pad.iso10126),iterations:aY})};this.encryptWallet=function(aZ,aY){if(S==2){return JSON.stringify({pbkdf2_iterations:h.getMainPasswordPbkdf2Iterations(),version:S,payload:h.encrypt(aZ,aY,h.getMainPasswordPbkdf2Iterations())})}else{if(S==0){return h.encrypt(aZ,aY,h.getDefaultPbkdf2Iterations())}else{throw"Unknown encryption version "+S}}};this.decryptWallet=function(aZ,a5,a6,a2){try{var aY=null;try{var aY=$.parseJSON(aZ)}catch(a0){console.log(a0)}var a1=function(){try{var a8=Crypto.AES.decrypt(aY.payload,a5,{mode:new Crypto.mode.CBC(Crypto.pad.iso10126),iterations:aY.pbkdf2_iterations});var a7=$.parseJSON(a8);a6(a7,aY)}catch(a9){a2("Error Decrypting Wallet. Please check your password is correct.")}};if(aY&&aY.payload&&aY.pbkdf2_iterations){if(aY.version!=aq){throw"Wallet version "+aY.version+" not supported"}if(aY.pbkdf2_iterations>100){var a4=$("#decrypting-progress-modal");var a3=setTimeout(function(){a4.modal({keyboard:false,backdrop:"static",show:true});a4.center()},500);h.decryptWebWorker(aY.payload,a5,aY.pbkdf2_iterations,function(a8){clearTimeout(a3);a4.modal("hide");try{var a7=$.parseJSON(a8);a6(a7,aY)}catch(a9){a1()}},function(){clearTimeout(a3);a4.modal("hide");a1()})}else{a1()}}else{h.decrypt(aZ,a5,h.getDefaultPbkdf2Iterations(),function(a8){try{var a7=$.parseJSON(a8);try{a6(a7)}catch(a9){console.log(a9)}return true}catch(a9){return false}},function(){a2("Error Decrypting Wallet. Please check your password is correct.")})}}catch(a0){if(a2){a2(a0)}}};this.decryptWebWorker=function(a1,a5,a0,a6,a4){var aY=false;var a3=function(a7){if(!aY){a4(a7);aY=true}};try{var aZ=new Worker(resource+"wallet/signer"+(min?".min.js":".js"));aZ.addEventListener("message",function(a8){var a7=a8.data;try{switch(a7.cmd){case"on_decrypt":a6(a7.data);aZ.terminate();break;case"on_error":throw a7.e}}catch(a8){aZ.terminate();a3(a8)}},false);aZ.addEventListener("error",function(a7){a3(a7)});aZ.postMessage({cmd:"load_resource",path:resource+"wallet/bitcoinjs"+(min?".min.js":".js")});aZ.postMessage({cmd:"decrypt",data:a1,password:a5,pbkdf2_iterations:a0})}catch(a2){a3(a2)}};this.decrypt=function(a2,a1,aZ,a4,a0){try{var aY=Crypto.AES.decrypt(a2,a1,{mode:new Crypto.mode.CBC(Crypto.pad.iso10126),iterations:aZ});if(aY!=null&&aY.length>0){if(a4(aY)){return aY}}}catch(a3){console.log(a3)}if(aZ!=10){try{var aY=Crypto.AES.decrypt(a2,a1,{mode:new Crypto.mode.CBC(Crypto.pad.iso10126),iterations:10});if(aY!=null&&aY.length>0){if(a4(aY)){return aY}}}catch(a3){console.log(a3)}}try{var aY=Crypto.AES.decrypt(a2,a1);if(aY!=null&&aY.length>0){if(a4(aY)){return aY}}}catch(a3){console.log(a3)}try{var aY=Crypto.AES.decrypt(a2,a1,{mode:new Crypto.mode.OFB(Crypto.pad.iso7816),iterations:1});if(aY!=null&&aY.length>0){if(a4(aY)){return aY}}}catch(a3){console.log(a3)}try{var aY=Crypto.AES.decrypt(a2,a1,{mode:new Crypto.mode.CBC(Crypto.pad.iso10126),iterations:1});if(aY!=null&&aY.length>0){if(a4(aY)){return aY}}}catch(a3){console.log(a3)}if(a0){a0()}return null};this.handleNTPResponse=function(a2,a3){var a0=(new Date()).getTime();if(a2.clientTimeDiff&&a2.serverTime){var aY=a0-a2.serverTime;var aZ=(a2.clientTimeDiff-a0+a3-aY)/2;var a1=(aY-aZ)/2;if(aa){aO=(aO+a1)/2}else{aO=a1;aa=true;MyStore.put("server_time_offset",""+aO)}console.log("Server Time offset "+aO+"ms - This offset "+a1)}};this.setGUID=function(a0,aY){console.log("Set GUID "+a0);if(B){throw"Cannot Set GUID Once Initialized"}h.setLoadingText("Changing Wallet Identifier");$("#initial_error,#initial_success").remove();var aZ=$("#restore-wallet-continue");aZ.prop("disabled",true);var a2=(new Date()).getTime();var a1={format:"json",resend_code:aY,ct:a2};if(aC){a1.checksum=aC}$.ajax({type:"GET",dataType:"json",url:root+"wallet/"+a0,data:a1,timeout:10000,success:function(a3){h.handleNTPResponse(a3,a2);aZ.prop("disabled",false);if(!a3.guid){h.makeNotice("error","misc-error","Server returned null guid.");return}$(".auth-"+q).hide();ac=a3.extra_seed;O=a3.guid;q=a3.auth_type;aR=a3.real_auth_type;z=a3.sync_pubkeys;if(a3.payload&&a3.payload.length>0&&a3.payload!="Not modified"){h.setEncryptedWalletData(a3.payload)}war_checksum=a3.war_checksum;setLocalSymbol(a3.symbol_local);setBTCSymbol(a3.symbol_btc);$("#restore-guid").val(O);$(".auth-"+q).show();if(a3.initial_error){h.makeNotice("error","misc-error",a3.initial_error)}if(a3.initial_success){h.makeNotice("success","misc-success",a3.initial_success)}MyStore.get("guid",function(a4){if(a4!=O){MyStore.remove("guid");MyStore.remove("payload");MyStore.remove("multiaddr");if(O!=E){MyStore.put("guid",O)}}});if(a3.language&&Z!=a3.language){h.setLanguage(a3.language)}},error:function(a3){aZ.prop("disabled",false);MyStore.get("guid",function(a4){if(a4==a0&&ak){h.makeNotice("error","misc-error","Error Contacting Server. Using Local Wallet Cache.");O=a4;aC=aj();q=0;$("#restore-guid").val(O);$(".auth-"+q).show();return}try{var a6=$.parseJSON(a3.responseText);if(a6.authorization_required){loadScript("wallet/poll-for-session-guid",function(){pollForSessionGUID()})}if(a6.initial_error){h.makeNotice("error","misc-error",a6.initial_error)}return}catch(a5){}if(a3.responseText){h.makeNotice("error","misc-error",a3.responseText)}else{h.makeNotice("error","misc-error","Error changing wallet identifier")}})}})};function i(aY){var aZ=B58.encode(aY);return aQ(aZ)}this.decryptPK=function(aY){if(G){if(am==null){throw"Cannot decrypt private key without a password"}return h.decrypt(aY,d+am,h.getSecondPasswordPbkdf2Iterations(),h.isBase58)}else{return aY}return null};this.decodePK=function(aZ){if(!aZ){throw"null PK passed to decodePK"}var aY=h.decryptPK(aZ);if(aY!=null){return B58.decode(aY)}return null};this.signmessage=function(aY,a0){var a2=K[aY];if(!a2.priv){throw"Cannot sign a watch only address"}var a1=h.decodePK(a2.priv);var aZ=new Bitcoin.ECKey(a1);return Bitcoin.Message.signMessage(aZ,a0,a2.addr)};function aM(aZ){var aY=Crypto.SHA256(d+aZ,{asBytes:true});var a2=ag(aY,h.getSecondPasswordPbkdf2Iterations()-1);if(a2==w){am=aZ;return true}if(h.getSecondPasswordPbkdf2Iterations()!=10){var a0=ag(aY,10-1);if(a0==w){am=aZ;w=a2;return true}}if(Crypto.util.bytesToHex(aY)==w){am=aZ;w=a2;return true}var a1=Crypto.SHA256(aZ);if(a1==w){am=aZ;w=a2;return true}return false}this.runCompressedCheck=function(){var aY=[];var a0={};for(var a1 in K){var a5=K[a1];if(a5.priv!=null){var a4=h.decodePK(a5.priv);var a2=new Bitcoin.ECKey(a4);var aZ=a2.getBitcoinAddress().toString();var a3=a2.getBitcoinAddressCompressed().toString();if(a5.addr!=aZ){a0[aZ]=a5.priv;aY.push(aZ)}if(a5.addr!=a3){a0[a3]=a5.priv;aY.push(a3)}}}if(aY.length==0){alert("to_check length == 0")}BlockchainAPI.get_balances(aY,function(a9){var ba=0;for(var a8 in a9){var bb=a9[a8].final_balance;if(bb>0){var a7=new Bitcoin.ECKey(h.decodePK(a0[a8]));var a6=a7.getBitcoinAddress().toString();if(h.addPrivateKey(a7,{compressed:a6!=a8,app_name:IMPORTED_APP_NAME,app_version:IMPORTED_APP_VERSION})){alert(formatBTC(bb)+" claimable in address "+a8)}}ba+=bb}alert(formatBTC(ba)+" found in compressed addresses");if(ba>0){h.backupWallet("update",function(){h.get_history()})}})};this.checkAllKeys=function(aY){for(var aZ in K){var a3=K[aZ];if(a3.addr==null){throw"Null Address Found in wallet "+aZ}if(a3.addr.toString()==null){throw"Error decoding wallet address "+a3.addr}if(a3.priv!=null){var a2=h.decodePK(a3.priv);var a1=new Bitcoin.ECKey(a2);var a0=a1.getBitcoinAddress().toString();if(a0!=a3.addr&&a1.getBitcoinAddressCompressed().toString()!=a3.addr){throw"Private key does not match bitcoin address "+a3.addr+" != "+a0}if(aY){a3.priv=i(a2)}}}h.makeNotice("success","wallet-success","Wallet verified.")};this.setMainPassword=function(aY){h.getMainPassword(function(){aL=aY;h.backupWallet("update",function(){h.logout()},function(){h.logout()})})};function ah(aY){if(aY===j){return}if(j!=null){if($("#"+j.attr("id")+"-btn").length>0){$("#"+j.attr("id")+"-btn").parent().attr("class","")}j.hide()}j=aY;j.show();if($("#"+j.attr("id")+"-btn").length>0){$("#"+j.attr("id")+"-btn").parent().attr("class","active")}c(true)}function aH(a0){var aZ=0,aY;for(aY in a0){aZ++}return aZ}function af(aY){K[aY].priv=null}function al(){if(aH(K)>=aE){h.makeNotice("error","misc-error","We currently support a maximum of "+aE+" private keys, please remove some unused ones.");return true}return false}function aU(a0,aY){var aZ=K[a0];if(!aZ||aZ.length==0){K[a0]={addr:a0,priv:aY,balance:0};return true}else{if(!aZ.priv&&aY){aZ.priv=aY;return true}}return false}function o(){var a0=$("#add-address-book-entry-modal");a0.modal({keyboard:true,backdrop:"static",show:true});var aY=a0.find('input[name="label"]');var aZ=a0.find('input[name="address"]');aY.val("");aZ.val("");a0.find(".btn.btn-primary").unbind().click(function(){a0.modal("hide");var a2=stripHTML(aY.val());var a1=stripHTML(aZ.val());if(a2.length==0||a1.length==0){h.makeNotice("error","misc-error","You must enter an address and label for the address book entry");return false}var a4;try{a4=new Bitcoin.Address(a1);if(a4==null){throw"Null address"}}catch(a3){h.makeNotice("error","misc-error","Bitcoin address invalid, please make sure you entered it correctly");return false}if(g[a1]!=null){h.makeNotice("error","misc-error","Bitcoin address already exists");return false}h.makeNotice("success","misc-success","Added Address book entry");h.addAddressBookEntry(a1,a2);h.backupWalletDelayed();$("#send-coins").find(".tab-pane").trigger("show",true)});a0.find(".btn.btn-secondary").unbind().click(function(){a0.modal("hide")})}this.logout=function(){if(ar){return}if(O==E){window.location=root+"wallet/logout"}else{$.ajax({type:"GET",url:root+"wallet/logout",data:{format:"plain"},success:function(aY){window.location.reload()},error:function(){window.location.reload()}})}};function ap(a4){var a6=$("#delete-address-modal");a6.modal({keyboard:true,backdrop:"static",show:true});a6.find(".btn.btn-primary").hide();a6.find(".btn.btn-danger").hide();$("#change-mind").hide();a6.find("#to-delete-address").html(a4.join(" "));a6.find("#delete-balance").empty();var a0=a6.find("#delete-balance");var aY=[];for(var a3 in a4){var a5=a4[a3];if(K[a5]&&K[a5].priv){aY.push(a4[a3])}}BlockchainAPI.get_balance(aY,function(a7){a6.find(".btn.btn-primary").show(200);a6.find(".btn.btn-danger").show(200);a0.html("Balance "+formatBTC(a7));if(a7>0){a0.css("color","red")}else{a0.css("color","black")}},function(){a6.find(".btn.btn-primary").show(200);a6.find(".btn.btn-danger").show(200);a0.text("Error Fetching Balance")});var a1=false;var a3=0;var aZ=null;var a2=10;changeMind=function(){$("#change-mind").show();$("#change-mind-time").text(a2-a3)};a6.find(".btn.btn-primary").unbind().click(function(){changeMind();a6.find(".btn.btn-primary").hide();a6.find(".btn.btn-danger").hide();aZ=setInterval(function(){if(a1){return}++a3;changeMind();if(a3==a2){$("#delete-address-modal").modal("hide");h.makeNotice("warning","warning-deleted","Private Key Removed From Wallet");for(var a7 in a4){af(a4[a7])}c();h.backupWallet();clearInterval(aZ)}},1000)});a6.find(".btn.btn-danger").unbind().click(function(){changeMind();a6.find(".btn.btn-primary").hide();a6.find(".btn.btn-danger").hide();aZ=setInterval(function(){if(a1){return}++a3;changeMind();if(a3==a2){try{$("#delete-address-modal").modal("hide");h.makeNotice("warning","warning-deleted","Address & Private Key Removed From Wallet");for(var a7 in a4){h.deleteAddress(a4[a7])}c();h.backupWallet("update",function(){h.get_history()})}finally{clearInterval(aZ)}}},1000)});a6.unbind().on("hidden",function(){if(aZ){a1=true;clearInterval(aZ);aZ=null}});a6.find(".btn.btn-secondary").unbind().click(function(){a6.modal("hide")})}function aD(){var a0=[];for(var aY in g){a0.push(g[aY])}for(var aY in K){var aZ=K[aY];if(aZ.tag!=2&&aZ.label){a0.push(aZ.label)}}return a0}this.sweepAddressesModal=function(aZ,aY){h.getSecondPassword(function(){var a1=$("#sweep-address-modal");a1.modal("show");BlockchainAPI.get_balance(aZ,function(a2){a1.find(".balance").text("Amount: "+formatBTC(a2))},function(){a1.find(".balance").text("Error Fetching Balance")});var a0=a1.find('select[name="change"]');l(a0,true);a1.find(".btn.btn-primary").unbind().click(function(){loadScript("wallet/signer",function(){BlockchainAPI.get_balance(aZ,function(a3){var a4=initNewTx();var a2=a0.val();if(a2=="any"){a2=h.getPreferredAddress()}a4.fee=a4.base_fee;a4.to_addresses.push({address:new Bitcoin.Address(a2),value:BigInteger.valueOf(a3).subtract(a4.fee)});a4.from_addresses=aZ;a4.extra_private_keys=aY;a4.start()},function(){h.makeNotice("error","misc-error","Error Getting Address Balance")})});a1.modal("hide")});a1.find(".btn.btn-secondary").unbind().click(function(){a1.modal("hide")})})};this.openWindow=function(aZ){function aY(a1){var a0=false;try{if(typeof a1=="undefined"||!a1){a0=true}else{if(a1&&a1.closed){a0=false}else{if(a1&&a1.test){a0=false}}}}catch(a2){}return a0}window.open(aZ,null,"scroll=1,status=1,location=1,toolbar=1");if(aY(window)){h.makeNotice("error","misc-error","Popup Blocked. Try and click again.");return false}else{return true}};function aF(){try{$(".pop").popover({offset:10,placement:"bottom"})}catch(aY){}}function n(){if(V){return}V=true;$("#add-address-book-entry-btn").click(function(){o()});$("#home-intro-btn").click(function(){ah($("#home-intro"))});$("#my-transactions-btn").click(function(){ah($("#my-transactions"))});$("#send-coins-btn").click(function(){ah($("#send-coins"))});$("#import-export-btn").click(function(){ah($("#import-export"));T()});$("#chord-diagram").click(function(){loadScript("wallet/frame-modal",function(){showFrameModal({title:"Address Relationships",description:"",src:root+"taint/"+h.getActiveAddresses().join("|")})})});$("#verify-message").click(function(){loadScript("wallet/address_modal",function(){verifyMessageModal()})});$("#generate-cold-storage").click(function(){loadScript("wallet/paper-wallet",function(){PaperWallet.showColdStorageModal()},null,true)});$("#group-received").click(function(){loadScript("wallet/taint_grouping",function(){try{loadTaintData()}catch(aY){h.makeNotice("error","misc-error","Unable To Load Taint Grouping Data")}})});$("#my-account-btn").click(function(){ah($("#my-account"));var aY=$("#account-settings-warning").show();var aZ=$("#my-account-content").hide();$("#show-account-settings").unbind().click(function(){h.getMainPassword(function(){aY.hide();loadScript("wallet/account",function(){AccountSettings.init(aZ,function(){aZ.show()},function(){ah($("#home-intro"))})},function(a0){h.makeNotice("error","misc-error",a0);ah($("#home-intro"))})},function(){ah($("#home-intro"))})})});$("#enable_archived_checkbox").change(function(){var aY=$(this).is(":checked");$(".archived_checkbox").prop("checked",false);$(".archived_checkbox").prop("disabled",!aY);$("#archived-sweep").prop("disabled",!aY);$("#archived-delete").prop("disabled",!aY)});$("#shared-addresses").on("show",function(){var aY=$(this);loadScript("wallet/shared-addresses",function(){buildSharedTable(aY)})});$("#active-addresses").on("show",function(){var a4=$(this).find("table:first");a4.find("tbody:gt(0)").remove();var a1=a4.find("tbody").empty();for(var a3 in K){var a5=K[a3];if(a5.tag==2||(a5.tag==1&&!at)){continue}var a2="";if(a5.tag==1){a2=' <font color="red" class="pop" title="Not Synced" data-content="This is a new address which has not yet been synced with our the server. Do not used this address yet.">(Not Synced)</font>'}else{if(a5.priv==null){a2=' <font color="red" class="pop" title="Watch Only" data-content="Watch Only means there is no private key associated with this bitcoin address. <br /><br /> Unless you have the private key stored elsewhere you do not own the funds at this address and can only observe the transactions.">(Watch Only)</font>'}}var aY="";var a0=a5.addr;if(a5.label!=null){a0=a5.label;aY='<span class="hidden-phone"> - '+a5.addr+"</span>"}var aZ=$('<tr><td><div class="short-addr"><a href="'+root+"address/"+a5.addr+'" target="new">'+a0+"</a>"+aY+" "+a2+'<div></td><td><span style="color:green">'+formatMoney(a5.balance,true)+'</span></td>            <td><div class="btn-group pull-right"><a class="btn btn-mini dropdown-toggle" data-toggle="dropdown" href="#"><span class="hidden-phone">Actions </span><span class="caret"></span></a><ul class="dropdown-menu">             <li><a href="#" class="pop act-archive" title="Archive Address" data-content="Click this button to hide the address from the main view. You can restore or delete later by finding it in the Archived addresses tab.">Archive Address</a></li>            <li><a href="#" class="pop act-label" title="Label Address" data-content="Set the label for this address.">Label Address</a></li>            <li><a href="#" class="pop act-qr" title="Show QR Code" data-content="Show a QR Code for this address.">QR Code</a></li>            <li><a href="#" class="pop act-sign" title="Sign Message" data-content="Sign A message with this address.">Sign Message</a></li>            <li><a href="#" class="pop act-request" title="Request Payment" data-content="Click here to create a new QR Code payment request. The QR Code can be scanned using most popular bitcoin software and mobile apps.">Create Payment Request</a></li>            <li><a href="#" class="pop act-pubkey">Show Public Key</a></li>            </ul></div></td></tr>');(function(a6){aZ.find(".act-archive").click(function(){h.archiveAddr(a6)});aZ.find(".act-label").click(function(){loadScript("wallet/address_modal",function(){showLabelAddressModal(a6)})});aZ.find(".act-qr").click(function(){loadScript("wallet/address_modal",function(){showAddressModalQRCode(a6)})});aZ.find(".act-pubkey").click(function(){h.getSecondPassword(function(){var a7=h.getPrivateKey(a6);if(a7==null){h.makeNotice("eror","misc-error","Public Key Unknown");return}var a8=new Bitcoin.ECKey(h.decodePK(a7));if(a8.getBitcoinAddressCompressed().toString()==a6){var a9=a8.getPubCompressed()}else{var a9=a8.getPub()}h.makeNotice("success","pub-key","Public Key of "+a6+" is "+Crypto.util.bytesToHex(a9),20000)})});aZ.find(".act-sign").click(function(){loadScript("wallet/address_modal",function(){showAddressModalSignMessage(a6)})});aZ.find(".act-request").click(function(){loadScript("wallet/frame-modal",function(){showFrameModal({title:"Create Payment Request",description:"Request Payment into address <b>"+a6+"</b>",src:root+"payment_request?address="+a6})})})})(a5.addr);if(a5.balance>0&&a5.priv){a4.prepend(aZ)}else{a4.append(aZ)}}aF()});$("#archived-addresses").on("show",function(){$("#enable_archived_checkbox").prop("checked",false);$("#archived-delete").prop("disabled",true);$("#archived-sweep").prop("disabled",true);$("#archived-addr tbody").empty();var aZ=$(this).find("tbody");var aY=h.getArchivedAddresses();var a0=function(){aZ.empty();for(var a4 in aY){var a6=K[aY[a4]];if(a6.tag!=2||(a6.tag==1&&!at)){continue}var a3="";if(a6.priv==null){a3=' <font color="red">(Watch Only)</font>'}var a1="";var a2=a6.addr;if(a6.label!=null){a2=a6.label;a1='<span class="hidden-phone"> - '+a6.addr+"</span>"}var a5=$('<tr><td style="width:20px;"><input type="checkbox" class="archived_checkbox" value="'+a6.addr+'" disabled></td><td><div class="short-addr"><a href="'+root+"address/"+a6.addr+'" target="new">'+a2+"</a>"+a1+" "+a3+'<div></td><td><span style="color:green">'+formatBTC(a6.balance)+'</span></td><td style="width:16px"><img src="'+resource+'unarchive.png" class="act-unarchive" /></td></tr>');(function(a7){a5.find(".act-unarchive").click(function(){h.unArchiveAddr(a7)})})(a6.addr);if(a6.balance>0&&a6.priv){aZ.prepend(a5)}else{aZ.append(a5)}}};a0();BlockchainAPI.get_balances(aY,function(a1){a0()},function(a1){h.makeNotice("error","misc-error",a1)})});$("#archived-sweep").click(function(){var aY=[];$(".archived_checkbox:checked").each(function(){var aZ=K[$(this).val()];if(aZ.priv==null){h.makeNotice("error","misc-error","Cannot Sweep Watch Only Address");return}aY.push(aZ.addr)});if(aY.length==0){return}h.sweepAddressesModal(aY)});$("#archived-delete").click(function(){var aY=[];$(".archived_checkbox:checked").each(function(){aY.push($(this).val())});if(aY.length==0){return}ap(aY)});$("#shared-never-ask").click(function(){SetCookie("shared-never-ask",$(this).is(":checked"))});$(".deposit-btn").click(function(){var a0=$(this);var aZ=h.getPreferredAddress();var aY=a0.data("extra");if(aY==null){aY=""}loadScript("wallet/frame-modal",function(){showFrameModal({title:a0.data("title"),description:"Deposit into address <b>"+aZ+"</b>",top_right:'Have Questions? Read <a href="'+a0.data("link")+'" target="new">How It Works</a>',src:root+"deposit?address="+aZ+"&ptype="+a0.data("type")+"&guid="+O+aY})})});$(".withdraw-btn").click(function(){var aY=$(this);h.getSecondPassword(function(){var aZ=h.getPreferredAddress();loadScript("wallet/frame-modal",function(){showFrameModal({title:aY.data("title"),description:"Your Wallet Balance is <b>"+formatBTC(aB)+"</b>",src:root+"withdraw?method="+aY.data("type")+"&address="+aZ+"&balance="+aB+"&guid="+O})})})});$("#logout").click(h.logout);$("#refresh").click(function(){L();h.get_history()});$("#summary-n-tx-chart").click(function(){loadScript("wallet/frame-modal",function(){showFrameModal({title:"Number of transactions",description:"",src:root+"charts/n-transactions?show_header=false&address="+h.getActiveAddresses().join("|")})})});$("#summary-received-chart").click(function(){loadScript("wallet/frame-modal",function(){showFrameModal({title:"BTC Received Per Day",description:"",src:root+"charts/received-per-day?show_header=false&address="+h.getActiveAddresses().join("|")})})});$("#summary-balance-chart").click(function(){loadScript("wallet/frame-modal",function(){showFrameModal({title:"Wallet Balance",description:"",src:root+"charts/balance?show_header=false&address="+h.getActiveAddresses().join("|")})})});$("#new-addr").click(function(){try{L(function(){h.getSecondPassword(function(){var a0=h.generateNewKey();if(!a0){return}var aZ=a0.getBitcoinAddress().toString();h.backupWallet("update",function(){h.makeNotice("info","new-address","Generated new Bitcoin Address "+aZ);loadScript("wallet/address_modal",function(){showLabelAddressModal(aZ)});h.get_history()})})})}catch(aY){h.makeNotice("error","misc-error",aY)}});$(".tx_filter a").click(function(){az=0;au=$(this).data("value");h.get_history()});$(".tx_display a").click(function(){var aY=$(this).data("value");if(aY=="export"){v();return}s.tx_display=aY;c();h.backupWalletDelayed()});$("#email-backup-btn").click(function(){H()});$("#dropbox-backup-btn").click(function(){h.openWindow(root+"wallet/dropbox-login?guid="+O)});$("#gdrive-backup-btn").click(function(){h.openWindow(root+"wallet/gdrive-login?guid="+O)});$("#balance").click(function(){toggleSymbol();c()});$("#send-quick").on("show",function(a0,aZ){var aY=$(this);r(aY,aZ);aY.find(".send").unbind().click(function(){loadScript("wallet/signer",function(){startTxUI(aY,"quick",initNewTx())})})});$("#send-email").on("show",function(a0,aZ){var aY=$(this);r(aY,aZ);aY.find(".send").unbind().click(function(){loadScript("wallet/signer",function(){startTxUI(aY,"email",initNewTx())})})});$("#send-shared").on("show",function(a0,aZ){var aY=$(this);r(aY,aZ);aY.find(".mixer_fee").text(x);aY.find(".fees,.free,.bonus").show();if(x<0){aY.find(".fees,.free").hide()}else{if(x==0){aY.find(".fees,.bonus").hide()}else{aY.find(".free,.bonus").hide()}}aY.find(".send").unbind().click(function(){loadScript("wallet/signer",function(){startTxUI(aY,"shared",initNewTx())})});aY.find(".shared-fees").text("0.00");aY.find('input[name="send-before-fees"]').unbind().bind("keyup change",function(){var a2=parseFloat($(this).val());var a1=0;if(a2>0){if(x>0){a1=parseFloat(a2+((a2/100)*x))}else{a1=parseFloat(a2);aY.find(".bonus-value").text(formatPrecision((Math.min(a2,precisionFromBTC(200))/100)*x))}}if(precisionToBTC(a2)<0.1||precisionToBTC(a2)>250){aY.find(".shared-fees").text("0.00");aY.find(".send").prop("disabled",true)}else{aY.find(".shared-fees").text(formatBTC(a1*symbol_btc.conversion));aY.find(".send").prop("disabled",false)}aY.find(".send-value").val(a1).trigger("keyup")})});$("#send-custom").on("show",function(a0,aZ){var aY=$(this);r(aY,aZ);aY.find(".send").unbind().click(function(){var a1=false;if(aY.find('textarea[name="public-note"]').val()){aY.find(".send-value").each(function(){if($(this).val()<0.0001){h.makeNotice("error","misc-error","You cannot attach a note to a transaction with an output size less than 0.0001 BTC");a1=true;return false}})}if(!a1){loadScript("wallet/signer",function(){startTxUI(aY,"custom",initNewTx())})}});aY.find('input[name="fees"]').unbind().bind("keyup change",function(a1){if(a1.keyCode=="9"){return}$(this).parent().find(".send-value-usd").val(convert($(this).val()*symbol_btc.conversion,symbol_local.conversion)).text(formatSymbol($(this).val()*symbol_btc.conversion,symbol_local))});aY.find(".reset").unbind().click(function(){r(aY,true);aY.find('select[name="from"]').trigger("change")})});$("#send-satoshi-dice").on("show",function(a0,aZ){var aY=this;loadScript("wallet/dicegames",function(){try{DICEGame.init($(aY))}catch(a1){h.makeNotice("error","misc-error","Unable To Load Dice Bets")}},function(a1){h.makeNotice("error","misc-error",a1)})});$("#shared-coin").on("show",function(a0,aZ){var aY=$(this);loadScript("wallet/sharedcoin",function(){try{r(aY);SharedCoin.init(aY)}catch(a1){console.log(a1);h.makeNotice("error","misc-error",a1)}},function(a1){h.makeNotice("error","misc-error",a1)})});$("#send-sms").on("show",function(a0,aZ){if(aZ){return}var aY=$(this);r(aY);$.ajax({type:"GET",url:resource+"wallet/country_codes.html",success:function(a1){aY.find('select[name="sms-country-code"]').html(a1)},error:function(){h.makeNotice("error","misc-error","Error Downloading SMS Country Codes")}});aY.find(".send").unbind().click(function(){loadScript("wallet/signer",function(){var a1=initNewTx();startTxUI(aY,"sms",a1)})})});$("#address-book").on("show",function(){var aZ=$("#address-book-tbl tbody");if(aH(g)>0){aZ.empty();for(var aY in g){var a0=$("<tr><td>"+g[aY]+'</td><td><div class="addr-book-entry">'+aY+'</div></td><td style="width:16px" class="hidden-phone"><img src="'+resource+'delete.png" class="act-delete" /></td></tr>');(function(a1){a0.find(".act-delete").click(function(){h.deleteAddressBook(a1)})})(aY);aZ.append(a0)}}});$('a[data-toggle="tab"]').unbind().on("show",function(aY){$(aY.target.hash).trigger("show")});$("#receive-coins-btn").click(function(){ah($("#receive-coins"))});$("#cash-into-coins").click(function(){$(this).attr("href",$(this).attr("href")+h.getPreferredAddress())});$(".show_adv").click(function(){$(".modal:visible").center()});$(".download-backup-btn").show();aF()}function p(){$(".resend-code").click(function(){h.setGUID(O,true)});$("#reset-two-factor-btn").click(function(){h.openWindow(root+"wallet/reset-two-factor"+(O?"?guid="+O:""))});$(".recover-wallet-btn").click(function(){h.openWindow(root+"wallet/forgot-password"+(O?"?guid="+O:""))});$(".download-backup-btn").toggle(ak!=null).click(function(){if(!ak){h.makeNotice("error","error","No Wallet Data to Download");return}try{var aZ=!!new Blob()}catch(a0){}if(aZ){loadScript("wallet/filesaver",function(){var a1=new Blob([ak],{type:"text/plain;charset=utf-8"});saveAs(a1,"wallet.aes.json")})}else{var aY=window.open(null,null,"width=700,height=800,toolbar=0");aY.document.write('<!DOCTYPE html><html><head></head><body><div style="word-wrap:break-word;" >'+ak+"</div></body></html>")}aV()});$(".auth-0,.auth-1,.auth-2,.auth-3,.auth-4,.auth-5").unbind().keypress(function(aY){if(aY.keyCode==13){aY.preventDefault();$("#restore-wallet-continue").click()}});$("#restore-wallet-continue").unbind().click(function(aZ){aZ.preventDefault();var aY=$.trim($("#restore-guid").val());if(aY.length==0){return}if(O!=aY){h.setGUID(aY,false)}else{a()}});$(".modal").on("show",function(){N();$(this).center()}).on("hidden",function(){var aZ=$(".modal:visible");var aY=$("#notices").remove();if(aZ.length>0){aZ.find(".modal-body").prepend(aY)}else{$("#main-notices-container").append(aY)}}).on("shown",function(){N();var aY=$(this);setTimeout(function(){if(aY.is(":visible")){aY.find(".modal-body").prepend($("#notices").remove())}},100);aY.center()})}function an(aZ){var a0=Crypto.SHA256(aZ+"?");switch(a0.slice(0,2)){case"00":var a1=Crypto.SHA256(aZ,{asBytes:true});return a1;break;case"01":var aY=Crypto.util.hexToBytes(a0.slice(2,4))[0];var a2=Math.round(Math.pow(2,(aY/4)));var a1=Crypto.PBKDF2(aZ,"Satoshi Nakamoto",32,{iterations:a2,asBytes:true});return a1;break;default:console.log("invalid key");break}}function aK(){var a0,aY="";if(window.getSelection){a0=window.getSelection();if(a0.rangeCount){var a1=a0.getRangeAt(0).cloneContents();var aZ=document.createElement("div");aZ.appendChild(a1);aY=aZ.innerText}}else{if(document.selection&&document.selection.type=="Text"){aY=document.selection.createRange().htmlText}}return aY}this.detectPrivateKeyFormat=function(aZ){if(/^5[123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz]{50}$/.test(aZ)){return"sipa"}if(/^[LK][123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz]{51}$/.test(aZ)){return"compsipa"}if(/^[123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz]{44}$/.test(aZ)||/^[123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz]{43}$/.test(aZ)){return"base58"}if(/^[A-Fa-f0-9]{64}$/.test(aZ)){return"hex"}if(/^[ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789=+\/]{44}$/.test(aZ)){return"base64"}if(/^6P[123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz]{56}$/.test(aZ)){return"bip38"}if(/^S[123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz]{21}$/.test(aZ)||/^S[123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz]{25}$/.test(aZ)||/^S[123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz]{29}$/.test(aZ)||/^S[123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz]{30}$/.test(aZ)){var aY=Crypto.SHA256(aZ+"?",{asBytes:true});if(aY[0]===0||aY[0]===1){return"mini"}}throw"Unknown Key Format "+aZ};this.privateKeyStringToKey=function(aZ,a1){var aY=null;if(a1=="base58"){aY=B58.decode(aZ)}else{if(a1=="base64"){aY=Crypto.util.base64ToBytes(aZ)}else{if(a1=="hex"){aY=Crypto.util.hexToBytes(aZ)}else{if(a1=="mini"){aY=an(aZ)}else{if(a1=="sipa"){var a0=B58.decode(aZ);a0.shift();aY=a0.slice(0,a0.length-4)}else{if(a1=="compsipa"){var a0=B58.decode(aZ);a0.shift();a0.pop();aY=a0.slice(0,a0.length-4)}else{throw"Unsupported Key Format"}}}}}}if(aY.length!=32){throw"Result not 32 bytes in length"}return new Bitcoin.ECKey(aY)};$(document).ready(function(){if(!$.isEmptyObject({})){h.makeNotice("error","error","Object.prototype has been extended by a browser extension. Please disable this extensions and reload the page.");return}$("input,button,select").attr("autocomplete","off");var a2=$(document.body);function a3(){if(O&&O.length==36){setTimeout(function(){h.setGUID(O,false)},10)}else{$("#signup-btn").show()}}O=a2.data("guid");d=a2.data("sharedkey");Z=a2.data("language");if(h.skip_init){return}var a4=1;function a1(){--a4;if(a4==-1){p()}}MyStore.get("payload",function(a7){if(!ak&&a7){ak=a7;aC=aj()}a1()});MyStore.get("server_time_offset",function(a7){aO=parseInt(a7);if(isNaN(aO)){aO=0}});if((!O||O.length==0)&&(isExtension||window.location.href.indexOf("/login")>0)){++a4;MyStore.get("guid",function(a7){O=a7;a3();a1()})}else{a3()}if(top.location!=self.location){top.location=self.location.href}a2.click(function(){if(W){clearTimeout(W);W=setTimeout(h.logout,h.getLogoutTime())}rng_seed_time()}).keypress(function(){if(W){clearTimeout(W);W=setTimeout(h.logout,h.getLogoutTime())}rng_seed_time()}).mousemove(function(a7){if(a7){rng_seed_int(a7.clientX*a7.clientY)}});a1();$(".auth-"+q).show();j=$("#restore-wallet");j.show();var a6=false;var aZ=17,a0=86,aY=67,a5=67;$(document).keydown(function(a8){try{if(a8.keyCode==aZ||a8.keyCode==a5){a6=true}if(a6&&a8.keyCode==aY){var a7=$.trim(aK());var a9=K[a7];if(a9!=null){if(a9.priv==null){$("#watch-only-copy-warning-modal").modal("show")}else{if(a9.tag==1){Q()}}}}}catch(a8){console.log(a8)}}).keyup(function(a7){if(a7.keyCode==aZ||a7.keyCode==a5){a6=false}}).ajaxStart(function(){aw("loading_start");$(".loading-indicator").fadeIn(200)}).ajaxStop(function(){aw("loading_stop");$(".loading-indicator").hide()})});function aX(){$("#receive-coins").find(".tab-pane.active").trigger("show");setupToggle()}};