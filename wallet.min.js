function precisionToSatoshiBN(a){return Bitcoin.Util.parseValue(a).divide(BigInteger.valueOf(Math.pow(10,sShift(symbol_btc)).toString()))}function precisionToBTC(a){return Bitcoin.Util.formatValue(precisionToSatoshiBN(a))}function precisionFromSatoshi(a){return Bitcoin.Util.formatValue(a.multiply(BigInteger.valueOf(Math.pow(10,sShift(symbol_btc)))))}function precisionFromBTC(a){return precisionFromSatoshi(Bitcoin.Util.parseValue(a))}function formatPrecision(a){return formatBTC(precisionToSatoshiBN(a).toString())}var MyWallet=new function(){var i=this;this.skip_init=false;var E="abcaa314-6f67-6705-b384-5d47fbe9d7cc";var an;var O;var k;var aN;var ap;var x;var e;var aD=0;var W=0;var ax=0;var M=0;var aX=0;var aL;var h={};var F=[];var G=false;var aB=0;var aw=0;var aG=1000;var K={};var aE;var ar;var I=true;var al=5000;var R=al;var c={};var r;var aS=0;var Y;var ad=[];var C;var P=60000;var B=false;var ae;var ab="en";var au=2;var S=0;var aP=0;var ac=false;var aI;var av=false;var X=false;var aA=false;var z=false;var Q=null;var T=null;var t={pbkdf2_iterations:al,fee_policy:0,html5_notifications:false,logout_time:600000,tx_display:0,always_keep_local_backup:false,transactions_per_page:30,additional_seeds:[]};this.setEncryptedWalletData=function(aZ){if(!aZ||aZ.length==0){an=null;aE=null;return}an=aZ;aE=am()};this.setRealAuthType=function(aZ){aS=aZ};this.addAdditionalSeeds=function(aZ){if(t.additional_seeds.length>=50){t.additional_seeds=t.additional_seeds.slice(t.additional_seeds.length-49,t.additional_seeds.length)}t.additional_seeds.push(aZ)};this.getAdditionalSeeds=function(){return t.additional_seeds};this.getLanguage=function(){return ab};this.setLanguage=function(aZ){MyStore.put("language",aZ);ab=aZ};this.addEventListener=function(aZ){ad.push(aZ)};this.sendEvent=function(a1,a0){for(var aZ in ad){ad[aZ](a1,a0)}};this.getLogoutTime=function(){return t.logout_time};this.getSecondPasswordPbkdf2Iterations=function(){return t.pbkdf2_iterations};this.getMainPasswordPbkdf2Iterations=function(){return R};this.getSharedKey=function(){return e};this.getSharedcoinEndpoint=function(){return aI};this.disableLogout=function(aZ){av=aZ};this.getFinalBalance=function(){return aD};this.getTotalSent=function(){return W};this.getTotalReceived=function(){return ax};this.setLogoutTime=function(aZ){t.logout_time=aZ;clearInterval(Y);Y=setTimeout(i.logout,i.getLogoutTime())};this.getDoubleEncryption=function(){return G};this.getEncryptedWalletData=function(){return an};this.getFeePolicy=function(){return t.fee_policy};this.setFeePolicy=function(aZ){t.fee_policy=parseInt(aZ)};this.setAlwaysKeepLocalBackup=function(aZ){t.always_keep_local_backup=aZ};this.getAlwaysKeepLocalBackup=function(){return t.always_keep_local_backup};this.setNTransactionsPerPage=function(aZ){t.transactions_per_page=aZ};this.getNTransactionsPerPage=function(){return t.transactions_per_page};this.getGuid=function(){return O};this.getHTML5Notifications=function(){return t.html5_notifications};this.setHTML5Notifications=function(aZ){t.html5_notifications=aZ};this.getNTransactions=function(){return M};this.getTransactions=function(){return F};this.addressExists=function(aZ){return K[aZ]!=null};this.getAddressTag=function(aZ){return K[aZ].tag};this.setAddressTag=function(a0,aZ){K[a0].tag=aZ};this.getAddressBook=function(){return h};this.getAddressLabel=function(aZ){if(K[aZ]){return K[aZ].label}else{return null}};this.setAddressLabel=function(aZ,a0){K[aZ].label=a0};this.setAddressBalance=function(aZ,a0){K[aZ].balance=a0};this.getAddressBookLabel=function(aZ){return h[aZ]};this.isWatchOnly=function(aZ){return !K[aZ]||K[aZ].priv==null};this.getAddressBalance=function(aZ){return K[aZ].balance};this.getRecommendIncludeFee=function(){return I};this.deleteAddress=function(aZ){delete K[aZ]};this.addAddressBookEntry=function(a0,aZ){h[a0]=aZ};this.getPrivateKey=function(aZ){return K[aZ].priv};this.setLabel=function(aZ,a0){K[aZ].label=a0;i.backupWalletDelayed();d()};this.securePost=function(aZ,a2,a9,a6){var a5=jQuery.extend({},a2);if(!a2.sharedKey){if(!e||e.length==0||e.length!=36){throw"Shared key is invalid"}var a0=new Date().getTime();var a4=parseInt((a0-aP)/10000);var a3=Crypto.SHA256(e.toLowerCase()+a4);var a1=0;var a8=a3.substring(a1,a1+=8)+"-"+a3.substring(a1,a1+=4)+"-"+a3.substring(a1,a1+=4)+"-"+a3.substring(a1,a1+=4)+"-"+a3.substring(a1,a1+=12);a5.sharedKey=a8;a5.sKTimestamp=a4;a5.sKDebugHexHash=a3;a5.sKDebugTimeOffset=aP;a5.sKDebugOriginalClientTime=a0;a5.sKDebugOriginalSharedKey=e}if(!a2.guid){a5.guid=O}a5.format=a2.format?a2.format:"plain";var a7="text";if(a2.format=="json"){a7="json"}$.ajax({dataType:a7,type:"POST",timeout:60000,url:root+aZ,data:a5,success:a9,error:a6})};this.isCorrectMainPassword=function(aZ){return aN==aZ};function ai(a0,a2){var aZ=Crypto.SHA256(a0,{asBytes:true});for(var a1=1;a1<a2;++a1){aZ=Crypto.SHA256(aZ,{asBytes:true})}return Crypto.util.bytesToHex(aZ)}this.setPbkdf2Iterations=function(aZ,a1){var a0=function(a2){console.log("Panic "+a2);window.location.reload()};i.getSecondPassword(function(){try{if(G){for(var a2 in K){var a4=K[a2];if(a4.priv){a4.priv=i.encrypt(i.decryptPK(a4.priv),e+ap,aZ);if(!a4.priv){throw"addr.priv is null"}}}t.pbkdf2_iterations=aZ;x=ai(e+ap,aZ)}S=2;R=aZ;i.backupWallet("update",function(){a1()},function(){a0(a3)})}catch(a3){a0(a3)}},function(a2){a0(a2)})};this.setDoubleEncryption=function(a1,aZ,a3){var a0=function(a4){console.log("Panic "+a4);window.location.reload()};try{if(G==a1){return}if(a1){i.getSecondPassword(function(){try{G=true;ap=aZ;for(var a4 in K){var a6=K[a4];if(a6.priv){a6.priv=j(B58.decode(a6.priv));if(!a6.priv){throw"addr.priv is null"}}}x=ai(e+ap,t.pbkdf2_iterations);ap=null;i.getSecondPassword(function(){try{i.checkAllKeys();i.backupWallet("update",function(){a3()},function(){a0(a7)})}catch(a7){a0(a7)}},function(a7){a0(a7)})}catch(a5){a0(a5)}},function(a4){a0(a4)})}else{i.getSecondPassword(function(){try{for(var a4 in K){var a6=K[a4];if(a6.priv){a6.priv=i.decryptPK(a6.priv);if(!a6.priv){throw"addr.priv is null"}}}G=false;ap=null;i.checkAllKeys();i.backupWallet("update",function(){a3()},function(){a0(a5)})}catch(a5){a0(a5)}},function(a4){a0(a4)})}}catch(a2){a0(a2)}};this.unArchiveAddr=function(aZ){var aZ=K[aZ];if(aZ.tag==2){aZ.tag=null;d();i.backupWalletDelayed("update",function(){i.get_history()})}else{i.makeNotice("error","add-error","Cannot Unarchive This Address")}};this.archiveAddr=function(aZ){if(i.getActiveAddresses().length<=1){i.makeNotice("error","add-error","You must leave at least one active address");return}var aZ=K[aZ];if(aZ.tag==null||aZ.tag==0){aZ.tag=2;d();i.backupWalletDelayed("update",function(){i.get_history()})}else{i.makeNotice("error","add-error","Cannot Archive This Address")}};this.addWatchOnlyAddress=function(aZ){return aV(aZ)};this.addPrivateKey=function(aZ,a1){if(ao()){return false}if(aZ==null){throw"Cannot add null key."}if(a1==null){a1={}}var a4=a1.compressed?aZ.getBitcoinAddressCompressed().toString():aZ.getBitcoinAddress().toString();var a3=j(aZ.priv);if(a3==null){throw"Error Encoding key"}var a0=new Bitcoin.ECKey(i.decodePK(a3));if(a4!=a0.getBitcoinAddress().toString()&&a4!=a0.getBitcoinAddressCompressed().toString()){throw"Decoded Key address does not match generated address"}if(aV(a4,a3)){K[a4].tag=1;K[a4].created_time=a1.created_time?a1.created_time:new Date().getTime();K[a4].created_device_name=a1.app_name?a1.app_name:APP_NAME;K[a4].created_device_version=a1.app_version?a1.app_version:APP_VERSION;if(K[a4].priv!=a3){throw"Address priv does not match encoded"}try{ws.send('{"op":"addr_sub", "addr":"'+a4+'"}')}catch(a2){}}else{throw"Unable to add generated private key."}return a4};this._seed=function(a0){var a2=""+new Date().getTime();if(aN&&aN.length>0){a2+=aN}if(a0&&a0.length>0){a2+=a0}if(ae&&ae.length>0){a2+=ae}var a4=$("body").data("extra-seed");if(a4&&a4.length>0){a2+=a4}var a3=[];var a1=0;while(a3.length<rng_psize){a3=a3.concat(Crypto.SHA256(a2+a1,{asBytes:true}));++a1}var aZ=Crypto.util.bytesToWords(a3);seed_large_int32_array(aZ)};this.generateNewKey=function(a0){i._seed(a0);var aZ=new Bitcoin.ECKey(false);var a1=i.addPrivateKey(aZ,{compressed:true});if(a1){return{key:aZ,addr:a1}}};this.setLoadingText=function(aZ){$(".loading-text").text(aZ)};function N(){try{$(".popover").remove()}catch(aZ){}}$(window).resize(function(){$(".modal:visible").center();N()});function aU(a0,aZ){a0.click(function(){A(aZ.txIndex,aZ.result)});a0.find(".show-note").unbind("mouseover").mouseover(function(){var a1=aZ.note?aZ.note:c[aZ.hash];aO(this,a1,aZ.hash)});a0.find(".add-note").unbind("mouseover").mouseover(function(){n(this,aZ.hash)});return a0}function u(a0,a6){var aZ=0;for(var a2=0;a2<a0.inputs.length;++a2){var a1=a0.inputs[a2].prev_out;if(!a1||!a1.addr){continue}var a5=K[a1.addr];if(a5){var a4=parseInt(a1.value);aZ-=a4;if(a6){W+=a4;a5.balance-=a4}}}for(var a3=0;a3<a0.out.length;++a3){var a1=a0.out[a3];if(!a1||!a1.addr){continue}var a5=K[a1.addr];if(a5){var a4=parseInt(a1.value);aZ+=a4;if(a6){ax+=a4;a5.balance+=a4}}}return aZ}function am(){return Crypto.util.bytesToHex(Crypto.SHA256(an,{asBytes:true}))}function y(aZ){var a0=null;aZ.onmessage=function(a7){try{var a4=$.parseJSON(a7.data);if(a4.op=="on_change"){var a8=am();var a6=a4.checksum;console.log("On change old "+a8+" ==  new "+a6);if(a0!=a6&&a8!=a6){a0=a6;L()}}else{if(a4.op=="utx"){var a5=TransactionFromJSON(a4.x);for(var ba in F){if(F[ba].txIndex==a5.txIndex){return}}var bc=u(a5,true);if(i.getHTML5Notifications()){i.showNotification({title:bc>0?"Payment Received":"Payment Sent",body:"Transaction Value "+formatBTC(bc),iconUrl:resource+"cube48.png"})}a5.result=bc;aD+=bc;M++;a5.setConfirmations(0);playSound("beep");if(aw==0&&aB==0){F.unshift(a5);var a9=false;if(F.length>i.getNTransactionsPerPage()){F.pop();a9=true}}i.sendEvent("on_tx");var a2=Z();if("my-transactions"==a2){if(aw==0&&aB==0){$("#no-transactions").hide();if(t.tx_display==0){var a1=$("#transactions-compact").show();aU(D(a5,K,h),a5).prependTo(a1.find("tbody")).find("div").hide().slideDown("slow");if(a9){a1.find("tbody tr:last-child").remove()}}else{var a1=$("#transactions-detailed").show();a1.prepend(a5.getHTML(K,h));if(a9){a1.find("div:last-child").remove()}setupSymbolToggle()}}}else{d()}}else{if(a4.op=="block"){for(var a3=0;a3<a4.x.txIndexes.length;++a3){for(var bb=0;bb<F.length;++bb){if(F[bb].txIndex==a4.x.txIndexes[a3]){if(F[bb].blockHeight==null||F[bb].blockHeight==0){F[bb].blockHeight=a4.x.height;break}}}}aC(BlockFromJSON(a4.x));i.sendEvent("on_block");aa()}}}}catch(a7){console.log(a7);console.log(a7.data)}};aZ.onopen=function(){i.sendEvent("ws_on_open");ay("ok");var a4='{"op":"blocks_sub"}';if(O!=null){a4+='{"op":"wallet_sub","guid":"'+O+'"}'}try{var a2=i.getActiveAddresses();for(var a1 in a2){a4+='{"op":"addr_sub", "addr":"'+a2[a1]+'"}'}}catch(a3){alert(a3)}aZ.send(a4)};aZ.onclose=function(){i.sendEvent("ws_on_close");ay("error")}}var aT="ok";function ay(a0){var aZ=$("#logout");if(a0=="loading_start"){aZ.attr("src",resource+"logout-orange.png");return}else{if(a0!="loading_stop"){aT=a0}}if(aT=="ok"){aZ.attr("src",resource+"logout.png")}else{if(aT=="error"){aZ.attr("src",resource+"logout-red.png")}}}this.showNotification=function(aZ,a0){try{var a2;if(window.webkitNotifications&&webkitNotifications.checkPermission()==0){a2=webkitNotifications.createNotification(aZ.iconUrl,aZ.title,aZ.body);a2.show()}else{if(window.Notification&&window.Notification.permissionLevel()=="granted"){a2=new window.Notification(aZ.title,aZ).show()}}if(a2){setTimeout(function(){a2.cancel()},a0?a0:5000)}}catch(a1){}};this.makeNotice=function(a0,a3,a2,a1){if(a2==null||a2.length==0){return}console.log(a2);var aZ=$('<div class="alert alert-block alert-'+a0+'"></div>');aZ.text(""+a2);if($("#"+a3).length>0){aZ.attr("id",a3);return}$("#notices").append(aZ).hide().fadeIn(200);(function(){var a4=aZ;setTimeout(function(){a4.fadeOut(250,function(){$(this).remove()})},a1?a1:5000)})()};this.pkBytesToSipa=function(aZ,a3){var a0=new Bitcoin.ECKey(aZ);while(aZ.length<32){aZ.unshift(0)}aZ.unshift(128);if(a0.getBitcoinAddress().toString()==a3){}else{if(a0.getBitcoinAddressCompressed().toString()==a3){aZ.push(1)}else{throw"Private Key does not match bitcoin address"+a3}}var a1=Crypto.SHA256(Crypto.SHA256(aZ,{asBytes:true}),{asBytes:true});aZ=aZ.concat(a1.slice(0,4));var a2=B58.encode(aZ);return a2};function aK(aZ){return aZ}function az(aZ){return i.decryptPK(aZ)}function ag(aZ){var a0=i.decodePK(aZ);return Crypto.util.bytesToBase64(a0)}function l(aZ){var a0=i.decodePK(aZ);return Crypto.util.bytesToHex(a0)}this.base58ToSipa=function(aZ,a0){return i.pkBytesToSipa(i.decodePK(aZ),a0)};this.makeWalletJSON=function(aZ){return i.makeCustomWalletJSON(aZ,O,e)};this.makeCustomWalletJSON=function(a4,a0,a6){var a3=aK;if(a4=="base64"){a3=ag}else{if(a4=="hex"){a3=l}else{if(a4=="sipa"){a3=i.base58ToSipa}else{if(a4=="base58"){a3=az}}}}var aZ='{\n	"guid" : "'+a0+'",\n	"sharedKey" : "'+a6+'",\n';if(G&&x!=null&&a3==aK){aZ+='	"double_encryption" : '+G+',\n	"dpasswordhash" : "'+x+'",\n'}if(t){aZ+='	"options" : '+JSON.stringify(t)+",\n"}aZ+='	"keys" : [\n';for(var a2 in K){var a5=$.extend({},K[a2]);if(a5.tag==1){delete a5.tag}if(a5.priv!=null){a5.priv=a3(a5.priv,a5.addr)}for(var a1 in a5){if(a5[a1]===null||a5[a1]===undefined){delete a5[a1]}}delete a5.balance;aZ+=JSON.stringify(a5)+",\n";atLeastOne=true}if(atLeastOne){aZ=aZ.substring(0,aZ.length-2)}aZ+="\n	]";if(aJ(h)>0){aZ+=',\n	"address_book" : [\n';for(var a2 in h){aZ+='	{"addr" : "'+a2+'",\n';aZ+='	 "label" : "'+h[a2]+'"},\n'}aZ=aZ.substring(0,aZ.length-2);aZ+="\n	]"}if(Q){aZ+=',\n "hd_wallets" : '+JSON.stringify(Q)}if(aJ(c)>0){aZ+=',\n	"tx_notes" : '+JSON.stringify(c)}aZ+="\n}";return aZ};this.get_history=function(a0,aZ){BlockchainAPI.get_history(function(a1){J(a1,false);if(F.length==0&&aB>0){i.setPage(0)}else{d()}if(a0){a0()}},function(){if(aZ){aZ()}},aw,aB*i.getNTransactionsPerPage(),i.getNTransactionsPerPage())};this.deleteAddressBook=function(aZ){delete h[aZ];i.backupWalletDelayed();$("#send-coins").find(".tab-pane").trigger("show",true)};function v(aZ){$("#send-coins").find(".tab-pane.active").trigger("show",aZ);if(aZ){BlockchainAPI.get_ticker();$(".send").prop("disabled",false)}}function m(aZ,a0,a4){var a3=aZ.val();aZ.empty();for(var a2 in K){var a5=K[a2];if(!a5||a5.tag==2){continue}var a1=a5.label;if(!a1){a1=a5.addr.substring(0,15)+"..."}if(a0||a5.balance>0){aZ.prepend('<option value="'+a5.addr+'">'+a1+" - "+formatBTC(a5.balance)+"</option>")}}aZ.prepend('<option value="any" selected>Any Address</option>');if(!a4&&a3){aZ.val(a3)}}function s(a2,a3){m(a2.find('select[name="from"]'),false,a3);m(a2.find('select[name="change"]'),true,a3);a2.find('select[name="change"]').prepend('<option value="new">New Address</option>');a2.find(".local-symbol").text(symbol_local.symbol);a2.find(".btc-symbol").text(symbol_btc.symbol);if(a3){a2.find("input").val("");a2.find(".send-value-usd").text(formatSymbol(0,symbol_local)).val("");a2.find(".amount-needed").text(0)}var a1=a2.find(".recipient-container");if(a3){var a5=a1.find(".recipient:first-child").clone();a1.empty().append(a5)}function a0(){var a6=BigInteger.ZERO;a2.find(".send-value").each(function(){a6=a6.add(precisionToSatoshiBN($(this).val()))});return a6}function a4(a6){a6.find('input[name="send-to-address"]').typeahead({source:aF()}).next().unbind().click(function(){var a7=$(this).prev();i.scanQRCode(function(a8){console.log(a8);try{new Bitcoin.Address(a8);a7.val(a8)}catch(a9){i.handleURI(a8,a6)}},function(a8){i.makeNotice("error","misc-error",a8)})});a6.find(".send-value").unbind().bind("keyup change",function(a7){if(a7.keyCode=="9"){return}a2.find(".amount-needed").text(formatBTC(a0().toString()));a6.find(".send-value-usd").val(convert($(this).val()*symbol_btc.conversion,symbol_local.conversion)).text(formatSymbol($(this).val()*symbol_btc.conversion,symbol_local))});a6.find(".send-value-usd").text(formatSymbol(0,symbol_local)).unbind().bind("keyup change",function(a7){if(a7.keyCode=="9"){return}a6.find(".send-value").val(formatSatoshi(parseFloat($(this).val())*symbol_local.conversion,sShift(symbol_btc),true))})}a1.find(".recipient").each(function(){a4($(this))});a2.find(".remove-recipient").unbind().click(function(){var a6=a1.find(".recipient").length;if(a6>1){if(a6==2){$(this).hide(200)}a1.find(".recipient:last-child").remove()}});a2.find(".add-recipient").unbind().click(function(){var a6=a1.find(".recipient:first-child").clone();a6.find('input[type="text"]').val("");a6.appendTo(a1);a4(a6);a2.find(".remove-recipient").show(200)});var aZ=a2.find('select[name="from"]');if(aZ.length==0){a2.find(".amount-available").text(formatBTC(aD))}else{aZ.unbind().change(function(){var a8=0;var a6=$(this).val();for(var a7 in a6){if(a6[a7]=="any"){$(this).val("any");a8=aD;break}else{var a9=K[a6[a7]];if(a9&&a9.balance){a8+=a9.balance}}}a2.find(".amount-available").text(formatBTC(a8))}).trigger("change")}}this.getAllAddresses=function(){var a0=[];for(var aZ in K){a0.push(aZ)}return a0};this.getPreferredAddress=function(){var a0=null;for(var aZ in K){var a1=K[aZ];if(a0==null){a0=a1}if(a1.priv!=null){if(a0==null){a0=a1}if(a1.tag==null||a1.tag==0){a0=a1;break}}}return a0.addr};function aW(){var aZ=$("#restore-backup-modal");aZ.modal({keyboard:true,backdrop:"static",show:true});aZ.find(".btn.btn-secondary").unbind().click(function(){aZ.modal("hide")})}this.scanQRCode=function(a1,aZ){var a0=$("#qr-code-reader-modal");a0.modal({keyboard:false,backdrop:"static",show:true});loadScript("wallet/qr.code.reader",function(){QRCodeReader.init(a0,function(a2){QRCodeReader.stop();a0.modal("hide");a1(a2)},function(a2){a0.modal("hide");aZ(a2)})},aZ);a0.find(".btn.btn-secondary").unbind().click(function(){QRCodeReader.stop();a0.modal("hide");aZ()})};this.getActiveAddresses=function(){var a1=[];for(var aZ in K){var a0=K[aZ];if(a0.tag!=2){a1.push(a0.addr)}}return a1};this.getArchivedAddresses=function(){var a1=[];for(var aZ in K){var a0=K[aZ];if(a0.tag==2){a1.push(a0.addr)}}return a1};this.getLatestBlock=function(){return aL};function aC(a2){if(a2!=null){aL=a2;for(var a0 in F){var aZ=F[a0];if(aZ.blockHeight!=null&&aZ.blockHeight>0){var a1=aL.height-aZ.blockHeight+1;if(a1<=100){aZ.setConfirmations(aL.height-aZ.blockHeight+1)}else{aZ.setConfirmations(null)}}else{aZ.setConfirmations(0)}}i.sendEvent("did_set_latest_block")}}function A(a0,aZ){loadScript("wallet/frame-modal",function(){showFrameModal({title:"Transaction Summary",description:"",src:root+"tx-summary/"+a0+"?result="+aZ+"&symbol_btc="+symbol_btc.code+"&symbol_local="+symbol_local.code})})}this.deleteNote=function(aZ){delete c[aZ];d();i.backupWalletDelayed()};function aj(aZ){return/^[\w\-,._  @\+]+$/.test(aZ)}function n(aZ,a0){(function(a2,a4){a2=$(a2);try{a2.data("popover").tip().remove();a2.removeData("popover")}catch(a5){}console.log("addNotePopover()");a2.popover({title:'Add Note <span style="float:right"><i class="icon-remove-sign"></i></span>',trigger:"manual",content:'<textarea style="width:97%;height:50px;margin-top:2px" placeholder="Enter the note here..."></textarea><div style="text-align:right"><button class="btn btn-small">Save</button></div>'});a2.popover("show");a2.unbind("mouseleave").mouseleave(function(){if(!a2.__timeout){a2.__timeout=setTimeout(function(){a2.popover("hide")},250)}});function a1(){if(a2.__timeout){clearTimeout(a2.__timeout);a2.__timeout=null}}var a3=a2.data("popover").tip().mouseenter(a1);a3.find("textarea").focus(a1);a3.mouseleave(function(){a2.__timeout=setTimeout(function(){a2.popover("hide")},250)});a3.find("i").unbind().click(function(){a2.popover("hide")});a3.find("button").click(function(){var a6=$.trim(a3.find("textarea").val());if(!aj(a6)){i.makeNotice("error","misc-error","Note must be contain letters and numbers only");return}if(a6.length>0){c[a4]=a6;i.backupWalletDelayed()}d()})})(aZ,a0)}function aO(aZ,a0,a1){(function(a2,a3,a5){a2=$(a2);try{a2.data("popover").tip().remove();a2.removeData("popover")}catch(a6){}var a7="Note";if(c[a5]){a7+=' <span style="float:right"><img src="'+resource+'delete.png" /></span>'}a2.popover({title:a7,trigger:"manual",content:a3});a2.popover("show");a2.unbind("mouseleave").mouseleave(function(){if(!a2.__timeout){a2.__timeout=setTimeout(function(){a2.popover("hide")},250)}});var a4=a2.data("popover").tip().mouseenter(function(){if(a2.__timeout){clearTimeout(a2.__timeout);a2.__timeout=null}});a4.find("img").unbind().click(function(){i.deleteNote(a5)});a4.mouseleave(function(){a2.__timeout=setTimeout(function(){a2.popover("hide")},250)})})(aZ,a0,a1)}function D(a4,a9,a5){var bb=a4.result;var a8=$('<tr class="pointer"></tr>');a8.attr("id","tx-"+a4.txIndex);var a0=$('<td class="hidden-phone" style="width:365px"></td>');a8.append(a0);var aZ=$('<div style="margin-left:0px;margin-bottom:9px;" class="short-addr"></div>');a0.append(aZ);var a2=true;if(bb>=0){if(a4.inputs.length>5){a2=false;aZ.append('<span class="label">Many Inputs</span>')}else{for(var a3=0;a3<a4.inputs.length;++a3){var a1=a4.inputs[a3].prev_out;if(!a1){a2=false;if(a4.inputs.length==1){aZ.append('<span class="label">Newly Generated Coins</span>');break}else{aZ.append('<span class="label">Missing Outpoint</span>')}}else{if(!a1.addr){a2=false;aZ.append('<span class="label">Unknown Address</span>')}else{var a6=a9[a1.addr];if(a6){continue}a2=false;aZ.append(formatOutput(a1,a9,a5))}}}}}else{if(bb<0){if(a4.out.length>5){a2=false;aZ.append('<span class="label">Many Outputs</span>')}else{for(var a3=0;a3<a4.out.length;++a3){var a1=a4.out[a3];if(!a1.addr){a2=false;aZ.append('<span class="label">Unknown Address</span>')}else{var a6=a9[a1.addr];if(a6&&a1.type==0){continue}a2=false;aZ.append(formatOutput(a1,a9,a5))}}}}}if(a2){aZ.append('<span class="label">Moved Between Wallet</info>')}var a0=$("<td></td>");a8.append(a0);var aZ=$("<div></div>");a0.append(aZ);var a7=a4.note?a4.note:c[a4.hash];if(a7){aZ.append('<img src="'+resource+'note.png" class="show-note"> ')}else{aZ.append('<img src="'+resource+'note_grey.png" class="add-note"> ')}if(a4.time>0){aZ.append(dateToString(new Date(a4.time*1000))+" ")}if(a4.confirmations==0||a4.confirmations>0){var ba=$('<span class="label hidden-phone"></span>');if(a4.confirmations==0){ba.addClass("label-important");ba.text("Unconfirmed Transaction!")}else{if(a4.confirmations>0){ba.addClass("label-info");ba.text(a4.confirmations+" Confirmations")}}aZ.append(ba)}var a0=$("<td>"+formatMoney(bb,true)+"</td>");a8.append(a0);if(bb>0){a0.css({color:"green"})}else{if(bb<0){a0.css({color:"red"})}}var a0=$('<td class="hidden-phone"></td>');a8.append(a0);if(a4.balance!=null){a0.append("<div>"+formatMoney(a4.balance)+"</div>")}return a8}function Z(){N();if(aD==null){$("#balance").html("Loading...")}else{$("#balance").html(formatSymbol(aD,symbol,true));$("#balance2").html(formatSymbol(aD,(symbol===symbol_local)?symbol_btc:symbol_local),true)}return k.attr("id")}function d(aZ){var a0=Z();if("send-coins"==a0){v(aZ)}else{if("home-intro"==a0){f(aZ)}else{if("receive-coins"==a0){aY(aZ)}else{if("my-transactions"==a0){aa(aZ)}}}}}function f(aZ){$("#summary-n-tx").html(M);$("#summary-received").html(formatMoney(ax,true));$("#summary-sent").html(formatMoney(W,true));$("#summary-balance").html(formatMoney(aD,symbol));$(".paper-wallet-btn").unbind().click(function(){loadScript("wallet/paper-wallet",function(){PaperWallet.showModal()})});var a1=i.getPreferredAddress();if(a1==null){return}if(i.isWatchOnly(a1)){$(".no-watch-only").hide()}else{$(".no-watch-only").show();var a0=$("#my-primary-address");if(a0.text()!=a1){a0.text(a1);loadScript("wallet/jquery.qrcode",function(){$("#my-primary-addres-qr-code").empty().qrcode({width:125,height:125,text:a1})})}}$("#tweet-for-btc").unbind().click(function(){i.openWindow("https://twitter.com/share?url=https://blockchain.info/wallet&hashtags=tweet4btc,bitcoin,"+a1+"&text=Sign Up For a Free Bitcoin Wallet @ Blockchain.info")})}function V(){var aZ=$("#export-warning").show();var a0=$("#import-export-content").hide();$("#show-import-export").unbind().click(function(){i.getMainPassword(function(){aZ.hide();loadScript("wallet/import-export",function(){ImportExport.init(a0,function(){a0.show()},function(){ak($("#home-intro"))})},function(a1){i.makeNotice("error","misc-error",a1);ak($("#home-intro"))})},function(){ak($("#home-intro"))})})}function aa(){var a0=null;var a2=0;if(a0!=null){clearInterval(a0);a0=null}var aZ;if(t.tx_display==0){$("#transactions-detailed").hide();aZ=$("#transactions-compact").show().find("tbody").empty()}else{$("#transactions-compact").hide();aZ=$("#transactions-detailed").empty().show()}if(F.length==0){$("#transactions-detailed, #transactions-compact").hide();$("#no-transactions").show();return}else{$("#no-transactions").hide()}var a1=function(){for(var a6=a2;a6<F.length&&a6<(a2+i.getNTransactionsPerPage());++a6){var a5=F[a6];if(t.tx_display==0){aZ.append(aU(D(a5,K,h),a5))}else{aZ.append(a5.getHTML(K,h))}}a2+=i.getNTransactionsPerPage();if(a2<F.length){a0=setTimeout(a1,15)}else{setupSymbolToggle();N();var a4=$(".pagination ul").empty();if(aB==0&&F.length<i.getNTransactionsPerPage()){a4.hide();return}else{a4.show()}var a3=Math.ceil(aX/i.getNTransactionsPerPage());var a8=" disabled";if(aB>0){a8=""}var a9=10;var a7=Math.max(0,Math.min(aB-(a9/2),a3-a9));a4.append($('<li class="prev'+a8+'"><a>&larr; Previous</a></li>').click(function(){i.setPage(aB-1)}));if(a7>0){a4.append($("<li><a>≤</a></li>").click(function(){i.setPage(0)}))}for(var a6=a7;a6<a3&&a6<a7+a9;++a6){(function(ba){var bb="";if(aB==ba){bb=' class="active"'}a4.append($("<li"+bb+'><a class="hidden-phone">'+(ba+1)+"</a></li>").click(function(){i.setPage(ba)}))})(a6)}if(a7+a9<a3){a4.append($("<li><a>≥</a></li>").click(function(){i.setPage(a3-1)}))}var a8=" disabled";if(aB<a3-1){a8=""}a4.append($('<li class="next'+a8+'"><a>Next &rarr;</a></li>').click(function(){i.setPage(aB+1)}))}};a1()}this.setPage=function(aZ){aB=aZ;scroll(0,0);i.get_history()};function w(){loadScript("wallet/frame-modal",function(){showFrameModal({title:"Export History",description:"",src:root+"export-history?active="+i.getActiveAddresses().join("|")+"&archived="+i.getArchivedAddresses().join("|")})})}this.loadAdverts=function(aZ){$.ajax({type:"GET",dataType:"json",url:"https://blockchain.info/adverts_feed",timeout:60000,success:function(a0){if(a0&&a0.partners){U(a0.partners)}},error:function(a0){}})};function U(a7){var a0=$("#partner-home-buttons");if(a7.home_buttons&&a7.home_buttons.length>0){a0.show();a0.find("p").empty();for(var bh in a7.home_buttons){var aZ=a7.home_buttons[bh];var bf=$('<a class="btn" style="margin-left:3px;margin-bottom:3px;" href="" target="blank"><img src=""></a>');if(aZ.button_class){bf.addClass(aZ.button_class)}bf.attr("href",aZ.link);bf.text(" "+aZ.title);if(aZ.image){bf.prepend("<img>").find("img").attr("src",aZ.image.replace("{0}",resource))}a0.find("p").append(bf)}}else{a0.hide()}var a4=$("#send-coins-nav");a4.find("li.send_partner").remove();var bg=$("#partners-send-divider");if(a7.send_buttons&&a7.send_buttons.length>0){bg.show().next().show();for(var bh in a7.send_buttons){var aZ=a7.send_buttons[bh];var a1=$('<li class="send_partner"><a target="blank"></a></li>');var bf=a1.find("a");bf.attr("href",aZ.link);bf.text(" "+aZ.title);if(aZ.image){bf.prepend('<i class="icon-dice" style="background-position:0px;width:16px;height:16px;"></i>').find("i").css("background-image","url("+aZ.image.replace("{0}",resource)+")")}bg.next().after(a1)}}else{bg.hide().next().hide()}var be=$("#home-deposit-container").empty();if(a7.deposit_buttons.length>0){be.show();var a9=$('<ul id="myTab" class="nav nav-tabs">');var a5={US:[],GB:[],EU:[]};var a2=[];for(var bh in a7.deposit_buttons){var aZ=a7.deposit_buttons[bh];if(aZ.country_code==null||aZ.country_code.length==0){a2.push(aZ);continue}var a3=a5[aZ.country_code];if(a3==null){a3=[];a5[aZ.country_code]=a3}a3.push(aZ)}var a6=0;for(var ba in a5){var a3=a5[ba];if(a3.length==0&&a2.length==0){continue}var a8=$("<li><a></a></li>");if(a6==0){a8.addClass("active")}var bf=a8.find("a");bf.attr("href","#deposit-"+ba.toLowerCase());bf.text(" "+ba.toUpperCase());bf.prepend("<img>").find("img").attr("src",resource+"flags/"+ba.toLowerCase()+".png");++a6;a9.append(a8)}a9.find("a").click(function(){$(this).tab("show")});be.append(a9);var bc=$('<div class="tab-content page-header">');var a6=0;for(var ba in a5){var a3=a5[ba];var bb=$('<div class="tab-pane" style="text-align:right">');if(a6==0){bb.addClass("active")}bb.attr("id","deposit-"+ba.toLowerCase());a3=a3.concat(a2);if(a3.length==0){continue}for(var bd in a3){var aZ=a3[bd];var bf=$('<a style="margin-left:3px;" class="btn" target="blank"></a>');if(aZ.button_class){bf.addClass(aZ.button_class)}bf.attr("href",aZ.link);bf.text(" "+aZ.title);if(aZ.image){bf.prepend("<img>").find("img").attr("src",aZ.image.replace("{0}",resource))}bb.append(bf)}++a6;bc.append(bb)}be.append(bc)}else{be.hide()}}function J(a2,a1){if(!a1){I=a2.recommend_include_fee;if(a2.info){if(a2.info.symbol_local){setLocalSymbol(a2.info.symbol_local)}if(a2.info.symbol_btc){setBTCSymbol(a2.info.symbol_btc)}if(a2.info.notice){i.makeNotice("error","misc-error",a2.info.notice)}}}aI=a2.sharedcoin_endpoint;F.length=0;if(a2.wallet==null){ax=0;W=0;aD=0;M=0;aX=0;return}ax=a2.wallet.total_received;W=a2.wallet.total_sent;aD=a2.wallet.final_balance;M=a2.wallet.n_tx;aX=a2.wallet.n_tx_filtered;for(var a0=0;a0<a2.addresses.length;++a0){if(K[a2.addresses[a0].address]){K[a2.addresses[a0].address].balance=a2.addresses[a0].final_balance}}for(var a0=0;a0<a2.txs.length;++a0){var aZ=TransactionFromJSON(a2.txs[a0]);aZ.result=u(aZ,false);F.push(aZ)}if(!a1){if(a2.info.latest_block){aC(a2.info.latest_block)}}i.sendEvent("did_multiaddr")}this.handleURI=function(a0,aZ){loadScript("wallet/jsuri-1.1.1",function(){try{var a2=new Uri(a0);var a1=new Bitcoin.Address(a2.host());aZ.find('input[name="send-to-address"]').val(a1.toString());var a3=parseFloat(a2.getQueryParamValue("amount"));if(a3>0&&!isNaN(a3)){aZ.find(".send-value").val(a3)}}catch(a4){console.log(a4);i.makeNotice("error","error","Invalid Bitcoin Address or URI")}},function(){i.makeNotice("error","error","Invalid Bitcoin Address or URI")})};function aQ(){L();Y=setTimeout(i.logout,i.getLogoutTime());i.sendEvent("did_decrypt");i.get_history(null,function(){MyStore.get("multiaddr",function(a2){if(a2!=null){J($.parseJSON(a2),true);d()}})});$("#initial_error,#initial_success").remove();var a1=decodeURIComponent(window.location.hash.replace("#",""));if(a1.indexOf("bitcoin:")==0){var aZ=$("#send-coins");ak(aZ);var a0=aZ.find(".tab-pane.active").find(".recipient").first();i.handleURI(a1,a0)}else{ak($("#home-intro"))}window.location.hash=""}function g(aZ,a2,a0){var a1={method:"wallet.aes.json",format:"json",checksum:aZ};i.securePost("wallet",a1,function(a3){if(!a3.payload||a3.payload=="Not modified"){if(a2){a2()}}else{if(a0){a0()}}},function(a3){if(a0){a0()}})}function L(a1,aZ){var a0={method:"wallet.aes.json",format:"json"};if(aE&&aE.length>0){a0.checksum=aE}i.setLoadingText("Checking For Wallet Updates");i.securePost("wallet",a0,function(a5){if(a5.storage_token){if(T==null||T.indexOf(a5.storage_token)==-1){MyStore.put("storage_token",(T?T+"|":"")+a5.storage_token)}}if(!a5.payload||a5.payload=="Not modified"){if(a1){a1()}return}var a3;try{a3=$.parseJSON(a5.payload)}catch(a4){}if(a3&&a3.version&&a3.version>=3){var a2=i.getGuid();if(a2===undefined||a2===null){a2=""}window.location=root+"wallet-beta/#/login/"+a2;return}i.setEncryptedWalletData(a5.payload);af(function(){i.get_history();d();if(a1){a1()}},function(){if(aZ){aZ()}})},function(a2){if(aZ){aZ()}})}function af(a0,aZ){if(an==null||an.length==0){aZ("No Wallet Data To Decrypt");return}i.decryptWallet(an,aN,function(a8,a6){try{e=a8.sharedKey;if(!e||e.length==0||e.length!=36){throw"Shared Key is invalid"}if(a6){S=a6.version;R=a6.pbkdf2_iterations}if(a8.double_encryption&&a8.dpasswordhash){G=a8.double_encryption;x=a8.dpasswordhash}if(a8.options){$.extend(t,a8.options);if(t.additional_seeds.length>=50){t.additional_seeds=t.additional_seeds.slice(t.additional_seeds.length-50,t.additional_seeds.length)}}K={};for(var a2=0;a2<a8.keys.length;++a2){var a1=a8.keys[a2];if(!a1.addr||!aj(a1.addr)){i.makeNotice("error","null-error","Your wallet contains an invalid address. This is a sign of possible corruption, please double check all your BTC is accounted for. Backup your wallet to remove this error.",15000);continue}if(a1.tag==1||!aj(a1.tag)){a1.tag=null}if(a1.label&&!aj(a1.label)){a1.label=null}K[a1.addr]=a1}h={};if(a8.address_book){for(var a2=0;a2<a8.address_book.length;++a2){var a4=a8.address_book[a2];if(a4.label&&aj(a4.label)&&aj(a4.addr)){i.addAddressBookEntry(a4.addr,a4.label)}}}if(a8.hd_wallets){Q=a8.hd_wallets}if(a8.tx_notes){for(var a5 in a8.tx_notes){var a3=a8.tx_notes[a5];if(a3&&aj(a3)){c[a5]=a3}}}if(aE==null||aE.length==0){aE=am()}a();a0()}catch(a7){aZ(a7)}},aZ)}this.getPassword=function(a4,a5,a2){if(!a4.is(":visible")){a4.trigger("hidden");a4.unbind()}a4.modal({keyboard:false,backdrop:"static",show:true});a4.center();var a3=a4.find('input[name="password"]');var a7=a3,aZ=false,a6=false;a4.find(".vkeyboard li").unbind().click(function(){var ba=$(this),a9=ba.html();if(ba.hasClass("left-shift")||ba.hasClass("right-shift")){$(".letter").toggleClass("uppercase");$(".symbol span").toggle();aZ=(aZ===true)?false:true;a6=false;return false}if(ba.hasClass("capslock")){$(".letter").toggleClass("uppercase");a6=true;return false}if(ba.hasClass("delete")){var a8=a7.val();a7.val(a8.substr(0,a8.length-1));return false}if(ba.hasClass("symbol")){a9=$("span:visible",ba).html()}if(ba.hasClass("space")){a9=" "}if(ba.hasClass("tab")){a9="\t"}if(ba.hasClass("return")){a9="\n"}if(ba.hasClass("uppercase")){a9=a9.toUpperCase()}if(aZ===true){$(".symbol span").toggle();if(a6===false){$(".letter").toggleClass("uppercase")}aZ=false}a7.val(a7.val()+a9)});a3.keypress(function(a8){if(a8.keyCode==13){a8.preventDefault();a4.find(".btn.btn-primary").click()}});a3.val("");var a0=a4.find(".btn.btn-primary");a0.click(function(){if(a5){a2=null;var a8=a5;a5=null;setTimeout(function(){a4.modal("hide");a8(a3.val())},10)}else{a4.modal("hide")}});var a1=a4.find(".btn.btn-secondary");a1.click(function(){if(a2){var a8=a2;a2=null;a5=null;setTimeout(function(){a4.modal("hide");try{a8()}catch(a9){i.makeNotice("error","misc-error",a9)}},10)}else{a4.modal("hide")}});a4.on("hidden",function(){a3.unbind();a1.unbind();a0.unbind();a4.unbind();if(a2){var a8=a2;a2=null;a5=null;setTimeout(function(){try{a8()}catch(a9){i.makeNotice("error","misc-error",a9)}},10)}})};this.makePairingQRCode=function(a0,aZ){i.getMainPassword(function(){loadScript("wallet/jquery.qrcode",function(){try{if(aZ==1){i.securePost("wallet",{method:"pairing-encryption-password"},function(a2){a0($("<div></div>").qrcode({width:300,height:300,text:"1|"+O+"|"+i.encrypt(e+"|"+Crypto.util.bytesToHex(UTF8.stringToBytes(aN)),a2,10)}))},function(a2){i.makeNotice("error","misc-error",a2)})}else{if(aZ==0){a0($("<div></div>").qrcode({width:300,height:300,text:O+"|"+e+"|"+aN}))}}}catch(a1){i.makeNotice("error","misc-error",a1)}})},function(){i.logout()})};this.getMainPassword=function(a0,aZ){if(C>new Date().getTime()-P){return a0(aN)}i.getPassword($("#main-password-modal"),function(a1){if(aN==a1){C=new Date().getTime();if(a0){try{a0(aN)}catch(a2){i.makeNotice("error","misc-error",a2)}}}else{i.makeNotice("error","misc-error","Password incorrect.");if(aZ){try{aZ()}catch(a2){i.makeNotice("error","misc-error",a2)}}}},aZ)};this.getSecondPassword=function(a1,aZ){if(!G||ap!=null){if(a1){try{a1(ap)}catch(a0){i.makeNotice("error","misc-error",a0)}}return}i.getPassword($("#second-password-modal"),function(a2){try{if(i.validateSecondPassword(a2)){if(a1){try{a1(a2)}catch(a3){console.log(a3);i.makeNotice("error","misc-error",a3)}}}else{i.makeNotice("error","misc-error","Password incorrect.");if(aZ){try{aZ()}catch(a3){i.makeNotice("error","misc-error",a3)}}}}catch(a3){if(aZ){try{aZ()}catch(a3){i.makeNotice("error","misc-error",a3)}}}},aZ)};function b(){if(B||aA){return}function a0(a4){aA=false;i.makeNotice("error","misc-error",a4);i.sendEvent("error_restoring_wallet")}try{aA=true;var aZ=$("#restore-password");aN=aZ.val();aZ.val("");C=new Date().getTime();if(an==null||an.length==0){i.setLoadingText("Validating Authentication key");var a1=$.trim($(".auth-"+r).find(".code").val());if(a1.length==0||a1.length>255){throw"You must enter a Two Factor Authentication code"}var a2={guid:O,payload:a1,length:a1.length,method:"get-wallet",format:"plain"};if(T){a2.storageToken=T}$.ajax({timeout:60000,type:"POST",url:root+"wallet",data:a2,success:function(a4){try{if(a4==null||a4.length==0){throw"Server Return Empty Wallet Data"}if(a4!="Not modified"){i.setEncryptedWalletData(a4)}$(".auth-"+r).hide();$(".auth-0").show();af(function(){aA=false;o();aQ()},a0)}catch(a5){a0(a5)}},error:function(a4){a0(a4.responseText)}})}else{af(function(){aA=false;o();aQ()},a0)}}catch(a3){a0(a3)}}this.getIsInitialized=function(){return B};function a(){if(B){return}ay("error");webSocketConnect(y);B=true;$("#tech-faq").hide();$("#intro-text").hide();$("#large-summary").show()}this.connectWebSocket=function(){webSocketConnect(y)};this.quickSendNoUI=function(a1,a0,aZ){loadScript("wallet/signer",function(){i.getSecondPassword(function(){try{var a3=initNewTx();a3.webworker_resource_prefix="";a3.from_addresses=i.getActiveAddresses();a3.to_addresses.push({address:new Bitcoin.Address(a1),value:Bitcoin.Util.parseValue(a0)});a3.addListener(aZ);a3.start()}catch(a2){aZ.on_error(a2)}},function(a2){aZ.on_error(a2)})})};function H(){i.setLoadingText("Sending email backup");i.securePost("wallet",{method:"email-backup"},function(aZ){i.makeNotice("success","backup-success",aZ)},function(aZ){i.makeNotice("error","misc-error",aZ.responseText)})}this.backupWalletDelayed=function(a2,a1,a0,aZ){if(ar){clearInterval(ar);ar=null}ar=setTimeout(function(){i.backupWallet(a2,a1,a0,aZ)},3000)};this.backupWallet=function(a5,a4,a0){if(ar){clearInterval(ar);ar=null}var aZ=function(a6){i.sendEvent("on_backup_wallet_error");i.makeNotice("error","misc-error","Error Saving Wallet: "+a6,10000);L();d();if(a0!=null){a0(a6)}};try{if(a5==null){a5="update"}if(aJ(K)==0){throw"Addresses Length 0"}var a1=i.makeWalletJSON();var a3=i.encryptWallet(a1,aN);if(a3.length==0){throw"Error encrypting the JSON output"}i.decryptWallet(a3,aN,function(ba){try{var a7=aE;i.setLoadingText("Saving wallet");i.setEncryptedWalletData(a3);var a6=aE;var a8={length:a3.length,payload:a3,checksum:a6,old_checksum:a7,method:a5,format:"plain",language:ab};if(z){a8.active=i.getActiveAddresses().join("|")}i.securePost("wallet",a8,function(bb){g(a6,function(){for(var bc in K){var bd=K[bc];if(bd.tag==1){delete bd.tag}}i.makeNotice("success","misc-success",bb);d();if(a4!=null){a4()}i.sendEvent("on_backup_wallet_success")},function(){aZ("Checksum Did Not Match Expected Value")})},function(bb){aZ(bb.responseText)})}catch(a9){aZ(a9)}})}catch(a2){aZ(a2)}};function aR(aZ){if(G){if(ap==null){throw"Cannot encrypt private key without a password"}return i.encrypt(aZ,e+ap,i.getSecondPasswordPbkdf2Iterations())}else{return aZ}return null}this.isBase58=function(a1,a0){for(var aZ=0;aZ<a1.length;++aZ){if(a1[aZ]<0||a1[aZ]>58){return false}}return true};this.encrypt=function(a1,a0,aZ){return Crypto.AES.encrypt(a1,a0,{mode:new Crypto.mode.CBC(Crypto.pad.iso10126),iterations:aZ})};this.encryptWallet=function(a0,aZ){return JSON.stringify({pbkdf2_iterations:i.getMainPasswordPbkdf2Iterations(),version:2,payload:i.encrypt(a0,aZ,i.getMainPasswordPbkdf2Iterations())})};this.decryptWallet=function(a0,a9,ba,a4){try{i.setLoadingText("Decrypting Wallet");i.sendEvent("on_wallet_decrypt_start");var a6=function(bb,bc){i.sendEvent("on_wallet_decrypt_finish");if(ba!=null){ba(bb,bc)}};var a8=function(bb){i.sendEvent("on_wallet_decrypt_finish");if(a4!=null){a4(bb)}};var aZ=null;try{var aZ=$.parseJSON(a0)}catch(a2){}var a1=function(){try{var bc=Crypto.AES.decrypt(aZ.payload,a9,{mode:new Crypto.mode.CBC(Crypto.pad.iso10126),iterations:aZ.pbkdf2_iterations});var bb=$.parseJSON(bc);a6(bb,aZ)}catch(bd){a8("Error Decrypting Wallet. Please check your password is correct.")}};if(aZ&&aZ.payload&&aZ.pbkdf2_iterations){if(aZ.version!=au){var a3=i.getGuid();if(a3===undefined||a3===null){a3=""}window.location=root+"wallet-beta/#/login/"+a3}if(aZ.pbkdf2_iterations>0){var a7=$("#decrypting-progress-modal");var a5=setTimeout(function(){a7.modal({keyboard:false,backdrop:"static",show:true});a7.center()},500);i.decryptWebWorker(aZ.payload,a9,aZ.pbkdf2_iterations,function(bc){clearTimeout(a5);a7.modal("hide");try{var bb=$.parseJSON(bc);a6(bb,aZ)}catch(bd){a1()}},function(bb){clearTimeout(a5);a7.modal("hide");a1()})}else{a1()}}else{i.decrypt(a0,a9,10,function(bc){try{var bb=$.parseJSON(bc);try{a6(bb)}catch(bd){console.log(bd)}return true}catch(bd){return false}},function(){a8("Error Decrypting Wallet. Please check your password is correct.")})}}catch(a2){a8(a2)}};this.getWebWorkerLoadPrefix=function(){return resource+"wallet/"};this.decryptWebWorker=function(a2,a6,a1,a7,a5){var aZ=false;var a4=function(a8){if(!aZ){a5(a8);aZ=true}};try{var a0=new Worker(i.getWebWorkerLoadPrefix()+"signer"+(min?".min.js":".js"));a0.addEventListener("message",function(a9){var a8=a9.data;try{switch(a8.cmd){case"on_decrypt":a7(a8.data);a0.terminate();break;case"on_error":throw a8.e}}catch(a9){a0.terminate();a4(a9)}},false);a0.addEventListener("error",function(a8){a4(a8)});a0.postMessage({cmd:"load_resource",path:i.getWebWorkerLoadPrefix()+"bitcoinjs"+(min?".min.js":".js")});a0.postMessage({cmd:"decrypt",data:a2,password:a6,pbkdf2_iterations:a1})}catch(a3){a4(a3)}};this.decrypt=function(a3,a2,a0,a5,a1){try{var aZ=Crypto.AES.decrypt(a3,a2,{mode:new Crypto.mode.CBC(Crypto.pad.iso10126),iterations:a0});if(aZ!=null&&aZ.length>0){if(a5(aZ)){return aZ}}}catch(a4){console.log(a4)}if(a0!=10){try{var aZ=Crypto.AES.decrypt(a3,a2,{mode:new Crypto.mode.CBC(Crypto.pad.iso10126),iterations:10});if(aZ!=null&&aZ.length>0){if(a5(aZ)){return aZ}}}catch(a4){console.log(a4)}}try{var aZ=Crypto.AES.decrypt(a3,a2);if(aZ!=null&&aZ.length>0){if(a5(aZ)){return aZ}}}catch(a4){console.log(a4)}try{var aZ=Crypto.AES.decrypt(a3,a2,{mode:new Crypto.mode.OFB(Crypto.pad.iso7816),iterations:1});if(aZ!=null&&aZ.length>0){if(a5(aZ)){return aZ}}}catch(a4){console.log(a4)}try{var aZ=Crypto.AES.decrypt(a3,a2,{mode:new Crypto.mode.CBC(Crypto.pad.iso10126),iterations:1});if(aZ!=null&&aZ.length>0){if(a5(aZ)){return aZ}}}catch(a4){console.log(a4)}if(a1){a1()}return null};this.handleNTPResponse=function(a3,a4){var a1=(new Date()).getTime();if(a3.clientTimeDiff&&a3.serverTime){var aZ=a1-a3.serverTime;var a0=(a3.clientTimeDiff-a1+a4-aZ)/2;var a2=(aZ-a0)/2;if(ac){aP=(aP+a2)/2}else{aP=a2;ac=true;MyStore.put("server_time_offset",""+aP)}console.log("Server Time offset "+aP+"ms - This offset "+a2)}};this.setGUID=function(a1,aZ){if(B){throw"Cannot Set GUID Once Initialized"}if(!a1||a1.length==0){throw"Invalid GUID"}i.setLoadingText("Downloading Wallet");$("#initial_error,#initial_success").remove();var a0=$("#restore-wallet-continue");a0.prop("disabled",true);var a3=(new Date()).getTime();var a2={format:"json",resend_code:aZ,ct:a3};if(aE){a2.checksum=aE}if(e){a2.sharedKey=e}if(T){a2.storageToken=T}$.ajax({type:"GET",dataType:"json",url:root+"wallet/"+encodeURIComponent(a1),data:a2,timeout:60000,success:function(a4){i.handleNTPResponse(a4,a3);a0.prop("disabled",false);if(!a4.guid){i.makeNotice("error","misc-error","Server returned null guid.");return}$(".auth-"+r).hide();ae=a4.extra_seed;O=a4.guid;r=a4.auth_type;aS=a4.real_auth_type;z=a4.sync_pubkeys;if(a4.payload&&a4.payload.length>0&&a4.payload!="Not modified"){i.setEncryptedWalletData(a4.payload)}i.sendEvent("did_set_guid");war_checksum=a4.war_checksum;setLocalSymbol(a4.symbol_local);setBTCSymbol(a4.symbol_btc);$("#restore-guid").val(O);$(".auth-"+r).show();if(a4.initial_error){i.makeNotice("error","misc-error",a4.initial_error)}if(a4.initial_success){i.makeNotice("success","misc-success",a4.initial_success)}MyStore.get("guid",function(a5){if(a5!=O){MyStore.remove("guid");MyStore.remove("multiaddr");MyStore.remove("payload");if(O!=E){MyStore.put("guid",O)}}});if(a4.language&&ab!=a4.language){i.setLanguage(a4.language)}},error:function(a4){a0.prop("disabled",false);MyStore.get("guid",function(a5){i.sendEvent("did_fail_set_guid");try{var a7=$.parseJSON(a4.responseText);if(a7.authorization_required){loadScript("wallet/poll-for-session-guid",function(){pollForSessionGUID()})}if(a7.initial_error){i.makeNotice("error","misc-error",a7.initial_error)}return}catch(a6){}if(a4.responseText){i.makeNotice("error","misc-error",a4.responseText)}else{i.makeNotice("error","misc-error","Error changing wallet identifier")}})}})};function j(aZ){var a0=B58.encode(aZ);return aR(a0)}this.decryptPK=function(aZ){if(G){if(ap==null){throw"Cannot decrypt private key without a password"}return i.decrypt(aZ,e+ap,i.getSecondPasswordPbkdf2Iterations(),i.isBase58)}else{return aZ}return null};this.decodePK=function(a0){if(!a0){throw"null PK passed to decodePK"}var aZ=i.decryptPK(a0);if(aZ!=null){return B58.decode(aZ)}return null};this.signmessage=function(aZ,a1){var a3=K[aZ];if(!a3.priv){throw"Cannot sign a watch only address"}var a2=i.decodePK(a3.priv);var a0=new Bitcoin.ECKey(a2);return Bitcoin.Message.signMessage(a0,a1,a3.addr)};this.validateSecondPassword=function(a0){var aZ=Crypto.SHA256(e+a0,{asBytes:true});var a3=ai(aZ,i.getSecondPasswordPbkdf2Iterations()-1);if(a3==x){ap=a0;return true}if(i.getSecondPasswordPbkdf2Iterations()!=10){var a1=ai(aZ,10-1);if(a1==x){ap=a0;x=a3;return true}}if(Crypto.util.bytesToHex(aZ)==x){ap=a0;x=a3;return true}var a2=Crypto.SHA256(a0);if(a2==x){ap=a0;x=a3;return true}return false};this.runCompressedCheck=function(){var aZ=[];var a1={};for(var a2 in K){var a6=K[a2];if(a6.priv!=null){var a5=i.decodePK(a6.priv);var a3=new Bitcoin.ECKey(a5);var a0=a3.getBitcoinAddress().toString();var a4=a3.getBitcoinAddressCompressed().toString();if(a6.addr!=a0){a1[a0]=a6.priv;aZ.push(a0)}if(a6.addr!=a4){a1[a4]=a6.priv;aZ.push(a4)}}}if(aZ.length==0){alert("to_check length == 0")}BlockchainAPI.get_balances(aZ,function(ba){var bb=0;for(var a9 in ba){var bc=ba[a9].final_balance;if(bc>0){var a8=new Bitcoin.ECKey(i.decodePK(a1[a9]));var a7=a8.getBitcoinAddress().toString();if(i.addPrivateKey(a8,{compressed:a7!=a9,app_name:IMPORTED_APP_NAME,app_version:IMPORTED_APP_VERSION})){alert(formatBTC(bc)+" claimable in address "+a9)}}bb+=bc}alert(formatBTC(bb)+" found in compressed addresses");if(bb>0){i.backupWallet("update",function(){i.get_history()})}})};this.checkAllKeys=function(aZ){for(var a0 in K){var a4=K[a0];if(a4.addr==null){throw"Null Address Found in wallet "+a0}if(a4.addr.toString()==null){throw"Error decoding wallet address "+a4.addr}if(a4.priv!=null){var a3=i.decodePK(a4.priv);var a2=new Bitcoin.ECKey(a3);var a1=a2.getBitcoinAddress().toString();if(a1!=a4.addr&&a2.getBitcoinAddressCompressed().toString()!=a4.addr){throw"Private key does not match bitcoin address "+a4.addr+" != "+a1}if(aZ){a4.priv=j(a3)}}}i.makeNotice("success","wallet-success","Wallet verified.")};this.setMainPassword=function(aZ){i.getMainPassword(function(){aN=aZ;i.backupWallet("update",function(){i.logout()},function(){i.logout()})})};function ak(aZ){if(aZ===k){return}if(k!=null){if($("#"+k.attr("id")+"-btn").length>0){$("#"+k.attr("id")+"-btn").parent().attr("class","")}k.hide()}k=aZ;k.show();if($("#"+k.attr("id")+"-btn").length>0){$("#"+k.attr("id")+"-btn").parent().attr("class","active")}d(true)}function aJ(a1){var a0=0,aZ;for(aZ in a1){a0++}return a0}function ah(aZ){K[aZ].priv=null}function ao(){if(aJ(K)>=aG){i.makeNotice("error","misc-error","We currently support a maximum of "+aG+" private keys, please remove some unused ones.");return true}return false}function aV(a1,aZ){var a0=K[a1];if(!a0||a0.length==0){K[a1]={addr:a1,priv:aZ,balance:0};return true}else{if(!a0.priv&&aZ){a0.priv=aZ;return true}}return false}function p(){var a1=$("#add-address-book-entry-modal");a1.modal({keyboard:true,backdrop:"static",show:true});var aZ=a1.find('input[name="label"]');var a0=a1.find('input[name="address"]');aZ.val("");a0.val("");a1.find(".btn.btn-primary").unbind().click(function(){a1.modal("hide");var a3=$.trim(aZ.val());var a2=$.trim(a0.val());if(a3.length==0||a2.length==0){i.makeNotice("error","misc-error","You must enter an address and label for the address book entry");return false}if(!aj(a3)||!aj(a2)){i.makeNotice("error","misc-error","Label and Bitcoin Address must contain letters and numbers only");return false}var a5;try{a5=new Bitcoin.Address(a2);if(a5==null){throw"Null address"}}catch(a4){i.makeNotice("error","misc-error","Bitcoin address invalid, please make sure you entered it correctly");return false}if(h[a2]!=null){i.makeNotice("error","misc-error","Bitcoin address already exists");return false}i.makeNotice("success","misc-success","Added Address book entry");i.addAddressBookEntry(a2,a3);i.backupWalletDelayed();$("#send-coins").find(".tab-pane").trigger("show",true)});a1.find(".btn.btn-secondary").unbind().click(function(){a1.modal("hide")})}this.logout=function(){if(av){return}if(O==E){window.location=root+"wallet/logout"}else{$.ajax({type:"GET",timeout:60000,url:root+"wallet/logout",data:{format:"plain"},success:function(aZ){window.location.reload()},error:function(){window.location.reload()}})}};function at(a5){var a7=$("#delete-address-modal");a7.modal({keyboard:true,backdrop:"static",show:true});a7.find(".btn.btn-primary").hide();a7.find(".btn.btn-danger").hide();$("#change-mind").hide();a7.find("#to-delete-address").html(a5.join(" "));a7.find("#delete-balance").empty();var a1=a7.find("#delete-balance");var aZ=[];for(var a4 in a5){var a6=a5[a4];if(K[a6]&&K[a6].priv){aZ.push(a5[a4])}}BlockchainAPI.get_balance(aZ,function(a8){a7.find(".btn.btn-primary").show(200);a7.find(".btn.btn-danger").show(200);a1.html("Balance "+formatBTC(a8));if(a8>0){a1.css("color","red")}else{a1.css("color","black")}},function(){a7.find(".btn.btn-primary").show(200);a7.find(".btn.btn-danger").show(200);a1.text("Error Fetching Balance")});var a2=false;var a4=0;var a0=null;var a3=10;changeMind=function(){$("#change-mind").show();$("#change-mind-time").text(a3-a4)};a7.find(".btn.btn-primary").unbind().click(function(){changeMind();a7.find(".btn.btn-primary").hide();a7.find(".btn.btn-danger").hide();a0=setInterval(function(){if(a2){return}++a4;changeMind();if(a4==a3){$("#delete-address-modal").modal("hide");i.makeNotice("warning","warning-deleted","Private Key Removed From Wallet");for(var a8 in a5){ah(a5[a8])}d();i.backupWallet();clearInterval(a0)}},1000)});a7.find(".btn.btn-danger").unbind().click(function(){changeMind();a7.find(".btn.btn-primary").hide();a7.find(".btn.btn-danger").hide();a0=setInterval(function(){if(a2){return}++a4;changeMind();if(a4==a3){try{$("#delete-address-modal").modal("hide");i.makeNotice("warning","warning-deleted","Address & Private Key Removed From Wallet");for(var a8 in a5){i.deleteAddress(a5[a8])}d();i.backupWallet("update",function(){i.get_history()})}finally{clearInterval(a0)}}},1000)});a7.unbind().on("hidden",function(){if(a0){a2=true;clearInterval(a0);a0=null}});a7.find(".btn.btn-secondary").unbind().click(function(){a7.modal("hide")})}function aF(){var a1=[];for(var aZ in h){a1.push(h[aZ])}for(var aZ in K){var a0=K[aZ];if(a0.tag!=2&&a0.label){a1.push(a0.label)}}return a1}this.sweepAddressesModal=function(a0,aZ){i.getSecondPassword(function(){var a2=$("#sweep-address-modal");a2.modal("show");BlockchainAPI.get_balance(a0,function(a3){a2.find(".balance").text("Amount: "+formatBTC(a3))},function(){a2.find(".balance").text("Error Fetching Balance")});var a1=a2.find('select[name="change"]');m(a1,true);a2.find(".btn.btn-primary").unbind().click(function(){loadScript("wallet/signer",function(){BlockchainAPI.get_balance(a0,function(a4){var a5=initNewTx();var a3=a1.val();if(a3=="any"){a3=i.getPreferredAddress()}a5.fee=a5.base_fee;a5.to_addresses.push({address:new Bitcoin.Address(a3),value:BigInteger.valueOf(a4).subtract(a5.fee)});a5.from_addresses=a0;a5.extra_private_keys=aZ;a5.start()},function(){i.makeNotice("error","misc-error","Error Getting Address Balance")})});a2.modal("hide")});a2.find(".btn.btn-secondary").unbind().click(function(){a2.modal("hide")})})};this.openWindow=function(a0){function aZ(a3){var a2=false;try{if(typeof a3=="undefined"||!a3){a2=true}else{if(a3&&a3.closed){a2=false}else{if(a3&&a3.test){a2=false}}}}catch(a4){}return a2}var a1=window.open(a0,null,"scroll=1,status=1,location=1,toolbar=1");if(aZ(a1)){i.makeNotice("error","misc-error","Popup Blocked. Try and click again.");return false}else{return true}};function aH(){try{$(".pop").popover({offset:10,placement:"bottom"})}catch(aZ){}}function o(){if(X){return}X=true;$("#add-address-book-entry-btn").click(function(){p()});$("#home-intro-btn").click(function(){ak($("#home-intro"))});$("#my-transactions-btn").click(function(){ak($("#my-transactions"))});$("#send-coins-btn").click(function(){ak($("#send-coins"))});$("#import-export-btn").click(function(){ak($("#import-export"));V()});$("#chord-diagram").click(function(){loadScript("wallet/frame-modal",function(){showFrameModal({title:"Address Relationships",description:"",src:root+"taint/"+i.getActiveAddresses().join("|")})})});$("#verify-message").click(function(){loadScript("wallet/address_modal",function(){verifyMessageModal()})});$("#generate-cold-storage").click(function(){loadScript("wallet/paper-wallet",function(){PaperWallet.showColdStorageModal()},null,true)});$("#group-received").click(function(){loadScript("wallet/taint_grouping",function(){try{loadTaintData()}catch(aZ){i.makeNotice("error","misc-error","Unable To Load Taint Grouping Data")}})});$("#my-account-btn").click(function(){ak($("#my-account"));var aZ=$("#account-settings-warning").show();var a0=$("#my-account-content").hide();$("#show-account-settings").unbind().click(function(){i.getMainPassword(function(){aZ.hide();loadScript("wallet/account",function(){AccountSettings.init(a0,function(){a0.show()},function(){ak($("#home-intro"))})},function(a1){i.makeNotice("error","misc-error",a1);ak($("#home-intro"))})},function(){ak($("#home-intro"))})})});$("#active-addresses").on("show",function(){var a5=$(this).find("table:first");a5.find("tbody:gt(0)").remove();var a2=a5.find("tbody").empty();for(var a4 in K){var a6=K[a4];if(a6.tag==2||a6.tag==1){continue}var a3="";if(a6.tag==1){a3=' <font color="red" class="pop" title="Not Synced" data-content="This is a new address which has not yet been synced with our the server. Do not used this address yet.">(Not Synced)</font>'}else{if(a6.priv==null){a3=' <font color="red" class="pop" title="Watch Only" data-content="Watch Only means there is no private key associated with this bitcoin address. <br /><br /> Unless you have the private key stored elsewhere you do not own the funds at this address and can only observe the transactions.">(Watch Only)</font>'}}var aZ="";var a1=a6.addr;if(a6.label!=null){a1=a6.label;aZ='<span class="hidden-phone"> - '+a6.addr+"</span>"}var a0=$('<tr><td><div class="short-addr"><a href="'+root+"address/"+a6.addr+'" target="new">'+a1+"</a>"+aZ+" "+a3+'<div></td><td><span style="color:green">'+formatMoney(a6.balance,true)+'</span></td>            <td><div class="btn-group pull-right"><a class="btn btn-mini dropdown-toggle" data-toggle="dropdown" href="#"><span class="hidden-phone">Actions </span><span class="caret"></span></a><ul class="dropdown-menu">             <li><a href="#" class="pop act-archive" title="Archive Address" data-content="Click this button to hide the address from the main view. You can restore or delete later by finding it in the Archived addresses tab.">Archive Address</a></li>            <li><a href="#" class="pop act-label" title="Label Address" data-content="Set the label for this address.">Label Address</a></li>            <li><a href="#" class="pop act-qr" title="Show QR Code" data-content="Show a QR Code for this address.">QR Code</a></li>            <li><a href="#" class="pop act-sign" title="Sign Message" data-content="Sign A message with this address.">Sign Message</a></li>            <li><a href="#" class="pop act-request" title="Request Payment" data-content="Click here to create a new QR Code payment request. The QR Code can be scanned using most popular bitcoin software and mobile apps.">Create Payment Request</a></li>            <li><a href="#" class="pop act-pubkey">Show Public Key</a></li>            </ul></div></td></tr>');(function(a7){a0.find(".act-archive").click(function(){i.archiveAddr(a7)});a0.find(".act-label").click(function(){loadScript("wallet/address_modal",function(){showLabelAddressModal(a7)})});a0.find(".act-qr").click(function(){loadScript("wallet/address_modal",function(){showAddressModalQRCode(a7)})});a0.find(".act-pubkey").click(function(){i.getSecondPassword(function(){var a8=i.getPrivateKey(a7);if(a8==null){i.makeNotice("eror","misc-error","Public Key Unknown");return}var a9=new Bitcoin.ECKey(i.decodePK(a8));if(a9.getBitcoinAddressCompressed().toString()==a7){var ba=a9.getPubCompressed()}else{var ba=a9.getPub()}i.makeNotice("success","pub-key","Public Key of "+a7+" is "+Crypto.util.bytesToHex(ba),20000)})});a0.find(".act-sign").click(function(){loadScript("wallet/address_modal",function(){showAddressModalSignMessage(a7)})});a0.find(".act-request").click(function(){loadScript("wallet/frame-modal",function(){showFrameModal({title:"Create Payment Request",description:"Request Payment into address <b>"+a7+"</b>",src:root+"payment_request?address="+a7})})})})(a6.addr);if(a6.balance>0&&a6.priv){a5.prepend(a0)}else{a5.append(a0)}}aH()});$("#archived-addresses").on("show",function(){$("#archived-addr tbody").empty();var a0=$(this).find("tbody");var aZ=i.getArchivedAddresses();var a1=function(){a0.empty();for(var a5 in aZ){var a7=K[aZ[a5]];if(a7.tag!=2||a7.tag==1){continue}var a4="";if(a7.priv==null){a4=' <font color="red">(Watch Only)</font>'}var a2="";var a3=a7.addr;if(a7.label!=null){a3=a7.label;a2='<span class="hidden-phone"> - '+a7.addr+"</span>"}var a6=$('<tr><td style="width:20px;"><input type="checkbox" class="archived_checkbox" value="'+a7.addr+'"></td><td><div class="short-addr"><a href="'+root+"address/"+a7.addr+'" target="new">'+a3+"</a>"+a2+" "+a4+'<div></td><td><span style="color:green">'+formatBTC(a7.balance)+'</span></td><td style="width:16px"><img src="'+resource+'unarchive.png" class="act-unarchive" /></td></tr>');(function(a8){a6.find(".act-unarchive").click(function(){i.unArchiveAddr(a8)})})(a7.addr);if(a7.balance>0&&a7.priv){a0.prepend(a6)}else{a0.append(a6)}}};a1();BlockchainAPI.get_balances(aZ,function(a2){a1()},function(a2){i.makeNotice("error","misc-error",a2)})});$("#archived-select-all").click(function(){$(".archived_checkbox").prop("checked",true)});$("#archived-select-none").click(function(){$(".archived_checkbox").prop("checked",false)});$("#archived-sweep").click(function(){var aZ=[];$(".archived_checkbox:checked").each(function(){var a0=K[$(this).val()];if(a0.priv==null){i.makeNotice("error","misc-error","Cannot Sweep Watch Only Address");return}aZ.push(a0.addr)});if(aZ.length==0){return}i.sweepAddressesModal(aZ)});$("#archived-delete").click(function(){var aZ=[];$(".archived_checkbox:checked").each(function(){aZ.push($(this).val())});if(aZ.length==0){return}at(aZ)});$("#shared-never-ask").click(function(){SetCookie("shared-never-ask",$(this).is(":checked"))});$(".deposit-btn").click(function(){var a1=$(this);var a0=i.getPreferredAddress();var aZ=a1.data("extra");if(aZ==null){aZ=""}loadScript("wallet/frame-modal",function(){showFrameModal({title:a1.data("title"),description:"Deposit into address <b>"+a0+"</b>",top_right:'Have Questions? Read <a href="'+a1.data("link")+'" target="new">How It Works</a>',src:root+"deposit?address="+a0+"&ptype="+a1.data("type")+"&guid="+O+aZ})})});$(".withdraw-btn").click(function(){var aZ=$(this);i.getSecondPassword(function(){var a0=i.getPreferredAddress();loadScript("wallet/frame-modal",function(){showFrameModal({title:aZ.data("title"),description:"Your Wallet Balance is <b>"+formatBTC(aD)+"</b>",src:root+"withdraw?method="+aZ.data("type")+"&address="+a0+"&balance="+aD+"&guid="+O})})})});$("#logout").click(i.logout);$("#refresh").click(function(){L(function(){i.get_history()})});$("#summary-n-tx-chart").click(function(){loadScript("wallet/frame-modal",function(){showFrameModal({title:"Number of transactions",description:"",src:root+"charts/n-transactions?show_header=false&address="+i.getActiveAddresses().join("|")})})});$("#summary-received-chart").click(function(){loadScript("wallet/frame-modal",function(){showFrameModal({title:"BTC Received Per Day",description:"",src:root+"charts/received-per-day?show_header=false&address="+i.getActiveAddresses().join("|")})})});$("#summary-balance-chart").click(function(){loadScript("wallet/frame-modal",function(){showFrameModal({title:"Wallet Balance",description:"",src:root+"charts/balance?show_header=false&address="+i.getActiveAddresses().join("|")})})});$("#new-addr").click(function(){$("#new-addr").prop("disabled",true);L(function(){i.getSecondPassword(function(){var a0=i.generateNewKey();if(!a0||!a0.addr){$("#new-addr").removeAttr("disabled");throw"Error Generating New Address"}var aZ=a0.addr;i.backupWallet("update",function(){i.makeNotice("info","new-address","Generated new Bitcoin Address "+aZ);$("#new-addr").removeAttr("disabled");loadScript("wallet/address_modal",function(){showLabelAddressModal(aZ)});i.get_history()},function(){$("#new-addr").removeAttr("disabled")})},function(){i.logout()})},function(){$("#new-addr").removeAttr("disabled")})});$(".tx_filter a").click(function(){aB=0;aw=$(this).data("value");i.get_history()});$(".tx_display a").click(function(){var aZ=$(this).data("value");if(aZ=="export"){w();return}t.tx_display=aZ;d();i.backupWalletDelayed()});$("#email-backup-btn").click(function(){H()});$("#dropbox-backup-btn").click(function(){i.openWindow(root+"wallet/dropbox-login?guid="+O)});$("#gdrive-backup-btn").click(function(){i.openWindow(root+"wallet/gdrive-login?guid="+O)});$("#balance").click(function(){toggleSymbol();d()});$("#send-quick").on("show",function(a1,a0){var aZ=$(this);s(aZ,a0);aZ.find(".send").unbind().click(function(){loadScript("wallet/signer",function(){startTxUI(aZ,"quick",initNewTx())})})});$("#send-email").on("show",function(a1,a0){var aZ=$(this);s(aZ,a0);aZ.find(".send").unbind().click(function(){loadScript("wallet/signer",function(){startTxUI(aZ,"email",initNewTx())})})});$("#send-custom").on("show",function(a1,a0){var aZ=$(this);s(aZ,a0);aZ.find(".send").unbind().click(function(){var a2=false;if(aZ.find('textarea[name="public-note"]').val()){aZ.find(".send-value").each(function(){if($(this).val()<0.0001){i.makeNotice("error","misc-error","You cannot attach a note to a transaction with an output size less than 0.0001 BTC");a2=true;return false}})}if(!a2){loadScript("wallet/signer",function(){startTxUI(aZ,"custom",initNewTx())})}});aZ.find('input[name="fees"]').unbind().bind("keyup change",function(a2){if(a2.keyCode=="9"){return}$(this).parent().find(".send-value-usd").val(convert($(this).val()*symbol_btc.conversion,symbol_local.conversion)).text(formatSymbol($(this).val()*symbol_btc.conversion,symbol_local))});aZ.find(".reset").unbind().click(function(){s(aZ,true);aZ.find('select[name="from"]').trigger("change")})});$("#shared-coin").on("show",function(a1,a0){var aZ=$(this);loadScript("wallet/sharedcoin",function(){try{s(aZ);SharedCoin.init(aZ)}catch(a2){console.log(a2);i.makeNotice("error","misc-error",a2)}},function(a2){i.makeNotice("error","misc-error",a2)})});$("#send-sms").on("show",function(a1,a0){if(a0){return}var aZ=$(this);s(aZ);$.ajax({type:"GET",timeout:60000,url:resource+"wallet/country_codes.html",success:function(a2){aZ.find('select[name="sms-country-code"]').html(a2)},error:function(){i.makeNotice("error","misc-error","Error Downloading SMS Country Codes")}});aZ.find(".send").unbind().click(function(){loadScript("wallet/signer",function(){var a2=initNewTx();startTxUI(aZ,"sms",a2)})})});$("#address-book").on("show",function(){var a0=$("#address-book-tbl tbody");if(aJ(h)>0){a0.empty();for(var aZ in h){var a1=$("<tr><td>"+h[aZ]+'</td><td><div class="addr-book-entry">'+aZ+'</div></td><td style="width:16px" class="hidden-phone"><img src="'+resource+'delete.png" class="act-delete" /></td></tr>');(function(a2){a1.find(".act-delete").click(function(){i.deleteAddressBook(a2)})})(aZ);a0.append(a1)}}});$('a[data-toggle="tab"]').unbind().on("show",function(aZ){$(aZ.target.hash).trigger("show")});$("#receive-coins-btn").click(function(){ak($("#receive-coins"))});$("#cash-into-coins").click(function(){$(this).attr("href",$(this).attr("href")+i.getPreferredAddress())});$(".show_adv").click(function(){$(".modal:visible").center()});$(".download-backup-btn").show();aH()}function q(){$(".resend-code").click(function(){i.setGUID(O,true)});$("#reset-two-factor-btn").click(function(){i.openWindow(root+"wallet/reset-two-factor"+(O?"?guid="+O:""))});$(".recover-wallet-btn").click(function(){i.openWindow(root+"wallet/forgot-password"+(O?"?guid="+O:""))});$(".download-backup-btn").toggle(an!=null).click(function(){if(!an){i.makeNotice("error","error","No Wallet Data to Download");return}try{var a0=!!new Blob()}catch(a1){}if(a0){loadScript("wallet/filesaver",function(){var a2=new Blob([an],{type:"text/plain;charset=utf-8"});saveAs(a2,"wallet.aes.json")})}else{var aZ=window.open(null,null,"width=700,height=800,toolbar=0");aZ.document.write('<!DOCTYPE html><html><head></head><body><div style="word-wrap:break-word;" >'+an+"</div></body></html>")}aW()});$(".auth-0,.auth-1,.auth-2,.auth-3,.auth-4,.auth-5").unbind().keypress(function(aZ){if(aZ.keyCode==13){aZ.preventDefault();$("#restore-wallet-continue").click()}});$("#restore-wallet-continue").unbind().click(function(a0){a0.preventDefault();var aZ=$.trim($("#restore-guid").val());if(aZ.length==0){return}if(O!=aZ){e=null;i.setGUID(aZ,false)}else{b()}});$(".modal").on("show",function(){N();$(this).center()}).on("hidden",function(){var a0=$(".modal:visible");var aZ=$("#notices").remove();if(a0.length>0){a0.find(".modal-body").prepend(aZ)}else{$("#main-notices-container").append(aZ)}}).on("shown",function(){N();var aZ=$(this);setTimeout(function(){if(aZ.is(":visible")){aZ.find(".modal-body").prepend($("#notices").remove())}},100);aZ.center()})}function aq(a0){var a1=Crypto.SHA256(a0+"?");switch(a1.slice(0,2)){case"00":var a2=Crypto.SHA256(a0,{asBytes:true});return a2;break;case"01":var aZ=Crypto.util.hexToBytes(a1.slice(2,4))[0];var a3=Math.round(Math.pow(2,(aZ/4)));var a2=Crypto.PBKDF2(a0,"Satoshi Nakamoto",32,{iterations:a3,asBytes:true});return a2;break;default:console.log("invalid key");break}}function aM(){var a1,aZ="";if(window.getSelection){a1=window.getSelection();if(a1.rangeCount){var a2=a1.getRangeAt(0).cloneContents();var a0=document.createElement("div");a0.appendChild(a2);aZ=a0.innerText}}else{if(document.selection&&document.selection.type=="Text"){aZ=document.selection.createRange().htmlText}}return aZ}this.detectPrivateKeyFormat=function(a0){if(/^5[123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz]{50}$/.test(a0)){return"sipa"}if(/^[LK][123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz]{51}$/.test(a0)){return"compsipa"}if(/^[123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz]{44}$/.test(a0)||/^[123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz]{43}$/.test(a0)){return"base58"}if(/^[A-Fa-f0-9]{64}$/.test(a0)){return"hex"}if(/^[ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789=+\/]{44}$/.test(a0)){return"base64"}if(/^6P[123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz]{56}$/.test(a0)){return"bip38"}if(/^S[123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz]{21}$/.test(a0)||/^S[123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz]{25}$/.test(a0)||/^S[123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz]{29}$/.test(a0)||/^S[123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz]{30}$/.test(a0)){var aZ=Crypto.SHA256(a0+"?",{asBytes:true});if(aZ[0]===0||aZ[0]===1){return"mini"}}throw"Unknown Key Format "+a0};this.privateKeyStringToKey=function(a0,a2){var aZ=null;if(a2=="base58"){aZ=B58.decode(a0)}else{if(a2=="base64"){aZ=Crypto.util.base64ToBytes(a0)}else{if(a2=="hex"){aZ=Crypto.util.hexToBytes(a0)}else{if(a2=="mini"){aZ=aq(a0)}else{if(a2=="sipa"){var a1=B58.decode(a0);a1.shift();aZ=a1.slice(0,a1.length-4)}else{if(a2=="compsipa"){var a1=B58.decode(a0);a1.shift();a1.pop();aZ=a1.slice(0,a1.length-4)}else{throw"Unsupported Key Format"}}}}}}if(aZ.length!=32){throw"Result not 32 bytes in length"}return new Bitcoin.ECKey(aZ)};$(document).ready(function(){if(!$.isEmptyObject({})||!$.isEmptyObject([])){i.makeNotice("error","error","Object.prototype has been extended by a browser extension. Please disable this extensions and reload the page.");return}window.applicationCache.addEventListener("updateready",function(){if(window.applicationCache.status===window.applicationCache.UPDATEREADY){window.applicationCache.swapCache();location.reload()}});$("input,button,select").attr("autocomplete","off");i.loadAdverts();var a0=$(document.body);O=a0.data("guid");e=a0.data("sharedkey");ab=a0.data("language");if(i.skip_init){return}MyStore.get("storage_token",function(a6){T=a6});MyStore.get("server_time_offset",function(a6){aP=parseInt(a6);if(isNaN(aP)){aP=0}});q();var a1=$("#restore-guid").val();if(O&&O.length==36){i.setGUID(O,false)}else{if(a1&&a1.length>0){$("#restore-wallet-continue").click()}else{if(isExtension||window.location.href.indexOf("/login")>0){MyStore.get("guid",function(a6){if(a6&&a6.length==36){i.setGUID(a6,false)}else{$("#signup-btn").show()}})}else{$("#signup-btn").show()}}}if(top.location!=self.location){top.location=self.location.href}a0.click(function(){if(Y){clearTimeout(Y);Y=setTimeout(i.logout,i.getLogoutTime())}rng_seed_time()}).keypress(function(){if(Y){clearTimeout(Y);Y=setTimeout(i.logout,i.getLogoutTime())}rng_seed_time()}).mousemove(function(a6){if(a6){rng_seed_int(a6.clientX*a6.clientY,16)}});$(".auth-"+r).show();k=$("#restore-wallet");k.show();var a2=false;var a5=17,a4=86,aZ=67,a3=67;$(document).keydown(function(a7){try{if(a7.keyCode==a5||a7.keyCode==a3){a2=true}if(a2&&a7.keyCode==aZ){var a6=$.trim(aM());var a8=K[a6];if(a8!=null){if(a8.priv==null){$("#watch-only-copy-warning-modal").modal("show")}}}}catch(a7){console.log(a7)}}).keyup(function(a6){if(a6.keyCode==a5||a6.keyCode==a3){a2=false}}).ajaxStart(function(){ay("loading_start");$(".loading-indicator").fadeIn(200)}).ajaxStop(function(){ay("loading_stop");$(".loading-indicator").hide()})});function aY(){$("#receive-coins").find(".tab-pane.active").trigger("show");setupToggle()}};