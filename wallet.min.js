var MyWallet=new function(){var h=this;this.skip_init=false;var E="abcaa314-6f67-6705-b384-5d47fbe9d7cc";var ad;var N;var j;var az;var ag;var w;var d;var ap=0;var Q=0;var al=0;var L=0;var aG=0;var ax;var g={};var F=[];var G=false;var an=0;var ak=0;var at=1000;var J={};var aq;var ai;var x=1.5;var T=10;var b={};var S;var X=[];var C;var O=60000;var q;var B=false;var s={fee_policy:0,html5_notifications:false,logout_time:600000,tx_display:0};this.addEventListener=function(aI){X.push(aI)};this.getLogoutTime=function(){return s.logout_time};this.setLogoutTime=function(aI){s.logout_time=aI;clearInterval(S);S=setTimeout(h.logout,h.getLogoutTime())};this.getDoubleEncryption=function(){return G};this.getEncryptedWalletData=function(){return ad};this.getFeePolicy=function(){return s.fee_policy};this.getGuid=function(){return N};this.setFeePolicy=function(aI){s.fee_policy=aI};this.getHTML5Notifications=function(){return s.html5_notifications};this.setHTML5Notifications=function(aI){s.html5_notifications=aI};this.getTransactions=function(){return F};this.addressExists=function(aI){return J[aI]!=null};this.getAddressTag=function(aI){return J[aI].tag};this.setAddressTag=function(aJ,aI){J[aJ].tag=aI};this.getAddressBook=function(){return g};this.getAddressLabel=function(aI){return J[aI].label};this.setAddressLabel=function(aI,aJ){J[aI].label=aJ};this.setAddressBalance=function(aI,aJ){J[aI].balance=aJ};this.getAddressBookLabel=function(aI){return g[aI]};this.isWatchOnly=function(aI){return J[aI].priv==null};this.getAddressBalance=function(aI){return J[aI].balance};this.getMixerFee=function(){return x};this.deleteAddress=function(aI){delete J[aI]};this.addAddressBookEntry=function(aJ,aI){g[aJ]=aI};this.getPrivateKey=function(aI){return J[aI].priv};this.setLabel=function(aI,aJ){J[aI].label=aJ;ae();c()};this.securePost=function(aI,aJ){var aK=jQuery.extend({},aJ);if(d==null||d.length==0||d.length!=36){throw"Shared key is invalid"}aK.sharedKey=d;aK.guid=N;aK.format="plain";return $.post(root+aI,aK)};this.isCorrectMainPassword=function(aI){return az==aI};this.setDoubleEncryption=function(aK,aI,aM){var aJ=function(aN){console.log("Panic "+aN);window.location.reload()};try{if(G==aK){return}if(aK){h.getSecondPassword(function(){try{G=true;ag=aI;for(var aP in J){var aR=J[aP];if(aR.priv!=null){aR.priv=i(B58.decode(aR.priv))}}var aN=Crypto.SHA256(d+ag,{asBytes:true});for(var aO=1;aO<T;++aO){aN=Crypto.SHA256(aN,{asBytes:true})}w=Crypto.util.bytesToHex(aN);ag=null;h.getSecondPassword(function(){try{h.checkAllKeys();h.backupWallet("update",function(){aM()},function(){aJ(aS)})}catch(aS){aJ(aS)}},function(){aJ()})}catch(aQ){aJ(aQ)}},function(){aJ()})}else{h.getSecondPassword(function(){try{for(var aN in J){var aP=J[aN];if(aP.priv!=null){aP.priv=h.decryptPK(aP.priv)}}G=false;ag=null;h.checkAllKeys();h.backupWallet("update",function(){aM()},function(){aJ(aO)})}catch(aO){aJ(aO)}},function(aN){aJ(aN)})}}catch(aL){aJ(aL)}};function M(){try{$(".popover").remove()}catch(aI){}}$(window).resize(function(){$(".modal:visible").center();M()});this.setLoadingText=function(aI){$(".loading-text").text(aI)};function aE(aJ,aI){aJ.click(function(){A(aI.txIndex,aI.result)});aJ.find(".show-note").mouseover(function(){var aK=aI.note?aI.note:b[aI.hash];aB(this,aK,aI.hash)});aJ.find(".add-note").mouseover(function(){m(this,aI.hash)});return aJ}function t(aJ,aP){var aI=0;for(var aL=0;aL<aJ.inputs.length;++aL){var aK=aJ.inputs[aL].prev_out;if(!aK||!aK.addr){continue}var aO=J[aK.addr];if(aO){var aN=parseInt(aK.value);aI-=aN;if(aP){Q+=aN;aO.balance-=aN}}}for(var aM=0;aM<aJ.out.length;++aM){var aK=aJ.out[aM];if(!aK||!aK.addr){continue}var aO=J[aK.addr];if(aO){var aN=parseInt(aK.value);aI+=aN;if(aP){al+=aN;aO.balance+=aN}}}return aI}function y(aI){}function ac(){return Crypto.util.bytesToHex(Crypto.SHA256(ad,{asBytes:true}))}function z(aI){aI.onmessage=function(aQ){try{var aN=$.parseJSON(aQ.data);if(aN.op=="status"){$("#status").html(aN.msg)}else{if(aN.op=="on_change"){var aR=ac();var aP=aN.checksum;console.log("On change old "+aR+" ==  new "+aP);if(aR!=aP){h.updateCacheManifest();setTimeout(K,250)}}else{if(aN.op=="utx"){var aO=TransactionFromJSON(aN.x);for(var aT in F){if(F[aT].txIndex==aO.txIndex){return}}var aV=t(aO,true);if(h.getHTML5Notifications()){var aM=function(aW){try{if(window.webkitNotifications&&navigator.userAgent.indexOf("Chrome")>-1){if(webkitNotifications.checkPermission()==0){webkitNotifications.createNotification(aW.iconUrl,aW.title,aW.body).show()}}else{if(window.Notification){if(Notification.permissionLevel()==="granted"){new Notification(aW.title,aW).show()}}}}catch(aX){}};try{aM({title:aV>0?"Payment Received":"Payment Sent",body:"Transaction Value "+formatBTC(aV)+" BTC",iconUrl:resource+"cube48.png"})}catch(aQ){console.log(aQ)}}aO.result=aV;ap+=aV;L++;aO.setConfirmations(0);playSound("beep");if(ak==0&&an==0){F.unshift(aO);var aS=false;if(F.length>50){F.pop();aS=true}}var aK=U();if("my-transactions"==aK){if(ak==0&&an==0){$("#no-transactions").hide();if(s.tx_display==0){var aJ=$("#transactions-compact").show();aE($(D(aO,J,g)),aO).prependTo(aJ.find("tbody")).find("div").hide().slideDown("slow");if(aS){aJ.find("tbody tr:last-child").remove()}}else{var aJ=$("#transactions-detailed").show();aJ.prepend(aO.getHTML(J,g));if(aS){aJ.find("div:last-child").remove()}setupSymbolToggle()}}}else{c()}}else{if(aN.op=="block"){for(var aL=0;aL<aN.x.txIndexes.length;++aL){for(var aU=0;aU<F.length;++aU){if(F[aU].txIndex==aN.x.txIndexes[aL]){if(F[aU].blockHeight==null||F[aU].blockHeight==0){F[aU].blockHeight=aN.x.height;break}}}}ao(BlockFromJSON(aN.x));W()}}}}}catch(aQ){console.log(aQ);console.log(aQ.data)}};aI.onopen=function(){$("#status").html("CONNECTED.");var aM='{"op":"blocks_sub"}';if(N!=null){aM+='{"op":"wallet_sub","guid":"'+N+'"}'}try{var aK=h.getActiveAddresses();for(var aJ in aK){aM+='{"op":"addr_sub", "addr":"'+aK[aJ]+'"}'}}catch(aL){alert(aL)}aI.send(aM)};aI.onclose=function(){$("#status").html("DISCONNECTED.")}}this.makeNotice=function(aJ,aM,aL,aK){if(aL==null||aL.length==0){return}console.log(aL);if(aK==null){aK=5000}var aI=$('<div class="alert alert-block alert-'+aJ+'"></div>');aI.text(""+aL);if($("#"+aM).length>0){aI.attr("id",aM);return}$("#notices").append(aI).hide().fadeIn(200);if(aK>0){(function(){var aN=aI;setTimeout(function(){aN.fadeOut(250,function(){$(this).remove()})},aK)})()}};function aw(aI){return aI}function am(aI){return h.decryptPK(aI)}function Z(aI){var aJ=h.decodePK(aI);return Crypto.util.bytesToBase64(aJ)}function k(aI){var aJ=h.decodePK(aI);return Crypto.util.bytesToHex(aJ)}this.base58ToSipa=function(aI,aN){var aJ=h.decodePK(aI);var aK=new Bitcoin.ECKey(aJ);while(aJ.length<32){aJ.unshift(0)}aJ.unshift(128);if(aK.getBitcoinAddress().toString()==aN){}else{if(aK.getBitcoinAddressCompressed().toString()==aN){aJ.push(1)}else{throw"Private Key does not match bitcoin address"+aN}}var aL=Crypto.SHA256(Crypto.SHA256(aJ,{asBytes:true}),{asBytes:true});aJ=aJ.concat(aL.slice(0,4));var aM=B58.encode(aJ);return aM};this.makeWalletJSON=function(aI){return h.makeCustomWalletJSON(aI,N,d)};this.makeCustomWalletJSON=function(aM,aJ,aO){var aL=aw;if(aM=="base64"){aL=Z}else{if(aM=="hex"){aL=k}else{if(aM=="sipa"){aL=h.base58ToSipa}else{if(aM=="base58"){aL=am}}}}var aI='{\n	"guid" : "'+aJ+'",\n	"sharedKey" : "'+aO+'",\n';if(G&&w!=null&&aL==aw){aI+='	"double_encryption" : '+G+',\n	"dpasswordhash" : "'+w+'",\n'}if(s){aI+='	"options" : '+JSON.stringify(s)+",\n"}aI+='	"keys" : [\n';for(var aK in J){var aN=J[aK];aI+='	{"addr" : "'+aN.addr+'"';if(aN.priv!=null){aI+=',\n	 "priv" : "'+aL(aN.priv,aN.addr)+'"'}if(aN.tag==2){aI+=',\n	 "tag" : '+aN.tag}if(aN.label!=null){aI+=',\n	 "label" : "'+aN.label+'"'}aI+="},\n";atLeastOne=true}if(atLeastOne){aI=aI.substring(0,aI.length-2)}aI+="\n	]";if(av(g)>0){aI+=',\n	"address_book" : [\n';for(var aK in g){aI+='	{"addr" : "'+aK+'",\n';aI+='	 "label" : "'+g[aK]+'"},\n'}aI=aI.substring(0,aI.length-2);aI+="\n	]"}if(av(b)>0){aI+=',\n	"tx_notes" : '+JSON.stringify(b)}aI+="\n}";return aI};this.get_history=function(aJ,aI){BlockchainAPI.get_history(function(aK){I(aK,false);c();if(aJ){aJ()}},function(){if(aI){aI()}},ak,an)};this.deleteAddressBook=function(aI){delete g[aI];ae();$("#send-coins").find(".tab-pane").trigger("show",true)};function u(aI){$("#send-coins").find(".tab-pane.active").trigger("show",aI);if(aI){BlockchainAPI.get_ticker();$(".send").attr("disabled",false)}}function l(aI,aJ,aN){var aM=aI.val();aI.empty();for(var aL in J){var aO=J[aL];if(!aO||aO.tag==2){continue}var aK=aO.label;if(!aK){aK=aO.addr.substring(0,15)+"..."}if(aJ||aO.balance>0){aI.prepend('<option value="'+aO.addr+'">'+aK+" - "+formatBTC(aO.balance)+" BTC</option>")}}aI.prepend('<option value="any" selected>Any Address</option>');if(!aN&&aM){aI.val(aM)}}function r(aK,aL){l(aK.find('select[name="from"]'),false,aL);l(aK.find('select[name="change"]'),true,aL);aK.find('select[name="change"]').prepend('<option value="new">New Address</option>');if(aL){aK.find("input").val("");aK.find(".send-value-usd").text(formatSymbol(0,symbol_local)).val("");aK.find(".amount-needed").text(0)}var aJ=aK.find(".recipient-container");if(aL){var aN=aJ.find(".recipient:first-child").clone();aJ.empty().append(aN)}function aI(){var aO=0;aK.find('input[name="send-value"]').each(function(){var aP=parseFloat($(this).val());if(!isNaN(aP)){aO+=aP}});return aO}function aM(aO){aO.find('input[name="send-to-address"]').val("").typeahead({source:ar()});aO.find(".local-symbol").text(symbol_local.symbol);aO.find('input[name="send-value"]').val("").bind("keyup change",function(aP){if(aP.keyCode=="9"){return}aK.find(".amount-needed").text(formatBTC(Bitcoin.Util.parseValue(aI().toFixed(8)).toString()));aO.find(".send-value-usd").val(convert($(this).val()*100000000,symbol_local.conversion)).text(formatSymbol($(this).val()*100000000,symbol_local))});aO.find(".send-value-usd").val("").text(formatSymbol(0,symbol_local)).bind("keyup change",function(aP){if(aP.keyCode=="9"){return}aO.find('input[name="send-value"]').val(formatBTC(parseFloat($(this).val())*symbol_local.conversion))})}aJ.find(".recipient").each(function(){aM($(this))});aK.find(".remove-recipient").unbind().click(function(){var aO=aJ.find(".recipient").length;if(aO>1){if(aO==2){$(this).hide(200)}aJ.find(".recipient:last-child").remove()}});aK.find(".add-recipient").unbind().click(function(){var aO=aJ.find(".recipient:first-child").clone();aO.appendTo(aJ);aM(aO);aK.find(".remove-recipient").show(200)})}this.getAllAddresses=function(){var aJ=[];for(var aI in J){aJ.push(aI)}return aJ};this.getPreferredAddress=function(){var aJ=null;for(var aI in J){var aK=J[aI];if(aJ==null){aJ=aK}if(aK.priv!=null){if(aJ==null){aJ=aK}if(aK.tag==null||aK.tag==0){aJ=aK;break}}}return aJ.addr};function V(aI){var aL=[];for(var aJ in J){var aK=J[aJ];if(aK.tag==aI){aL.push(aK.addr)}}return aL}this.getActiveAddresses=function(){return V()};this.getArchivedAddresses=function(){return V(2)};function ao(aL){if(aL!=null){ax=aL;for(var aJ in F){var aI=F[aJ];if(aI.blockHeight!=null&&aI.blockHeight>0){var aK=ax.height-aI.blockHeight+1;if(aK<=100){aI.setConfirmations(ax.height-aI.blockHeight+1)}else{aI.setConfirmations(null)}}else{aI.setConfirmations(0)}}}}function A(aJ,aI){loadScript("wallet/frame-modal.js",function(){showFrameModal({title:"Transaction Summary",description:"",src:root+"tx-summary/"+aJ+"?result="+aI+"&guid="+N})})}this.deleteNote=function(aI){delete b[aI];c();ae()};function m(aI,aJ){(function(aL,aN){aL=$(aL);if(!aL.data("popover")){aL.popover({title:'Add Note <span style="float:right"><i class="icon-remove-sign"></i></span>',trigger:"manual",content:'<textarea style="width:97%;height:50px;margin-top:2px" placeholder="Enter the note here..."></textarea><div style="text-align:right"><button class="btn btn-small">Save</button></div>'})}else{if(aL.data("popover").tip().is(":visible")){return}}aL.popover("show");aL.mouseleave(function(){if(!aL.__timeout){aL.__timeout=setTimeout(function(){aL.popover("hide")},250)}});function aK(){if(aL.__timeout){clearTimeout(aL.__timeout);aL.__timeout=null}}var aM=aL.data("popover").tip().mouseenter(aK);aM.find("textarea").focus(aK);aM.mouseleave(function(){aL.__timeout=setTimeout(function(){aL.popover("hide")},250)});aM.find("i").unbind().click(function(){aL.popover("hide")});aM.find("button").click(function(){var aO=$.trim($("<div>"+aM.find("textarea").val()+"</div>").text().replace(/'/g,"").replace(/"/g,""));if(aO.length>0){b[aN]=aO;ae()}c()})})(aI,aJ)}function aB(aI,aJ,aK){(function(aL,aM,aO){aL=$(aL);if(!aL.data("popover")){var aP="Note";if(b[aO]){aP+=' <span style="float:right"><img src="'+resource+'delete.png" /></span>'}$(aL).popover({title:aP,trigger:"manual",content:aM})}else{if(aL.data("popover").tip().is(":visible")){return}}aL.popover("show");aL.mouseleave(function(){if(!aL.__timeout){aL.__timeout=setTimeout(function(){aL.popover("hide")},250)}});var aN=aL.data("popover").tip().mouseenter(function(){if(aL.__timeout){clearTimeout(aL.__timeout);aL.__timeout=null}});aN.find("img").unbind().click(function(){h.deleteNote(aO)});aN.mouseleave(function(){aL.__timeout=setTimeout(function(){aL.popover("hide")},250)})})(aI,aJ,aK)}function D(aL,aQ,aN){var aR=aL.result;var aM='<tr class="pointer" id="tx-'+aL.txIndex+'"><td class="hidden-phone" style="width:365px"><div><ul style="margin-left:0px;" class="short-addr">';var aJ=true;if(aR>=0){for(var aK=0;aK<aL.inputs.length;++aK){var aI=aL.inputs[aK].prev_out;if(!aI||!aI.addr){aJ=false;aM+='<span class="label">Newly Generated Coins</span>'}else{var aO=aQ[aI.addr];if(aO){continue}aJ=false;aM+=formatOutput(aI,aQ,aN)}}}else{if(aR<0){for(var aK=0;aK<aL.out.length;++aK){var aI=aL.out[aK];var aO=aQ[aI.addr];if(aO&&aI.type==0){continue}aJ=false;aM+=formatOutput(aI,aQ,aN)}}}if(aJ){aM+='<span class="label">Moved Between Wallet</info>'}aM+="</ul></div></td><td><div>";var aP=aL.note?aL.note:b[aL.hash];if(aP){aM+='<img src="'+resource+'note.png" class="show-note"> '}else{aM+='<img src="'+resource+'note_grey.png" class="add-note"> '}if(aL.time>0){aM+=dateToString(new Date(aL.time*1000))}if(aL.confirmations==0){aM+=' <span class="label label-important pull-right hidden-phone">Unconfirmed Transaction!</span> '}else{if(aL.confirmations>0){aM+=' <span class="label label-info pull-right hidden-phone">'+aL.confirmations+" Confirmations</span> "}}aM+="</div></td>";if(aR>0){aM+='<td style="color:green"><div>'+formatMoney(aR,true)+"</div></td>"}else{if(aR<0){aM+='<td style="color:red"><div>'+formatMoney(aR,true)+"</div></td>"}else{aM+="<td><div>"+formatMoney(aR,true)+"</div></td>"}}if(aL.balance==null){aM+="<td></td></tr>"}else{aM+='<td class="hidden-phone"><div>'+formatMoney(aL.balance)+"</div></td></tr>"}return aM}function U(){M();if(ap==null){$("#balance").html("Loading...")}else{$("#balance").html(formatSymbol(ap,symbol));$("#balance2").html(formatSymbol(ap,(symbol==symbol_local)?symbol_btc:symbol_local))}return j.attr("id")}function c(aI){var aJ=U();if("send-coins"==aJ){u(aI)}else{if("home-intro"==aJ){f(aI)}else{if("receive-coins"==aJ){aH(aI)}else{if("my-transactions"==aJ){W(aI)}}}}}function f(aI){$("#summary-n-tx").html(L);$("#summary-received").html(formatMoney(al,true));$("#summary-sent").html(formatMoney(Q,true));$("#summary-balance").html(formatMoney(ap,symbol));var aK=h.getPreferredAddress();$("#tweet-for-btc").unbind().click(function(){window.open("https://twitter.com/share?url=https://blockchain.info/wallet&hashtags=tweet4btc,bitcoin,"+aK+"&text=Sign Up For a Free Bitcoin Wallet @ Blockchain.info","","toolbar=0, status=0, width=650, height=360")});if(h.isWatchOnly(aK)==null){$(".no-watch-only").hide()}else{$(".no-watch-only").show();var aJ=$("#my-primary-address");if(aJ.text()!=aK){aJ.text(aK);$("#my-primary-addres-qr-code").html('<img style="padding-right:10px;padding-bottom:10px" src="'+root+"qr?data="+aK+'&size=125">')}}}function R(){var aI=$("#export-warning").show();var aJ=$("#import-export-content").hide();$("#show-import-export").unbind().click(function(){h.getMainPassword(function(){aI.hide();loadScript("wallet/import-export.min.js",function(){ImportExport.init(aJ,function(){aJ.show()},function(){ab($("#home-intro"))})},function(aK){h.makeNotice("error","misc-error",aK);ab($("#home-intro"))})},function(){ab($("#home-intro"))})})}function W(){var aJ=null;var aL=0;if(aJ!=null){clearInterval(aJ);aJ=null}var aI;if(s.tx_display==0){$("#transactions-detailed").hide();aI=$("#transactions-compact").show().find("tbody").empty()}else{$("#transactions-compact").hide();aI=$("#transactions-detailed").empty().show()}if(F.length==0){$("#transactions-detailed, #transactions-compact").hide();$("#no-transactions").show();return}else{$("#no-transactions").hide()}var aK=function(){for(var aP=aL;aP<F.length&&aP<(aL+10);++aP){var aO=F[aP];if(s.tx_display==0){aI.append(aE($(D(aO,J,g)),aO))}else{aI.append(aO.getHTML(J,g))}}aL+=10;if(aL<F.length){aJ=setTimeout(aK,15)}else{setupSymbolToggle();M();var aN=$(".pagination ul").empty();if(an==0&&F.length<50){aN.hide();return}else{aN.show()}var aM=Math.ceil(aG/50);var aQ=" disabled";if(an>0){aQ=""}aN.append($('<li class="prev'+aQ+'"><a>&larr; Previous</a></li>').click(function(){h.setPage(an-1)}));for(var aP=0;aP<aM&&aP<=10;++aP){(function(aR){var aS="";if(an==aR){aS=' class="active"'}aN.append($("<li"+aS+'><a class="hidden-phone">'+aR+"</a></li>").click(function(){h.setPage(aR)}))})(aP)}var aQ=" disabled";if(an<aM){aQ=""}aN.append($('<li class="next'+aQ+'"><a>Next &rarr;</a></li>').click(function(){h.setPage(an+1)}))}};aK()}this.setPage=function(aI){an=aI;scroll(0,0);h.get_history()};function v(){loadScript("wallet/frame-modal.js",function(){showFrameModal({title:"Export History",description:"",src:root+"export-history?active="+h.getActiveAddresses().join("|")+"&archived="+h.getArchivedAddresses().join("|")})})}function I(aM,aK){if(!aK&&aM.mixer_fee){x=aM.mixer_fee}F.length=0;if(aM.wallet==null){al=0;Q=0;ap=0;L=0;aG=0;return}al=aM.wallet.total_received;Q=aM.wallet.total_sent;ap=aM.wallet.final_balance;L=aM.wallet.n_tx;aG=aM.wallet.n_tx_filtered;for(var aJ=0;aJ<aM.addresses.length;++aJ){if(J[aM.addresses[aJ].address]){J[aM.addresses[aJ].address].balance=aM.addresses[aJ].final_balance}}for(var aJ=0;aJ<aM.txs.length;++aJ){var aI=TransactionFromJSON(aM.txs[aJ]);aI.result=t(aI,false);F.push(aI)}if(aM.info){$("#nodes-connected").html(aM.info.nconnected);if(aM.info.latest_block!=null){ao(aM.info.latest_block)}var aL=aM.info.symbol_local;if(symbol==symbol_local){symbol_local=aL;symbol=aL;calcMoney()}else{if(!aK){symbol_local=aL}}}}function aC(){S=setTimeout(h.logout,h.getLogoutTime());for(var aK in X){X[aK]("did_decrypt")}window.location.hash="";try{var aI=localStorage.getItem("guid");if(aI!=N){localStorage.clear();if(N!=E){localStorage.setItem("guid",N)}}else{var aJ=localStorage.getItem("multiaddr");if(aJ!=null){I($.parseJSON(aJ),true);c()}}}catch(aL){}h.get_history();ab($("#home-intro"));$("#initial_error,#initial_success").remove()}function K(){for(var aI in J){var aK=J[aI];if(aK.tag==1){alert("Warning! wallet data may have changed but cannot sync as you have uns-saved keys");return}}console.log("Get wallet with checksum "+aq);var aJ={guid:N,sharedKey:d,format:"plain"};if(aq&&aq.length>0){aJ.checksum=aq}$.get(root+"wallet/wallet.aes.json",aJ).success(function(aL){if(aL==null||aL.length==0){return}if(aL=="Not modified"){console.log("Not modified");return}else{console.log("Wallet data modified");ad=aL;if(Y()){aq=ac();h.get_history();c()}else{window.location.reload()}}})}function Y(){try{if(ad==null||ad.length==0){h.makeNotice("error","misc-error","No Wallet Data To Decrypt");return false}var aL=null;h.decrypt(ad,az,function(aM){try{aL=$.parseJSON(aM);return(aL!=null)}catch(aN){return false}});if(aL==null){throw"Error Decrypting Wallet. Please check your password is correct."}if(aL.double_encryption&&aL.dpasswordhash){G=aL.double_encryption;w=aL.dpasswordhash}if(aL.options){$.extend(s,aL.options)}else{if(aL.fee_policy){h.setFeePolicy(aL.fee_policy)}if(aL.html5_notifications){h.setHTML5Notifications(aL.html5_notifications)}}J={};for(var aJ=0;aJ<aL.keys.length;++aJ){var aI=aL.keys[aJ];if(aI.addr==null||aI.addr.length==0||aI.addr=="undefined"){h.makeNotice("error","null-error","Your wallet contains an undefined address. This is a sign of possible corruption, please double check all your BTC is accounted for. Backup your wallet to remove this error.",15000);continue}J[aI.addr]=aI}g={};if(aL.address_book){for(var aJ=0;aJ<aL.address_book.length;++aJ){h.addAddressBookEntry(aL.address_book[aJ].addr,aL.address_book[aJ].label)}}if(aL.tx_notes){b=aL.tx_notes}d=aL.sharedKey;if(d==null||d.length==0||d.length!=36){throw"Shared Key is invalid"}if(aq==null||aq.length==0){aq=ac()}K();e();return true}catch(aK){h.makeNotice("error","misc-error",aK)}return false}this.getPassword=function(aN,aO,aL){aN.modal({keyboard:false,backdrop:"static",show:true});aN.center();var aK=aN.find('input[name="password"]');var aJ=aK,aI=false,aM=false;aN.find(".vkeyboard li").click(function(){var aR=$(this),aQ=aR.html();if(aR.hasClass("left-shift")||aR.hasClass("right-shift")){$(".letter").toggleClass("uppercase");$(".symbol span").toggle();aI=(aI===true)?false:true;aM=false;return false}if(aR.hasClass("capslock")){$(".letter").toggleClass("uppercase");aM=true;return false}if(aR.hasClass("delete")){var aP=aJ.val();aJ.val(aP.substr(0,aP.length-1));return false}if(aR.hasClass("symbol")){aQ=$("span:visible",aR).html()}if(aR.hasClass("space")){aQ=" "}if(aR.hasClass("tab")){aQ="\t"}if(aR.hasClass("return")){aQ="\n"}if(aR.hasClass("uppercase")){aQ=aQ.toUpperCase()}if(aI===true){$(".symbol span").toggle();if(aM===false){$(".letter").toggleClass("uppercase")}aI=false}aJ.val(aJ.val()+aQ)});aK.unbind().keypress(function(aP){if(aP.keyCode==13){aP.preventDefault();aN.find(".btn.btn-primary").click()}});aK.val("");aN.find(".btn.btn-primary").unbind().click(function(){if(aO){aL=null;var aP=aO;aO=null;aN.modal("hide");setTimeout(function(){aP(aK.val())},100)}});aN.find(".btn.btn-secondary").unbind().click(function(){if(aL){var aP=aL;aL=null;setTimeout(function(){try{aP()}catch(aQ){h.makeNotice("error","misc-error",aQ)}},100)}aN.modal("hide")});aN.unbind().on("hidden",function(){if(aL){var aP=aL;aL=null;setTimeout(function(){try{aP()}catch(aQ){h.makeNotice("error","misc-error",aQ)}},100)}})};this.makePairingQRCode=function(aI){h.getMainPassword(function(){loadScript("wallet/qr.code.creator.js",function(){try{var aJ=makeQRCode(300,300,1,N+"|"+d+"|"+az);aI(aJ)}catch(aK){h.makeNotice("error","misc-error",aK)}})},function(){h.logout()})};this.getMainPassword=function(aJ,aI){if(C>new Date().getTime()-O){return aJ(az)}h.getPassword($("#main-password-modal"),function(aK){if(az==aK){C=new Date().getTime();if(aJ){try{aJ(az)}catch(aL){h.makeNotice("error","misc-error",aL)}}}else{h.makeNotice("error","misc-error","Password incorrect.");if(aI){try{aI()}catch(aL){h.makeNotice("error","misc-error",aL)}}}},aI)};this.getSecondPassword=function(aK,aI){if(!G||ag!=null){if(aK){try{aK(ag)}catch(aJ){h.makeNotice("error","misc-error",aJ)}}return}h.getPassword($("#second-password-modal"),function(aL){if(aA(aL)){if(aK){try{aK(aL)}catch(aM){h.makeNotice("error","misc-error",aM)}}}else{h.makeNotice("error","misc-error","Password incorrect.");if(aI){try{aI()}catch(aM){h.makeNotice("error","misc-error",aM)}}}},aI)};function a(){if(B){console.log("Already initd");return}var aI=$("#restore-password");az=aI.val();aI.val("");C=new Date().getTime();if(ad==null||ad.length==0){h.setLoadingText("Validating Authentication key");var aJ=$.trim($(".auth-"+q).find(".code").val());if(aJ.length==0||aJ.length>255){h.makeNotice("error","misc-error","You must enter a Two Factor Authentication code");return false}$.post(root+"wallet",{guid:N,payload:aJ,length:aJ.length,method:"get-wallet",format:"plain"},function(aK){try{if(aK==null||aK.length==0){h.makeNotice("error","misc-error","Server Return Empty Wallet Data");return}ad=aK;aq=ac();$(".auth-"+q).hide();$(".auth-0").show();if(Y()){n();aC()}}catch(aL){h.makeNotice("error","misc-error",aL)}}).error(function(aK){h.makeNotice("error","misc-error",aK.responseText)})}else{if(Y()){n();aC()}}return true}function e(){webSocketConnect(z);B=true;$("#tech-faq").hide();$("#intro-text").hide();$("#large-summary").show();$("#status-container").show()}this.quickSendNoUI=function(aK,aJ,aI){loadScript("wallet/signer.min.js",function(){h.getSecondPassword(function(){try{var aM=initNewTx();aM.from_addresses=h.getActiveAddresses();aM.to_addresses.push({address:new Bitcoin.Address(aK),value:Bitcoin.Util.parseValue(aJ)});aM.addListener(aI);aM.start()}catch(aL){aI.on_error(aL)}},function(aL){aI.on_error(aL)})})};function H(){h.setLoadingText("Sending email backup");$.post(root+"wallet",{guid:N,sharedKey:d,method:"email-backup",format:"plain"},function(aI){h.makeNotice("success","backup-success",aI)}).error(function(aI){h.makeNotice("error","misc-error",aI.responseText)})}this.updateCacheManifest=function(aI){try{var aJ=window.applicationCache;console.log("Clear Cache Manifest");aJ.addEventListener("updateready",function(aL){aJ.swapCache();if(aI){aI()}},false);aJ.addEventListener("noupdate",function(aL){if(aI){aI()}},false);aJ.addEventListener("error",function(aL){if(aI){aI()}},false);aJ.update()}catch(aK){console.log(aK);if(aI){aI()}}};function ae(aL,aK,aJ,aI){if(ai!=null){clearInterval(ai);ai=null}ai=setTimeout(function(){h.backupWallet(aL,aK,aJ,aI)},3000)}this.backupWallet=function(aP,aO,aI){try{if(aP==null){aP="update"}if(av(J)==0){return}var aK=h.makeWalletJSON();var aN=h.encrypt(aK,az);if(aN.length==0){throw"Error encrypting the JSON output"}var aM=null;h.decrypt(aN,az,function(aQ){try{aM=$.parseJSON(aQ);return(aM!=null)}catch(aR){return false}});if(aM==null){throw"Error Decrypting Previously encrypted JSON. Not Saving Wallet."}var aJ=Crypto.util.bytesToHex(Crypto.SHA256(aN,{asBytes:true}));h.setLoadingText("Saving wallet");ad=aN;$.ajax({type:"POST",url:root+"wallet",data:{guid:N,length:aN.length,payload:aN,sharedKey:d,checksum:aJ,old_checksum:aq,method:aP},converters:{"* text":window.String,"text html":true,"text json":window.String,"text xml":window.String},success:function(aR){var aT=false;for(var aQ in J){var aS=J[aQ];if(aS.tag==1){aS.tag=null;aT=true}}aq=aJ;h.makeNotice("success","misc-success",aR);c();if(aO!=null){aO()}h.updateCacheManifest()},error:function(aQ){h.makeNotice("error","misc-error",aQ.responseText,10000);c();if(errorcallback!=null){errorcallback()}}})}catch(aL){h.makeNotice("error","misc-error","Error Saving Wallet: "+aL,10000);c();if(errorcallback!=null){errorcallback(aL)}else{throw aL}}};function aD(aI){if(G){if(ag==null){throw"Cannot encrypt private key without a password"}return h.encrypt(aI,d+ag)}else{return aI}return null}this.isBase58=function(aK,aJ){for(var aI=0;aI<aK.length;++aI){if(aK[aI]<0||aK[aI]>58){return false}}return true};this.encrypt=function(aJ,aI){return Crypto.AES.encrypt(aJ,aI,{mode:new Crypto.mode.CBC(Crypto.pad.iso10126),iterations:T})};this.decrypt=function(aL,aK,aN,aJ){try{var aI=Crypto.AES.decrypt(aL,aK,{mode:new Crypto.mode.CBC(Crypto.pad.iso10126),iterations:T});if(aI!=null&&aI.length>0){if(aN(aI)){return aI}}}catch(aM){console.log(aM)}try{var aI=Crypto.AES.decrypt(aL,aK,{mode:new Crypto.mode.OFB(Crypto.pad.iso7816),iterations:1});if(aI!=null&&aI.length>0){if(aN(aI)){return aI}}}catch(aM){console.log(aM)}try{var aI=Crypto.AES.decrypt(aL,aK,{mode:new Crypto.mode.CBC(Crypto.pad.iso10126),iterations:1});if(aI!=null&&aI.length>0){if(aN(aI)){return aI}}}catch(aM){console.log(aM)}if(aJ!=null){aJ()}return null};this.setGUID=function(aJ,aI){if(B){throw"Cannot Set GUID Once Initialized"}h.setLoadingText("Changing Wallet Identifier");$("#initial_error,#initial_success").remove();$.getJSON(root+"wallet/"+aJ,{format:"json",resend_code:aI}).success(function(aM){$(".auth-"+q).hide();N=aM.guid;q=aM.auth_type;aq=aM.payload_checksum;ad=aM.payload;war_checksum=aM.war_checksum;symbol_local=aM.symbol_local;$("#restore-guid").val(N);$(".auth-"+q).show();if(aM.initial_error){h.makeNotice("error","misc-error",aM.initial_error)}if(aM.initial_success){h.makeNotice("success","misc-success",aM.initial_success)}try{var aK=localStorage.getItem("guid");if(aK!=N){localStorage.clear();if(N!=E){localStorage.setItem("guid",N)}}}catch(aL){}}).error(function(aL){console.log(aL);try{var aK=$.parseJSON(aL.responseText);if(aK.initial_error){h.makeNotice("error","misc-error",aK.initial_error);return}}catch(aL){}h.makeNotice("error","misc-error","Error changing wallet identifier")})};function i(aI){var aJ=B58.encode(aI);return aD(aJ)}this.decryptPK=function(aI){if(G){if(ag==null){throw"Cannot decrypt private key without a password"}return h.decrypt(aI,d+ag,h.isBase58)}else{return aI}return null};this.decodePK=function(aJ){var aI=h.decryptPK(aJ);if(aI!=null){return B58.decode(aI)}return null};this.signmessage=function(aI,aK){var aM=J[aI];var aL=h.decodePK(aM.priv);var aJ=new Bitcoin.ECKey(aL);return Bitcoin.Message.signMessage(aJ,aK,aM.addr)};function aA(aJ){var aI=Crypto.SHA256(d+aJ,{asBytes:true});var aL=aI;for(var aK=1;aK<T;++aK){aL=Crypto.SHA256(aL,{asBytes:true})}var aN=Crypto.util.bytesToHex(aL);if(aN==w){ag=aJ;return true}if(Crypto.util.bytesToHex(aI)==w){ag=aJ;w=aN;return true}var aM=Crypto.SHA256(aJ);if(aM==w){ag=aJ;w=aN;return true}return false}this.checkAllKeys=function(aI){for(var aJ in J){var aN=J[aJ];if(aN.addr==null){throw"Null Address Found in wallet "+aJ}if(aN.addr.toString()==null){throw"Error decoding wallet address "+aN.addr}if(aN.priv!=null){var aM=h.decodePK(aN.priv);var aL=new Bitcoin.ECKey(aM);var aK=aL.getBitcoinAddress().toString();if(aK!=aN.addr&&aL.getBitcoinAddressCompressed().toString()!=aN.addr){throw"Private key does not match bitcoin address "+aN.addr+" != "+aK}if(aI){aN.priv=i(aM)}}}h.makeNotice("success","wallet-success","Wallet verified.")};this.setMainPassword=function(aI){h.getMainPassword(function(){az=aI;h.backupWallet("update",function(){h.updateCacheManifest(function(){h.logout()})},function(){h.logout()})})};function ab(aI){if(aI===j){return}if(j!=null){if($("#"+j.attr("id")+"-btn").length>0){$("#"+j.attr("id")+"-btn").parent().attr("class","")}j.hide()}j=aI;j.show();if($("#"+j.attr("id")+"-btn").length>0){$("#"+j.attr("id")+"-btn").parent().attr("class","active")}c(true)}function av(aK){var aJ=0,aI;for(aI in aK){aJ++}return aJ}function aa(aI){J[aI].priv=null}function af(){if(av(J)>=at){h.makeNotice("error","misc-error","We currently support a maximum of "+at+" private keys, please remove some unused ones.");return true}return false}function aF(aK,aI){var aJ=J[aK];if(!aJ||aJ.length==0){J[aK]={addr:aK,priv:aI,balance:0};return true}else{if(!aJ.priv&&aI){aJ.priv=aI;return true}}return false}function o(){var aK=$("#add-address-book-entry-modal");aK.modal({keyboard:true,backdrop:"static",show:true});var aI=aK.find('input[name="label"]');var aJ=aK.find('input[name="address"]');aI.val("");aJ.val("");aK.find(".btn.btn-primary").unbind().click(function(){aK.modal("hide");var aM=$.trim($("<div>"+aI.val()+"</div>").text());var aL=$.trim(aJ.val());if(aM.length==0){h.makeNotice("error","misc-error","You must enter a label for the address book entry");return false}if(aM.indexOf('"')!=-1){h.makeNotice("error","misc-error","Label cannot contain double quotes");return false}if(aL.length==0){h.makeNotice("error","misc-error","You must enter a bitcoin address for the address book entry");return false}var aO;try{aO=new Bitcoin.Address(aL);if(aO==null){throw"Null address"}}catch(aN){h.makeNotice("error","misc-error","Bitcoin address invalid, please make sure you entered it correctly");return false}if(g[aL]!=null){h.makeNotice("error","misc-error","Bitcoin address already exists");return false}h.makeNotice("success","misc-success","Added Address book entry");h.addAddressBookEntry(aL,aM);ae();$("#send-coins").find(".tab-pane").trigger("show",true)});aK.find(".btn.btn-secondary").unbind().click(function(){aK.modal("hide")})}this.logout=function(){$.get(root+"wallet/logout?format=plain").success(function(){window.location.reload()}).error(function(){window.location.reload()})};function aj(aO){var aQ=$("#delete-address-modal");aQ.modal({keyboard:true,backdrop:"static",show:true});aQ.find(".btn.btn-primary").hide();aQ.find(".btn.btn-danger").hide();$("#change-mind").hide();aQ.find("#to-delete-address").html(aO.join(" "));aQ.find("#delete-balance").empty();var aK=aQ.find("#delete-balance");var aI=[];for(var aN in aO){var aP=aO[aN];if(J[aP]&&J[aP].priv){aI.push(aO[aN])}}BlockchainAPI.get_balance(aI,function(aR){aQ.find(".btn.btn-primary").show(200);aQ.find(".btn.btn-danger").show(200);aK.html("Balance "+formatBTC(aR)+" BTC");if(aR>0){aK.css("color","red")}else{aK.css("color","black")}},function(){aQ.find(".btn.btn-primary").show(200);aQ.find(".btn.btn-danger").show(200);aK.text("Error Fetching Balance")});var aL=false;var aN=0;var aJ=null;var aM=10;changeMind=function(){$("#change-mind").show();$("#change-mind-time").text(aM-aN)};aQ.find(".btn.btn-primary").unbind().click(function(){changeMind();aQ.find(".btn.btn-primary").hide();aQ.find(".btn.btn-danger").hide();aJ=setInterval(function(){if(aL){return}++aN;changeMind();if(aN==aM){$("#delete-address-modal").modal("hide");h.makeNotice("warning","warning-deleted","Private Key Removed From Wallet");for(var aR in aO){aa(aO[aR])}c();h.backupWallet();clearInterval(aJ)}},1000)});aQ.find(".btn.btn-danger").unbind().click(function(){changeMind();aQ.find(".btn.btn-primary").hide();aQ.find(".btn.btn-danger").hide();aJ=setInterval(function(){if(aL){return}++aN;changeMind();if(aN==aM){try{$("#delete-address-modal").modal("hide");h.makeNotice("warning","warning-deleted","Address & Private Key Removed From Wallet");for(var aR in aO){h.deleteAddress(aO[aR])}c();h.backupWallet("update",function(){h.get_history()})}finally{clearInterval(aJ)}}},1000)});aQ.unbind().on("hidden",function(){if(aJ){aL=true;clearInterval(aJ);aJ=null}});aQ.find(".btn.btn-secondary").unbind().click(function(){aQ.modal("hide")})}function ar(){var aK=[];for(var aI in g){aK.push(g[aI])}for(var aI in J){var aJ=J[aI];if(aJ.tag!=2&&aJ.label){aK.push(aJ.label)}}return aK}function P(aI){h.getSecondPassword(function(){var aK=$("#sweep-address-modal");aK.modal("show");BlockchainAPI.get_balance(aI,function(aL){aK.find(".balance").text("Amount: "+formatBTC(aL)+" BTC")},function(){aK.find(".balance").text("Error Fetching Balance")});var aJ=aK.find('select[name="change"]');l(aJ,true);aK.find(".btn.btn-primary").unbind().click(function(){loadScript("wallet/signer.min.js",function(){BlockchainAPI.get_balance(aI,function(aL){var aM=initNewTx();aM.fee=aM.base_fee;aM.to_addresses.push({address:new Bitcoin.Address($.trim(aJ.val())),value:BigInteger.valueOf(aL).subtract(aM.fee)});aM.from_addresses=aI;aM.start()},function(){h.makeNotice("error","misc-error","Error Getting Address Balance")})});aK.modal("hide")});aK.find(".btn.btn-secondary").unbind().click(function(){aK.modal("hide")})})}function au(){try{$(".pop").popover({offset:10,placement:"bottom"})}catch(aI){}}function n(){$("#add-address-book-entry-btn").click(function(){o()});$("#home-intro-btn").click(function(){ab($("#home-intro"))});$("#my-transactions-btn").click(function(){ab($("#my-transactions"))});$("#send-coins-btn").click(function(){ab($("#send-coins"))});$("#import-export-btn").click(function(){ab($("#import-export"));R()});$("#chord-diagram").click(function(){window.open(root+"taint/"+h.getActiveAddresses().join("|"),null,"width=850,height=850")});$("#verify-message").click(function(){loadScript("wallet/address_modal.min.js",function(){verifyMessageModal()})});$("#group-received").click(function(){loadScript("wallet/taint_grouping.min.js",function(){try{loadTaintData()}catch(aI){h.makeNotice("error","misc-error","Unable To Load Taint Grouping Data")}})});$("#my-account-btn").click(function(){ab($("#my-account"));var aI=$("#account-settings-warning").show();var aJ=$("#my-account-content").hide();$("#show-account-settings").unbind().click(function(){h.getMainPassword(function(){aI.hide();loadScript("wallet/account.min.js",function(){AccountSettings.init(aJ,function(){aJ.show()},function(){ab($("#home-intro"))})},function(aK){h.makeNotice("error","misc-error",aK);ab($("#home-intro"))})},function(){ab($("#home-intro"))})})});$(".download-backup-btn").click(function(){window.open(root+"wallet/wallet.aes.json?guid="+N+"&sharedKey="+d)});$("#enable_archived_checkbox").change(function(){var aI=$(this).is(":checked");$(".archived_checkbox").attr("checked",false);$(".archived_checkbox").attr("disabled",!aI);$("#archived-sweep").attr("disabled",!aI);$("#archived-delete").attr("disabled",!aI)});$("#anonymous-addresses").on("show",function(){var aI=$(this);loadScript("wallet/anonymous-addresses.min.js",function(){buildAnonymousTable(aI)})});$("#active-addresses").on("show",function(){var aO=$(this).find("table:first");aO.find("tbody:gt(0)").remove();var aL=aO.find("tbody").empty();for(var aN in J){var aP=J[aN];if(aP.tag==2){continue}var aM="";if(aP.tag==1){aM=' <font color="red" class="pop" title="Not Synced" data-content="This is a new address which has not yet been synced with our the server. Do not used this address yet.">(Not Synced)</font>'}else{if(aP.priv==null){aM=' <font color="red" class="pop" title="Watch Only" data-content="Watch Only means there is no private key associated with this bitcoin address. <br /><br /> Unless you have the private key stored elsewhere you do not own the funds at this address and can only observe the transactions.">(Watch Only)</font>'}}var aI="";var aK=aP.addr;if(aP.label!=null){aK=aP.label;aI='<span class="hidden-phone"> - '+aP.addr+"</span>"}var aJ=$('<tr><td><div class="short-addr"><a href="'+root+"address/"+aP.addr+'" target="new">'+aK+"</a>"+aI+" "+aM+'<div></td><td><span style="color:green">'+formatMoney(aP.balance,true)+'</span></td>            <td><div class="btn-group pull-right"><a class="btn btn-mini dropdown-toggle" data-toggle="dropdown" href="#"><span class="hidden-phone">Actions </span><span class="caret"></span></a><ul class="dropdown-menu">             <li><a href="#" class="pop act-archive" title="Archive Address" data-content="Click this button to hide the address from the main view. You can restore or delete later by finding it in the Archived addresses tab.">Archive Address</a></li>            <li><a href="#" class="pop act-label" title="Label Address" data-content="Set the label for this address.">Label Address</a></li>            <li><a href="#" class="pop act-qr" title="Show QR Code" data-content="Show a QR Code for this address.">QR Code</a></li>            <li><a href="#" class="pop act-sign" title="Sign Message" data-content="Sign A message with this address.">Sign Message</a></li>            <li><a href="#" class="pop act-request" title="Request Payment" data-content="Click here to create a new QR Code payment request. The QR Code can be scanned using most popular bitcoin software and mobile apps.">Create Payment Request</a></li>            </ul></div></td></tr>');(function(aQ){aJ.find(".act-archive").click(function(){h.archiveAddr(aQ)});aJ.find(".act-label").click(function(){loadScript("wallet/address_modal.min.js",function(){showLabelAddressModal(aQ)})});aJ.find(".act-qr").click(function(){loadScript("wallet/address_modal.min.js",function(){showAddressModalQRCode(aQ)})});aJ.find(".act-sign").click(function(){loadScript("wallet/address_modal.min.js",function(){showAddressModalSignMessage(aQ)})});aJ.find(".act-request").click(function(){loadScript("wallet/frame-modal.js",function(){showFrameModal({title:"Create Payment Request",description:"Request Payment into address <b>"+aQ+"</b>",src:root+"payment_request?address="+aQ})})})})(aP.addr);if(aP.balance>0&&aP.priv){aO.prepend(aJ)}else{aO.append(aJ)}}au()});$("#archived-addresses").on("show",function(){$("#enable_archived_checkbox").attr("checked",false);$("#archived-delete").attr("disabled",true);$("#archived-sweep").attr("disabled",true);$("#archived-addr tbody").empty();var aJ=$(this).find("tbody");var aI=h.getArchivedAddresses();var aK=function(){aJ.empty();for(var aO in aI){var aQ=J[aI[aO]];if(aQ.tag!=2){continue}var aN="";if(aQ.priv==null){aN=' <font color="red">(Watch Only)</font>'}var aL="";var aM=aQ.addr;if(aQ.label!=null){aM=aQ.label;aL='<span class="hidden-phone"> - '+aQ.addr+"</span>"}var aP=$('<tr><td style="width:20px;"><input type="checkbox" class="archived_checkbox" value="'+aQ.addr+'" disabled></td><td><div class="short-addr"><a href="'+root+"address/"+aQ.addr+'" target="new">'+aM+"</a>"+aL+" "+aN+'<div></td><td><span style="color:green">'+formatBTC(aQ.balance)+'<span class="hidden-phone"> BTC</span></span></td><td style="width:16px"><img src="'+resource+'unarchive.png" class="act-unarchive" /></td></tr>');(function(aR){aP.find(".act-unarchive").click(function(){h.unArchiveAddr(aR)})})(aQ.addr);if(aQ.balance>0&&aQ.priv){aJ.prepend(aP)}else{aJ.append(aP)}}};aK();BlockchainAPI.get_balances(aI,function(aL){aK()},function(aL){h.makeNotice("error","misc-error",aL)})});$("#archived-sweep").click(function(){var aI=[];$(".archived_checkbox:checked").each(function(){var aJ=J[$(this).val()];if(aJ.priv==null){h.makeNotice("error","misc-error","Cannot Sweep Watch Only Address");return}aI.push(aJ.addr)});if(aI.length==0){return}P(aI)});$("#archived-delete").click(function(){var aI=[];$(".archived_checkbox:checked").each(function(){aI.push($(this).val())});if(aI.length==0){return}aj(aI)});$("#anonymous-never-ask").click(function(){SetCookie("anonymous-never-ask",$(this).is(":checked"))});$(".deposit-btn").click(function(){var aJ=$(this);var aI=h.getPreferredAddress();loadScript("wallet/frame-modal.js",function(){showFrameModal({title:aJ.data("title"),description:"Deposit into address <b>"+aI+"</b>",top_right:'Have Questions? Read <a href="'+aJ.data("link")+'" target="new">How It Works</a>',src:root+"deposit?address="+aI+"&ptype="+aJ.data("type")+"&guid="+N+"&sharedKey="+d})})});$(".withdraw-btn").click(function(){var aI=$(this);h.getSecondPassword(function(){var aJ=h.getPreferredAddress();loadScript("wallet/frame-modal.js",function(){showFrameModal({title:aI.data("title"),description:"Your Wallet Balance is <b>"+formatBTC(ap)+" BTC</b>",src:root+"withdraw?method="+aI.data("type")+"&address="+aJ+"&balance="+ap+"&guid="+N+"&sharedKey="+d})})})});$("#logout").click(h.logout);$("#refresh").click(function(){K();h.get_history()});$("#summary-n-tx-chart").click(function(){window.open(root+"charts/n-transactions?show_header=false&address="+h.getActiveAddresses().join("|"),null,"scroll=0,status=0,location=0,toolbar=0,width=1000,height=700")});$("#summary-received-chart").click(function(){window.open(root+"charts/received-per-day?show_header=false&address="+h.getActiveAddresses().join("|"),null,"scroll=0,status=0,location=0,toolbar=0,width=1000,height=700")});$("#summary-balance-chart").click(function(){window.open(root+"charts/balance?show_header=false&address="+h.getActiveAddresses().join("|"),null,"scroll=0,status=0,location=0,toolbar=0,width=1000,height=700")});$("#new-addr").click(function(){try{h.getSecondPassword(function(){var aJ=h.generateNewKey().getBitcoinAddress().toString();h.makeNotice("info","new-address","Generated new Bitcoin Address "+aJ);loadScript("wallet/address_modal.min.js",function(){showLabelAddressModal(aJ)});h.backupWallet()})}catch(aI){h.makeNotice("error","misc-error",aI)}});$(".tx_filter a").click(function(){an=0;ak=$(this).data("value");h.get_history()});$(".tx_display a").click(function(){var aI=$(this).data("value");if(aI=="export"){v();return}s.tx_display=aI;c();ae()});$("#email-backup-btn").click(function(){H()});$("#dropbox-backup-btn").click(function(){window.open(root+"wallet/dropbox-login?guid="+N+"&sharedKey="+d)});$("#gdrive-backup-btn").click(function(){window.open(root+"wallet/gdrive-login?guid="+N+"&sharedKey="+d)});$("#large-summary").click(function(){toggleSymbol();c()});$("#send-quick").on("show",function(aK,aJ){var aI=$(this);r(aI,aJ);aI.find(".send").unbind().click(function(){loadScript("wallet/signer.min.js",function(){startTxUI(aI,"quick",initNewTx())})})});$("#send-email").on("show",function(aK,aJ){var aI=$(this);r(aI,aJ);aI.find(".send").unbind().click(function(){loadScript("wallet/signer.min.js",function(){startTxUI(aI,"email",initNewTx())})})});$("#send-anonymous").on("show",function(aK,aJ){var aI=$(this);r(aI,aJ);aI.find(".mixer_fee").text(x);aI.find(".fees,.free,.bonus").show();if(x<0){aI.find(".fees,.free").hide()}else{if(x==0){aI.find(".fees,.bonus").hide()}else{aI.find(".free,.bonus").hide()}}aI.find(".send").unbind().click(function(){loadScript("wallet/signer.min.js",function(){startTxUI(aI,"anonymous",initNewTx())})});aI.find(".anonymous-fees").text("0.00");aI.find('input[name="send-before-fees"]').unbind().bind("keyup change",function(){var aM=parseFloat($.trim($(this).val()));var aL=0;if(aM>0){if(x>0){aL=parseFloat(aM+((aM/100)*x))}else{aL=parseFloat(aM);aI.find(".bonus-value").text(-(Math.min($(this).val(),200)/100)*x)}}if(aM<0.5){aI.find(".anonymous-fees").text("0.00")}else{aI.find(".anonymous-fees").text(aL.toFixed(4))}aI.find('input[name="send-value"]').val(aL).trigger("keyup")})});$("#send-custom").on("show",function(aK,aJ){var aI=$(this);r(aI,aJ);aI.find(".send").unbind().click(function(){loadScript("wallet/signer.min.js",function(){startTxUI(aI,"custom",initNewTx())})});aI.find('select[name="from"]').unbind().change(function(){var aN=0;var aL=$(this).val();for(var aM in aL){if(aL[aM]=="any"){$(this).val("any");aN=ap;break}else{var aO=J[aL[aM]];if(aO&&aO.balance){aN+=aO.balance}}}aI.find(".amount-available").text(formatBTC(aN))}).trigger("change");aI.find(".reset").unbind().click(function(){r(aI,true);aI.find('select[name="from"]').trigger("change")})});$("#send-satoshi-dice,#send-btcdice-dice").on("show",function(aK,aJ){var aI=this;loadScript("wallet/dicegames.min.js",function(){try{DICEGame.init($(aI))}catch(aL){h.makeNotice("error","misc-error","Unable To Load Dice Bets")}},function(aL){h.makeNotice("error","misc-error",aL)})});$("#send-sms").on("show",function(aK,aJ){if(aJ){return}var aI=$(this);r(aI);$.get(resource+"wallet/country_codes.html").success(function(aL){aI.find('select[name="sms-country-code"]').html(aL)}).error(function(){h.makeNotice("error","misc-error","Error Downloading SMS Country Codes")});aI.find(".send").unbind().click(function(){loadScript("wallet/signer.min.js",function(){var aL=initNewTx();startTxUI(aI,"sms",aL)})})});$("#address-book").on("show",function(){var aJ=$("#address-book-tbl tbody");if(av(g)>0){aJ.empty();for(var aI in g){var aK=$("<tr><td>"+g[aI]+'</td><td><div class="addr-book-entry">'+aI+'</div></td><td style="width:16px" class="hidden-phone"><img src="'+resource+'delete.png" class="act-delete" /></td></tr>');(function(aL){aK.find(".act-delete").click(function(){h.deleteAddressBook(aL)})})(aI);aJ.append(aK)}}});$('a[data-toggle="tab"]').unbind().on("show",function(aI){$(aI.target.hash).trigger("show")});$("#receive-coins-btn").click(function(){ab($("#receive-coins"))});$(".show_adv").click(function(){$(".modal:visible").center()})}function p(){$(".resend-code").click(function(){h.setGUID(N,true)});au();$(".auth-0,.auth-1,.auth-2,.auth-3,.auth-4,.auth-5").unbind().keypress(function(aI){if(aI.keyCode==13){aI.preventDefault();$("#restore-wallet-continue").click()}});$("#restore-wallet-continue").unbind().click(function(aJ){aJ.preventDefault();var aI=$.trim($("#restore-guid").val());if(aI.length==0){return}if(N!=aI){h.setGUID(aI,false)}else{a()}});$(".modal").on("show",function(){M();$(this).center()}).on("shown",function(){M();$(this).center()})}function ah(aJ){var aK=Crypto.SHA256(aJ+"?");switch(aK.slice(0,2)){case"00":var aL=Crypto.SHA256(aJ,{asBytes:true});return aL;break;case"01":var aI=Crypto.util.hexToBytes(aK.slice(2,4))[0];var aM=Math.round(Math.pow(2,(aI/4)));var aL=Crypto.PBKDF2(aJ,"Satoshi Nakamoto",32,{iterations:aM,asBytes:true});return aL;break;default:console.log("invalid key");break}}function ay(){var aK,aI="";if(window.getSelection){aK=window.getSelection();if(aK.rangeCount){var aL=aK.getRangeAt(0).cloneContents();var aJ=document.createElement("div");aJ.appendChild(aL);aI=aJ.innerText}}else{if(document.selection&&document.selection.type=="Text"){aI=document.selection.createRange().htmlText}}return aI}this.detectPrivateKeyFormat=function(aJ){if(/^5[123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz]{50}$/.test(aJ)){return"sipa"}if(/^[LK][123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz]{51}$/.test(aJ)){return"compsipa"}if(/^[123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz]{44}$/.test(aJ)||/^[123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz]{43}$/.test(aJ)){return"base58"}if(/^[A-Fa-f0-9]{64}$/.test(aJ)){return"hex"}if(/^[ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789=+\/]{44}$/.test(aJ)){return"base64"}if(/^S[123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz]{21}$/.test(aJ)||/^S[123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz]{25}$/.test(aJ)||/^S[123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz]{29}$/.test(aJ)||/^S[123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz]{30}$/.test(aJ)){var aI=Crypto.SHA256(aJ+"?",{asBytes:true});if(aI[0]===0||aI[0]===1){return"mini"}}throw"Unknown Key Format "+aJ};this.privateKeyStringToKey=function(aJ,aL){var aI=null;if(aL=="base58"){aI=B58.decode(aJ)}else{if(aL=="base64"){aI=Crypto.util.base64ToBytes(aJ)}else{if(aL=="hex"){aI=Crypto.util.hexToBytes(aJ)}else{if(aL=="mini"){aI=ah(aJ)}else{if(aL=="sipa"){var aK=B58.decode(aJ);aK.shift();aI=aK.slice(0,aK.length-4)}else{if(aL=="sipa"){var aK=B58.decode(aJ);aK.shift();aI=aK.slice(0,aK.length-4)}else{if(aL=="compsipa"){var aK=B58.decode(aJ);aK.shift();aK.pop();aI=aK.slice(0,aK.length-4)}else{throw"Unsupported Key Format"}}}}}}}if(aI.length!=32){throw"Result not 32 bytes in length"}return new Bitcoin.ECKey(aI)};$(document).ready(function(){var aJ=$(document.body);ad=aJ.data("payload");N=aJ.data("guid");d=aJ.data("sharedkey");aq=aJ.data("payload-checksum");q=aJ.data("auth-type");if(h.skip_init){return}if(top.location!=self.location){top.location=self.location.href}if(!$.isEmptyObject({})){h.makeNotice("error","error","Object.prototype has been extended by a browser extension. Please disable this extensions and reload the page.");return}$("input,button,select").attr("autocomplete","off");aJ.ajaxStart(function(){$(".loading-indicator").fadeIn(200)}).ajaxStop(function(){$(".loading-indicator").hide()}).click(function(){if(S){clearTimeout(S);S=setTimeout(h.logout,h.getLogoutTime())}rng_seed_time()}).keypress(function(){if(S){clearTimeout(S);S=setTimeout(h.logout,h.getLogoutTime())}rng_seed_time()});p();$(".auth-"+q).show();j=$("#restore-wallet");j.show();var aK=false;var aN=17,aM=86,aI=67,aL=67;$(document).keydown(function(aP){try{if(aP.keyCode==aN||aP.keyCode==aL){aK=true}if(aK&&aP.keyCode==aI){var aO=$.trim(ay());var aQ=J[aO];if(aQ!=null){if(aQ.priv==null){$("#watch-only-copy-warning-modal").modal("show")}else{if(aQ.tag==1){$("#not-synced-warning-modal").modal("show")}}}}}catch(aP){console.log(aP)}}).keyup(function(aO){if(aO.keyCode==aN||aO.keyCode==aL){aK=false}})});this.unArchiveAddr=function(aI){var aI=J[aI];if(aI.tag==2){aI.tag=null;c();ae("update",function(){h.get_history()})}else{h.makeNotice("error","add-error","Cannot Unarchive This Address")}};this.archiveAddr=function(aI){if(h.getActiveAddresses().length<=1){h.makeNotice("error","add-error","You must leave at least one active address");return}var aI=J[aI];if(aI.tag==null||aI.tag==0){aI.tag=2;c();ae("update",function(){h.get_history()})}else{h.makeNotice("error","add-error","Cannot Archive This Address")}};function aH(){$("#receive-coins").find(".tab-pane.active").trigger("show");setupToggle()}this.addWatchOnlyAddress=function(aI){return aF(aI)};this.addPrivateKey=function(aJ,aI){if(af()){return false}if(aJ==null){throw"Unable to generate a new bitcoin address."}if(aI){var aL=aJ.getBitcoinAddressCompressed()}else{var aL=aJ.getBitcoinAddress()}if(aL==null){throw"Generated invalid bitcoin address."}if(aF(aL.toString(),i(aJ.priv))){J[aL].tag=1;try{ws.send('{"op":"addr_sub", "addr":"'+aL+'"}')}catch(aK){}}else{throw"Unable to add generated bitcoin address."}return aL};this.generateNewKey=function(){var aI=new Bitcoin.ECKey(false);if(h.addPrivateKey(aI)){return aI}}};