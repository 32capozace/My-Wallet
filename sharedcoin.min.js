var SharedCoin=new function(){var d=this;var g=0.5;var c=120000;var h=3;var m=0;var l=120000;var n={};var j=3;var k=MyWallet.getSharedcoinEndpoint()+"?version="+j;var f={};var b="sharedcoin-seed-v2:";var a="sharedcoin-seed:";(function(o){o.retryAjax=function(q){var p;q.tryCount=(!q.tryCount)?0:q.tryCount;q.retryLimit=(!q.retryLimit)?2:q.retryLimit;q.suppressErrors=true;if(q.error){p=q.error;delete q.error}else{p=function(){}}q.complete=function(r,s){if(o.inArray(s,["timeout","abort","error"])>-1){this.tryCount++;if(this.tryCount<=this.retryLimit){if(this.tryCount===this.retryLimit){this.error=p;delete this.suppressErrors}o.ajax(this);return true}return true}};o.ajax(q)}}(jQuery));Bitcoin.Transaction.deserialize=function(x){function p(G){var E,F;E=G.splice(0,1)[0];if(E<253){F=[E]}else{if(E==253){F=G.splice(0,2)}else{if(E==254){F=G.splice(0,4)}else{F=G.splice(0,8)}}}return BigInteger.fromByteArrayUnsigned(F)}function A(E){return new BigInteger(E.splice(0,4).reverse()).intValue()}var z=new Bitcoin.Transaction();z.version=A(x);var t=p(x).intValue();for(var y=0;y<t;y++){var u=x.splice(0,32);var r=Crypto.util.bytesToBase64(u);var o=A(x);var w=p(x).intValue();var B=new Bitcoin.Script(x.splice(0,w));var s=A(x);var C=new Bitcoin.TransactionIn({outpoint:{hash:r,index:o},script:B,sequence:s});z.ins.push(C)}var D=p(x).intValue();for(var y=0;y<D;y++){var q=x.splice(0,8);var w=p(x).intValue();var B=new Bitcoin.Script(x.splice(0,w));var v=new Bitcoin.TransactionOut({script:B,value:q});z.outs.push(v)}z.lock_time=A(x);return z};function i(s,v){var t=[];var o=Math.round(s*1/v);var u=Math.round(0.5*o);var q=0;for(var p=0;p<v;p++){var r=Math.floor((Math.random()*o)+u);if(q+r>s||p==v-1){r=s-q}q+=r;t[p]=r;if(q==s){break}}return t}var e={show:function(){var o=this;o.modal=$("#sharedcoin-modal");o.modal.modal({keyboard:false,backdrop:"static",show:true});o.modal.find(".btn.btn-secondary").unbind().click(function(){o.hide()})},setAddressAndAmount:function(o,p){if(this.modal){this.modal.find(".total_value").text(formatBTC(p));this.modal.find(".address").text(o)}},hide:function(){if(this.modal){this.modal.modal("hide")}},disableCancel:function(){if(this.modal){this.modal.find(".alert-warning").show();this.modal.find(".alert-error").hide();this.modal.find(".btn.btn-secondary").prop("disabled",true)}},enableCancel:function(){if(this.modal){this.modal.find(".alert-error").show();this.modal.find(".alert-warning").hide();this.modal.find(".btn.btn-secondary").prop("disabled",false)}}};this.newProposal=function(){return{_pollForCompleted:function(q,p){var o=this;console.log("Offer._pollForCompleted()");MyWallet.setLoadingText("Waiting For Other Participants To Sign");$.retryAjax({dataType:"json",type:"POST",url:k,timeout:c,retryLimit:4,data:{method:"poll_for_proposal_completed",format:"json",proposal_id:o.proposal_id},success:function(r){q(r)},error:function(r){p(r.responseText)}})},pollForCompleted:function(r,p){var o=this;var q=function(s){if(s.status=="waiting"){o._pollForCompleted(q,p)}else{if(s.status=="not_found"){p("Proposal ID Not Found")}else{if(s.status=="complete"){r(s.tx_hash,s.tx)}else{p("Unknown status "+s.status)}}}};o._pollForCompleted(q,p)}}};this.newOffer=function(){return{offered_outpoints:[],request_outputs:[],offer_id:0,fee_percent:BigInteger.ZERO,submit:function(r,q,o){var p=this;MyWallet.setLoadingText("Submitting Offer");$.retryAjax({dataType:"json",type:"POST",url:k,timeout:c,retryLimit:h,data:{method:"submit_offer",fee_percent:p.fee_percent.toString(),format:"json",token:d.getToken(),offer:JSON.stringify(p)},success:function(s){if(s.status=="complete"){o(s.tx_hash,s.tx)}else{if(!s.offer_id){q("Null offer_id returned")}else{p.offer_id=s.offer_id;r()}}},error:function(s){q(s.responseText)}})},_pollForProposalID:function(q,p){var o=this;console.log("Offer._pollForProposalID()");MyWallet.setLoadingText("Waiting For Other Participants");$.retryAjax({dataType:"json",type:"POST",url:k,timeout:c,retryLimit:h,data:{method:"get_offer_id",format:"json",offer_id:o.offer_id},success:function(r){q(r)},error:function(r){p(r.responseText)}})},calculateFee:function(){var o=this;var r=BigInteger.ZERO;for(var p in o.offered_outpoints){r=r.add(BigInteger.valueOf(o.offered_outpoints[p].value))}var q=BigInteger.ZERO;for(var p in o.request_outputs){q=q.add(BigInteger.valueOf(o.request_outputs[p].value))}return r.subtract(q)},pollForProposalID:function(r,p){var o=this;var q=function(s){if(s.status=="waiting"){o._pollForProposalID(q,p)}else{if(s.status=="not_found"){p("Offer ID Not Found")}else{if(s.status=="active_proposal"){r(s.proposal_id)}else{p("Unknown status "+s.status)}}}};o._pollForProposalID(q,p)},getProposal:function(r,s,q,o){var p=this;console.log("SharedCoin.getProposal()");MyWallet.setLoadingText("Fetching Proposal");$.retryAjax({dataType:"json",type:"POST",url:k,timeout:c,retryLimit:h,data:{method:"get_proposal_id",format:"json",offer_id:p.offer_id,proposal_id:r},success:function(u){var t=d.newProposal();var v=jQuery.extend(t,u);if(v.status=="not_found"){q("Proposal or Offer ID Not Found")}else{if(v.status=="complete"){o(v.tx_hash,v.tx)}else{if(v.status=="signatures_needed"){s(v)}else{if(v.status=="waiting"){p.getProposal(r,s,q,o)}else{q("Unknown get_proposal_id status")}}}}},error:function(t){q(t.responseText)}})},isOutpointOneWeOffered:function(p){var o=this;var r=p.outpoint.hash;var u=Crypto.util.bytesToHex(Crypto.util.base64ToBytes(r).reverse());var q=p.outpoint.index;for(var s in o.offered_outpoints){var t=o.offered_outpoints[s];if(t.hash.toString()==u.toString()&&t.index.toString()==q.toString()){return true}}return false},isOutputOneWeRequested:function(q){var p=this;var u=q.value.slice(0);u.reverse();var o=Crypto.util.bytesToHex(q.script.buffer);var t=new BigInteger(u);for(var r in p.request_outputs){var s=p.request_outputs[r];if(s.script.toString()==o.toString()&&t.toString()==s.value.toString()){return true}}return false},isOutputChange:function(q){var p=this;var u=q.value.slice(0);u.reverse();var o=Crypto.util.bytesToHex(q.script.buffer);var t=new BigInteger(u);for(var r in p.request_outputs){var s=p.request_outputs[r];if(s.script.toString()==o.toString()&&t.toString()==s.value.toString()){return s.exclude_from_fee}}return false},determineOutputsToOfferNextStage:function(u,y,v){var z=this;try{var p=Crypto.util.hexToBytes(u);var r=Bitcoin.Transaction.deserialize(p);var w=[];for(var q=0;q<r.outs.length;++q){var o=r.outs[q];if(z.isOutputOneWeRequested(o)){if(!z.isOutputChange(o)){var t=o.value.slice(0);t.reverse();var x=new BigInteger(t);w.push({hash:null,index:parseInt(q),value:x.toString()})}}}y(w)}catch(s){v(s)}},checkProposal:function(v,x,w){console.log("Offer.checkProposal()");var z=this;try{if(v.tx==null){throw"Proposal Transaction Is Null"}var r=Crypto.util.hexToBytes(v.tx);var t=Bitcoin.Transaction.deserialize(r);if(t==null){throw"Error deserializing transaction"}var y=0;for(var s=0;s<t.outs.length;++s){var q=t.outs[s];if(z.isOutputOneWeRequested(q)){++y}}if(y<z.request_outputs.length){throw"Could not find all our requested outputs ("+y+" < "+z.request_outputs.length+")"}var p=0;for(var s=0;s<v.signature_requests.length;++s){var o=v.signature_requests[s].tx_input_index;if(z.isOutpointOneWeOffered(t.ins[o])){++p}}if(z.offered_outpoints.length!=p){throw"Could not find all our offered outpoints ("+z.offered_outpoints.length+" != "+p+")"}x(t)}catch(u){w(u)}},signNormal:function(o,s,u,r){console.log("Offer.signNormal()");var q=0;var t=[];var p=function(){setTimeout(function(){try{var v=s[q];if(v==null){throw"Null connected script"}var x=signInput(o,v.tx_input_index,v.priv_to_use,v,SIGHASH_ALL);if(x){q++;t.push({tx_input_index:v.tx_input_index,input_script:Crypto.util.bytesToHex(x.buffer),offer_outpoint_index:v.offer_outpoint_index});if(q==s.length){u(t)}else{p()}}else{throw"Unknown error signing transaction"}}catch(w){r(w)}},1)};p()},submitInputScripts:function(r,s,t,q,o){console.log("Offer.submitInputScripts()");var p=this;MyWallet.setLoadingText("Submitting Signatures");m=new Date().getTime();$.retryAjax({dataType:"json",type:"POST",url:k,timeout:c,retryLimit:h,data:{method:"submit_signatures",format:"json",input_scripts:JSON.stringify(s),offer_id:p.offer_id,proposal_id:r.proposal_id},success:function(u){if(u.status=="not_found"){q("Proposal Expired or Not Found")}else{if(u.status=="verification_failed"){q("Signature Verification Failed")}else{if(u.status=="complete"){o(u.tx_hash,u.tx)}else{if(u.status=="signatures_accepted"){t("Signatures Accepted")}else{q("Unknown status "+u.status)}}}}},error:function(u){q(u.responseText)}})},signInputs:function(w,t,z,x){console.log("Offer.signInputs()");var A=this;try{var u={};var p=[];for(var s=0;s<w.signature_requests.length;++s){var r=w.signature_requests[s];var y=new Bitcoin.Script(Crypto.util.hexToBytes(r.connected_script));if(y==null){throw"signInputs() Connected script is null"}y.tx_input_index=r.tx_input_index;y.offer_outpoint_index=r.offer_outpoint_index;var o=y.simpleOutPubKeyHash();var q=new Bitcoin.Address(o).toString();if(u[q]){y.priv_to_use=u[q]}else{if(f[q]){y.priv_to_use=Bitcoin.Base58.decode(f[q])}else{if(MyWallet.addressExists(q)&&!MyWallet.isWatchOnly(q)){y.priv_to_use=MyWallet.decodePK(MyWallet.getPrivateKey(q))}}}if(y.priv_to_use==null){throw"Private key not found"}else{u[q]=y.priv_to_use}p.push(y)}A.signNormal(t,p,function(B){z(B)},function(B){x(B)})}catch(v){x(v)}}}};this.generateAddressAndKeyFromCustomSeed=function(p,s){var r=Crypto.SHA256(p+s,{asBytes:true});var q=new Bitcoin.ECKey(r);if(p.indexOf(b)==0){var o=q.getBitcoinAddressCompressed()}else{if(r[0]%2==0){var o=q.getBitcoinAddress()}else{var o=q.getBitcoinAddressCompressed()}}return{address:o,key:q}};this.generateAddressFromCustomSeed=function(p,q){var o=this.generateAddressAndKeyFromCustomSeed(p,q);f[o.address.toString()]=Bitcoin.Base58.encode(o.key.priv);return o.address};this.newPlan=function(){return{offers:[],n_stages:0,c_stage:0,address_seed:null,address_seen_n:0,generated_addresses:[],fee_percent_each_repetition:[],fee_each_repetition:[],generateAddressFromSeed:function(){if(this.address_seed==null){MyWallet._seed();var p=new Array(18);new SecureRandom().nextBytes(p);this.address_seed=Crypto.util.bytesToHex(p);MyWallet.addAdditionalSeeds(b+this.address_seed)}var o=d.generateAddressFromCustomSeed(b+this.address_seed,this.address_seen_n);this.address_seen_n++;return o},generateChangeAddress:function(){var p=MyWallet.generateNewKey();if(!p||!p.addr){throw"Error Generating Change Address"}var o=p.addr;this.generated_addresses.push(o);return new Bitcoin.Address(o)},executeOffer:function(q,r,p){function o(t,s){console.log("executeOffer.complete");q.determineOutputsToOfferNextStage(s,function(v){for(var u in v){v[u].hash=t}r(v)},p)}q.submit(function(){console.log("Successfully Submitted Offer");q.pollForProposalID(function(s){console.log("Proposal ID "+s);q.getProposal(s,function(t){console.log("Got Proposal");q.checkProposal(t,function(u){console.log("Proposal Looks Good");q.signInputs(t,u,function(v){console.log("Inputs Signed");q.submitInputScripts(t,v,function(w){console.log("Submitted Input Scripts");t.pollForCompleted(o,p)},p,o)},p)},p)},p,o)},p)},p,o)},execute:function(r,p){var o=this;var q=function(s){o.c_stage=s;var u=o.offers[s];console.log("Executing Stage "+s);var t=function(v){s++;if(s<o.n_stages){o.offers[s].offered_outpoints=v;q(s)}else{if(s==o.n_stages){r()}}};o.executeOffer(u,t,function(v){console.log("executeOffer failed "+v);setTimeout(function(){o.executeOffer(u,t,p)},5000)})};MyWallet.backupWallet("update",function(){console.log("Saved Wallet");var v=MyWallet.getAdditionalSeeds();var u=false;for(var t in v){var s=v[t];if(s.indexOf(o.address_seed)>=0){u=true;break}}if(!u){p("Address Seed Not Found")}else{q(0)}},p)},constructRepetitions:function(t,A,O){try{var L=this;var B=BigInteger.ZERO;for(var P in t.offered_outpoints){B=B.add(BigInteger.valueOf(t.offered_outpoints[P].value))}var r=B;var G=BigInteger.ZERO;for(var H=0;H<L.n_stages-1;++H){var p=d.newOffer();if(H==0){for(var P in t.request_outputs){if(t.request_outputs[P].exclude_from_fee){var E=t.request_outputs.splice(P,1)[0];G=BigInteger.valueOf(E.value);r=r.subtract(G);break}}p.offered_outpoints=t.offered_outpoints.slice(0);t.offered_outpoints=[]}p.fee_percent=L.fee_percent_each_repetition[H];r=r.subtract(L.fee_each_repetition[H]);var y=[10,5,1,0.5,0.3,0.1];var I=8;var T=Math.random();if(r.intValue()>=0.2*satoshi){var M=2;if(T>=0.5){M=3}}else{var M=1}var R=BigInteger.ZERO;var u=100;if(G.compareTo(BigInteger.ZERO)<0){throw"totalChangeValueLeftToConsume < 0"}else{if(G.compareTo(BigInteger.ZERO)>0){R=G.divide(BigInteger.valueOf(100)).multiply(BigInteger.valueOf(u))}}console.log("changeValue "+R.toString());if(R.compareTo(BigInteger.valueOf(d.getMinimumOutputValue()))<=0||G.subtract(R).compareTo(BigInteger.valueOf(d.getMinimumOutputValue()))<=0){R=G;G=BigInteger.ZERO}else{G=G.subtract(R)}if(G.compareTo(BigInteger.ZERO)<0){throw"totalChangeValueLeftToConsume < 0"}var s=r.add(G);var C=false;for(var q=0;q<1000;++q){for(var J in y){var x=(y[J]/100)*((Math.random()*30)-15);var v=BigInteger.valueOf(Math.round((y[J]+x)*satoshi));var F=s.divideAndRemainder(v);var o=F[0].intValue();if(o>d.getMaximumOfferNumberOfOutputs()){continue}if(o>=M&&o<=I){if(F[1].compareTo(BigInteger.ZERO)==0||F[1].compareTo(BigInteger.valueOf(d.getMinimumOutputValue()))>=0){var D=[];if(F[1].compareTo(BigInteger.ZERO)>0){if(o<=1){if(F[1].compareTo(d.getMinimumInputValue())<0||F[1].compareTo(d.getMaximumOutputValue())>0){continue}var w=L.generateAddressFromSeed();p.request_outputs.push({value:F[1].toString(),script:Crypto.util.bytesToHex(Script.createOutputScript(w).buffer)})}else{D=i(F[1].intValue(),o)}}var S=true;for(var K=0;K<o;++K){var N=v;if(D[K]&&D[K]>0){N=N.add(BigInteger.valueOf(D[K]))}if(N.compareTo(d.getMinimumInputValue())<0||N.compareTo(d.getMaximumOutputValue())>0){S=false;break}}if(!S){continue}for(var K=0;K<o;++K){var w=L.generateAddressFromSeed();var N=v;if(D[K]&&D[K]>0){N=N.add(BigInteger.valueOf(D[K]))}p.request_outputs.push({value:N.toString(),script:Crypto.util.bytesToHex(Script.createOutputScript(w).buffer)})}C=true;break}}}if(C){break}}if(!C){var w=L.generateAddressFromSeed();p.request_outputs.push({value:s.toString(),script:Crypto.util.bytesToHex(Script.createOutputScript(w).buffer)})}if(R.compareTo(BigInteger.ZERO)>0){var z=L.generateChangeAddress();if(R.compareTo(BigInteger.valueOf(d.getMinimumOutputValueExcludingFee()))<0){throw"Change Value Too Small 0 ("+R.toString()+" < "+d.getMinimumOutputValueExcludingFee()+")"}p.request_outputs.push({value:R.toString(),script:Crypto.util.bytesToHex(Script.createOutputScript(z).buffer),exclude_from_fee:true})}L.offers.push(p)}if(G.compareTo(BigInteger.ZERO)>0){var z=L.generateChangeAddress();if(G.compareTo(BigInteger.valueOf(d.getMinimumOutputValueExcludingFee()))<0){throw"Change Value Too Small 1 ("+G.toString()+" < "+d.getMinimumOutputValueExcludingFee()+")"}t.request_outputs.push({value:G.toString(),script:Crypto.util.bytesToHex(Script.createOutputScript(z).buffer),exclude_from_fee:true})}L.offers.push(t);A(L)}catch(Q){O(Q)}}}};this.getMaximumOfferNumberOfInputs=function(){return n.maximum_offer_number_of_inputs};this.getMaximumOfferNumberOfOutputs=function(){return n.maximum_offer_number_of_outputs};this.getMinimumOutputValue=function(){return n.minimum_output_value};this.getMinimumOutputValueExcludingFee=function(){return n.minimum_output_value_exclude_fee};this.getToken=function(){return n.token};this.getMinimumInputValue=function(){return n.minimum_input_value};this.getMinimumSupportedVersion=function(){return n.min_supported_version};this.getIsEnabled=function(){return n.enabled};this.getMaximumOutputValue=function(){return n.maximum_output_value};this.getFee=function(){return n.fee_percent};this.getMinimumFee=function(){return n.minimum_fee?n.minimum_fee:0};this.constructPlan=function(r,z,G){try{var E=this;var H=r.find('select[name="repetitions"]');var q=r.find('input[name="shared-coin-donate"]').is(":checked");console.log("donate "+q);var B=parseInt(H.val());if(B<=0){throw"invalid number of repetitions"}var t=d.newPlan();function v(O){for(var N in t.generated_addresses){MyWallet.deleteAddress(t.generated_addresses[N])}G(O)}var K=initNewTx();var s=r.find('select[name="from"]');var u=s.val();if(u==null||u=="any"){K.from_addresses=MyWallet.getActiveAddresses()}else{if(s.attr("multiple")=="multiple"){K.from_addresses=u}else{K.from_addresses=[u]}}var A=r.find(".recipient");A.each(function(){try{var U=$(this);var S=U.find('input[name="send-value"]');var P=U.find('input[name="send-to-address"]');var Q=0;try{Q=precisionToSatoshiBN(S.val());if(Q==null||Q.compareTo(BigInteger.ZERO)<=0){throw"You must enter a value greater than zero"}}catch(R){throw"Invalid send amount"}var N=$.trim(P.val()).replace(/[\u200B-\u200D\uFEFF]/g,"");if(N==null||N.length==0){throw"You must enter a bitcoin address for each recipient"}var O=resolveAddress(N);if(O==null||O.length==0){throw"You must enter a bitcoin address for each recipient"}var T=new Bitcoin.Address(O);if(T.version!=0){throw"Sharedcoin only supports sending payments to regular bitcoin addresses"}K.to_addresses.push({address:T,value:Q})}catch(R){v(R)}});if(K.to_addresses.length==0||K.to_addresses.length<A.length){return}var o=[];var x=[];var J=[];for(var I in K.to_addresses){var M=K.to_addresses[I];o.push(M.value);for(var C=B-1;C>=0;--C){var y=d.getFee();if(C==0&&q){y+=g}J[C]=y;var F=d.calculateFeeForValue(y,M.value);M.value=M.value.add(F);var D=x[C];if(D){x[C]=D.add(F)}else{x[C]=F}}}var w=t.generateAddressFromSeed();K.min_input_confirmations=1;K.do_not_use_unspent_cache=true;K.allow_adjust=false;K.change_address=w;K.base_fee=BigInteger.ZERO;K.min_input_size=BigInteger.valueOf(d.getMinimumInputValue());K.min_free_output_size=BigInteger.valueOf(satoshi);K.fee=BigInteger.ZERO;K.ask_for_fee=function(O,N){N()};var p=d.newOffer();K.addListener({on_error:function(N){v()}});K.signInputs=function(){try{var X=this;if(X.tx.ins.length>d.getMaximumOfferNumberOfInputs()){v("Maximum number of inputs exceeded. Please consolidate some or lower the send amount");return}for(var Q=0;Q<X.tx.ins.length;++Q){var V=X.tx.ins[Q];var O=V.outpoint.hash;var U=Crypto.util.bytesToHex(Crypto.util.base64ToBytes(O).reverse());p.offered_outpoints.push({hash:U,index:V.outpoint.index,value:V.outpoint.value.toString()})}for(var Q=0;Q<X.tx.outs.length;++Q){var P=X.tx.outs[Q];var T=P.value.slice(0);T.reverse();var W=new BigInteger(T);var N=new Bitcoin.Script(P.script).simpleOutPubKeyHash();var S=new Bitcoin.Address(N).toString();if(S.toString()==w.toString()){if(W.compareTo(BigInteger.valueOf(d.getMinimumOutputValueExcludingFee()))<0){throw"Change Value Too Small 3 ("+W.toString()+" < "+d.getMinimumOutputValueExcludingFee()+")"}p.request_outputs.push({value:W.toString(),script:Crypto.util.bytesToHex(P.script.buffer),exclude_from_fee:true})}else{if(o[Q].compareTo(BigInteger.valueOf(d.getMinimumOutputValue()))<0){throw"Output Value Too Small"}p.request_outputs.push({value:o[Q].toString(),script:Crypto.util.bytesToHex(P.script.buffer)})}}t.n_stages=B;t.c_stage=0;t.fee_each_repetition=x;t.fee_percent_each_repetition=J;t.constructRepetitions(p,z,function(Y){v(Y)})}catch(R){v(R)}};K.start()}catch(L){v(L)}};this.calculateFeeForValue=function(s,p){var q=BigInteger.valueOf(d.getMinimumFee());if(p.compareTo(BigInteger.ZERO)>0&&s>0){var r=Math.ceil(100/s);var o=p.divide(BigInteger.valueOf(r));if(q.compareTo(o)>0){return q}else{return o}}else{return q}};this.recoverSeeds=function(r,s,u){var v=$("#sharedcoin-recover-progress-modal");var o=v.find(".bar");v.modal("show");o.width("0%");var q=function(y){v.modal("hide");u(y)};var x=function(y){v.modal("hide");s(y)};var p=0;var w=0;function t(){if(!v.is(":visible")){return}if(p>=r.length){if(w>0){MyWallet.get_history();MyWallet.makeNotice("success","misc-success",formatBTC(w)+" recovered from intermediate addresses")}x();return}o.width(((p/r.length)*100)+"%");var A=r[p];++p;var C={};for(var B=0;B<100;++B){var z=d.generateAddressAndKeyFromCustomSeed(A,B);var y=z.address.toString();if(!MyWallet.addressExists(y)){C[y]=z.key}}BlockchainAPI.get_balances(Object.keys(C),function(G){try{var H=0;for(var E in G){var I=G[E].final_balance;if(I>0){console.log("Balance "+E+" = "+I);var D=C[E];var F=D.getBitcoinAddress().toString();try{if(MyWallet.addPrivateKey(D,{compressed:E!=F,app_name:IMPORTED_APP_NAME,app_version:IMPORTED_APP_VERSION})){console.log("Imported "+E)}}catch(J){console.log("Error importing "+E)}}H+=I}if(H>0){w+=H;MyWallet.backupWalletDelayed("update",function(){setTimeout(t,500)})}else{setTimeout(t,500)}}catch(J){q(J)}},q)}setTimeout(t,100)};this.init=function(q){$("#sharedcoin-recover").unbind().click(function(){var u=$(this);MyWallet.getSecondPassword(function(){u.prop("disabled",true);var y=u.text();u.text("Working. Please Wait...");var z=MyWallet.getAdditionalSeeds();var v=[];for(var x in z){var w=z[x];if(w.indexOf(b)==0||w.indexOf(a)==0){v.push(w)}}v.reverse();d.recoverSeeds(v,function(){u.prop("disabled",false);u.text(y)},function(A){u.prop("disabled",false);u.text(y);MyWallet.makeNotice("error","misc-error",A)})})});var t=q.find(".send");var r=q.find(".send-options");var p=q.find('select[name="repetitions"]');t.unbind().prop("disabled",true);q.find('input[name="send-value"]').bind("keyup change",function(){o()});r.hide();function s(){var u=r.find("span");u.eq(0).text(formatBTC(d.getMaximumOutputValue()));u.eq(1).text(formatBTC(d.getMinimumOutputValue()));u.eq(2).text(d.getFee());u.eq(3).text(formatBTC(d.getMinimumFee()));r.show()}function o(){t.unbind();var v=parseInt(p.val());if(v>0&&d.getIsEnabled()&&j>=d.getMinimumSupportedVersion()){var u=precisionToSatoshiBN(q.find('input[name="send-value"]').val());if(u.compareTo(BigInteger.valueOf(d.getMinimumOutputValue()))<0){t.prop("disabled",true)}else{if(u.compareTo(BigInteger.valueOf(d.getMaximumOutputValue()))>0){t.prop("disabled",true)}else{t.prop("disabled",false);t.unbind().click(function(){MyWallet.disableLogout(true);var w=function(z,y){q.find("input,select,button").prop("disabled",false);o();MyWallet.disableLogout(false);MyWallet.makeNotice("error","misc-error",z);setTimeout(function(){if(y&&y.c_stage>=0){console.log("Recover Seeds");e.hide();d.recoverSeeds([b+y.address_seed],function(){e.show()},function(){e.show()})}},1000);e.enableCancel()};var x=function(){q.find("input,select,button").prop("disabled",false);MyWallet.makeNotice("success","misc-success","Sharedcoin Transaction Successfully Completed");MyWallet.disableLogout(false);e.hide();o()};if(u.compareTo(BigInteger.valueOf(d.getMinimumOutputValue()))<0){MyWallet.makeNotice("error","misc-error","The Minimum Send Value is "+formatPrecision(d.getMinimumOutputValue()));return}else{if(u.compareTo(BigInteger.valueOf(d.getMaximumOutputValue()))>0){MyWallet.makeNotice("error","misc-error","The Maximum Send Value is "+formatPrecision(d.getMaximumOutputValue()));return}}MyWallet.getSecondPassword(function(){loadScript("wallet/signer",function(){e.show();e.disableCancel();var B=precisionToSatoshiBN(q.find('input[name="send-value"]').val());var z=q.find('input[name="send-to-address"]').val();e.setAddressAndAmount(z,B);q.find("input,select,button").prop("disabled",true);MyWallet.setLoadingText("Constructing Plan. Please Wait.");var y=new Date().getTime()-m;var A=Math.max(0,l-y);if(A>0){$(".loading-indicator").fadeIn(200)}setTimeout(function(){$(".loading-indicator").hide();d.constructPlan(q,function(C){console.log("Created Plan");console.log(C);C.execute(x,function(D){w(D,C)})},w)},A)},w)},w)})}}}else{t.prop("disabled",true)}}MyWallet.setLoadingText("Fetching SharedCoin Info");$.retryAjax({dataType:"json",type:"POST",url:k,timeout:c,retryLimit:h,data:{method:"get_info",format:"json"},success:function(w){try{n=w;if(!d.getIsEnabled()){throw"Shared Coin is currently disabled"}if(j<d.getMinimumSupportedVersion()){throw"Version out of date. Please update your client or reload the page."}s();p.empty();for(var u=w.recommended_min_iterations;u<=w.recommended_max_iterations;u+=1){p.append('<option value="'+(u)+'">'+(u)+" Repetitions</option>")}p.val(w.recommended_iterations)}catch(v){MyWallet.makeNotice("error","misc-error",v)}o()},error:function(u){t.prop("disabled",true);MyWallet.makeNotice("error","misc-error",u.responseText)}});o()}};